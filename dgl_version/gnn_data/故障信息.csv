Description,Cause,Suggestion
 •对设备进行每日巡检时，连续使用displaycpu-usage命令查看CPU的占用率，CPU占 执行#displaycpu-usa(用率明显比日常平均值高。)gesummary命令显示最近5秒、1分钟、5分钟内CPU占用率 的平均值。 <Sysname>displaycpu-usagesummary CPULast5secLast1minLast5min 05%5%4% #执行displaycpu-usagehistory命令以图表的方式显示最近60个采样点的CPU占用率，观察到CPU占用率持续在增长或者明显比日常平均值高。 •通过Telnet/SSH等方式登录设备，并执行命令行时，设备反应缓慢，出现卡顿现象。 •设备上打印CPU占用率高的相关日志。 ,"本类故障的常见原因主要包括： •协议震荡，通常为STP震荡、路由协议震荡等。 •网络环路。 •设备产生海量日志，设备生成和管理这些日志需要占用大量CPU资源。 3.故障分析 本类故障的诊断流程如图4-4所示。 图4-4CPU占用率高的故障诊断流程图 4.处理步骤 (1)确认设备是否出现协议震荡。协议震荡会导致设备不断地处理协议报文、计算拓扑、更新表项，引起CPU占用率高。在实际应用中，最常见的协议震荡为STP协议震荡和OSPF协议震荡。 对于STP协议震荡，在系统视图执行stpport-log命令打开端口状态变化日志显示开关，如果命令行界面频繁输出以下日志，则说明出现了STP协议震荡。 STP/6/STP_DETECTED_TC:Instance0'sportGigabitEthernet1/0/1detectedatopologychange. STP/6/STP_DISCARDING:Instance0'sportGigabitEthernet1/0/1hasbeensettodiscardingstate. STP/6/STP_NOTIFIED_TC:Instance0'sportGigabitEthernet1/0/1wasnotifiedatopologychange. −如果STP协议震荡，请先排除STP协议震荡问题。 对(−)OSPF协议震荡，执行于displayip(如果STP协议没有震荡，则继续定位。)routing-table命令，查看路由信息。如果路由表项中相同网段的路由条目被频繁反复地创建和删除，则表示路由震荡。 −如果路由震荡，或者路由一直不存在，则先排除链路问题和IGP路由问题。−如果路由没有震荡，则执行步骤（2）。 (2)确认是否存在网络环路。 当以太网接口工作在二层模式并且链路存在环路时，可能出现广播风暴和网络振荡。大量的协议报文上送CPU处理，从而导致CPU占用率升高。当存在网络环路时，设备很多端口的流量会明显变大，且广播和组播报文占比较大。可通过以下步骤来确认设备是否存在网络环路，设备是否存在广播、组播、未知单播报文风暴。a.清除接口的统计信息。 <Sysname>resetcountersinterface b.多次执行displaycountersrateinboundinterface命令查看端口使用率是否 明显增大。 <Sysname>displaycountersrateinboundinterfaceUsage:Bandwidthutilizationinpercentage InterfaceUsage(%)Total(pps)Broadcast(pps)Multicast(pps)GE5/3/00.017---- MGE0/31/00.011----MGE0/32/00.015----VMC1/1/00.0560---- VMC1/2/00.0452---- Overflow:Morethan14digits.--:Notsupported. c.如果端口使用率明显增大，可继续多次执行displaycountersinboundinterface 命令查看接口收到的总报文数、广播和组播报文的数量，分别对应显示信息中Total(pkt)、Broadcast(pkt)、Multicast(pkt)字段的取值。如果广播和组播报文的增长速度快，广播、组播报文在接口收到的总报文数中占比大，则可能出现广播/组播风暴。如果广播和组播报文数量没有明显增加，但是接口收到的总报文数明显增加，则可能出现未知单播报文风暴。 <Sysname>displaycountersinboundinterface InterfaceTotal(pkt)Broadcast(pkt)Multicast(pkt)Err(pkt)GE5/3/0141271110MGE0/31/0274866476960-- MGE0/32/010630346848082--VMC1/1/0111577977274558500 VMC1/2/096538985619640520 Overflow:Morethan14digits(7digitsforcolumn""Err""). --:Notsupported. 如链路出现环路，可进行如下处理： −排查链路连接，避免物理拓扑出现环路。 −使用displaystp命令检查STP协议是否使能，配置是否正确。如果配置错误，请 −使用displ(修改配置。)aystpbrief和displaystpabnormal-port命令检查邻接设备STP状态是否正常。请根据displaystpabnormal-port命令显示信息中的BlockReason字段的取值，定位并解决STP异常问题。如STP配置均正确，可能为STP协议计算错误或协议计算正确但端口驱动层没有正常Block阻塞，可以在发生环路的接口上执行shutdown/undoshutdown命令或者拔插网线让STP重新计算来快速恢复STP功能，消除环路。 −在以太网接口视图下，使用broadcast-suppression命令开启端口广播风暴抑制功能，使用multicast-suppression命令开启端口组播风暴抑制功能，使用unicast-suppression命令开启端口未知单播风暴抑制功能。或者使用flow-control命令配置流量控制功能。 如未出现环，请执行步骤(3）。 (3)确认设备当前是否正在生成海量日志。某些异常情况下，例如，设备受到攻击、运行中发生了错误、端口频繁Up/Down等，设备会不停地产生诊断信息或日志信息。此时系统软件要频繁的读写存储器，会造成CPU占用率升高。 允许日志信息输出到当前终端。 <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 配置该命令后，如果有大量异常日志或者重复日志输出到命令行界面，则说明设备正在生 重复执行dis(成海量日志。)playlogbuffersummary命令，如果日志信息总量有明显的增加，再使用displaylogbufferreverse命令查看日志详情，确认是否有大量异常日志或者某一条信息大量重复出现。 <Sysname>displaylogbuffersummary EMERGALERTCRITERRORWARNNOTIFINFODEBUG 002924121280 0004172820 004211147400 <Sysname>displaylogbufferreverse Logbuffer:Enabled Maxbuffersize:1024 Actualbuffersize:512 Droppedmessages:0 Overwrittenmessages:0 Currentmessages:410 %Jan1508:17:24:2592021SysnameSHELL/6/SHELL_CMD: -Line=vty0-IPAddr=192.168.2.108-User=**;Commandisdisplaylogbuffer %Jan1508:17:19:7432021SysnameSHELL/4/SHELL_CMD_MATCHFAIL: -User=**-IPAddr=192.168.2.108;Commanddisplaylogfileinviewshellfailedtobematched. ... 如果设备正在生成海量日志，可以通过以下方法减少日志的生成： ess命令禁止指定模块日志的输出。 使用info-centerloggingsuppressduplicates命令开启重复日志抑制功能。如果设备未生成海量日志，则执行步骤（4）。 (4)收集CPU占用率相关信息，找到CPU占用率高的业务模块。 a.确定对CPU占用率高的任务。 #在设备上执行displayprocesscpu命令查看一段时间内占用CPU最多的任务。 <Sysname>displayprocesscpu CPUutilizationin5secs:0.5%;1min:0.6%;5mins:0.4% JID5Sec1Min5MinName 10.0%0.0%0.0%scmd ...如果某个进程的CPU占用率高于3%（经验值供参考），则需要针对该进程继续定位。#在设备上执行monitorprocessdumbtty命令实时查看进程在指定CPU上的占用率。 <Sysname>system-view [Sysname]monitorprocessdumbtty 319processes;411threads;2093fdsThreadstates:1running,410sleeping,0stopped,0zombieCPU0:90.10%idle,4.50%user,5.40%kernel,0.00%interrupt,0.00%stealCPU1:99.10%idle,0.00%user,0.90%kernel,0.00%interrupt,0.00%stealCPU2:100.00%idle,0.00%user,0.00%kernel,0.00%interrupt,0.00%stealCPU3:100.00%idle,0.00%user,0.00%kernel,0.00%interrupt,0.00%stealMemory:967Mtotal,381Mavailable,pagesize4KJIDPIDPRIStateFDsMEMHH:MM:SSCPUName856856120S2014956K00:03:281.42%diagd11120S1918764K00:00:160.15%scmd294294120S00K00:02:150.15%[kworker/1:1 … −在monitorprocessdumbtty命令显示信息中找到CPU占用率超过3%（经验值供参考）的进程的JID，再对这些进程执行displayprocessjob命令，收集进程的详细信息，并确认该进程是否运行在控制核上。 如果displayprocessjob命令的显示信息中LAST_CPU字段的取值为控制核的编号（例如0～1），则说明该进程运行在CPU控制核上，则需要进一步定位；如果显示信息中LAST_CPU字段的取值为非控制核的编号，则说明该进程运行在CPU转发核上，无需关注，请执行步骤（5）。下面以pppd进程为例，通过显示信息可以看到，该进程包含多个线程，这些线程都运行在控制核上。 <Sysname>displayprocessnamepppd JobID:515PID:515 ParentJID:1 ParentPID:1 Executablepath:/sbin/pppd Instance:0 Respawn:ON Respawncount:1 Max.spawnsperminute:12 Laststarted:WedNov309:52:002021 Processstate:sleeping Max.core:1 ARGS:--MaxTotalLimit=2000000 --MaxIfLimit=65534--CmdOption=0x01047fbf--bSaveRunDb--pppoechastenflag=1 --pppoechastennum=6--pppoechastenperiod=60--pppoechastenblocktime=300 --pppchastenflag=1--pppchastennum=6--pppchastenperiod=60 --pppchastenblocktime=300--PppoeKChasten--bSoftRateLimit--RateLimitToken=2048 TIDLAST_CPUStackPRIStateHH:MM:SS:MSECName 5150136K115S0:0:0:90pppd 5490136K115S0:0:0:0ppp_misc 5570136K115S0:0:0:10ppp_chasten 6100136K115S0:0:0:0ppp_work0 6111136K115S0:0:0:0ppp_work1 6121136K115S0:0:0:0ppp_work2 6131136K115S0:0:0:0mp_main 6181136K115S0:0:0:110pppoes_main 6191136K115S0:0:0:100pppoes_mesh 6201136K115S0:0:0:120l2tp_mesh6211136K115S0:0:0:20l2tp_main −对于运行在控制核、CPU占用率超过5%的进程，查看进程的Name字段的取值来确定该进程是否为用户态进程。 如果Process的Name取值中包含“[]”，表示它是内核线程，无需执行monitorthreaddumbtty命令；如果Process的Name取值中未包含“[]”，表示它是用户态进程，它可能包含多个线程。对于多线程的用户态进程，还需要对该用户态进程执行monitorthreaddumbtty命令，如果显示信息中某线程LAST_CPU字段的取值为CPU控制核的编号，且CPU字段取值大于5%，则该线程可能为导致CPU控制核占用率高的线程，需要进一步定位。 <Sysname>monitorthreaddumbtty 206processes;342threads;5134fds Threadstates:4running,338sleeping,0stopped,0zombie CPU0:98.06%idle,0.97%user,0.97%kernel,0.00%interrupt,0.00%steal CPU1:97.12%idle,0.96%user,0.96%kernel,0.96%interrupt,0.00%steal CPU2:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%stealCPU3:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal CPU4:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal Memory:7940Mtotal,5315Mavailable,pagesize4K JIDTIDLAST_CPUPRIStateHH:MM:SSMAXCPUName 3223222115R00:04:21020.15%[kdrvfwdd2]3233233115R00:04:21020.15%[kdrvfwdd3] 3243244115R00:04:21020.15%[kdrvfwdd4] 111120S00:00:02210.19%scmd 3763761120S00:00:0010.19%diagd 220120S00:00:0000.00%[kthreadd] ... b.确认异常任务的调用栈。 在Probe视图下执行followjob命令确认异常任务的调用栈。下面以Sysname上pppd进程（进程编号为515）的操作为例。 <Sysname>system-view [Sysname]probe [Sysname-probe]followjob515 Attachingtoprocess515(pppd) Iteration1of5 ------------------------------ ThreadLWP515:Switches:3205 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x0000000000441745inppp_EpollSched+0x35/0x5c #20x0000000000000004in?? Kernelstack: [<ffffffff811f0573>]ep_poll+0x2f3/0x370 [<ffffffff811f06c0>]SyS_epoll_wait+0xd0/0xe0 [<ffffffff814aed79>]system_call_fastpath+0x16/0x1b[<ffffffffffffffff>]0xffffffffffffffff ThreadLWP549:Switches:20 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x00000000004435d4inppp_misc_EpollSched+0x44/0x6c Kernelstack: [<ffffffffffffffff>]0xffffffffffffffff ... c.根据a和b步骤找到任务名称，再根据任务名称找到对应的业务模块，定位并处理业务模块的问题。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 4.4生成树故障处理 4.4.1设备连接成环时业务中断 ",Suggestion not provided
 •用户会话超时时间超时。 •用户闲置切断。 •计费更新失败。 •用户流量达到阈值。 •服务器强制用户下线。 •用户在线探测失败下线。 •用户上线的接口down。,用户在线时长超过会话时长后，设备会触发用户下线。,(1)通过portallogout-recordenable命令，开启Portal用户下线信息记录功能。 (2)检查用户会话超时时间是否超时。如果AAA服务器给Portal用户下发了会话时长，即用户单次在线时长。用户在线时长超过会话时长后，设备会触发用户下线。可通过如下三种方法确认是否因会话超时导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Sessiontimeout 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Sessiontimertimedoutandtheuserwillbeloggedoff.用户会话超时触发的下线属于正常下线，用户重新上线即可。 (3)检查是否为用户闲置切断。如果设备或者AAA服务器授权了用户闲置切断时长，用户上线后，设备会周期性检测用户的流量，若某用户在指定的闲置检测时间内产生的流量小于指定的数据流量，则会被强制下线。可通过如下三种方法确认是否因用户闲置切换功能导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:Idletimeout 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Idle-cuttimertimedoutandtheuserwillbeloggedoff.用户闲置切断触发的下线属于正常下线，用户重新上线即可。 (4)检查是否为计费更新失败。远程Portal认证用户上线，设备会定期向AAA服务器发送计费更新报文。当设备与AAA服务器链路不通或者服务器故障时，计费更新报文会发送失败。当达到最大重传次数后，如果计费更新报文还是发送失败并且设备上配置了用户计费更新失败策略（通过accountingupdate-failoffline命令配置），则触发用户下线。可通过如下方法确认是否因计费更新失败导致用户下线： 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58Logoutreason:Accountingupdatefailure 通过displayinterface查看设备上连接AAA服务器的端口是否发生过变化，检查AAA服务器否有异常记录等。或者通过displayradiusscheme命令显示的State字段查看服务器状态是否为Block，如果是，则可能是计费更新失败导致的下线。 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Processedaccounting-updatefailedanduserlogout. 如果确认是计费更新失败导致的用户下线，请检查设备与服务器之间的链路状态，以及设备和AAA服务器的相关计费配置是否发生过更改。 (5)检查是否为用户流量达到阈值。用户上线时，如果AAA服务器下发了流量阈值，当用户的流量超过AAA服务器下发的流量阈值时，设备就会强制用户下线。可通过如下方法确认是否因用户流量达到阈值导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Usertrafficreachedthreshold 用户流量达到阈值触发的下线属于正常下线，用户重新上线即可。 (6)检查是否为AAA服务器主动踢用户下线。设备上开启了RADIUSsessioncontrol功能后，若收到AAA服务器的断开连接请求，则会立马强制对应的用户下线。首先查看设备上是否开启了（通过radiussession-controlenable命令配置）。如果开启了，则可以通过如下方法查看是否因AAA服务器强制用户下线导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:ForcelogoutbyRADIUSserver服务器为何强制用户下线，请联系服务器管理员进行确认。 (7)检查是否为Portal用户在线探测失败导致用户下线。 如果设备上开启了Portal用户在线探测功能（通过portaluser-detect命令配置），设备会定期向用户终端发送探测报文。若在指定探测次数内，设备未收到终端的回应，则强制用户下线。确认设备上是否开启了Portal用户在线探测功能。如果开启了，则可以通过如下方法确认是否因用户在线探测失败导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Userdetectionfailure 如果确认是因Portal用户在线探测导致用户下线，请检查终端和设备之间的链路状态，排查终端没有回应探测报文的原因。 (8)检查Portal用户上线的接口是否down。如果Portal用户上线的接口down了一段时间后，设备会强制从该接口接入的Portal用户全部下线。 可通过如下方法确认是否因接口down导致用户下线： 查看AAA服务器上的用户下线记录。 通过displayinterface命令查看接口的状态是否发生过变化，如果发生变化的时间正好和用户下线的时间接近，则可能是接口down触发的用户下线。 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/ASSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Interfacedown 如果确认是接口down导致的下线，请排查接口down的原因，如网线口松动等。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Portal服务器上Portal相关配置截图。 AAA服务器上记录的用户下线记录。 设备与服务器间的抓包文件。 调试信息。 4.告警与日志 相关告警无 相关日志无 4.11MAC地址认证故障处理 4.11.1MAC地址认证失败 
(1)Client不停的在几个AP间漫游； (2)Client漫游困难，Client原来关联的AP信号已经很差，但Client仍然不会主动漫游到信号较好的AP上。 ,如果Client不停的在几个AP间漫游，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调低。,•如果Client不停的在几个AP间漫游，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调低。 •如果Client漫游困难，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调高。 4.11802.1X远程服务器认证失败问题 
(1)FITAP启用本地转发后，在AC上可以看到AP状态为“Run”，但是大约30秒后又切换为 “Idle”状态； (2)在设备上可以看到如下打印信息： %Aug1110:25:04:2252018H3CCWS/4/CWS_AP_DOWN:CAPWAPtunneltoAPa4fa-7679-b390wentdown.Reason:Failedtoretransmitmessage. %Aug1110:25:04:2732018H3CAPMGR/6/APMGR_AP_OFFLINE:APa4fa-7679-b390wentoffline.StatechangedtoIdle. ,这是由于下发到FITAP的本地配置文件将上行以太网接口的PVID修改了，不再是原来的VLAN1，最终导致AP和AC不通，AC的状态机超时，并断开连接。因此需要修改本地转发文件，保证上行接口PVID为1。 •目前FITAP使用VLAN1获取地址并和AC进行连接，所以必须保证AP上使用VLAN1能够成功从网络中获取地址，也就是上行口必须支持VLAN1。 •如果FITAP上行交换机为AP分配地址不在VLAN1中，则FITAP上行接口的PVID必须配置为VLAN1。 •如果FITAP上行交换机为AP分配地址在VLAN1中，且要将FITAP上行接口PVID修改为其他的VLAN，则FITAP上行接口必须设置支持VLAN1，而且为tag方式，同时上行交换机也必须保证接口为VLAN1的tag方式。 •对于无线用户接入的VLAN，尽量在FITAP上行接口使用tag方式，否则属于PVID的无线用户报文将在上行交换机被接入到上行交换机接口的PVID的VLAN中。 4.3主、备AC切换，主AC无法回切 ,这是由于下发到FITAP的本地配置文件将上行以太网接口的PVID修改了，不再是原来的VLAN1，最终导致AP和AC不通，AC的状态机超时，并断开连接。因此需要修改本地转发文件，保证上行接口PVID为1。 •目前FITAP使用VLAN1获取地址并和AC进行连接，所以必须保证AP上使用VLAN1能够成功从网络中获取地址，也就是上行口必须支持VLAN1。 •如果FITAP上行交换机为AP分配地址不在VLAN1中，则FITAP上行接口的PVID必须配置为VLAN1。 •如果FITAP上行交换机为AP分配地址在VLAN1中，且要将FITAP上行接口PVID修改为其他的VLAN，则FITAP上行接口必须设置支持VLAN1，而且为tag方式，同时上行交换机也必须保证接口为VLAN1的tag方式。 •对于无线用户接入的VLAN，尽量在FITAP上行接口使用tag方式，否则属于PVID的无线用户报文将在上行交换机被接入到上行交换机接口的PVID的VLAN中。 4.3主、备AC切换，主AC无法回切 
(1)FITAP无法成功注册到AC上，AC收不到任何该AP的报文，该AP无法动态获取IP地址； (2)使用客户端替换FITAP后，客户端可以成功获取IP地址并使用网络资源； (3)通过抓包和调试可以发现AP已经正常发送了DHCPdiscover报文申请IP地址，然而却没有收到DHCPoffer报文，而通过DHCPserver信息发现已经收到了Discover报文并且回应offer报文。 ,(1)FITAP配置静态IP地址可以和AC互通，并且注册到AC设备上； (2)在DHCPserver位置挂一台PC1，将AP替换成PC2，两台PC都配置静态IP地址（IP地址为DHCPserver要分配的网段地址）； (3)清除两台PC的ARP，此时PC1无法ping通PC2，但是PC2可以ping通PC1； (4)因此可以断定广播上行OK，但是下行不通； (5)通过逐个设备上镜像抓包，确定丢包位置，排查下行广播报文丢失情况。 5.2Client连接到信号较弱的AP，而未连接到信号较强且距离较近的AP ,(1)FITAP配置静态IP地址可以和AC互通，并且注册到AC设备上； (2)在DHCPserver位置挂一台PC1，将AP替换成PC2，两台PC都配置静态IP地址（IP地址为DHCPserver要分配的网段地址）； (3)清除两台PC的ARP，此时PC1无法ping通PC2，但是PC2可以ping通PC1； (4)因此可以断定广播上行OK，但是下行不通； (5)通过逐个设备上镜像抓包，确定丢包位置，排查下行广播报文丢失情况。 5.2Client连接到信号较弱的AP，而未连接到信号较强且距离较近的AP 
(3)检查接口是否震荡。 执行displayinterfacebrief命令，查看Link和Protocol字段。Link和Protocol字段均显示Up，则表示接口状态为Up，否则表示接口状态为Down。若接口一直在Up和Down两种状态间切换，则表示接口震荡。 如果接口震荡，则请参见“接口不UP”故障进行定位。 如果接口没有震荡，请执行步骤(4)。 <Sysname>displayinterfacegigabitethernet1/0/1brief Briefinformationoninterfacesinroutemode: Link:ADM-administrativelydown;Stby-standby Protocol:(s)–spoofing InterfaceLinkProtocolPrimaryIPDescriptionGE1/0/1UPUP-- (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。,Cause not provided,Suggestion not provided
(3)检查路由是否迭代到LSP隧道上。 执行displaymplstunnelall命令，查看所有隧道的信息。执行displayfib命令，查看指定下一跳地址的FIB表项。对于FIB表项中Nexthop字段与隧道信息中Destination字段相同值的FIB表项，检查该FIB表项的LSP索引号（Token字段）与隧道的NHLFEID是否相同。 如果不同，则表示未迭代到LSP隧道上，确认指定FEC的隧道类型（Type字段）与配置的隧道策略是否相同： −如果不同，则在隧道策略视图下修改隧道策略，使配置的隧道策略与指定FEC的隧道类型匹配。 −如果相同，则执行步骤(7)。,Cause not provided,Suggestion not provided
(5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 12.3.4配置相同RT的不同VPN之间不能互通 ,Cause not provided,Suggestion not provided
<Sysname>displaybgppeeripv4vpn-instancevpn1BGPlocalrouterID:1.1.1.1 LocalASnumber:100 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState 10.1.1.165410540100:01:19Established (4)检查私网路由是否正常。 执行displayiprouting-tablevpn-instance命令，查看私网路由： 如果私网路由的掩码不是32位，且发现该路由的协议不是BGP协议，则表示两端PE的Loopback接口的IP地址在同一网段，设备将优选直连路由，而不是私网路由。请修改PE上的Loopback接口的IP地址，将掩码修改为为32位。 如果私网路由的掩码是32位，且发现该路由的协议是BGP协议，则私网路由正常，请执行步骤(5)。 <Sysname>displayiprouting-tablevpn-instancevpn1 Summarycount:1 Destination/MaskProtoPreCostNextHopInterface ,Cause not provided,Suggestion not provided
"<Sysname>displayinterfacegigabitethernet3/0/1 GigabitEthernet3/0/1 Currentstate:DOWN Lineprotocolstate:DOWN Description:GigabitEthernet3/0/1Interface Bandwidth:1000000kbps Maximumtransmissionunit:1500 Internetaddress:2.1.1.2/24(primary) IPpacketframetype:EthernetII,hardwareaddress:0000-fc00-9276 IPv6packetframetype:EthernetII,hardwareaddress:0000-fc00-9276 Loopbackisnotset Mediatypeistwistedpair,porthardwaretypeis1000_BASE_T Portpriority:0 1000Mbps-speedmode,full-duplexmode Linkspeedtypeisautonegotiation,linkduplextypeisautonegotiation Flow-controlisnotenabled Maximumframelength:9216 Lastclearingofcounters:Never Peakinputrate:8bytes/sec,at2019-03-1909:20:48 Peakoutputrate:1bytes/sec,at2019-03-1909:16:16 Last300secondinput:0packets/sec0bytes/sec-% Last300secondoutput:0packets/sec0bytes/sec-% Input(total):2892packets,236676bytes 24unicasts,2broadcasts,2866multicasts,0pauses Input(normal):2892packets,-bytes 24unicasts,2broadcasts,2866multicasts,0pauses Input:0inputerrors,0runts,0giants,0throttles 3CRC,0frame,-overruns,0aborts -ignored,-parityerrors Output(total):29packets,1856bytes 24unicasts,5broadcasts,0multicasts,0pauses Output(normal):29packets,-bytes 24unicasts,5broadcasts,0multicasts,0pauses Output:0outputerrors,-underruns,-bufferfailures 0aborts,0deferred,0collisions,0latecollisions 0lostcarrier,-nocarrier 以上显示信息表明，入端口出现了CRC错包。 ",•	端口与电缆连接器物理连接有虚插现象。 •	端口异常。 •	电缆连接器损坏。 •	光模块、光纤有污染或连接不好。 •	光功率不足。 •	中间链路或设备故障。 •	设备或单板硬件故障。 3.	故障分析 本类故障的诊断流程如图18所示。 图18故障诊断流程图 ,(1)	端口进行内部环回检查。 在端口下配置loopbackinternal命令开启内部环回功能，然后通过displayinterface查看端口CRC错包统计是否增长。如果增长，则可能是设备或单板硬件故障，请联系技术支持人员。如果不增长，则不是端口内部问题。 (2)	检查端口与电缆连接器是否有异常。 a.	检查端口和电缆连接器的物理连接是否有虚插。若有虚插，请正确连接端口和电缆连接器。 b.	检查端口是否异常，比如端口内存在异物，端口的PIN针有弯针，端口的外壳变形等异常。 若有异常，需要更换其他正常端口或光模块。 c.	检查电缆连接器是否出现损坏现象。若有损坏现象，请更换电缆。 (3)	检查光模块是否有异常。 a.使用光纤将该端口的光模块Tx端和Rx端连接，然后通过displayinterface查看端口CRC错包统计是否增长。如果增长，则可能是光模块的问题。如果不增长，则不是该光b.通过displ(模块问题。)aytransceiveralarm命令查看光模块是否有Rx_Los或Tx_Fault告警 c.信息，若有aytransceiverdiagnosis通过命令查看(告警信息，需要清洁或更换光纤、光模块。displ)光模块的接收功率和发送功率是否 在规定的最大值和最小值的范围内，若有接收或发送的功率超出范围，需要清洁或更换光纤、光模块。 (4)	更换正常端口测试是否能恢复正常。 更换其他正常的端口测试，如果端口更换后错包消失，端口更换回来错包又再次出现，则为端口硬件故障，请更换端口并将故障信息发送技术支持人员分析；如更换到其他正常端口仍会出现错包，则中间传输链路故障的可能性较大。 (5)	检查中间传输链路是否正常。 使用仪器测试中间链路，链路质量差或者线路光信号衰减过大会导致报文在传输过程中出错。检查互连中间链路设备（光转，转接架，传输等设备）是否正常。若中间传输链路故障，请更 (6)	shutdown执行命令，再(换或恢复中间传输链路。)执行undoshutdown命令，查看端口是否能恢复正常。 (7)	检查端口是否收到大量流控帧 通过displayinterface命令，查看端口pauses帧计数，如果在不断增长，表明端口发出或者收到了大量的流控帧。检查下端口出入流量是否过大及对端设备的流量处理能力。 (8)	如果故障仍然未能排除，可能是设备或单板硬件故障，请收集信息，并联系技术支持人员。 5.告警与日志相关告警无 相关日志无 3.6.2端口不接收报文 
<Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX ,Cause not provided,Suggestion not provided
<Sysname>pingsrv6-tepolicypolicy-namep1 TheSRv6-TEpolicydoesnotreferenceaSIDlistorthereferencedSIDlistisdown. ,本类故障的常见原因主要包括： •SRv6TEPolicy状态为Shutdown。•SRv6TEPolicy的BSID配置错误或者冲突。 •SRv6TEPolicy下配置缺失。•SRv6TEPolicy的资源超限。 •SegmentList中SID数量超限。 •SRv6TEPolicy的SID列表与报文转发路径的规划不同。 •SRv6TEPolicy报文转发路径上的物理链路故障。3.故障诊断流程本类故障的诊断流程如图116所示。 图116SRv6TEPolicy无法生效的故障诊断流程图 4.故障处理步骤 (1)在SRv6TEPolicy的头节点执行displaysegment-routingipv6tepolicystatus命令初步查看SRv6TEPolicy不生效的原因。 <Sysname>displaysegment-routingipv6tepolicystatus Name/ID:p1/0 Status:Down Checkadminstatus:Failed Checkforendpoint&color:PassedCheckforsegmentlist:PassedCheckvalidcandidatepaths:FailedCheckforBSIDs:- 如果Checkadminstatus字段显示为Failed，说明SRv6TEPolicy处于管理关闭状态。请进入指定SRv6TEPolicy视图下执行undoshutdown命令，设置SRv6TEPolicy为开启状 开启(态。)指定SRv6TEPolicy后，再次执行displaysegment-routingipv6tepolicystatus命令，如果存在其他校验字段显示为Failed或“-”，例如CheckforsegmentList字段显示为Failed，请继续执行以下操作。(2)检查SRv6TEPolicy的BSID是否存在冲突。 在SRv6TEPolicy的头节点执行displaysegment-routingipv6tepolicy命令。显示信息中Requeststate字段取值为Failed表示BSID申请失败。静态指定的BSID可能不在Locator段范围内或者与已存在的SRv6TEPolicy的BSID出现重复，从而导致SRv6TEPolicy失效。建议在失效的SRv6TEPolicy下执行undobinding-sid命令删除静态手工指定BSID，由系统自动申请BSID，以避免错误和冲突。 <Sysname>displaysegment-routingipv6tepolicy Name/ID:p1/0 Color:10Endpoint:1000::1NamefromBGP:BSID: Mode:DynamicType:Type2Requeststate:Succeeded CurrentBSID:8000::1ExplicitBSID:-DynamicBSID:8000::1Referencecounts:3Flags:A/BS/NC 如果BSID申请成功以后，问题仍未解决，则请继续执行以下操作。 (3)检查SRv6TEPolicy的配置是否完整。 以IS-IS作为IGP通告SID为例，在SRv6TEPolicy的头节点上执行命令displaycurrent-configuration，查看配置是否与以下实例中的一致。如果缺少任意一项，则说明遗漏了部分配置。isis1 address-familyipv6unicastsegment-routingipv6locatora segment-routingipv6 locatoraipv6-prefix1000:0:0:1::64static16traffic-engineeringsrv6-policylocatorasegment-listsl1 index10ipv61000::2:0:0:1:0index20ipv61000::2:0:0:1:3policyp1 color100end-pointipv64::4candidate-pathspreference100explicitsegment-listsl1 SRv6TEPolicy报文转发路径的各节点上，也需要在IGP视图下配置segment-routingipv6locator命令，以正常发布Locator段。例如：isis1 address-familyipv6unicastsegment-routingipv6locatorb 如果配置不完整，请补充缺失配置。配置补充完整后，如果问题仍未解决，请继续执行以下操作。 (4)检查当前SRv6TEPolicy数量和SegmentList数量是否超限。在SRv6TEPolicy头节点执行displaysegment-routingipv6tepolicystatistics命令，查看SRv6TEPolicy的使用数量是否达到上限。 <Sysname>displaysegment-routingipv6tepolicystatistics IPv6TEPolicyDatabaseStatistics … SRv6-TEpolicyresourceinformation: Maxresources:1024 Usedresources:1 Upperthreshold:512(50%) Lowerthreshold:102(10%) SIDlistresourceinformation: Maxresources:4096 Usedresources:1 Upperthreshold:3277(80%) Lowerthreshold:1638(40%) … 如果SRv6-TEpolicyresourceinformation下的Usedresources字段的值等于Max resources字段的值，则表示SRv6TEPolicy数量可能超限，此时请删除不需要的SRv6 TEPolicy。 如果SIDlistresourceinformation下的Usedresources字段的值等于Maxresources字段的值，则表示SegmentList数量可能超限，请删除不需要的SegmentList。 如果SRv6TEPolicy数量和SegmentList数量均没有超限，请继续执行以下操作。 (5)检查SegmentList中SID数量是否超限。在SRv6TEPolicy头节点上进入probe视图，并执行displaysysteminternalsegment-routingipv6tepolicystatus命令，显示信息中MaxSIDs表示Segment List中SID的数量上限。 [Sysname-probe]displaysysteminternalsegment-routingipv6tepolicystatus … MaxGroupNidNum:1024MaxPolicyNidNum:1024 MaxSeglistNidNum:4096MaxNexthopNidNum:65535 MaxOutNum:32MaxEcmpNum:16 MaxSIDs:10 … 执行displaysegment-routingipv6tesegment-list命令，显示信息中的Nodes字段表示该指定SegmentList中配置的SID节点数量。 <Sysname>displaysegment-routingipv6tesegment-list TotalSegmentlists:1 Name/ID:A/1 Origin:CLI Status:Up VerificationState:Down Nodes:11 … 如果配置的SID节点数量超过SID的数量上限，请删除SegmentList中不必要的SID值。如果配置的SID节点数量未超过上限，请继续执行以下操作。 (6)检查SID列表的配置与规划是否一致。 在SRv6TEPolicy头节点执行displaysegment-routingipv6tesegment-list 命令，显示SID列表信息，其中自上而下依次排列的SID值表示转发路径上距离SRv6TEPolicy头节点由近到远的各节点或链路。如果Status字段为Down，表示未正常学习到该SID所属的Locator段。请参考OSPFv3故障处理手册或IS-IS故障处理手册处理。 [Sysname]displaysegment-routingipv6tesegment-list TotalSegmentlists:1 Name/ID:s1/1 Origin:CLI Status:Down VerificationState:DownNodes:3 Index:10SID:1::1 Status:UPTopoStatus:Nonexistent Type:Type_2Flags:NoneCocType:-Commonprefixlength:0 Index:20SID:1::2 Status:DownTopoStatus:Nonexistent Type:Type_2Flags:NoneCocType:-Commonprefixlength:0 Index:30SID:1::3 Status:DownTopoStatus:Nonexistent Type:Type_2Flags:None CocType:-Commonprefixlength:0 在SRv6TEPolicy转发路径上的各个节点上依次执行displaysegment-routingipv6local-sid命令查看SID值是否与上述命令显示的SID列表中的SID值一致。SID类型通常为EndSID或End.XSID。例如，对于EndSID，查看SRv6LocalSID的信息。 [Sysname]displaysegment-routingipv6local-sidend LocalSIDforwardingtable(End) TotalSIDs:2 SID:1000::2:0:0:1:0/64 Functiontype:EndFlavor:PSP Locatorname:bAllocationtype:Dynamic Owner:IS-IS-1State:ActiveCreateTime:Sep0416:32:03.4432021 如果SID列表与转发路径上各节点的SID值不一致，请执行undoindexindex-number命令删除错误的SID，再执行indexindex-numberipv6ipv6-address命令重新配 (7)置正确的SID。如果SIDlicy转发路径上的各个节点上通过displayinter(列表与规划一致，请继续执行以下操作。在SRv6TEPo)facebrief命令检查物 理链路状态，确保转发路径上各接口的物理状态和数据链路层协议状态均为UP。如果链路正常，或链路恢复后问题仍未解决，请继续执行以下操作。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •SRPV6/2/SRPV6_BSID_CONFLICT •SRPV6/2/SRPV6_BSID_CONFLICT_CLEAR •SRPV6/5/SRPV6_PATH_STATE_DOWN •SRPV6/4/SRPV6_POLICY_STATUS_CHG •SRPV6/4/SRPV6_RESOURCE_EXDCEED •SRPV6/4/SRPV6_RESOURCE_EXCEED_CLEAR •SRPV6/5/SRPV6_SEGLIST_STATE_DOWN •SRPV6/5/SRPV6_SEGLIST_STATE_DOWN •SRPV6/2/SRPV6_STATE_DOWN •SRPV6/2/SRPV6_STATE_DOWN_CLEAR 14VXLAN类故障处理 14.1VXLAN故障处理 14.1.1Ping不通集中式VXLANIP网关 ,Suggestion not provided
•IS-IS邻居Down。 •	IS-IS邻居关系震荡。 ,本类故障的常见原因主要包括： •	设备底层故障或者链路故障，导致IS-IS无法正常的收发Hello报文。 •	链路两端的设备配置的SystemID相同。 •	链路两端接口的MTU设置不一致，或者接口的MTU小于发送的Hello报文的长度。 •	链路两端接口的IP地址不在同一网段。 •	链路两端的IS-IS接口认证方式不匹配。 •	链路两端的IS-ISLevel不匹配。 •	建立IS-ISLevel-1邻居时，链路两端设备的区域地址不匹配。 3.	故障分析 本类故障的诊断流程如图71所示。 图71IS-IS邻居无法建立的故障诊断流程图 ,(1)	检查接口的物理层状态是否为Up。 请执行displayinterface[interface-type[interface-number|interface-number.subnumber]]命令查看IS-IS接口物理层状态，如果接口物理层状态为Down，请先处理接口故障问题。如果接口物理状态为Up，请执行步骤(2)。 (2)	检查链路是否故障。请执行ping命令，检查设备链路是否故障（包括传输设备故障）。如果链路正常，请执行步骤(3)。 如果设备支持isisbfdsession-restrict-adj命令且IS-IS使用BFD检测设备间链路，可通过isisbfdsession-restrict-adj命令开启BFD抑制IS-IS建立和保持邻 接关系的功能后，接口发送的Hello报文中将会携带BFD-enabledTLV，当两端BFD-enabledTLV中的信息一致时，抑制IS-IS建立和保持邻居关系的功能生效。当BFD会话Down时，无法建立IS-IS邻居关系。请执行displaybfdsession命令查看检测IS-IS两端链路的BFD会话的状态，如果“State”字段取值为“Down”，请排除链路故障。如果“State”字段取值为“Up”，请执行步骤(3)。 (3)	检查CPU或内存利用率是否过高。 请执行displaycpu-usage命令检查故障设备的主控板和接口板的CPU利用率是否过高。如果CPU利用率过高，IS-IS将无法正常收发协议报文，从而导致邻居关系震荡。可通过关闭一些不必要的功能解决此问题。如果CPU利用率不高，则执行步骤(4)。 请执行displaymemory-threshold命令，查看显示信息中的Currentfree-memorystate，即系统当前内存使用状态。如果Currentfree-memorystate为Minor、Severe或Critical，表示剩余空闲内存较少，可能会导致设备无法收发IS-IS报文或处理IS-IS报文速度较慢，请关闭一些不必要的功能尝试解决此问题。如果系统当前内存使用状态为Normal，则执行步骤(4)。(4)检查接口在IS-IS协议下的状态是否正常。请执行displayisisinterface命令，检查使能了IS-IS的接口的状态（“IPv4state”或“IPv6state”字段）是否为正常状态。 	如果IS-IS接口状态为“Lnk:Up/IP:Dn”，说明IPv4或IPv6相邻节点的链路层可达、网络层不可达，请处理网络层故障问题。 	如果IS-IS接口状态为“Up”，请执行步骤(5)。 (5)	检查两端IP地址是否在同一网段。对于IPv4IS-IS，请执行displayinterfacebrief命令查看两端接口的IPv4地址。 	如果两端接口的IPv4地址不在同一网段，请在接口视图下执行ipaddress命令修改两端的IPv4地址，使其在同一网段。 	如果两端接口的IPv4地址处于同一网段，请执行(6)。 对于IPv6IS-IS，无需执行此检查。 (6)	检查各IS-IS接口的MTU是否一致。 请执行displayinterface[interface-type[interface-number|interface-number.subnumber]]命令命令查看接口MTU信息。 	如果接口的MTU值配置不一致，请在接口视图下执行mtusize命令，将各个接口的MTU值修改为一致。 	如果接口的MTU值一致，请执行(7)。(7)检查IS-IS能否接收到Hello报文。 请执行displayisispackethelloby-interfaceverbose命令，检查IS-IS能否 接收到Hello报文。如果设备无法接收Hello报文，请排除丢包问题。如果故障依然存在，请执行(12)。 如果设备能够接收Hello报文，请继续执行以下检查： 	如果“DuplicatesystemID”字段的统计计数随时间增长，说明SystemID冲突。请执行步骤(8)。 	如果“Mismatchedlevel(LAN)”字段的统计计数随时间增长，说明Level不匹配。请执行步骤(9)。 	如果“BadareaaddressTLV”字段的统计计数随时间增长，说明区域地地址不匹配。请执行步骤(10)。 	如果其他字段的统计计数随时间增长，请执行步骤(12)。(8)检查链路两端的设备配置的SystemID是否相同。 请执行displaycurrent-configurationisis命令检查链路两端的设备配置的 SystemID是否相同。 	如果两端SystemID相同，请修改配置，使两端的SystemID不同。 	如果两端SystemID不相同，请执行步骤(9)。 (9)	检查链路两端的设备的IS-ISLevel是否匹配。 	ration|includeis-level命令，检查链路两端设备的Level级别。如果通过displaycurrent-configuration|includeis-level命令无法查询到设备的Level级别的相关配置，表明设备的Level级别为缺省 	请执行display(值为Level-1-2。)current-configurationinterfaceinterface-typeinterface-number|includecircuit-level命令，检查接口的链路邻接关系类型。如果通过displaycurrent-configurationinterfaceinterface-typeinterface-number|includecircuit-level命令无法查询到接口的链路邻接关 系类型，说明接口的链路邻接关系类型为缺省值，这种情况下，该接口既可以建立 Level-1的邻接关系，也可以建立Level-2的邻接关系。 需要保证链路两端的Level匹配才能建立IS-IS邻居关系，接口Level匹配的原则如下： 	如果本端接口Level级别为Level-1，则对端接口Level级别必须为Level-1或Level-1-2。 	如果本端接口Level级别为Level-2，则对端接口Level级别必须为Level-2或Level-1-2。 	如果本端接口Level级别为Level-1-2，则对端接口Level级别可以为Level-1、Level-2或 Level-1-2。 对于不同的情况，请选择不同的处理方式： 	如果链路两端设备的IS-ISLevel不匹配，请在IS-IS视图下使用is-level命令修改设备的IS-IS级别，或者在接口视图下使用isiscircuit-level命令修改接口的Level级别。 	如果链路两端设备的IS-ISLevel匹配，请执行步骤(10)。 (10)	检查链路两端设备的区域地址是否匹配。 请执行displayisis命令查看“Networkentity”字段，检查链路两端设备的区域地址是否匹配。“Networkentity”的格式为X…X.XXXX.XXXX.XXXX.00，前面的“X…X”是区域地址，中间的12个“X”是交换机的SystemID，最后的“00”是SEL。 	如果链路两端建立Level-1邻居，需要保证链路两端设备在同一个区域内。建立IS-IS Level-2邻居时，不需要判断区域地址是否匹配。 当建立Level-1邻居的两端设备区域地址不同时，请在IS-IS视图下使用network-entity命令修改设备的区域地址。 	如果链路两端区域地址匹配，请执行步骤(11)。 (11)	检查链路两端设备的认证方式是否匹配。 请执行displaycurrent-configurationinterface-typeinterface-number|includeisis命令检查链路两端设备IS-IS接口的认证方式。 a.	如果两端认证类型不匹配，请在链路两端设备的IS-IS接口视图下执行isisauthentication-mode命令，将两端设置为相同的认证类型。 b.	如果认证方式相同的情况下，IS-IS仍然无法建立邻居关系，请将两端设置为相同的认证密码。 如果故障依然存在，请执行步骤(12)。 (12)	如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警 模块名：ISIS-MIB •	isisAdjacencyChange(1.3.6.1.2.1.138.0.17) 相关日志 •	ISIS/3/ISIS_NBR_CHG 10.2.2设备学习不到IS-IS路由 
•OSPFv3邻居Down •OSPFv3邻居震荡 ,本类故障的常见原因主要包括： •BFD会话Down，即BFD检测到链路故障。 •对端设备故障。 •CPU利用率或内存利用率过高。 •链路故障。 •OSPFv3接口没有Up。 •两端IP地址不在同一网段。 •两端OSPFv3参数的配置不匹配： RouterID配置冲突。 两端区域类型配置不一致。 两端OSPFv3认证配置不匹配。 两端定时器参数配置不一致。 OSPFv3接口的网络类型不匹配。 3.故障分析 本类故障的诊断流程如图74所示。 图74OSPFv3邻居Down的故障诊断流程图 4.处理步骤 (1)通过命令行查看OSPFv3邻居状态变为Down的原因。 执行displayospfv3event-logpeer命令，显示信息中的Reason字段为邻居状态发 生变化的原因，一般包含如下几种情况： DeadExpired 表示在邻居失效定时器超时前没有收到Hello报文，导致OSPFv3邻居状态变为Down。 出现这种情况请执行步骤(2)。 BFDDown 表示BFD会话Down导致OSPFv3邻居状态变为Down。出现这种情况请执行步骤(2)。 1-Way 表示对端OSPFv3状态首先变成Down，然后向本端发送1-wayHello报文，导致本端 OSPFv3状态变为Init。出现这种情况请排查对端设备的故障。 IntPhyChange 表示接口Down或者接口MTU改变导致邻居关系变为Down。此时，执行displayinterface[interface-type[interface-number| interface-number.subnumber]]命令查看接口的运行状态和相关信息，排查接口故障。其他情况请执行步骤(11)。 (2)检查接口的物理层状态是否为Up。 执行displayinterface[interface-type[interface-number| interface-number.subnumber]]命令查看OSPFv3接口物理层状态，如果接口物理层状态为Down请先处理接口故障问题。如果接口物理状态为Up，则执行步骤(3)。 (3)检查链路是否故障。 请执行ping命令，检查设备链路是否故障（包括传输设备故障）。如果链路正常，请执行步骤(4)。 (4)检查CPU利用率是否过高。 请执行displaycpu-usage命令检查故障设备的主控板和接口板的CPU利用率是否过高。 CPU利用率过高会导致OSPFv3无法正常收发协议报文，继而导致邻居振荡。可通过关闭一些不必要的功能解决此问题。如果CPU利用率不高，则执行步骤(5)。 (5)检查内存利用率是否超过了内存利用率阈值。 请执行displaymemory-threshold命令，查看显示信息中的Currentfree-memorystate，即系统当前内存使用状态。如果Currentfree-memorystate为Minor、Severe或Critical，表示剩余空闲内存较少，可能会导致设备无法收发OSPFv3报文或处理OSPFv3报文速度较慢，请关闭一些不必要的功能尝试解决此问题。如果系统当前内存使用状态为Normal，则执行步骤(6)。 (6)检查接口在OSPFv3协议下的状态是否正常。 执行displayospfv3interface查看接口在OSPFv3协议下状态是否为正常状态。 如果OSPFv3接口状态为Down，检查接口是否使能了OSPFv3功能。如果使能了OSPFv3功能，请处理网络层接口故障问题。 如果OSPFv3接口协议状态正常，即接口状态为DR、BDR、DROther或P-2-P时，请执行步骤(7)。 (7)检查各OSPFv3接口的MTU是否一致。 如果接口下未配置ospfv3mtu-ignore命令，则要求接口的MTU一致，否则无法建立 OSPFv3邻居关系。请执行displayinterface[interface-type [interface-number|interface-number.subnumber]]命令查看接口MTU信息。 如果接口的MTU值配置不一致，请在接口视图下执行mtusize命令，将各个接口的MTU值修改为一致。 如果接口的MTU值一致，请(8)执行步骤。 (8)检查各接口的DR优先级是否非零。 对于Broadcast和NBMA类型的网络，为了保证正确选举出DR，需要保证至少有一个OSPFv3接口的DR优先级是非零的，否则两边的邻居状态只能达到2-Way。请使用displayospfv3interface命令查看OSPFv3接口信息，其中的Priority表示接口的DR优先级。 如果接口的DR优先级非零，请执行步骤(9)。 (9)是否手工为NBMA网络或P2MP单播网络指定了邻居。 OSPFv3网络类型为NBMA或P2MP（unicast）时，必须通过ospfv3peer命令手工指定邻居接口的链路本地地址。请在OSPFv3接口视图下使用displaythis命令查看接口的网络类型，如果接口的网络类型为NBMA或P2MP（unicast），请在OSPFv3接口视图下使用ospfv3peer命令手工指定邻居接口的链路本地地址。 如果手工为NBMA网络或P2MP单播网络指定了邻居接口的链路本地地址，请执行步骤(10)。 (10)检查两端OSPFv3的参数配置是否有错误。 a.请使用displayospfv3命令检查两端OSPFv3RouterID配置是否冲突。如果OSPFv3 RouterID配置冲突，请修改配置保证OSPFv3RouterID不再冲突。如果OSPFv3Router b.displayospfv3interface请使用(ID配置不冲突，请继续执行以下检查。)命令检查两端OSPFv3AreaID配置是否一致。如果OSPFv3AreaID配置不一致，请修改配置保证OSPFv3AreaID配置一致。如果 OSPFv3AreaID配置一致，请继续执行以下检查。 c.请使用displayospfv3interface命令检查两端接口的OSPFv3网络类型是否一致。如果OSPFv3网络类型不一致，请修改配置保证OSPFv3网络类型一致。需要说明的是，如果双方一端为PTP，另一端为Broadcast，那么邻居关系可以达到Full状态，但无法计算出路由信息。 d.如果接口的OSP隔displayospfv3statisticserr(Fv3网络类型一致，请继续执行以下检查。10秒钟使用请每)or命令检查一次OSPFv3的 错误统计信息，并持续5分钟。需要查看的信息包括： −查看Authenticationfailure字段。如果这个字段对应的计数值一直增长，表示建立邻居的两台设备配置的OSPFv3认证类型不一致，需要在两端设备上配置相同类型的认证。 −查看HELLO:Hello-timemismatch字段。如果这个字段对应的计数值一直在增长，表示接口上的Hello定时器的值不一致，需要将两端接口的Hello定时器的值设置为一致。 −查看HELLO:Dead-timemismatch字段。如果这个字段对应的计数值一直在增长，表示接口上的Dead定时器的值不一致，需要将两端接口的Dead定时器的值设置为一致。 −查看HELLO:Ebitoptionmismatch字段。如果这个字段对应的计数值一直在增长，表示区域类型配置不一致（一端配置为普通区域，另一端配置为Stub或NSSA区域），需要将两端的区域类型设置为一致。 如果故障依然存在，请执行步骤(11)。 (11)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：OSPFV3-MIB •ospfv3VirtIfStateChange(1.3.6.1.2.1.191.0.1) •ospfv3NbrStateChange(1.3.6.1.2.1.191.0.2)•ospfv3VirtNbrStateChange(1.3.6.1.2.1.191.0.3) 相关日志 •OSPFV3/6/OSPFV3_LAST_NBR_DOWN •OSPFV3/5/OSPFV3_NBR_CHG 10.3.2OSPFv3邻居无法达到FULL状态 ,Suggestion not provided
•OSPF邻居Down •OSPF邻居震荡 ,本类故障的常见原因主要包括： •BFD会话Down，即BFD检测到链路故障。 •对端设备故障。 •CPU利用率过高。 •链路故障。 •OSPF接口没有Up。 •两端IP地址不在同一网段。 •OSPF两端参数的配置不匹配： RouterID配置冲突。 两端区域类型配置不一致。 两端OSPF验证配置不匹配。 两端定时器参数配置不一致。 OSPF接口的网络类型不匹配。 3.故障分析 本类故障的诊断流程如图76所示。 图76OSPF邻居Down的故障诊断流程图 4.处理步骤(1)通过命令行或日志查看OSPF邻居状态变为Down的原因。 执行displayospfevent-logpeer命令，显示信息中的Reason字段为邻居状态发生 变化的原因，一般包含如下几种情况： DeadExpired 表示在邻居失效定时器超时前没有收到Hello报文，导致OSPF邻居状态变为Down。出现这种情况请执行步骤(2)。 BFDDown 表示BFD会话Down导致OSPF邻居状态变为Down。出现这种情况请执行步骤(2)。 IntVliChange或virtuallinkwasdeletedortherouteitreliesonwasdeleted 表示虚连接删除或者其依赖的路由删除导致邻居关系变为Down。出现这种情况请执行步骤(2)。 1-Way 表示对端OSPF状态首先变成Down，然后向本端发送1-wayHello报文，导致本端OSPF状态变为Init。出现这种情况请排查对端设备的故障。 IntPhyChange 接口Down或者接口MTU改变导致邻居关系变为Down。此时，执行displayinterface [interface-type[interface-number|interface-number.subnumber]]命令查看接口的运行状态和相关信息，排查接口故障。其他情况请执行步骤(11)。 (2)检查链路是否故障。请执行ping命令，检查设备链路是否故障（包括传输设备故障）。如果链路正常，请执行步骤(3)。 (3)检查CPU利用率是否过高。请执行displaycpu-usage命令检查故障设备的主控板和接口板的CPU利用率是否过高。CPU利用率过高会导致OSPF无法正常收发协议报文从而导致邻居振荡。可通过关闭一些不必要的功能解决此问题。如果CPU利用率不高，则执行步骤(5)。(4)检查内存利用率是否超过了内存利用率阈值。 请执行displaymemory-threshold命令，查看显示信息中的Currentfree-memorystate，即系统当前内存使用状态。如果Currentfree-memorystate为Minor、Severe或Critical，表示剩余空闲内存较少，可能会导致设备无法收发OSPF报文或处理OSPF报文速度较慢，请关闭一些不必要的功能尝试解决此问题。如果系统当前内存使用状态为Normal，则执行步骤 (5)。 (5)检查接口状态是否为Up。 执行displayinterface[interface-type[interface-number| interface-number.subnumber]]命令查看接口物理层状态，如果接口物理层状态为Down请先处理接口故障问题。如果接口物理层状态是Up，请执行displayospfinterface查看接口在OSPF协议下状态是否为正常状态： 如果OSPF接口状态为Down，检查OSPF进程下是否通过network命令通告了接口所属网段。如果OSPF未通告接口所属网段，则检查接口下是否使能了OSPF。如果接口使能了OSPF进程，请处理网络层接口故障问题。 如果OSPF下的接口协议状态正常，即接口状态为DR、BDR、DROther或PTP时，请执行步骤(6)。 (6)检查两端IP地址是否在同一网段。 请执行displayinterfacebrief命令查看两端接口的IP地址： 如果两端接口的IP地址不在同一网段，请在接口视图下执行ipaddress命令修改两端的IP地址，使其在同一网段。 如果两端接口的IP地址处于同一网段，请执行步骤(7)。 (7)检查各OSPF接口的MTU是否一致。 如果在OSPF接口上通过ospfmtu-enable命令将该接口发送的DD报文中MTU域的值填充为接口的MTU值（缺省情况下接口发送的DD报文中MTU域的值为0），则要求各个 OSPF接口发送的DD报文中MTU域的值一致。否则，OSPF邻居无法协商成功。请执行displayinterface[interface-type[interface-number|interface-number.subnumber]]命令查看接口MTU信息： 如果接口的MTU值配置不一致，请在接口视图下执行mtusize命令，将各个接口的MTU值修改为一致。 如果接口的MTU值一致，请执行步骤(8)。 (8)检查各接口的DR优先级是否非零。 对于Broadcast和NBMA类型的网络，为了保证正确选举出DR，需要保证至少有一个OSPF接口的DR优先级是非零的，否则两边的邻居状态只能达到2-Way。请使用displayospfinterface命令查看OSPF接口信息，其中的Pri表示接口的DR优先级。 如果接口的DR优先级非零，请执行步骤(9)。 (9)是否手工为NBMA网络或P2MP单播网络指定了邻居。 OSPF网络类型为NBMA或P2MP（unicast）时，必须通过peer命令手工指定邻居的IP地址。请在OSPF接口视图下使用displaythis命令查看接口的网络类型，如果接口的网络类型为NBMA或P2MP（unicast），请在OSPF视图下使用peer命令手工指定邻居的IP地址。 如果手工为NBMA网络或P2MP单播网络指定了邻居的IP地址，请执行步骤(10)。 (10)检查两端OSPF的参数配置是否有错误。 a.请使用displayospf命令检查两端OSPFRouterID配置是否冲突。如果OSPFRouter ID配置冲突，请修改配置保证OSPFRouterID不再冲突。如果OSPFRouterID配置不 b.请使用displayospfinte(冲突，请继续执行以下检查。)rface命令检查两端OSPFAreaID配置是否一致。如果 OSPFAreaID配置不一致，请修改配置保证OSPFAreaID配置一致。如果OSPFAreaID c.请使用displayospfinterfa(配置一致，请继续执行以下检查。)ce命令检查两端接口的OSPF网络类型是否一致。如果OSPF网络类型不一致，请修改配置保证OSPF网络类型一致。需要说明的是，如果双方一端为PTP，另一端为Broadcast，那么邻居关系可以达到Full状态，但无法计算出路由信息。 d.如果接口的OS每隔displayospfstatisticserro(PF网络类型一致，请继续执行以下检查。10秒钟使用请)r命令检查一次OSPF的错误统计信息，并持续5分钟。需要查看的信息包括： −查看Badauthenticationtype字段。如果这个字段对应的计数值一直增长，表示建立邻 居的两台设备配置的OSPF认证类型不一致，需要在两端设备上配置相同认证的类型。 −查看Hello-timemismatch字段。如果这个字段对应的计数值一直在增长，表示接口上的Hello定时器的值不一致，需要将两端接口的Hello定时器的值设置为一致。 −查看Dead-timemismatch字段。如果这个字段对应的计数值一直在增长，表示接口上的Dead定时器的值不一致，需要将两端接口的Dead定时器的值设置为一致。 −查看Ebitoptionmismatch字段。如果这个字段对应的计数值一直在增长，表示区域类型配置不一致（一端配置为普通区域，另一端配置为Stub或NSSA区域），需要将两端的区域类型设置为一致。 如果故障依然存在，请执行步骤(11)。 (11)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：OSPF-TRAP-MIB •ospfVirtIfStateChange(1.3.6.1.2.1.14.16.2.1) •ospfNbrStateChange(1.3.6.1.2.1.14.16.2.2)•ospfVirtNbrStateChange(1.3.6.1.2.1.14.16.2.3)相关日志 •OSPF/5/OSPF_NBR_CHG •OSPF/5/OSPF_NBR_CHG_REASON 10.4.2OSPF邻居无法达到FULL状态 ,Suggestion not provided
•单板状态异常（比如执行displaydevice命令查看单板状态为Absent、Fault等）。 •单板出现异常重启、无法启动或不断重启等。 ,"本类故障的常见原因主要包括： •单板安装不到位。 •单板损坏。 •单板面板的指示灯点亮异常。 •电源模块故障。 •电源模块输出功率不足。 •主机软件版本不支持使用该单板。 •主控板非正常工作状态。 •业务板、备用主控板或网板与主用主控板的设备标识不一致。 •业务板启动前网板不在位或网板状态异常。 3.故障分析 本类故障的诊断流程如图10所示。 图10单板状态异常故障诊断流程图 4.处理步骤 •单板状态Absent (1)确认单板是否插稳，如检查单板与机框之间是否有空隙，也可以将单板拔出后重插入。重新插入前务必检查单板的连接器状态，看连接器是否变形、脏污。 (2)将单板放到别的槽位，将框上别的正常的单板放到这个槽位，进一步确认是不是单板故障。 (3)检查单板面板的指示灯是否点亮。 (4)确认电源模块输出功率是否充足。比如增加电源模块，看该单板状态是否恢复正常。 (5)确认主机软件版本是否支持该单板。 a.通过displayversion命令查看主机软件版本； b.联系技术支持，确认当前主机软件版本是否支持该单板； c.如果当前软件版本不支持该单板，请升级到正确版本，版本升级前务必确认新版本可以兼容其它单板。 (6)如果单板是主控板，连上Console口配置电缆后，使用尖细工具（如笔尖）按单板上的系统复位键（RESET）或通过rebootslotslotidforce命令重启单板，查看配置终端上的显示的启动信息是否恢复正常（配置终端无显示或显示乱码均为异常情况），同时查看单板状态指示灯是否恢复正常。正常情况下，配置终端启动后会有类似如下显示信息输出： SystemisStarting.... PressCtrl+DtoaccessBASIC-BOOTWAREMENU PressCtrl+TtoaccessBOOTWAREDIAG-TESTMENU BootingNormalExtendBootWare **************************************************************************** ***BootWare,Version1.35******************************************************************************* CompiledDate:Dec92021 MemoryType:DDR4SDRAM MemorySize:16384MBMemorySpeed:2133MHzflashSize:7296MBCPLD1Version:4.0 CPLD2Version:1.0 CPLD3Version:1.0 PCB1Version:Ver.A PCB2Version:Ver.A BootWareValidating... PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU... Loadingthemainimagefiles... Loadingfileflash:/SYSTEM.bin.............................................. ........................................................................................................................................................ ....................................Done. Loadingfileflash:/BOOT.bin................................................ ....................................................................................................................................................................................................................................................Done. Imagefileflash:/BOOT.binisself-decompressing........................................................................................................ .............................................Done. Systemimageisstarting... Cryptographicalgorithmstestspassed. Lineaux0isavailable. PressENTERtogetstarted. (7)如果单板是带有Console口的交换网板，连上Console口配置电缆后，通过执行rebootslotslotidforce命令或拔出该单板重新插入设备来重启单板，查看配置终端上的显示信息是否恢复正常，同时查看单板状态指示灯是否恢复正常。 (8)如果单板是业务板，请先确保主控板处于正常工作状态，确保子卡连接器没有变形、脏污。 (9)如确认为单板故障，请更换单板，收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 •单板状态Power-off。 (10)确认设备环境是否存在过温下电，部分产品支持通过displaypower-supply命令查看是否存在环境温度过高，单板被下电的记录。比如单板的供电状态“Status”为“off”表示单板由于用户操作或过温保护等原因被主动下电。如果确认是过温下电，请排查环境单板槽位是否插满，如果单板槽位已插满单板或者挡风板，请通过命令displayfan确认风扇工作是否正常，风扇状态为Normal表示风扇正常工作，如不正常，或确认单板存在电源故障，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 •单板状态Fault。 (11)检查整机功耗，整机功耗不够时，单板会进入fault状态。 (12)等待一段时间（大约10分钟左右）确认下单板是一直Fault还是Normal后又再次重启。如单板是Normal后又自动重启，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 (13)如果单板是主控板、带串口网板，请连上串口线，查看配置终端上是否有单板正常启动的显示信息、或单板启动是否异常。如下述主控板启动时出现内存读写测试失败而不断重启，需要检查主控板内存条是否插稳。 readedvalueis55555555,expectedvalueisaaaaaaaa DRAMtestfailsat:080ffff8 DRAMtestfailsat:080ffff8 Fatalerror!Pleasereboottheboard. (14)将单板放到别的槽位，进一步确认是不是槽位故障。 (15)如确认为单板故障，请更换单板，收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 •单板重启异常这里的单板重启是指单板出现过重启，而当前单板状态是Normal。 (16)通过日志或运行时间分析重启的时间段，确认重启的时间点附近有无用户通过命令行reboot (17)displayversion命令支持查(重启或进行单板上下电等操作。)询单板最近一次重启的原因。比如“Lastrebootreason”表示单板最近一次重启原因是设备上电。 <Sysname>displayversion H3CComwareSoftware,Version7.1.075,Release7751P01 Copyright(c)2004-2017NewH3CTechnologiesCo.Ltd.Allrightsreserved. H3CS12508X-AFuptimeis0weeks,0days,4hours,24minutesLastrebootreason:Coldreboot…… (18)如果所有单板同时出现重启，请检查设备电源模块是否正常，确认外部电源是否出现过停电，电源进线是否插稳、是否出现松动。 (19)确认日志中重启时有无出现类似“Warning:Standbyboardonslot1isnotcompatiblewithmasterboard.”或“Warning:TheLPUboardonslot1isnotcompatiblewithMPUboard.”提示信息，这种情况是业务板、备用主控板或网板与主用主控板的设备标识不一致，请联系技术支持人员更换。 (20)如无法确认，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •SYSM_PRODUCTCHECK_TRAPWARNING1 3.5.2主控板无法启动 ",Suggestion not provided
•对设备进行每日巡检时，连续使用displaycpu-usage命令查看CPU的占用率，CPU占 执行#displaycpu-usa(用率明显比日常平均值高。)gesummary命令显示最近5秒、1分钟、5分钟内CPU占用率的平均值。 <Sysname>displaycpu-usagesummary SlotCPULast5secLast1minLast5min 105%5%4% #执行displaycpu-usagehistory命令以图表的方式显示最近60个采样点的CPU占用率，观察到CPU占用率持续在增长或者明显比日常平均值高。 •通过Telnet/SSH等方式登录设备，并执行命令行时，设备反应缓慢，出现卡顿现象。 •设备上打印CPU占用率高的相关日志。 •SNMP网管上出现CPU占用率高的相关告警。 ,"本类故障的常见原因主要包括： •Telnet客户端和设备间网络不畅通。 •Telnet客户端未启用Telnet相关功能。 •设备未开启Telnet服务。 •VTY用户线下未配置支持Telnet协议。 •登录用户名、密码不正确。 •登录设备的用户数达到了上限。 •设备上配置了对Telnet用户的访问控制，Telnet客户端不在所引用ACL的规则中permit的用户范围之内。 •认证方式配置不正确。 •当Telnet客户端和Telnet服务器均为我司设备时，用户未从Telnet客户端上指定的发送Telnet报文的源地址或源接口登录Telnet服务器。 3.故障分析 本类故障的诊断流程如图37所示。 图37Telnet登录失败的故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通设备。 用户在Telnet客户端上执行ping命令查看Telnet客户端和设备之间网络连接情况。如果不能Ping通设备的IP地址，表示Telnet客户端和设备无法建立Telnet连接，则Telnet客户端登录将失败。无法Ping通设备，也可能是终端设备禁Ping导致。请参见“Ping和Tracert故障处理手册”继续定位，确保Telnet客户端与设备之间的网络畅通。 (2)检查客户端上是否启用Telnet相关功能。通常，在PC机上新建Telnet连接前，需要在PC上的“打开或关闭Windows功能”中启用“Telnet客户端”功能。移动端等其他类型的设备作为Telnet客户端时，开启Telnet相关功能的详细介绍和使用方法请参见该设备的使用指导。 (3)检查设备侧是否开启Telnet服务。缺省情况下，Telnet服务处于关闭状态。如果系统视图下执行displaythis命令后，没有显示telnetserverenable的配置信息，表示Telnet服务处于关闭状态。请先执行telnetserverenable命令开启Telnet服务，确保设备允许客户端通过Telnet登录。 (4)查看VTY用户线支持的协议是否包含Telnet协议。 在VTY用户线或VTY用户线类视图下执行displaythis命令， 如果显示配置信息中不包含protocolinboundtelnet或protocolinboundall，表示用户线下不支持Telnet协议。 非FIPS模式下，由于系统默认支持所有协议，如果显示配置信息中包含undoprotocolinbound，或者不包含protocolinbound相关配置，表示系统支持所有协议。若用户线下不支持Telnet协议，请配置protocolinboundtelnet或protocolinboundall命令来允许Telnet协议类型的登录用户接入。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modescheme [Sysname-line-vty0-63]protocolinboundall 需要注意的是，修改protocolinbound的配置将在用户下次使用该用户线登录时生效。 (5)检查客户端登录设备的用户名和密码是否正确。当用户向设备发起Telnet连接，在Telnet客户端按照提示输入登录设备的用户名和密码后，若系统提示认证失败，则建议重新输入用户名和密码，再次尝试登录设备。如果依旧登录失败， 可以查看LOGIN/5/LOGIN_INVALID_USERNAME_PWD日志，若日志中显示类似如下内容时表示用户输入无效的用户名或密码： LOGIN/5/LOGIN_INVALID_USERNAME_PWD:Invalidusernameorpasswordfromvty0. 如果忘记正确的登录用户名或密码，请修改认证方式为不认证，或重置密码，并通知用户再次 户线类视图下执行authentication-modenone命令，设置用户登 录设备时的认证方式为不认证，用户不需要输入用户名和密码，就可以使用该用户线登录设备，但这种方式存在安全隐患，请谨慎配置。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modenone 如果登录用户的认证方式为密码认证，在用户线视图或用户线类视图下执行setauthenticationpassword命令来重新设置认证密码。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modepassword [Sysname-line-vty0-63]setauthenticationpasswordsimplehello12345&！ 如果登录用户的认证方式为AAA认证，请参见“AAA&PasswordControl故障处理手册”重置密码。(6)检查登录设备的用户数是否达到了上限。从Console口登录到设备，在任意视图下执行displayusers命令查看当前的Telnet用户数。缺省情况下，同时在线的Telnet用户数上限为32个。可以查看TELNETD/6/TELNETD_REACH_SESSION_LIMIT日志，若日志中显示类似如下内容，表示Telnet登录用户达到上限： TELNETD/6/TELNETD_REACH_SESSION_LIMIT:Telnetclient1.1.1.1failedtologin.ThecurrentnumberofTelnetsessionsis10.Themaximumnumberallowedis(10). 如果登录设备的用户数已经达到了上限，可以先断开其他空闲Telnet用户的连接，或者执行aaasession-limittelnet命令增加允许同时在线的最大用户连接数，然后再向设备发起Telnet连接。(7)查看设备上是否引用了ACL对Telnet用户的访问进行控制。 在系统视图下执行displaythis命令，如果显示telnetserveracl、telnetserveripv6acl相关配置信息，表示引用了ACL对访问设备的Telnet的用户进行控制。 确认所引用的ACL规则中允许了Telnet客户端的IP地址、端口号、协议号等。可以查看TELNETD_ACL_DENY日志，若日志中显示类似如下内容，表示TelnetACL规则限制登录IP地址： TELNETD/5/TELNETD_ACL_DENY:TheTelnetConnection1.2.3.4(vpn1)requestwasdeniedaccordingtoACLrules. 执行undotelnetserveracl或undotelnetserveripv6acl命令来取消 ACL对Telnet用户的访问限制。(8)检查设备上认证方式配置是否正确。在任意视图下执行displayline命令查看用户线下用户登录设备时的认证方式，其中“Auth”字段表示使用该用户线登录的用户的认证方式，取值为“A”表示使用AAA认证方式，取值为“N”表示无需认证，取值为“P”表示使用当前用户线的密码进行认证。 如果使用命令authentication-modepassword配置了VTY用户线下的登录认证方 如果使用命令authentication-modesche(式为密码认证，还需要确保设置了认证密码。)me设置认证方式为AAA，则必须确保已经创建了AAA认证用户。具体请参见“AAA&PasswordControl故障处理手册”。 (9)当Telnet客户端和Telnet服务器均为我司设备时，检查Telnet客户端上是否配置了发送Telnet 在系统视图下执行displ(报文的源地址或源接口。)aythis命令，如果显示中包含telnetclientsource的相关配置信息，表示Telnet客户端上指定了发送Telnet报文的源IPv4地址和源接口，请确保用户从Telnet客户端上指定的源IPv4地址或源接口登录Telnet服务器。若登录失败，请选择以下配置后重新尝试登录： 执行telnetclientsource命令重新配置发送Telnet报文的源IPv4地址或源接口。 执行undotelnetclientsource命令来恢复缺省情况，即不指定发送Telnet报文的源IPv4地址和源接口，使用报文路由出接口的主IPv4地址作为Telnet报文的源地址。需要注意的是， 在用户视图下执行telnet命令也可以指定Telnet报文的源接口或源IPv4地址，若同时使用telnetclientsource命令和telnet命令指定源IPv4地址或源接口，则以telnet命令指定的源IP地址或源接口为准。 在IPv6组网环境下，可以通过用户视图下的telnetipv6命令来指定Telnet报文的源接口或源IPv6地址。 (10)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •LOGIN/5/LOGIN_FAILED •LOGIN/5/LOGIN_INVALID_USERNAME_PWD •TELNETD/5/TELNETD_ACL_DENY •TELNETD/6/TELNETD_REACH_SESSION_LIMIT 5.2硬件资源管理故障处理 5.2.1CPU占用率高 本类故障的常见原因主要包括： •网络攻击。 •协议震荡，通常为STP震荡、路由协议震荡等。 •网络环路。 •设备上配置了流采样功能，需要处理的流量太大或者设备采样频率太高，导致采样功能占用大量CPU资源。 •设备产生海量日志，设备生成和管理这些日志需要占用大量CPU资源。 3.故障分析 本类故障的诊断流程如图38所示。 图38CPU占用率高的故障诊断流程图 4.处理步骤 (1)确认设备是否受到网络攻击。 现网中，导致设备CPU占用率高最常见的原因是网络攻击。攻击者发起大量非正常网络交互对设备产生冲击，例如短时间内发送大量TCP连接建立请求报文或者ICMP请求报文，设备忙于处理这些攻击报文，导致CPU占用率高，从而影响设备正常业务的运行。 如果受到了网络攻击，则先解决网络攻击问题。 如果未受到网络攻击，则执行步骤(2)。 (2)确认设备是否出现协议震荡。协议震荡会导致设备不断地处理协议报文、计算拓扑、更新表项，引起CPU占用率高。在实际应用中，最常见的协议震荡为STP协议震荡和OSPF协议震荡。 对于STP协议震荡，在系统视图执行stpport-log命令打开端口状态变化日志显示开关，如果命令行界面频繁输出以下日志，则说明出现了STP协议震荡。 STP/6/STP_DETECTED_TC:Instance0'sportGigabitEthernet1/0/1detectedatopologychange. STP/6/STP_DISCARDING:Instance0'sportGigabitEthernet1/0/1hasbeensettodiscardingstate. STP/6/STP_NOTIFIED_TC:Instance0'sportGigabitEthernet1/0/1wasnotifiedatopologychange. −如果STP协议震荡，请先排除STP协议震荡问题。 对(−)OSPF协议震荡，执行于displayip(如果STP协议没有震荡，则继续定位。)routing-table命令，查看路由信息。如果路由表项中相同网段的路由条目被频繁反复地创建和删除，则表示路由震荡。 −如果路由震荡，或者路由一直不存在，则先排除链路问题和IGP路由问题。−如果路由没有震荡，则执行步骤(3)。 (3)确认是否存在网络环路。 当以太网接口工作在二层模式并且链路存在环路时，可能出现广播风暴和网络振荡。大量的协议报文上送CPU处理，从而导致CPU占用率升高。当存在网络环路时，设备很多端口的流量会明显变大，且广播和组播报文占比较大。可通过以下步骤来确认设备是否存在网络环路，设备是否存在广播、组播、未知单播报文风暴。a.清除接口的统计信息。 <Sysname>resetcountersinterface b.多次执行displaycountersrateinboundinterface命令查看端口使用率是否 明显增大。 <Sysname>displaycountersrateinboundinterfaceUsage:Bandwidthutilizationinpercentage InterfaceUsage(%)Total(pps)Broadcast(pps)Multicast(pps)GE5/3/00.017----MGE0/31/00.011----MGE0/32/00.015---- VMC1/1/00.0560---- VMC1/2/00.0452---- Overflow:Morethan14digits. --:Notsupported. c.如果端口使用率明显增大，可继续多次执行displaycountersinboundinterface 命令查看接口收到的总报文数、广播和组播报文的数量，分别对应显示信息中Total(pkt)、Broadcast(pkt)、Multicast(pkt)字段的取值。如果广播和组播报文的增长速度快，广播、组播报文在接口收到的总报文数中占比大，则可能出现广播/组播风暴。如果广播和组播报文数量没有明显增加，但是接口收到的总报文数明显增加，则可能出现未知单播报文风暴。 <Sysname>displaycountersinboundinterface InterfaceTotal(pkt)Broadcast(pkt)Multicast(pkt)Err(pkt)GE5/3/0141271110MGE0/31/0274866476960--MGE0/32/010630346848082--VMC1/1/0111577977274558500 VMC1/2/096538985619640520 Overflow:Morethan14digits(7digitsforcolumn""Err""). --:Notsupported. 如链路出现环路，可进行如下处理：−排查链路连接，避免物理拓扑出现环路。 −使用displaystp命令检查STP协议是否使能，配置是否正确。如果配置错误，请 −使用displ(修改配置。)aystpbrief和displaystpabnormal-port命令检查邻接设备STP状态是否正常。请根据displaystpabnormal-port命令显示信息中的BlockReason字段的取值，定位并解决STP异常问题。如STP配置均正确，可能为STP协议计算错误或协议计算正确但端口驱动层没有正常Block阻塞，可以在发生环路的接口上执行shutdown/undoshutdown命令或者拔插网线让STP重新计算来快速恢复STP功能，消除环路。 −在以太网接口视图下，使用broadcast-suppression命令开启端口广播风暴抑制功能，使用multicast-suppression命令开启端口组播风暴抑制功能，使用unicast-suppression命令开启端口未知单播风暴抑制功能。或者使用flow-control命令配置流量控制功能。（broadcast-suppression、multicast-suppression、unicast-suppression和flow-control命令仅部 分设备支持，如不支持这些命令请忽略此处理方式）−使用QoS策略针对组播、广播和未知单播报文进行限速。 如未出现环路，请执行步骤(4)或步骤（5）。 (4)对于支持流统计和采样功能的设备：确认是否配置了流统计和采样功能，以及配置的参数是否合适。当设备上配置了NetStream、sFlow等网络流量监控功能后，设备会对网络流量进行统计分析。如果网络流量较高，可能会导致CPU占用率偏高。此时，可进行以下处理：配置过滤条件来精确匹配流量，仅统计分析用户关心的流量。 配置采样器，调整采样比例，使得NetStream、sFlow收集到的统计信息既能基本反映整个网络的状况，又能避免统计报文过多影响设备转发性能。 (5)对于仅支持采样功能的设备：确认是否配置了采样功能，以及配置的参数是否合适。当设备上配置了sFlow等网络流量监控功能后，设备会对网络流量进行统计分析。如果网络流量较高，可能会导致CPU占用率偏高。此时，可进行以下处理：配置采样器，调整采样比例，使得sFlow收集到的统计信息既能基本反映整个网络的状况，又能避免统计报文过多影响设备转发性能。 (6)确认设备当前是否正在生成海量日志。某些异常情况下，例如，设备受到攻击、运行中发生了错误、端口频繁Up/Down等，设备会不停地产生诊断信息或日志信息。此时系统软件要频繁的读写存储器，会造成CPU占用率升高。 允许日志信息输出到当前终端。 <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 配置该命令后，如果有大量异常日志或者重复日志输出到命令行界面，则说明设备正在生 重复执行dis(成海量日志。)playlogbuffersummary命令，如果日志信息总量有明显的增加，再使用displaylogbufferreverse命令查看日志详情，确认是否有大量异常日志或者某一条信息大量重复出现。 <Sysname>displaylogbuffersummary SlotEMERGALERTCRITERRORWARNNOTIFINFODEBUG 1002924121280 5000417282097004211147400 <Sysname>displaylogbufferreverse Logbuffer:Enabled Maxbuffersize:1024 Actualbuffersize:512 Droppedmessages:0 Overwrittenmessages:0 Currentmessages:410 %Jan1508:17:24:2592021SysnameSHELL/6/SHELL_CMD: -Line=vty0-IPAddr=192.168.2.108-User=**;Commandisdisplaylogbuffer %Jan1508:17:19:7432021SysnameSHELL/4/SHELL_CMD_MATCHFAIL: -User=**-IPAddr=192.168.2.108;Commanddisplaylogfileinviewshellfailedtobematched. ... 如果设备正在生成海量日志，可以通过以下方法减少日志的生成： ess命令禁止指定模块日志的输出。 使用info-centerloggingsuppressduplicates命令开启重复日志抑制功能。如果设备未生成海量日志，则执行步骤(6)。 (7)收集CPU占用率相关信息，找到CPU占用率高的业务模块。 a.确定对CPU占用率高的任务。 #在设备上执行displayprocesscpu命令查看一段时间内占用CPU最多的任务。下面以slot1上的操作为例。 <Sysname>displayprocesscpuslot1 CPUutilizationin5secs:0.4%;1min:0.2%;5mins:0.2% JID5Sec1Min5MinName 10.0%0.0%0.0%scmd 25.5%5.1%5.0%[kthreadd]30.0%0.0%0.0%[ksoftirqd/0] ...如果某个进程的CPU占用率高于3%（经验值供参考），则需要针对该进程继续定位。#在设备上执行monitorprocessdumbtty命令实时查看进程在指定CPU上的占用率。下面以slot1CPU0为例。 <Sysname>system-view [Sysname]monitorprocessdumbttyslot1cpu0 206processes;342threads;5134fds Threadstates:4running,338sleeping,0stopped,0zombie CPU0:99.04%idle,0.00%user,0.96%kernel,0.00%interrupt,0.00%steal CPU1:98.06%idle,0.00%user,1.94%kernel,0.00%interrupt,0.00%steal CPU2:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%stealCPU3:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal CPU4:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal Memory:7940Mtotal,5273Mavailable,pagesize4K JIDPIDPRIStateFDsMEMHH:MM:SSCPUName 322322115R00K01:48:0320.02%[kdrvfwdd2] 323323115R00K01:48:0320.02%[kdrvfwdd3] 324324115R00K01:48:0320.02%[kdrvfwdd4] 376376120S22159288K00:00:070.37%diagd 11120S1830836K00:00:020.18%scmd 379379120S22173492K00:00:110.18%devd 22120S00K00:00:000.00%[kthreadd] 33120S00K00:00:020.00%[ksoftirqd/0] … −在monitorprocessdumbtty命令显示信息中找到CPU占用率超过3%（经验值供参考）的进程的JID，再对这些进程执行displayprocessjob命令，收集进程的详细信息，并确认该进程是否运行在控制核上。 如果displayprocessjob命令的显示信息中LAST_CPU字段的取值为控制核的编号（例如0～1），则说明该进程运行在CPU控制核上，则需要进一步定位；如果显示信息中LAST_CPU字段的取值为非控制核的编号，则说明该进程运行在CPU转发核上，无需关注，请执行步骤(7)。下面以pppd进程为例，通过显示信息可以看到，该进程包含多个线程，这些线程都运行在控制核上。 <Sysname>displayprocessnamepppd JobID:515PID:515 ParentJID:1 ParentPID:1 Executablepath:/sbin/pppd Instance:0 Respawn:ON Respawncount:1 Max.spawnsperminute:12 Laststarted:WedNov309:52:002021 Processstate:sleeping Max.core:1 ARGS:--MaxTotalLimit=2000000 --MaxIfLimit=65534--CmdOption=0x01047fbf--bSaveRunDb--pppoechastenflag=1 --pppoechastennum=6--pppoechastenperiod=60--pppoechastenblocktime=300 --pppchastenflag=1--pppchastennum=6--pppchastenperiod=60 --pppchastenblocktime=300--PppoeKChasten--bSoftRateLimit--RateLimitToken=2048 TIDLAST_CPUStackPRIStateHH:MM:SS:MSECName5150136K115S0:0:0:90pppd 5490136K115S0:0:0:0ppp_misc 5570136K115S0:0:0:10ppp_chasten 6100136K115S0:0:0:0ppp_work06111136K115S0:0:0:0ppp_work1 6121136K115S0:0:0:0ppp_work2 6131136K115S0:0:0:0mp_main 6181136K115S0:0:0:110pppoes_main6191136K115S0:0:0:100pppoes_mesh 6201136K115S0:0:0:120l2tp_mesh 6211136K115S0:0:0:20l2tp_main −对于运行在控制核、CPU占用率超过5%的进程，查看进程的Name字段的取值来确定该进程是否为用户态进程。 如果Process的Name取值中包含“[]”，表示它是内核线程，无需执行monitorthreaddumbtty命令；如果Process的Name取值中未包含“[]”，表示它是用户态进程，它可能包含多个线程。对于多线程的用户态进程，还需要对该用户态进程执行monitorthreaddumbtty命令，如果显示信息中某线程LAST_CPU字段的取值为CPU控制核的编号，且CPU字段取值大于5%，则该线程可能为导致CPU控制核占用率高的线程，需要进一步定位。 <Sysname>monitorthreaddumbttyslot1cpu0 206processes;342threads;5134fds Threadstates:4running,338sleeping,0stopped,0zombie CPU0:98.06%idle,0.97%user,0.97%kernel,0.00%interrupt,0.00%steal CPU1:97.12%idle,0.96%user,0.96%kernel,0.96%interrupt,0.00%steal CPU2:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%stealCPU3:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal CPU4:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal Memory:7940Mtotal,5315Mavailable,pagesize4K JIDTIDLAST_CPUPRIStateHH:MM:SSMAXCPUName 3223222115R00:04:21020.15%[kdrvfwdd2]3233233115R00:04:21020.15%[kdrvfwdd3] 3243244115R00:04:21020.15%[kdrvfwdd4] 111120S00:00:02210.19%scmd 3763761120S00:00:0010.19%diagd220120S00:00:0000.00%[kthreadd] ... b.确认异常任务的调用栈。 在Probe视图下执行followjob命令确认异常任务的调用栈。下面以Sysname上（slot 1）pppd进程（进程编号为515）的操作为例。 <Sysname>system-view [Sysname]probe [Sysname-probe]followjob515slot1 Attachingtoprocess515(pppd) Iteration1of5 ------------------------------ ThreadLWP515:Switches:3205 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x0000000000441745inppp_EpollSched+0x35/0x5c #20x0000000000000004in?? Kernelstack: [<ffffffff811f0573>]ep_poll+0x2f3/0x370 [<ffffffff811f06c0>]SyS_epoll_wait+0xd0/0xe0 [<ffffffff814aed79>]system_call_fastpath+0x16/0x1b[<ffffffffffffffff>]0xffffffffffffffff ThreadLWP549:Switches:20 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x00000000004435d4inppp_misc_EpollSched+0x44/0x6c Kernelstack: [<ffffffffffffffff>]0xffffffffffffffff ... c.根据a和b步骤找到任务名称，再根据任务名称找到对应的业务模块，定位并处理业务模块的问题。例如，如果任务snmpd的CPU占用率较高，可能是因为设备受到了SNMP攻击，或者NMS对设备的访问太频繁。需要进一步定位SNMP业务模块的问题；如果任务nqad的CPU占用率较高，可能是因为NQA探测太频繁，需要进一步定位NQA业务模块的问题。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 •hh3cEntityExtCpuUsageThresholdNotfication •hh3cEntityExtCpuUsageThresholdRecover •hh3cCpuUsageSevereNotification •hh3cCpuUsageSevereRecoverNotification •hh3cCpuUsageMinorNotification •hh3cCpuUsageMinorRecoverNotification 相关日志 •DIAG/5/CPU_MINOR_RECOVERY •DIAG/4/CPU_MINOR_THRESHOLD •DIAG/5/CPU_SEVERE_RECOVERY •DIAG/3/CPU_SEVERE_THRESHOLD 5.3软件升级故障处理 5.3.1设备启动失败 ",Suggestion not provided
1.1.1.9/32ISIS16010/-- 2.2.2.9/32OSPF16020/17020RAGG,Cause not provided,Suggestion not provided
"2.2.2.2/32Direct00127.0.0.1InLoop0 4.4.4.4/32O_INTRA10124.1.1.4GE1/0/1 12.1.1.0/24Direct0012.1.1.2GE1/0/2 12.1.1.0/32Direct0012.1.1.2GE1/0/2 12.1.1.2/32Direct00127.0.0.1InLoop0 12.1.1.255/32Direct0012.1.1.2GE1/0/2 14.1.1.0/24O_INTRA10212.1.1.1GE1/0/2 O_INTRA10224.1.1.4GE1/0/1 23.1.1.0/24Direct0023.1.1.2GE1/0/3 23.1.1.0/32Direct0023.1.1.2GE1/0/3 23.1.1.2/32Direct00127.0.0.1InLoop0 23.1.1.255/32Direct0023.1.1.2GE1/0/3 24.1.1.0/24Direct0024.1.1.2GE1/0/1 24.1.1.0/32Direct0024.1.1.2GE1/0/1 24.1.1.2/32Direct00127.0.0.1InLoop0 24.1.1.255/32Direct0024.1.1.2GE1/0/1 100.1.1.0/24BGP255023.1.1.3GE1/0/3 127.0.0.0/8Direct00127.0.0.1InLoop0 127.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.1/32Direct00127.0.0.1InLoop0 127.255.255.255/32Direct00127.0.0.1InLoop0 255.255.255.255/32Direct00127.0.0.1InLoop0 对于来自Leaf的100.1.1.0/24网段路由，到达其下一跳的IGP路由为23.1.1.0/24，该IGP路由的Metric为0；对于来自Spine1的100.1.1.0/24网段路由，到达其下一跳的IGP路由为1.1.1.1/32该IGP路由的Metric值为1。由于到达两条路由的下一跳的IGP路由的Metric值不相同，BGP路由表中两条100.1.1.0/24网段路由无法形成负载分担。这也是网络管理员需要的结果：到达Spine2的目的地址属于100.1.1.0/24网段的流量，会被Spine2全部直接转发给Leaf；而不是先发往Spine1，再由Spine1转发至Leaf。 Spine3通过BGP协议向Spine2发送了缺省路由，缺省路由的下一跳为Spine3与Spine2直连的接口IP地址。Spine1重启后，在会话保持时间内，Spine2仍不会断开与Spine1的会话，Spine2的路由表中仍会保留从Spine1接收到的100.1.1.0/24网段路由。但是由于下一跳1.1.1.1的IGP路由已经失效，且Spine2上不存在包含地址1.1.1.1的其他网段路由，来自Spine1的100.1.1.0/24网段路由只能迭代到缺省路由0.0.0.0/0上。此时Spine2的BGP路由表中，来自Spine1的100.1.1.0/24网段路由到达下一跳的IGP路由的 Metric值变为0（对应上表中的路由表项“0.0.0.0/0BGP255024.1.1.4 GE1/0/1”），与来自Leaf的100.1.1.0/24网段路由到达下一跳的IGP路由的Metric值相同。来自不同BGP对等体的两条100.1.1.0/24网段路由形成负载分担，导致经过Spine2的目的地址属于100.1.1.0/24网段的流量有一半通过负载分担被发送给了Spine3。而由于Spine3上100.1.1.0/24的网段路由学习自Spine1和Spine2，Spine3又会把流量转发回Spine2，造成环路和路由丢失。 3.故障分析 本类故障的诊断流程如图70所示。 图70Spine和Leaf设备跨AS连接场景BGP路由环路的诊断流程图 4.处理步骤 (1)查看Spine2的BGP路由表和IP路由表。本步骤以图69的组网为例，来说明Spine2上的BGP路由表和IP路由表情况。 a.Spnie1重启后，在Spnie1与Spnie2的会话断开前，在Spnie2上执行displaybgprouting-tableipv4命令可以看到来自不同设备的两条100.1.1.0/24网段路由同时被优选。 <Spine2>displaybgprouting-tableipv4 Totalnumberofroutes:3 BGPlocalrouterIDis2.2.2.2 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala-additional-path Origin:i-IGP,e-EGP,?-incomplete NetworkNextHopMEDLocPrfPrefValPath/Ogn *>i0.0.0.0/024.1.1.41000i *>e100.1.1.0/2423.1.1.30020i *>i1.1.1.10100020i b.在Spine2上执行displayiprouting-tableverbose命令，可以看到100.1.1.0/24 网段的两条路由形成了等价，并且其中一条路由的真实下一跳为Spine3的接口IP地址 24.1.1.4、出接口为Spine2与Spine3直连的接口。 <Spine2>displayiprouting-table100.1.1.0/24verbose Summarycount:2 Destination:100.1.1.0/24 Protocol:BGPinstancedefault ProcessID:0 SubProtID:0x5Age:00h00m13s FlushedAge:00h00m13s Cost:0Preference:255 IpPre:N/AQosLocalID:N/A Tag:0State:ActiveAdv OrigTblID:0x0OrigVrf:default-vrfTableID:0x2OrigAs:20NibID:0x16000002LastAs:10 AttrID:0x2 BkAttrID:0xffffffffNeighbor:1.1.1.1Flags:0x10060OrigNextHop:1.1.1.1 Label:NULLRealNextHop:24.1.1.4 BkLabel:NULLBkNextHop:N/A SRLabel:NULLInterface:GigabitEthernet1/0/1 BkSRLabel:NULLBkInterface:N/A TunnelID:InvalidIPInterface:GigabitEthernet1/0/1 BkTunnelID:InvalidBkIPInterface:N/AInLabel:NULLColorInterface:N/A SIDIndex:NULLBkColorInterface:N/A FtnIndex:0x0TunnelInterface:N/A TrafficIndex:N/ABkTunnelInterface:N/AConnector:N/APathID:0x0 UserID:0x0SRTunnelID:InvalidSIDType:N/ANID:InvalidFlushNID:InvalidBkNID:Invalid BkFlushNID:InvalidStatFlags:0x0 SID:N/ABkSID:N/A CommBlockLen:0Priority:LowMemberPort:N/A Destination:100.1.1.0/24 Protocol:BGPinstancedefault ProcessID:0 SubProtID:0x6Age:01h18m22s FlushedAge:00h00m13s Cost:0Preference:255 IpPre:N/AQosLocalID:N/A Tag:0State:ActiveAdv OrigTblID:0x0OrigVrf:default-vrfTableID:0x2OrigAs:20NibID:0x16000000LastAs:20 AttrID:0x0 BkAttrID:0xffffffffNeighbor:23.1.1.3Flags:0x10060OrigNextHop:23.1.1.3 Label:NULLRealNextHop:23.1.1.3 BkLabel:NULLBkNextHop:N/A SRLabel:NULLInterface:GigabitEthernet1/0/3 BkSRLabel:NULLBkInterface:N/A TunnelID:InvalidIPInterface:GigabitEthernet1/0/3 BkTunnelID:InvalidBkIPInterface:N/AInLabel:NULLColorInterface:N/A SIDIndex:NULLBkColorInterface:N/A FtnIndex:0x0TunnelInterface:N/A TrafficIndex:N/ABkTunnelInterface:N/AConnector:N/APathID:0x0 UserID:0x0SRTunnelID:InvalidSIDType:N/ANID:Invalid FlushNID:InvalidBkNID:Invalid BkFlushNID:InvalidStatFlags:0x0 SID:N/ABkSID:N/A CommBlockLen:0Priority:Low MemberPort:N/A c.执行displayiprouting-table命令，可以看到IP路由表中没有包含地址1.1.1.1的其他网段路由，缺省路由的下一跳出接口和下一跳IP也为GigabitEehternet1/0/1和24.1.1.4，由此可以判断出，来自Spine1的100.1.1.0/24网段路由迭代到了缺省路由上。 <Spine2>displayiprouting-table Destinations:23Routes:24 Destination/MaskProtoPreCostNextHopInterface 0.0.0.0/0BGP255024.1.1.4GE1/0/1 0.0.0.0/32Direct00127.0.0.1InLoop0 2.2.2.2/32Direct00127.0.0.1InLoop0 4.4.4.4/32O_INTRA10124.1.1.4GE1/0/1 12.1.1.0/24Direct0012.1.1.2GE1/0/2 12.1.1.0/32Direct0012.1.1.2GE1/0/2 12.1.1.2/32Direct00127.0.0.1InLoop012.1.1.255/32Direct0012.1.1.2GE1/0/214.1.1.0/24O_INTRA10224.1.1.4GE1/0/1 23.1.1.0/24Direct0023.1.1.2GE1/0/3 23.1.1.0/32Direct0023.1.1.2GE1/0/3 23.1.1.2/32Direct00127.0.0.1InLoop0 23.1.1.255/32Direct0023.1.1.2GE1/0/3 24.1.1.0/24Direct0024.1.1.2GE1/0/1 24.1.1.0/32Direct0024.1.1.2GE1/0/1 24.1.1.2/32Direct00127.0.0.1InLoop0 24.1.1.255/32Direct0024.1.1.2GE1/0/1 100.1.1.0/24BGP25501.1.1.1GE1/0/1 BGP255023.1.1.3GE1/0/3 127.0.0.0/8Direct00127.0.0.1InLoop0 127.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.1/32Direct00127.0.0.1InLoop0 127.255.255.255/32Direct00127.0.0.1InLoop0 255.255.255.255/32Direct00127.0.0.1InLoop0如果查看路由表项的结果与上述情形不符，请联系技术支持人员获得帮助。 (2)通过以下三种方式中的一种来消除路由环路。 配置根据路由策略来过滤迭代到的下一跳路由。 在RIBIPv4地址族视图下配置protocolbgpnexthoprecursive-lookuproute-policyroute-policy-name命令后，所有IPv4地址前缀的BGP路由的下一跳都只能迭代到通过路由策略route-policy-name过滤的路由上；在RIBIPv6地址族 视图下配置protocolbgp4+nexthoprecursive-lookuproute-policy route-policy-name命令后，所有IPv6地址前缀的BGP路由的下一跳都只能迭代到通过路由策略route-policy-name过滤的路由上。在本故障诊断的场景下，可以在Spine2上创建一个缺省路由无法通过过滤的路由策略，并配置protocolbgpnexthoprecursive-lookuproute-policyroute-policy-name或protocolbgpnexthoprecursive-lookuproute-policyroute-policy-name命令指定该路由策略，使得BGP路由无法迭代到缺省路由上，从而消除BGP路由环路。 配置BGP与BFD联动功能。 开启BGP与BFD联动功能后，Spine1和Spine2之间会使用BFD会话来检测链路，当Spine1重启时，BFD可以快速检测到链路故障，Spine2会及时断开BGP会话，删除失效路由，即从Spine1学习到的路由。BGP与BFD联动功能通过peerbfd命令进行配置，配置的详细指导以及注意事项请参见命令参考手册。 配置BGP负载分担时，不允许设备在EBGP和IGBP路由之间进行负载分担。 本例中的两条100.1.1.0/24网段路由分别来自IBGP会话和EBGP会话，在BGP进程中配置balance命令时，只要不指定eibgp参数，设备就不会在EBGP和IBGP路由之间进行负载分担，Spine2就能根据BGP的选路规则只优选来自Leaf的100.1.1.0/24网段路由，保证全部流量的正常转发。 (3)如果故障仍未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 无 相关日志无 10.2IS-IS故障处理 10.2.1IS-IS邻居无法建立 ",Cause not provided,Suggestion not provided
2.2.2.2/32ISIS16020/3GE0/0/1 2.2.2.2/32ISIS-/3GE0/0/13.3.3.3/32ISIS16030/16030GE0/0/1 3.3.3.3/32ISIS-/16030GE0/0/1 4.4.4.4/32ISIS16040/16040GE0/0/1 4.4.4.4/32ISIS-/16040GE0/0/11.1.1.1/1/4122SR-TE-/16030GE0/0/1 16040 ,本类故障的常见原因主要包括：•物理链路故障。 •IGP或BGP邻居关系未正常建立导致SR-MPLS标签发布失败。 •SR-MPLS配置缺少或错误。采用SR-BE方式建立SRLSP完全依赖于IGP或BGP路由的发布，在IGP或BGP邻居之间通告路由信息时，需要携带SR-MPLS标签信息以建立SRLSP。因此，IGP或BGP邻居关系是否正常建立、IGP路由是否正常发布是本类故障最重要的原因。 3.故障分析 本类故障的诊断流程如图114所示。 图114采用SR-BE方式无法建立SRLSP的故障诊断流程图 4.处理步骤 (1)在SRLSP经过的各个节点上通过命令displayinterfacebrief检查物理链路状态，确保SRLSP转发路径上各接口的物理状态和数据链路层协议状态均为UP。如果链路正常，或链路恢复后问题仍未解决，请继续执行以下操作。 (2)在SRLSP经过的各个节点上检查IGP/BGP邻居关系是否正常建立，IGP/BGP配置是否正确。 SR-MPLS采用不同的路由协议发布标签时，故障处理方法有所不同： 如果使用OSPF作为IGP来通告路由信息并发布SR-MPLS标签： −通过displayospf命令来判断OSPF是否使能OpaqueLSA发布接收能力。如果displayospf命令显示信息中存在Opaquecapable字段，表示OpaqueLSA发布 接收能力处于开启状态。若未使能该功能，则需要在OSPF视图下执行opaque-capabilityenable命令。 −执行displayospfpeer命令确认OSPF邻接关系是否正常。如果显示信息中邻居状态字段State显示为Full，表示OSPF邻居关系正常。否则，请参见OSPF故障处理手册中“OSPF邻居无法达到FULL状态”的处理过程。 −执行displaymplslsp命令检查是否存在OSPF协议发布的SRPrefix方式的LSP信息。各节点的SRPrefixSID是管理员为Loopback地址手工指定的SID。如果没有SRPrefix方式的LSP信息，请在各节点的Loopback接口视图下检查是否使用ospfarea命令使能OSPF或在OSPF视图下是否使用network命令引入Loopback接口网段地址。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX ,Suggestion not provided
2.2.2.2/32O_INTRA10129.1.1.2GE1/0/2 3.3.3.3/32O_INTRA10139.1.1.3GE1/0/3 9.9.9.9/32Direct00127.0.0.1InLoop0 10.10.10.10/32BGP25501.1.1.1GE1/0/1 19.1.1.0/24Direct0019.1.1.9GE1/0/1 19.1.1.0/32Direct0019.1.1.9GE1/0/1 19.1.1.9/32Direct00127.0.0.1InLoop0 19.1.1.255/32Direct0019.1.1.9GE1/0/1 10.110.0.0/16BGP25504.4.4.4GE1/0/1 29.1.1.0/24Direct0029.1.1.9GE1/0/2 29.1.1.0/32Direct0029.1.1.9GE1/0/2 29.1.1.9/32Direct00127.0.0.1InLoop0 29.1.1.255/32Direct0029.1.1.9GE1/0/2 39.1.1.0/24Direct0039.1.1.9GE1/0/3 39.1.1.0/32Direct0039.1.1.9GE1/0/3 39.1.1.9/32Direct00127.0.0.1InLoop0 39.1.1.255/32Direct0039.1.1.9GE1/0/3 49.1.1.0/24Direct0029.1.1.9GE1/0/2 49.1.1.0/32Direct0029.1.1.9GE1/0/2 49.1.1.9/32Direct00127.0.0.1InLoop0 49.1.1.255/32Direct0029.1.1.9GE1/0/2 127.0.0.0/8Direct00127.0.0.1InLoop0 127.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.1/32Direct00127.0.0.1InLoop0 127.255.255.255/32Direct00127.0.0.1InLoop0 255.255.255.255/32Direct00127.0.0.1InLoop0如果查看路由表项的结果与上述情形不符，请联系技术支持人员获得帮助。 (2)通过以下两种方式中的一种消除路由环路。 配置根据路由策略来过滤迭代到的下一跳路由。 在RIBIPv4地址族视图下配置protocolbgpnexthoprecursive-lookuproute-policyroute-policy-name命令后，所有IPv4地址前缀的BGP路由的下一跳都只能迭代到通过路由策略route-policy-name过滤的路由上；在RIBIPv6地址族 视图下配置protocolbgp4+nexthoprecursive-lookuproute-policy route-policy-name命令后，所有IPv6地址前缀的BGP路由的下一跳都只能迭代到通过路由策略route-policy-name过滤的路由上。 在本故障诊断的场景下，可以在RR1上创建一个缺省路由无法通过过滤的路由策略，并配置protocolbgpnexthoprecursive-lookuproute-policyroute-policy-name或protocolbgpnexthoprecursive-lookuproute-policyroute-policy-name命令指定该路由策略，使得BGP路由无法迭代到缺省路由上，从而消除BGP路由环路。 配置BGP与BFD联动功能。 开启BGP与BFD联动功能后，RR1和Border3、Border4之间会使用BFD会话来检测链路，当Border3或Border4重启时，BFD可以快速检测到链路故障，RR1会及时断开BGP会话，删除失效路由，即从Border3或Border4学习到的路由。BGP与BFD联动功能通过peerbfd命令进行配置，配置的详细指导以及注意事项请参见命令参考手册。 (3)如果故障仍未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 10.1.4Spine和Leaf设备跨AS连接场景BGP路由环路 ,Cause not provided,Suggestion not provided
"2.2.2.2/32O_INTRA10129.1.1.2GE1/0/2 3.3.3.3/32O_INTRA10139.1.1.3GE1/0/34.4.4.4/32O_INTRA10149.1.1.4GE1/0/4 9.9.9.9/32Direct00127.0.0.1InLoop0 10.10.10.10/32BGP25501.1.1.1GE1/0/1 19.1.1.0/24Direct0019.1.1.9GE1/0/1 19.1.1.0/32Direct0019.1.1.9GE1/0/1 19.1.1.9/32Direct00127.0.0.1InLoop0 19.1.1.255/32Direct0019.1.1.9GE1/0/1 10.110.0.0/16BGP25503.3.3.3GE1/0/3 29.1.1.0/24Direct0029.1.1.9GE1/0/2 29.1.1.0/32Direct0029.1.1.9GE1/0/2 29.1.1.9/32Direct00127.0.0.1InLoop0 29.1.1.255/32Direct0029.1.1.9GE1/0/2 39.1.1.0/24Direct0039.1.1.9GE1/0/3 39.1.1.0/32Direct0039.1.1.9GE1/0/3 39.1.1.9/32Direct00127.0.0.1InLoop0 39.1.1.255/32Direct0039.1.1.9GE1/0/3 49.1.1.0/24Direct0029.1.1.9GE1/0/2 49.1.1.0/32Direct0029.1.1.9GE1/0/2 49.1.1.9/32Direct00127.0.0.1InLoop0 49.1.1.255/32Direct0029.1.1.9GE1/0/2 127.0.0.0/8Direct00127.0.0.1InLoop0 127.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.1/32Direct00127.0.0.1InLoop0 127.255.255.255/32Direct00127.0.0.1InLoop0 255.255.255.255/32Direct00127.0.0.1InLoop0 在上表中，RR1通过IGP协议学习到Border3和Border4的Loopback接口路由。BGP网段路由10.110.0.0/16迭代到通过IGP学习的Border3和Border4的Loopback接口路由上。 假设Border4进行了设备重启，在Border4重启后，会话保持时间内RR1仍不会断开与Border4的会话，RR1的路由表中仍会保留从Border4接收到的10.110.0.0/16网段路由。但是由于下一跳4.4.4.4的IGP路由已经失效，且RR1上不存在包含地址4.4.4.4的其他网段路由，来自Border4的10.110.0.0/16网段路由只能迭代到缺省路由0.0.0.0/0上。此时RR1的BGP路由表中，来自Border3的10.110.0.0/16网段路由到达下一跳的IGP路由的 Metric值为1（对应上表中的路由表项“3.3.3.3/32O_INTRA10139.1.1.3GE1/0/3”），而来自Border4的10.110.0.0/16网段路由到达下一跳的IGP路由的Metric值为0（对应上表中的路由表项“0.0.0.0/0BGP255019.1.1.1GE1/0/1”）。按照BGP路由的优选规则，RR1优选来自Border4的10.110.0.0/16网段路由，在路由转发表中，网段 10.110.0.0/16的下一跳变为GigabitEehternet1/0/1。在转发目的地址属于10.110.0.0/16网段的报文时，RR1会把报文错误地发送给Border1，并且由于Border1上10.110.0.0/16网段的路由学习自RR1，Border1又会把报文转发回RR1，如此往复造成环路。 3.故障分析 本类故障的诊断流程如图68所示。 图68跨AS域的数据中心互联场景BGP路由环路的故障诊断流程图 4.处理步骤 (1)查看RR1的BGP路由表和IP路由表。本步骤以图67的组网为例，来说明RR1上的BGP路由表和IP路由表情况。 a.Border4重启后，在RR1与Border4的会话断开前，在RR1上执行displaybgprouting-tableipv4命令可以看到来自Border4的10.110.0.0/16网段路由仍然生效，并且被优选了。 <RR1>displaybgprouting-tableipv4 Totalnumberofroutes:5 BGPlocalrouterIDis9.9.9.9 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala-additional-path Origin:i-IGP,e-EGP,?-incomplete NetworkNextHopMEDLocPrfPrefValPath/Ogn *>i0.0.0.0/019.1.1.11000i*i29.1.1.21000i *>e10.110.0.0/164.4.4.40020i *e3.3.3.30020i b.在RR1上执行displayiprouting-tableverbose命令，可以看到10.110.0.0/16 网段路由的出接口和真实下一跳变为了RR1与Border1之间的直连接口 GigabitEehternet1/0/1以及直连IP地址19.1.1.1。<RR1>displayiprouting-table10.110.0.0/16verbose Summarycount:1 Destination:10.110.0.0/16 Protocol:BGPinstancedefault ProcessID:0 SubProtID:0x6Age:00h00m19s FlushedAge:00h00m19s Cost:0Preference:255 IpPre:N/AQosLocalID:N/A Tag:0State:ActiveAdv OrigTblID:0x0OrigVrf:default-vrf TableID:0x2OrigAs:20NibID:0x16000002LastAs:20 AttrID:0x2 BkAttrID:0xffffffffNeighbor:4.4.4.4Flags:0x10060OrigNextHop:4.4.4.4 Label:NULLRealNextHop:19.1.1.1 BkLabel:NULLBkNextHop:N/A SRLabel:NULLInterface:GigabitEthernet1/0/1 BkSRLabel:NULLBkInterface:N/A TunnelID:InvalidIPInterface:GigabitEthernet1/0/1 BkTunnelID:InvalidBkIPInterface:N/AInLabel:NULLColorInterface:N/A SIDIndex:NULLBkColorInterface:N/A FtnIndex:0x0TunnelInterface:N/A TrafficIndex:N/ABkTunnelInterface:N/AConnector:N/APathID:0x0 UserID:0x0SRTunnelID:Invalid SIDType:N/ANID:InvalidFlushNID:InvalidBkNID:Invalid BkFlushNID:InvalidStatFlags:0x0 SID:N/ABkSID:N/A CommBlockLen:0Priority:Low MemberPort:N/A c.执行displayiprouting-table命令，可以看到IP路由表中没有包含地址4.4.4.4的其他网段路由，缺省路由的下一跳出接口和下一跳IP也为GigabitEehternet1/0/1和19.1.1.1，由此可以判断出，来自Border4的10.110.0.0/16网段路由迭代到了缺省路由上。 <RR1>displayiprouting-table Destinations:25Routes:25 Destination/MaskProtoPreCostNextHopInterface 0.0.0.0/0BGP255019.1.1.1GE1/0/1 0.0.0.0/32Direct00127.0.0.1InLoop0 ",Cause not provided,Suggestion not provided
3网段。 图103IPv6MPLSL3VPN组网图 ,本类故障的常见原因主要为：CE3上没有到达PE1所有私网IPv6地址的路由。私网IPv6地址的范围是，PE1上与CE3相同的VPN实例中，所有处于UP状态的接口的IPv6地址。 3.故障分析 本故障的处理流程如图104所示。 图104PE设备Ping不同远端CE网段故障诊断流程图 4.操作步骤 (2)检查CE3上是否存在到达PE1所有私网IPv6地址的路由。 PE1在Ping远端CE网段时，会使用当前设备上指定VPN实例中所有处于UP状态的接口的IPv6地址中，最小的IPv6地址作为ICMPv6报文的源地址，如果CE3没有该IPv6地址的路由信息，将会导致ICMPv6报文无法返回。 上述问题可以通过以下方法解决： 在PE1上配置发布本设备的所有私网路由，例如，在BGP-VPNIPv6单播地址族视图下，配置import-routedirect命令。 执行Ping操作时，指定ICMPv6回显请求报文中的源IPv6地址为CE3的IPv6路由表中存在的地址，即执行pingipv6–asource-ipv6-vpn-instancevpn-instance-namehost命令。如果故障仍不能排除，请执行步骤（2）。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 12.4MPLSTE故障处理 12.4.1MPLSTE隧道状态为Down ,Suggestion not provided
802.1X、MAC地址认证、Web认证用户认证时，RADIUS服务器不可达情况下的逃生功能失效。 包括： •	未逃生，新用户无法上线。 •	已逃生，但不能访问配置的逃生资源。 •	已逃生，但又被强制下线。 ,本类故障的常见原因主要包括： •	接口上配置了端口安全的FreeVLAN，指定VLAN的用户流量不进行认证。 •	未按照实际需要配置相应的逃生策略。 •	采用RADIUS认证方案进行认证时，并非该方案下的所有RADIUS服务器均不可达，实际上存在可达的RADIUS服务器，且是其它原因造成用户认证失败。 •	为用户配置RADIUS认证方法的同时指定了备选认证方法（Local或None），导致RADIUS认证服务器不可达后，转为进行本地认证或不认证。 •	对于802.1X认证、MAC地址认证用户，采用接口上的逃生策略时，接口上配置的逃生资源不存在。 •	接口上开启了802.1X认证或MAC认证下线检测功能的情况下，未开启对应的在线用户逃生功能，使得设备因为在一个下线检测定时器间隔内没有检测到用户的流量而强制用户下线。 3.	故障分析 本类故障的诊断流程如图148所示。 图148RADIUS认证时逃生失效故障诊断流程图 ,"(1)	检查端口上是否配置了端口安全FreeVLAN。如果用户接入的端口上配置了端口安全FreeVLAN，那么指定VLAN内的802.1X认证、MAC地址认证用户的流量将不会触发认证，而是直接转发，因此这些用户也不会触发逃生功能。端 口安全FreeVLAN的配置示例如下： <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]port-securityfree-vlan23 如果不希望指定VLAN内的用户流量直接转发，请取消相关FreeVLAN的配置。 (2)	检查配置的逃生策略是否准确。 设备上支持两种逃生策略，请按需配置： 	基于ISP域逃生（802.1X认证、MAC地址认证和Web认证用户）：设备进入逃生状态时，认证域内新接入的用户从当前域中“逃离”，无需认证，直接切换到绑定的“逃生域”内。 逃生域的配置示例如下： #在ISP域test下，指定用户认证过程中，RADIUS服务器不可达时的逃生域为dm1。 <Sysname>system-view [Sysname]domainabc（不支持的设备请跳过本步骤） [Sysname]domainnameabc（不支持的设备请跳过本步骤） [Sysname-isp-abc]authen-radius-unavailableonlinedomaindm2 	基于端口逃生（802.1X认证、MAC地址认证用户）：设备进入逃生状态时，端口上新接 入的用户无需认证，直接访问当前端口上绑定的某类Critical资源（CriticalVLAN、CriticalVSI、Critical微分段、CriticalProfile内的Critical资源）。端口下的逃生资源配置示例如下： #配置端口GigabitEthernet1/0/1的CriticalVLAN为VLAN100。 <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]dot1xcriticalvlan100 需要注意的是，如果设备上同时部属了两种逃生策略，则逃生域的优先级更高。也就是说，如果RADIUS服务器不可达，新用户会直接进入认证域绑定的逃生域且在该域上线，但不能访问端口上配置的Critical资源。可以执行displaydomain命令检查用户认证的ISP域下是否配置了逃生域。在如下示例的显示信息中，“Authen-radius-unavailable”字段取值表示配置的逃生域为dm2。 <Sysname>displaydomainabcDomain:abc State:Active Loginauthorizationscheme:RADIUS=bbb LANaccessauthenticationscheme:RADIUS=bbbLANaccessaccountingscheme:RADIUS=bbb Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:OnlineAccountingquotaoutpolicy:Offline Servicetype:HSI Sessiontime:Excludeidletime Dual-stackaccountingmethod:Merge Authorizationattributes: Idlecut:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 Authen-failaction:Offline Authen-radius-unavailable:Onlinedomaindm2Authen-radius-recover:Notconfigured （部分设备上命令为displaydomainnameabc，且显示信息略有不同）(3)检查是否为用户配置了RADIUS认证方案。 执行displaydomain检查用户认证域下是否为lan-access接入用户配置了RADIUS认证方案。在如下示例的显示信息中，“LANaccessauthenticationscheme”字段取值表示配置了LDAP认证方案，并未配置RADIUS认证方案。 <Sysname>displaydomainabcDomain:abc State:Active Loginauthorizationscheme:RADIUS=bbb LANaccessauthenticationscheme:LDAP=ldp LANaccessauthorizationscheme:LocalLANaccessaccountingscheme:Local Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:OnlineAccountingquotaoutpolicy:Offline Servicetype:HSI Sessiontime:ExcludeidletimeDual-stackaccountingmethod:Merge Authorizationattributes: Idlecut:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 Authen-failaction:Offline Authen-radius-unavailable:Onlinedomaindm2Authen-radius-recover:Notconfigured （部分设备上命令为displaydomainnameabc，且显示信息略有不同）如果lan-access接入用户的认证域中未配置RADIUS认证方案，请参考如下示例重新配置。 #在ISP域abc下，配置lan-access用户使用RADIUS认证方案rd。 [Sysname]domainabc（不支持的设备请跳过本步骤） [Sysname]domainnameabc（不支持的设备请跳过本步骤） [Sysname-isp-abc]authenticationlan-accessradius-schemerd (4)检查用户认证使用的RADIUS认证方案下，是否所有的RADIUS服务器均不可达。仅当用户认证使用的RADIUS方案下的所有RADIUS服务器均处于Block状态时，才会触发设备进入逃生状态。可以通过执行displayradiusscheme命令查看RADIUS方案下的认证服务器的状态。在如下示例的显示信息中，所有RADIUS认证服务器的“State”字段均为Active，说明对应的服务器状态均可达，因此并不会触发用户进行逃生。 <Sysname>displayradiusschemerd RADIUSschemename:rad1 Index:0 Primaryauthenticationserver: Hostname:NotConfigured IP:128.11.3.33Port:1812VPN:Notconfigured State:Active(duration:0weeks,0days,0hours,43minutes,22seconds) Mostrecentstatechanges: 2022/03/3015:15:59Changedtoactivestate 2022/03/3015:11:05Changedtoblockedstate 2022/03/3015:09:55Changedtoactivestate 2022/03/3015:05:01Changedtoblockedstate 2022/03/3008:58:59Changedtoactivestate Testprofile:Notconfigured Weight:0 Primaryaccountingserver: Hostname:NotConfigured IP:128.11.3.33Port:1813 VPN:Notconfigured State:Blocked(mandatory)Mostrecentstatechanges: 2022/03/3008:59:11Changedtoblockedstate 2022/03/2919:15:04Changedtoactivestate 2022/03/2919:10:06Changedtoblockedstate 2022/03/2919:03:08Changedtoactivestate 2022/03/2918:58:15Changedtoblockedstate Weight:0 Secondauthenticationserver: Hostname:NotConfigured IP:1.12.3.4Port:1812VPN:Notconfigured State:Active(duration:0weeks,0days,0hours,0minutes,10seconds) Mostrecentstatechanges: 2022/03/3015:59:11Changedtoactivestate Testprofile:Notconfigured Weight:0 Accounting-Onfunction:Disabledextendedfunction:Disabledretransmissiontimes:50retransmissioninterval(seconds):3TimeoutInterval(seconds):3 RetransmissionTimes:3 RetransmissionTimesforAccountingUpdate:5 ServerQuietPeriod(minutes):5 RealtimeAccountingInterval(seconds):720 Stop-accountingpacketsbuffering:Enabled Retransmissiontimes:500 NASIPAddress:Notconfigured LocalNASIPAddress:Notconfigured （部分设备上显示信息略有不同） (5)检查RADIUS方案是否配置为最终采用的认证方式。 如果为用户配置RADIUS认证方法的同时指定了备选认证方法（Local或None），那么RADIUS认证服务器不可达后，将转为进行本地认证或不认证，而不会触发设备进入逃生状态。执行displaydomain命令，查看用户认证域下为lan-access接入用户配置的认证方法。在如下示例的显示信息中，“LANaccessauthenticationscheme”字段取值表示优先使用RADIUS认证方案rd，其次采用本地认证方案（Local）。 <Sysname>displaydomainabcDomain:abc State:Active Loginauthorizationscheme:RADIUS=bbb LANaccessauthenticationscheme:RADIUS=rd,Local LANaccessauthorizationscheme:RADIUS=rd,Local LANaccessaccountingscheme:RADIUS=rd,Local Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:OnlineAccountingquotaoutpolicy:Offline Servicetype:HSI Sessiontime:ExcludeidletimeDual-stackaccountingmethod:Merge Authorizationattributes: Idlecut:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 Authen-failaction:Offline Authen-radius-unavailable:Onlinedomaindm2Authen-radius-recover:Notconfigured （部分设备上命令为displaydomainnameabc，且显示信息略有不同） 这种情况下，如果希望RADIUS服务器不可达后用户逃生，则应该删除配置的备用认证方法，使得RADIUS认证方案为用户认证时采用的最后一种认证方法。 (6)	检查端口上配置的逃生资源是否存在。 	对于进入到逃生域的802.1X、MAC地址认证、Web认证用户，能够访问的逃生资源为逃生域下配置的授权资源。可以首先通过执行displaydomain命令查看逃生域下的授权属性（Authorizationattributes字段），然后在设备上创建对应的授权资源。 	对于基于端口逃生的802.1X、MAC地址认证用户，能够访问的逃生资源为端口上配置的Critical资源。可以首先查看用户认证接口下的Critical配置，然后在设备上创建对应的授权资源。 [Sysname-GigabitEthernet1/0/24]displaythis # interfaceGigabitEthernet1/0/24 portlink-modebridgedot1xcriticalvlan24 # (7)	检查用户接入的端口上是否开启了下线检测功能。如果设备上开启了在线认证下线检测功能，缺省情况下，当认证域下所有RADIUS认证服务器均不可达时，设备会将一个下线检测定时器间隔内没有流量的用户强制下线。 在如下例的显示信息中，可以看到MAC地址认证用户的接入端口下开启了在线探测功能。 <Sysname>displaymac-authenticationGlobalMACauthenticationparameters: MACauthentication:Enabled Authenticationmethod:PAP DRmemberconfigurationconflict:Unknown Usernameformat:MACaddressinlowercase(xxxxxxxxxxxx) Username:mac Password:Notconfigured MACrangeaccounts:2 MACaddressMaskUsername2222-0000-0000ffff-0000-0000user1 4444-0000-0000ffff-0000-0000user1 Offlinedetectperiod:300s Quietperiod:60s Servertimeout:100s Reauthperiod:3600sUseragingperiodforcriticalVLAN:1000s UseragingperiodforcriticalVSI:1000s UseragingperiodforguestVLAN:1000s UseragingperiodforguestVSI:1000sUseragingperiodforcriticalmicrosegment:1000s Temporaryuseragingperiod:60s Authenticationdomain:Notconfigured,usedefaultdomain HTTPproxyportlist:Total10ports 1-3,5,7,9,11-13,15 HTTPSproxyportlist:Notconfigured MaxnumberofsilentMACs:31236(perslot) OnlineMAC-authwiredusers:1 OnlineMAC-authwirelessusers:2 SilentMACusers: MACaddressVLANIDFromportPortindex 0001-0000-0001100GE1/0/221 GigabitEthernet1/0/1islink-up MACauthentication:Enabled CarryUser-IP:Disabled Authenticationdomain:Notconfigured Auth-delaytimer:Enabled Auth-delayperiod:60s Periodicreauth:Enabled Reauthperiod:120s Re-authserver-unreachable:Logoff GuestVLAN:100 GuestVLANreauthentication:Enabled GuestVLANauth-period:150s CriticalVLAN:Notconfigured CriticalvoiceVLAN:Disabled Hostmode:SingleVLAN Offlinedetection:Enabled Authenticationorder:Parallel Useraging:EnabledServer-recoveryonline-user-sync:Enabled...略... 当RADIUS认证服务器可达时，如果既需要使用用户下线检测功能，同时又希望RADIUS认证服务器均不可达时，能够保持用户在线状态，请在设备上开启在线用户逃生功能。以MAC地址认证用户为例，在接口上开启在线用户逃生功能的配置方法如下： <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]mac-authenticationauth-server-unavailableescape部分设备不支持配置在线认证下线检测功能，请跳过本步骤。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、调试信息、诊断信息。 5.告警与日志 相关告警无 相关日志无 18.3MAC地址认证故障处理 18.3.1MAC地址认证失败 "
802.1X和ACS配合认证时，Client关联到无线服务，下线后再关联，无法关联成功,在ACS的“SystemConfiguration->GlobalAuthenticationSetup“中将“EnableFastReconnect”后面的勾去除。 图4-1关闭快速重关联功能 4.13802.1X认证配置都正确，客户端上线时一直处于验证身份阶段 ,在ACS的“SystemConfiguration->GlobalAuthenticationSetup“中将“EnableFastReconnect”后面的勾去除。 图4-1关闭快速重关联功能 4.13802.1X认证配置都正确，客户端上线时一直处于验证身份阶段 
802.1X或MAC地址认证用户在线的情况下，RADIUS认证服务器为其动态下发的VLAN授权属性不生效。 ,本类故障的常见原因主要包括： •未开启RADIUSDAE服务。•RADIUS下发的授权属性内容不正确。 •接入用户未获取到动态VLAN。 •动态授权的VLAN所属接口类型配置错误。 •动态授权的VLAN不存在。 3.故障分析 本类故障的诊断流程如图4-50所示。 4.14PasswordControl故障处理 4.14.1管理员登录时系统要求修改密码 ,Suggestion not provided
802.1X认证过程中，设备端的配置都是正确的，输入用户名和密码也是正确的，但客户端网卡显示一直处于验证身份阶段,在无线服务模板视图下配置了dot1xhandshakeenable命令，开启了802.1X在线用户握手功能，就会出现这样的情况，需要使用undodot1xhandshakeenable命令关闭802.1X在线用户握手功能。 4.14802.1X本地认证失败问题 ,在无线服务模板视图下配置了dot1xhandshakeenable命令，开启了802.1X在线用户握手功能，就会出现这样的情况，需要使用undodot1xhandshakeenable命令关闭802.1X在线用户握手功能。 4.14802.1X本地认证失败问题 
802.1X认证下发ACL失败,"本类故障的常见原因主要包括：•802.1X认证配置不正确。 •AC上没有配置对应的ACL或者ACL配置不正确。 •AC与服务器路由不可达。 •服务器侧下发的ACL编号不正确。 •本地转发模式下，AP的MAP文件中没有增加对应的ACL配置。 •服务器没有下发ACL属性。 3.故障分析 本类故障的诊断流程如图4-17所示。 图4-17802.1X认证下发ACL失败的故障诊断流程图 4.处理步骤 (1)检查802.1X认证配置。 根据802.1X认证的典型配置检查AC上相关配置是否正确。例如：检查Radiusscheme配置是否正确，Domain调用是否正确，无线服务模板下的802.1X认证配置是否正确。 (2)检查AC上ACL配置。 认证服务器只下发ACL的编号，如果AC上没有配置对应的ACL则不会授权生效，且需要检 displayacl查看可通过命令(查对应ACL的配置是否正确。)AC上ACL配置： [AC]displayacl3001 AdvancedIPv4ACL3001,1rule,ACL'sstepis5 rule1denyipdestination192.168.137.60 (3)检查AC与服务器侧通信是否正常。 802．1x认证需要AC与服务器直接交互Radius协议报文，并使用命令radiusnas-ip指定的IP地址通信，因此需要保证AC上radiusnas-ip指定的IP地址与服务器路由可达。可通过命令ping–asource-IP-addressdestination-IP-address检查AC与服务器侧通信是否正常： <AC>ping–a192.168.137.61.1.1.3 Ping1.1.1.3(1.1.1.3)from192.168.137.6:56databytes,pressCTRL_Ctobreak 56bytesfrom1.1.1.3:icmp_seq=0ttl=255time=0.945ms56bytesfrom1.1.1.3:icmp_seq=1ttl=255time=0.556ms56bytesfrom1.1.1.3:icmp_seq=2ttl=255time=0.530ms56bytesfrom1.1.1.3:icmp_seq=3ttl=255time=0.550ms 56bytesfrom1.1.1.3:icmp_seq=4ttl=255time=0.538ms (4)查看服务器侧下发的ACL编号是否正确。 802.1X认证时，服务器会在Radius的2号报文中携带需要下发给终端的ACL编号，需要检 查终端命令displaywlanclientmac-addr(侧收到服务器下发的ACL编号是否正确。可通过)essmac-addressverbose查看终端侧收到服务器下发的ACL编号： <AC>displaywlanclientmac-address0015-00ba-0428verbose Totalnumberofclients:1 MACaddress:0015-00ba-0428 IPv4address:138.200.0.1 IPv6address:N/A Username:wjh1x … AKMmode:802.1X Ciphersuite:CCMP Userauthenticationmode:802.1XAuthorizationACLID:3001 如果ACL下发失败，则“AuthorizationACLID”字段会显示为N/A；如果ACL下发成功，则“AuthorizationACLID”字段会显示具体的ACL编号。 (5)检查本地转发的MAP文件配置。 检查该无线服务的转发方式，如果是本地转发则需要在对应AP的MAP文件中增加对应ACL的配置。 可通过命令moreapcfg.txt查看MAP文件的配置： <AC>moreapcfg.txtsystem-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunk porttrunkpermitvlan200 (6)检查服务器是否下发ACL属性。 按照Radius协议规范，服务器会在Radius2号报文中携带ACL授权属性。可通过抓包的方式查看Radius的coed2报文中是否存在attributevaluepairs字段，下发的值是否就是对应的ACL值。 图4-18检查服务器是否下发ACL属性 (7)拨打热线400-810-0504求助。 如果根据上述相关步骤排查还是无法解决ACL下发失败的问题，请收集AC的诊断和抓包信息，拨打400-810-0504热线寻求帮助。 4.24集中转发下无线终端无法获取IP地址 ",Suggestion not provided
802.1X用户认证成功上线后，异常掉线,本类故障的常见原因主要包括： •设备上802.1X认证的相关配置变化。 •在线用户握手失败。 •实时计费失败。 •802.1X用户重认证失败 •服务器强制用户下线。 •开启下线检测后用户下线。 •用户会话超时。 3.故障分析 本类故障的诊断流程如图图4-24所示。 图4-24802.1X用户掉线的故障诊断流程图 4.处理步骤 •Debug开关不能在设备正常运行时随意开启，可在故障发生后复现故障场景时打开。 •请及时保存以下步骤的执行结果，以便在故障无法解决时快速收集和反馈信息。 (1)检查设备上802.1X认证的相关配置是否发生变化。 a.通过displaydot1x命令查看设备上MAC地址认证的相关配置是否发生变化。 b.通过displaydomain命令查看用户认证域下的配置是否发生变化。 (2)检查802.1X在线用户握手交互是否失败。 a.执行displaydot1x命令通过“Handshake”字段查看认证接口下是否开启了802.1X b.执行debuggingdo(在线用户握手功能。)t1xevent命令打开802.1X事件调试信息开关。如果系统打印事件调试信息“Handshakeinteractionfailure.”，则表示握手交互失败。可以通过抓包检查设备与客户端间是否能正常收发EAP数据报文，分析抓包文件进一步定位问题。 (3)检查实时计费是否失败。 执行debuggingdot1xevent命令打开802.1X事件调试信息开关。如果系统打印事件调试信息“Real-timeaccountingfailure”，则表示实时计费失败。检查设备与计费服务器之间的链路状态，以及设备和服务器的相关计费配置是否发生过更改。 (4)检查用户是否是因为重认证失败而掉线。 a.执行displaydot1x命令通过“Periodicreauth”字段查看认证接口下是否开启了802.1X 周期性重认证功能。 b.参考“4.12.1802.1X用户认证失败”故障处理定位重认证失败原因。 (5)检查是否为RADIUS服务器强制用户下线。 RADIUS远程认证情况下，执行debuggingdot1xevent命令打开802.1X事件调试信息开关。如果系统打印事件调试信息“TheRADIUSserverforciblyloggedouttheuser”，则表示RADIUS服务器强制用户下线。请联系服务器管理员定位服务器强制用户下线原因。 (6)检查是否是因为下线检测定时器间隔内未收到用户报文。 a.执行displaydot1x命令通过“Offlinedetection”字段查看认证接口下是否开启了 802.1X下线检测功能。 b.执行debuggingdot1xevent命令打开802.1X事件调试信息开关。如果系统打印事件调试信息“Offlinedetecttimerexpired”，则表示下线检测定时器间隔内，未收到此端口下该802.1X在线用户的报文，设备切断了用户连接，导致用户下线。 c.检查客户端与设备之间的链路状态，排查客户端未发送报文原因。 (7)检查用户会话是否超时。 a.检查是否配置了802.1X认证用户会话超时时间。 −RADIUS远程认证情况下，执行debuggingradiuspacket命令打开RADIUS报文调试信息开关，通过调试信息确认服务器回应的报文中是否携带Session-Timeout属性。 −本地认证情况下，执行displaylocal-user命令查看显示信息中是否包含 “Session-timeout”字段。 b.执行debuggingdot1xevent命令打开802.1X事件调试信息开关。如果系统打印事件调试信息“Usersessiontimedout.”，则表示用户会话超时下线。c.用户会话超时触发的掉线情况属于正常现象，用户可重新发起上线。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 gradiusall命令收集的调试信息。 5.告警与日志相关告警无 相关日志无 4.13AAA故障处理 4.13.1登录设备后无法执行部分命令行 ,Suggestion not provided
802.1X用户认证失败或认证异常,本类故障的常见原因主要包括： •全局或接口802.1X功能未开启。 •802.1X客户端不能正常发送或接收认证报文。 •设备配置的认证方式与RADIUS服务器不一致。 •802.1X用户使用的认证域及相关配置错误。 •RADIUS服务器无回应。 •RADIUS服务器认证拒绝。 •授权属性下发失败。 •802.1X认证用户的MAC地址被其它端口绑定。 •802.1X用户处于静默状态。 •802.1X在线用户数达到最大值。 3.故障分析 本类故障的诊断流程如图4-23所示。 图4-23802.1X用户认证失败的故障诊断流程图 4.处理步骤 •Debug开关不能在设备正常运行时随意开启，可在故障发生后复现故障场景时打开。 •请及时保存以下步骤的执行结果，以便在故障无法解决时快速收集和反馈信息。 (1)检查设备全局或接口802.1X功能是否开启。 通过在设备上执行displaydot1x命令，检查全局和认证接口上的802.1X功能是否开启。 如果提示“802.1Xisnotconfigured.”，表示全局802.1X功能未开启，请在系统视图下执行dot1x命令，开启全局802.1X认证功能。 如果有全局配置信息，无接口下的配置信息显示，则说明接口下未开启802.1X功能，请在认证接口视图下执行dot1x命令。 (2)检查802.1X客户端是否能正常发送或接收认证报文。 检查802.1X客户端版本是否为设备和服务器支持的版本。 检查设备与802.1X客户端间的链路连接是否正常。 通过抓包检查设备与客户端间是否能正常收发数据报文，分析抓包文件进一步定位故障问题。 (3)检查设备上配置的认证方法与RADIUS服务器是否一致。设备上802.1X系统支持两种认证方法：EAP终结（PAP和CHAP）和EAP中继（EAP），配置EAP认证方法时需要注意以下几点： 保证设备和RADIUS服务器配置的认证方法一致，且客户端支持。 本地认证仅支持EAP终结方式。通过在设备上执行displaydot1x命令查看当前802.1X采用的认证方式。 <Sysname>displaydot1xGlobal802.1Xparameters: 802.1Xauthentication:EnabledDRmemberconfigurationconflict:UnknownEAPauthentication:Enabled 如(…)果与服务器不一致，可通过dot1xauthentication-method命令修改。 (4)检查认证域及相关配置是否正确。 802.1X用户按照如下先后顺序选择认证域：端口上指定的强制ISP域-->用户名中指定的ISP域-->系统缺省的ISP域。 a.通过在设备上执行displaydot1x命令查看认证接口下是否配置了802.1X用户的强制 认证域。 <Sysname>displaydot1x … GigabitEthernet1/0/1islink-up 802.1Xauthentication:Enabled … Multicasttrigger:Enabled Mandatoryauthdomain:Notconfigured … 如果配置了强制认证域，请执行displaydomain命令检查强制认证域下的认证方案是否配置准确。 b.如果没有配置强制认证域，若802.1X用户名中包含域名，请确认域名分隔符与RADIUS服务器支持的域名分隔符保持一致，然后根据用户名中包含的域名找到指定域并检查其配置。 c.如果802.1X用户名中未包含域名，则检查缺省认证域的配置。 d.如果不存在缺省认证域，若通过domainif-unknown命令配置了unknown域，则检查unknown域下的认证方案是否配置准确。 e.如果根据以上原则决定的认证域在设备上都不存在，则用户无法完成认证。 (5)检查RADIUS服务器有无响应。 具体的故障定位操作请参见《AAA故障处理手册》的“RADIUS服务器无响应”。 (6)检查下线原因是否为认证拒绝。 执行debuggingdot1xevent命令打开802.1X认证事件调试开关： 若系统打印调试信息“Localauthenticationrequestwasrejected.”，则表示本地认证拒绝。导致本地认证拒绝的原因有本地用户不存在、用户名密码错误、用户服务类型错误等。 若系统打印调试信息“TheRADIUSserverrejectedtheauthenticationrequest.”，则表示RADIUS服务器认证拒绝。RADIUS服务器认证拒绝有多种原因，最常见的有服务器上 未添加用户名、用户名密码错误、RADIUS服务器授权策略无法匹配等。通过执行 debuggingradiuserror命令打开RADIUS错误调试信息开关查看相关的Debug信息，并且同时可以在设备上执行test-aaa命令发起RADIUS请求测试，定位故障问题后，调整服务器、设备及客户端配置。 (7)检查授权属性是否下发失败。 a.执行debuggingdot1xevent打开802.1X认证事件调试开关。如果系统打印调试信 息“Authorizationfailure.”，则表示授权失败。 b.检查设备上是否通过port-securityauthorization-failoffline命令配置了授 权失败用户下线功能。如果未配置授权失败用户下线功能，缺省情况下授权失败用户也可以保持在线，则用户不是因为授权失败而导致认证失败，继续定位其它故障原因。 c.检查服务器上的授权属性（例如授权ACL、VLAN）设置是否正确，确保服务器下发的授 d.执行displayac(权属性内容准确。)l或displayvlan命令检查设备上对应的授权属性是否存在，如果 不存在，需要在设备上创建相应的授权属性，确保用户能够获取到授权的信息。 (8)检查802.1X用户的MAC地址是否绑定失败。 执行debuggingdot1xevent命令打开802.1X事件调试信息开关。如果系统打印调试信息“MACbindingprocessingfailure.”，则表示802.1X用户的MAC地址绑定处理失败。 (9)检查802.1X用户是否处于静默状态。 在设备上执行displaydot1x命令，显示信息中“Quiettimer”和“Quietperiod”字段显示的是静默定时器的开启状态和静默时长，“Online802.1Xusers”字段下如果用户的“Authstate”显示为“Unauthenticated”时，则表示该用户为802.1X静默用户。 静默期间，设备将不对静默用户进行802.1X认证处理。用户需等待静默时间老化后，重新发 起802.1X认证，同时也可通过执行dot1xtimerquiet-period命令重新设置静默时长。 (10)检查802.1X在线用户数是否达到最大值。 a.在设备上执行displaydot1xinterface查看认证接口下的信息，“Maxonlineusers”字段为该接口下配置的最大用户数，“Online802.1Xusers”字段为接口下当前在线用户数，对比两组数据判断802.1X认证在线用户数是否已经达到最大值。 b.如果接口接入的802.1X用户数达到最大值，可以通过dot1xmax-user命令增大最多允许同时接入的802.1X用户数。 c.如果接口接入的802.1X用户数无法再增加，则需要等其他用户下线或切换用户的接入端口。 (11)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.12.2802.1X用户掉线 ,Suggestion not provided
AC＋FITAP组网采用本地转发模式时，无线终端可以连接无线网络，但无法取得IP地址,本类故障的常见原因主要包括： •设备的VLAN配置不正确，导致终端获取不到IP地址。 •设备的接口配置不正确，导致终端获取不到IP地址。 •无线终端与DHCPServer中间链路不通。 •无线终端与DHCPServer间的DHCP报文交互流程出现问题，导致终端获取不到IP地址。 •配置基于VLAN的用户隔离功能时，下发给FITAP的网关实际MAC地址与配置的MAC地址不对应，使得DHCP和ARP广播报文被阻断，导致终端获取不到IP地址。 •在需要终端漫游的场景下，AP上行未能放通全部业务VLAN，终端漫游时可能无法上线。 图4-22本地转发下无线终端无法获取IP地址故障排查流程图 ,"(1)检查组网中的VLAN配置 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图4-23所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。在 AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图4-23本地转发组网AC配置 检查VLAN配置的方法为，在设备的任意视图下，通过displaycurrent-configuration命令查看全部VLAN配置。 <Sysname>displaycurrent-configuration #vlan100 # …# interfaceVlan-interface100ipaddress192.1.1.1255.255.0.0 # interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan100 如果设备的VLAN配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的VLAN配置正确，则继续执行步骤(2)。 (2)检查组网中的接口配置物理接口配置错误可能导致VLAN放通失败。如图4-23所示组网中，正确的物理接口配置如下： a.本地转发模式下，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 b.将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为100。 检查中间设备配置的方法为，在任意视图下通过displaycurrent-configuration命令查看中间设备全部VLAN和接口配置。 <Sysname>displaycurrent-configuration #vlan100#vlan200# interfaceVlan-interface100ipaddress192.1.1.2255.255.0.0 # interfaceVlan-interface200ipaddress192.2.1.1255.255.255.0 # interfaceGigabitEthernet1/0/1portlink-modebridgeportlink-typetrunkporttrunkpermitvlan1100 # interfaceGigabitEthernet1/0/2portlink-modebridgeportlink-typetrunkundoporttrunkpermitvlan1porttrunkpermitvlan100200porttrunkpvidvlan100 # 如果设备的接口配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的接口配置正确，则继续执行步骤(3)。 (3)判断中间链路网络是否可通如果中间链路网络不通，终端无法通过DHCP方式获取IP地址。有两种方式可以判断中间链路网络是否可通： a.在DHCPServer（通常是网关设备，也可能是AC）的任意视图下执行displaymac-address命令查看MAC地址表中是否存在无线终端的MAC地址，以及对应VLAN是否正确。如果正确学习到无线终端MAC地址，说明二层网络互通，反之则不通。 <Sysname>displaymac-address MACAddressVLANIDStatePort/NicknameAging 0008-2246-da06200ClientWLAN-BSS1/0/527N 5098-b853-5201790LearnedBAGG1Y b.为无线终端手动配置与网关处于同一网段的静态IP地址，再去Ping网关。如果Ping通，则说明中间链路网络互通。 如果中间链路网络不通，请排查中间链路网络故障。 如果中间链路网络互通，请继续执行步骤(4)。 (4)检查下发给FITAP的基于VLAN的二层隔离功能配置为了降低骨干网络对无线局域网的广播报文数量，无线网络可能配置了基于VLAN的二层隔离。一般将permit-mac配置为网关的MAC地址，当网络存在调整，网关MAC地址变化时，如果没有修改二层隔离的配置，会造成广播报文不通的情况，此时无线终端无法通过DHCP方式获取IP地址。本地转发下，需要将配置下发至AP，典型的配置如下： #apcfg.txt配置文件为： system-viewsystem-view user-isolationvlan200permit-mac000f-e212-7788user-isolationvlan200enable 如果基于VLAN的二层隔离功能配置不正确，请参照举例修改配置。 如果基于VLAN的二层隔离功能配置正确，或没有配置本功能，请继续执行步骤(5)。 (5)查看漫游场景下AP是否放通全部业务VLAN在漫游场景下，如果无线网络中存在多个终端上线的业务VLAN，则无线网络中的每个AP都需要在上行接口放通全部业务VLAN，否则在终端漫游时，可能无法连接至无线网络。如图 4-24所示，需要在AP1、AP2和AP3的GE1/0/1接口将VLAN100、VLAN200和VLAN300全部放通。通过MAP文件向AP下发配置的操作请参考步骤(2)。 图4-24漫游场景存在多个业务VLAN示意图 如果漫游场景存在多个业务VLAN且AP上行接口未全部放通，请参考上文举例或实际情况进行修改。 如果所有AP上行接口放通了全部业务VLAN，则故障原因可能是DHCPServer与无线客户端间的DHCP报文交互出现问题，请继续执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AP的上行接口抓包来判断DHCP报文交互过程。 设备间DHCP交互不完整时，终端无法获取IP地址。完整的DHCP交互流程,需要完成四个报文交互：表4-4完整的DHCP交互流程 DHCP报文类型描述 DHCPDiscoverDHCP客户端会在本地网络内以广播方式发送请求报文，即DHCPDiscover报文，目的是发现网络中的DHCP服务器。 所有收到Discover报文的DHCP服务器都会发送回应报文，DHCP客户端据此可以知道网络中存在的DHCP服务器的位置。 DHCPOfferDHCP服务器收到Discover报文后，会在所配置的地址池中选取IP地址，加上相应 的租约期限、网关和DNS服务器等信息，通过Offer报文告知客户端该服务器可用。 DHCPRequestDHCP客户端可能会收到很多Offer报文，客户端通常选择第一个回应Offer报文的服务器作为自己的目标服务器，并回应一个广播Request报文通告选择的服务器。 在DHCP客户端成功获取IP地址后，也会通过Request报文续延租期。 DHCPACKDHCP服务器收到Request报文后，根据Request报文中携带的用户MAC来查找是否存在相应的租约记录，若存在，则发送ACK报文作为回应，通知用户可以使用分配的IP地址。 图4-25抓包DHCP报文完整交互过程 在DHCPServer通过debuggingdhcpserver命令收集信息，判断终端是否发送了DHCP请求。 收到客户端发送的DHCPDiscovery报文的Debug信息如下： *Oct1411:43:09:4222020ACDHCPS/7/PACKET: From0.0.0.0port68,interfaceM-GigabitEthernet0/0/0 Messagetype:REQUEST(1) Hardwaretype:1,Hardwareaddresslength:6 Hops:0,TransactionID:650682081//同一个DHCP交互关注TID是否相同Seconds:0,Broadcastflag:1 ClientIPaddress:0.0.0.0YourIPaddress:0.0.0.0 ServerIPaddress:0.0.0.0RelayagentIPaddress:0.0.0.0Clienthardwareaddress:782c-2962-b098 Serverhostname:notconfigured Bootfilename:notconfigured DHCPmessagetype:DHCPDISCOVER(1)//DHCP报文类型 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5非设备故障类故障处理 5.1FITAP无法获取IP地址，但是用客户端替换FITAP后能够获取IP地址 "
AC＋FITAP组网采用本地转发模式时，无线终端可以连接无线网络，但无法取得IP地址，导致终端不能上网。 因为集中转发和本地转发的故障处理步骤不同，首先需要查看当前转发模式。在AC的任意视图下，执行displaywlanservice-templateverbose命令查看无线服务模板的转发模式。 Forwarder字段显示为AP时，说明是本地转发。 <AC>displaywlanservice-template1verbose Servicetemplatename:1 Description:Notconfigured SSID:123 … Forwarder:AP ,本类故障的常见原因主要包括： •设备的VLAN配置不正确，导致终端获取不到IP地址。 •设备的接口配置不正确，导致终端获取不到IP地址。 •无线终端与DHCPServer中间链路不通。 •无线终端与DHCPServer间的DHCP报文交互流程出现问题，导致终端获取不到IP地址。 •配置基于VLAN的用户隔离功能时，下发给FITAP的网关实际MAC地址与配置的MAC地址不对应，使得DHCP和ARP广播报文被阻断，导致终端获取不到IP地址。 •在需要终端漫游的场景下，AP上行未能放通全部业务VLAN，终端漫游时可能无法上线。 图4-22本地转发下无线终端无法获取IP地址故障排查流程图 ,"(1)检查组网中的VLAN配置 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图4-23所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。在 AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图4-23本地转发组网AC配置 检查VLAN配置的方法为，在设备的任意视图下，通过displaycurrent-configuration命令查看全部VLAN配置。 <Sysname>displaycurrent-configuration #vlan100 # …# interfaceVlan-interface100ipaddress192.1.1.1255.255.0.0 # interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan100 如果设备的VLAN配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的VLAN配置正确，则继续执行步骤(2)。 (2)检查组网中的接口配置物理接口配置错误可能导致VLAN放通失败。如图4-23所示组网中，正确的物理接口配置如下： a.本地转发模式下，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 b.将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为100。 检查中间设备配置的方法为，在任意视图下通过displaycurrent-configuration命令查看中间设备全部VLAN和接口配置。 <Sysname>displaycurrent-configuration #vlan100#vlan200# interfaceVlan-interface100ipaddress192.1.1.2255.255.0.0 # interfaceVlan-interface200ipaddress192.2.1.1255.255.255.0 # interfaceGigabitEthernet1/0/1portlink-modebridgeportlink-typetrunkporttrunkpermitvlan1100 # interfaceGigabitEthernet1/0/2portlink-modebridgeportlink-typetrunkundoporttrunkpermitvlan1porttrunkpermitvlan100200porttrunkpvidvlan100 # 如果设备的接口配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的接口配置正确，则继续执行步骤(3)。 (3)判断中间链路网络是否可通如果中间链路网络不通，终端无法通过DHCP方式获取IP地址。有两种方式可以判断中间链路网络是否可通： a.在DHCPServer（通常是网关设备，也可能是AC）的任意视图下执行displaymac-address命令查看MAC地址表中是否存在无线终端的MAC地址，以及对应VLAN是否正确。如果正确学习到无线终端MAC地址，说明二层网络互通，反之则不通。 <Sysname>displaymac-address MACAddressVLANIDStatePort/NicknameAging 0008-2246-da06200ClientWLAN-BSS1/0/527N 5098-b853-5201790LearnedBAGG1Y b.为无线终端手动配置与网关处于同一网段的静态IP地址，再去Ping网关。如果Ping通，则说明中间链路网络互通。 如果中间链路网络不通，请排查中间链路网络故障。 如果中间链路网络互通，请继续执行步骤(4)。 (4)检查下发给FITAP的基于VLAN的二层隔离功能配置为了降低骨干网络对无线局域网的广播报文数量，无线网络可能配置了基于VLAN的二层隔离。一般将permit-mac配置为网关的MAC地址，当网络存在调整，网关MAC地址变化时，如果没有修改二层隔离的配置，会造成广播报文不通的情况，此时无线终端无法通过DHCP方式获取IP地址。本地转发下，需要将配置下发至AP，典型的配置如下： #apcfg.txt配置文件为： system-viewsystem-view user-isolationvlan200permit-mac000f-e212-7788user-isolationvlan200enable 如果基于VLAN的二层隔离功能配置不正确，请参照举例修改配置。 如果基于VLAN的二层隔离功能配置正确，或没有配置本功能，请继续执行步骤(5)。 (5)查看漫游场景下AP是否放通全部业务VLAN在漫游场景下，如果无线网络中存在多个终端上线的业务VLAN，则无线网络中的每个AP都需要在上行接口放通全部业务VLAN，否则在终端漫游时，可能无法连接至无线网络。如图 4-24所示，需要在AP1、AP2和AP3的GE1/0/1接口将VLAN100、VLAN200和VLAN300全部放通。通过MAP文件向AP下发配置的操作请参考步骤(2)。 图4-24漫游场景存在多个业务VLAN示意图 如果漫游场景存在多个业务VLAN且AP上行接口未全部放通，请参考上文举例或实际情况进行修改。 如果所有AP上行接口放通了全部业务VLAN，则故障原因可能是DHCPServer与无线客户端间的DHCP报文交互出现问题，请继续执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AP的上行接口抓包来判断DHCP报文交互过程。 设备间DHCP交互不完整时，终端无法获取IP地址。完整的DHCP交互流程,需要完成四个报文交互：表4-4完整的DHCP交互流程 DHCP报文类型描述 DHCPDiscoverDHCP客户端会在本地网络内以广播方式发送请求报文，即DHCPDiscover报文，目的是发现网络中的DHCP服务器。 所有收到Discover报文的DHCP服务器都会发送回应报文，DHCP客户端据此可以知道网络中存在的DHCP服务器的位置。 DHCPOfferDHCP服务器收到Discover报文后，会在所配置的地址池中选取IP地址，加上相应 的租约期限、网关和DNS服务器等信息，通过Offer报文告知客户端该服务器可用。 DHCPRequestDHCP客户端可能会收到很多Offer报文，客户端通常选择第一个回应Offer报文的服务器作为自己的目标服务器，并回应一个广播Request报文通告选择的服务器。 在DHCP客户端成功获取IP地址后，也会通过Request报文续延租期。 DHCPACKDHCP服务器收到Request报文后，根据Request报文中携带的用户MAC来查找是否存在相应的租约记录，若存在，则发送ACK报文作为回应，通知用户可以使用分配的IP地址。 图4-25抓包DHCP报文完整交互过程 在DHCPServer通过debuggingdhcpserver命令收集信息，判断终端是否发送了DHCP请求。 收到客户端发送的DHCPDiscovery报文的Debug信息如下： *Oct1411:43:09:4222020ACDHCPS/7/PACKET: From0.0.0.0port68,interfaceM-GigabitEthernet0/0/0 Messagetype:REQUEST(1) Hardwaretype:1,Hardwareaddresslength:6 Hops:0,TransactionID:650682081//同一个DHCP交互关注TID是否相同Seconds:0,Broadcastflag:1 ClientIPaddress:0.0.0.0YourIPaddress:0.0.0.0 ServerIPaddress:0.0.0.0RelayagentIPaddress:0.0.0.0Clienthardwareaddress:782c-2962-b098 Serverhostname:notconfigured Bootfilename:notconfigured DHCPmessagetype:DHCPDISCOVER(1)//DHCP报文类型 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5非设备故障类故障处理 5.1FITAP无法获取IP地址，但是用客户端替换FITAP后能够获取IP地址 "
AC＋FITAP组网采用集中转发模式时，无线终端可以连接无线网络，但无法取得IP地址，导致终端不能上网。 因为集中转发和本地转发的故障处理步骤不同，首先需要查看当前转发模式。在AC的任意视图下，执行displaywlanservice-templateverbose命令查看无线服务模板的转发模式。 Forwarder字段显示为AC时，说明是集中转发。 <AC>displaywlanservice-template1verbose Servicetemplatename:1 Description:Notconfigured SSID:123 … Forwarder:AC ,"本类故障的常见原因主要包括： •设备的VLAN配置不正确，导致终端获取不到IP地址。 •设备的接口配置不正确，导致终端获取不到IP地址。 •无线终端与DHCPServer中间链路不通。 •配置基于VLAN的用户隔离功能时，网关实际MAC地址与配置的MAC地址不对应，使得 DHCP和ARP广播报文被阻断，导致终端获取不到IP地址。 •无线终端与DHCPServer间的DHCP报文交互流程出现问题，导致终端获取不到IP地址。 3.故障分析 本类故障的诊断流程如图4-19所示。 图4-19集中转发下无线终端无法获取IP地址故障排查流程图 4.处理步骤 (1)检查组网中的VLAN配置 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图4-20所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图4-20集中转发组网VLAN配置 在设备的任意视图下，通过displaycurrent-configuration命令查看本设备全部VLAN配置。 <Sysname>displaycurrent-configuration #vlan100#vlan200 # …# interfaceVlan-interface100ipaddress192.1.1.1255.255.0.0 # interfaceVlan-interface200ipaddress192.2.1.1255.255.255.0 # interfaceGigabitEthernet1/0/1portlink-typetrunkundoporttrunkpermitvlan1porttrunkpermitvlan100200 如果设备的VLAN配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的VLAN配置正确，则继续执行步骤(2)。 (2)检查组网中的物理接口配置物理接口配置错误可能导致VLAN放通失败。如图4-20所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。在设备的任意视图下，通过displaycurrent-configuration命令查看本设备全部接口配置。 如果设备的接口配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的接口配置正确，则继续执行步骤(3)。 (3)判断中间链路网络是否可通如果中间链路网络不通，终端无法通过DHCP方式获取IP地址。有两种方式可以判断中间链路网络是否可通： a.在DHCPServer（通常是网关设备，也可能是AC）的任意视图下执行displaymac-address命令查看MAC地址表中是否存在无线终端的MAC地址，以及对应VLAN是否正确。如果正确学习到无线终端MAC地址，说明二层网络互通，反之则不通。 <Sysname>displaymac-address MACAddressVLANIDStatePort/NicknameAging 0008-2246-da06200ClientWLAN-BSS1/0/527N 5098-b853-5201790LearnedBAGG1Y b.为无线终端手动配置与网关处于同一网段的静态IP地址，再去Ping网关。如果Ping通，则说明中间链路网络互通。 如果中间链路网络不通，请排查中间链路网络故障。 如果中间链路网络互通，请继续执行步骤(4)。 (4)查看基于VLAN的二层隔离功能配置为了降低骨干网络对无线局域网的广播报文数量，无线网络可能配置了基于VLAN的二层隔离。一般将permit-mac配置为网关的MAC地址，当网络存在调整，网关MAC地址变化时，如果没有修改二层隔离的配置，会造成广播报文不通的情况，此时无线终端无法通过DHCP方式获取IP地址。典型的配置如下： #在VLAN200上开启用户隔离功能，允许访问MAC地址为00bb-ccdd-eeff的设备（允许的MAC地址通常为网关MAC地址），同时禁止有线用户（permit-mac允许的mac地址除外）发送广播、组播报文给无线用户。 <AC>system-view [AC]user-isolationvlan200enable [AC]user-isolationvlan200permit-mac00bb-ccdd-eeff [AC]undouser-isolationpermit-broadcast 查看基于VLAN的二层隔离功能配置的方法为，在AC的任意视图下执行displayuser-isolationstatistics命令，以下文为例： <Sysname>displayuser-isolationstatistics NumberofVLANsenabledwithuserisolation:2 NumberofVLANsdisabledwithuserisolation:1 VLANStatusDropsPermit-UnicastPermittedMACsPermitIPv4|IPv6Acl4Enabled0YN/A3001|3002 200Enabled0Y00bb-ccdd-eeffN/A|N/A5Enabled0YN/AN/A|N/A 如果基于VLAN的二层隔离功能配置不正确，请参照举例修改配置。 如果基于VLAN的二层隔离功能配置正确，或没有配置本功能，请继续执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AP的上行接口抓包来判断DHCP报文交互过程。设备间DHCP交互不完整时，终端无法获取IP地址。如所示，完整的DHCP交互流程,需要完成四个报文交互：表4-3完整的DHCP交互流程 DHCP报文类型描述 DHCPDiscoverDHCP客户端会在本地网络内以广播方式发送请求报文，即DHCPDiscover报文，目的是发现网络中的DHCP服务器。 所有收到Discover报文的DHCP服务器都会发送回应报文，DHCP客户端据此可以知道网络中存在的DHCP服务器的位置。 DHCPOfferDHCP服务器收到Discover报文后，会在所配置的地址池中选取IP地址，加上相应 的租约期限、网关和DNS服务器等信息，通过Offer报文告知客户端该服务器可用。 DHCPRequestDHCP客户端可能会收到很多Offer报文，客户端通常选择第一个回应Offer报文的服务器作为自己的目标服务器，并回应一个广播Request报文通告选择的服务器。 在DHCP客户端成功获取IP地址后，也会通过Request报文续延租期。 DHCPACKDHCP服务器收到Request报文后，根据Request报文中携带的用户MAC来查找是否存在相应的租约记录，若存在，则发送ACK报文作为回应，通知用户可以使用分配的IP地址。 图4-21抓包DHCP报文完整交互过程 在DHCPServer通过debuggingdhcpserver命令收集信息，判断终端是否发送了DHCP请求。 收到客户端发送的DHCPDiscovery报文的Debug信息如下： *Oct1411:43:09:4222020ACDHCPS/7/PACKET: From0.0.0.0port68,interfaceM-GigabitEthernet0/0/0 Messagetype:REQUEST(1) Hardwaretype:1,Hardwareaddresslength:6 Hops:0,TransactionID:650682081//同一个DHCP交互关注TID是否相同Seconds:0,Broadcastflag:1 ClientIPaddress:0.0.0.0YourIPaddress:0.0.0.0 ServerIPaddress:0.0.0.0RelayagentIPaddress:0.0.0.0 Clienthardwareaddress:782c-2962-b098 Serverhostname:notconfiguredBootfilename:notconfigured DHCPmessagetype:DHCPDISCOVER(1)//DHCP报文类型 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.25本地转发下无线终端无法获取IP地址 ",Suggestion not provided
AC＋FITAP组网采用集中转发模式时终端不能上网,"本类故障的常见原因主要包括： •设备的VLAN配置不正确，导致终端获取不到IP地址。 •设备的接口配置不正确，导致终端获取不到IP地址。 •无线终端与DHCPServer中间链路不通。 •配置基于VLAN的用户隔离功能时，网关实际MAC地址与配置的MAC地址不对应，使得 DHCP和ARP广播报文被阻断，导致终端获取不到IP地址。 •无线终端与DHCPServer间的DHCP报文交互流程出现问题，导致终端获取不到IP地址。 3.故障分析 本类故障的诊断流程如图4-19所示。 图4-19集中转发下无线终端无法获取IP地址故障排查流程图 4.处理步骤 (1)检查组网中的VLAN配置 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图4-20所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图4-20集中转发组网VLAN配置 在设备的任意视图下，通过displaycurrent-configuration命令查看本设备全部VLAN配置。 <Sysname>displaycurrent-configuration #vlan100#vlan200 # …# interfaceVlan-interface100ipaddress192.1.1.1255.255.0.0 # interfaceVlan-interface200ipaddress192.2.1.1255.255.255.0 # interfaceGigabitEthernet1/0/1portlink-typetrunkundoporttrunkpermitvlan1porttrunkpermitvlan100200 如果设备的VLAN配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的VLAN配置正确，则继续执行步骤(2)。 (2)检查组网中的物理接口配置物理接口配置错误可能导致VLAN放通失败。如图4-20所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。在设备的任意视图下，通过displaycurrent-configuration命令查看本设备全部接口配置。 如果设备的接口配置不正确，请参考上文举例或依据实际情况修改配置。 如果设备的接口配置正确，则继续执行步骤(3)。 (3)判断中间链路网络是否可通如果中间链路网络不通，终端无法通过DHCP方式获取IP地址。有两种方式可以判断中间链路网络是否可通： a.在DHCPServer（通常是网关设备，也可能是AC）的任意视图下执行displaymac-address命令查看MAC地址表中是否存在无线终端的MAC地址，以及对应VLAN是否正确。如果正确学习到无线终端MAC地址，说明二层网络互通，反之则不通。 <Sysname>displaymac-address MACAddressVLANIDStatePort/NicknameAging 0008-2246-da06200ClientWLAN-BSS1/0/527N 5098-b853-5201790LearnedBAGG1Y b.为无线终端手动配置与网关处于同一网段的静态IP地址，再去Ping网关。如果Ping通，则说明中间链路网络互通。 如果中间链路网络不通，请排查中间链路网络故障。 如果中间链路网络互通，请继续执行步骤(4)。 (4)查看基于VLAN的二层隔离功能配置为了降低骨干网络对无线局域网的广播报文数量，无线网络可能配置了基于VLAN的二层隔离。一般将permit-mac配置为网关的MAC地址，当网络存在调整，网关MAC地址变化时，如果没有修改二层隔离的配置，会造成广播报文不通的情况，此时无线终端无法通过DHCP方式获取IP地址。典型的配置如下： #在VLAN200上开启用户隔离功能，允许访问MAC地址为00bb-ccdd-eeff的设备（允许的MAC地址通常为网关MAC地址），同时禁止有线用户（permit-mac允许的mac地址除外）发送广播、组播报文给无线用户。 <AC>system-view [AC]user-isolationvlan200enable [AC]user-isolationvlan200permit-mac00bb-ccdd-eeff [AC]undouser-isolationpermit-broadcast 查看基于VLAN的二层隔离功能配置的方法为，在AC的任意视图下执行displayuser-isolationstatistics命令，以下文为例： <Sysname>displayuser-isolationstatistics NumberofVLANsenabledwithuserisolation:2 NumberofVLANsdisabledwithuserisolation:1 VLANStatusDropsPermit-UnicastPermittedMACsPermitIPv4|IPv6Acl4Enabled0YN/A3001|3002 200Enabled0Y00bb-ccdd-eeffN/A|N/A5Enabled0YN/AN/A|N/A 如果基于VLAN的二层隔离功能配置不正确，请参照举例修改配置。 如果基于VLAN的二层隔离功能配置正确，或没有配置本功能，请继续执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AP的上行接口抓包来判断DHCP报文交互过程。设备间DHCP交互不完整时，终端无法获取IP地址。如所示，完整的DHCP交互流程,需要完成四个报文交互：表4-3完整的DHCP交互流程 DHCP报文类型描述 DHCPDiscoverDHCP客户端会在本地网络内以广播方式发送请求报文，即DHCPDiscover报文，目的是发现网络中的DHCP服务器。 所有收到Discover报文的DHCP服务器都会发送回应报文，DHCP客户端据此可以知道网络中存在的DHCP服务器的位置。 DHCPOfferDHCP服务器收到Discover报文后，会在所配置的地址池中选取IP地址，加上相应 的租约期限、网关和DNS服务器等信息，通过Offer报文告知客户端该服务器可用。 DHCPRequestDHCP客户端可能会收到很多Offer报文，客户端通常选择第一个回应Offer报文的服务器作为自己的目标服务器，并回应一个广播Request报文通告选择的服务器。 在DHCP客户端成功获取IP地址后，也会通过Request报文续延租期。 DHCPACKDHCP服务器收到Request报文后，根据Request报文中携带的用户MAC来查找是否存在相应的租约记录，若存在，则发送ACK报文作为回应，通知用户可以使用分配的IP地址。 图4-21抓包DHCP报文完整交互过程 在DHCPServer通过debuggingdhcpserver命令收集信息，判断终端是否发送了DHCP请求。 收到客户端发送的DHCPDiscovery报文的Debug信息如下： *Oct1411:43:09:4222020ACDHCPS/7/PACKET: From0.0.0.0port68,interfaceM-GigabitEthernet0/0/0 Messagetype:REQUEST(1) Hardwaretype:1,Hardwareaddresslength:6 Hops:0,TransactionID:650682081//同一个DHCP交互关注TID是否相同Seconds:0,Broadcastflag:1 ClientIPaddress:0.0.0.0YourIPaddress:0.0.0.0 ServerIPaddress:0.0.0.0RelayagentIPaddress:0.0.0.0 Clienthardwareaddress:782c-2962-b098 Serverhostname:notconfiguredBootfilename:notconfigured DHCPmessagetype:DHCPDISCOVER(1)//DHCP报文类型 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.25本地转发下无线终端无法获取IP地址 ",Suggestion not provided
AP上电后，用户终端的串口接到AP设备的RJ-45口，但是没有打印信息,用户终端的串口插到了设备的Console口导致没有打印信息,(1)请确认用户终端的串口是否插到了设备的Console口，如果插到AP的网口的话就不会有打印信息。 (2)检查用户终端的串口设置，特别是波特率需要设置为9600bps，校验（Parity）设置为none即不需要校验位，数据位（Databits）设置为8。 3.4网口无法连接 
AP上电后，用户终端的串口接到AP设备的RJ-45口，但是没有打印信息。 ,(1)请确认用户终端的串口是否插到了设备的Console口，如果插到AP的网口的话就不会有打印信息。 (2)检查用户终端的串口设置，特别是波特率需要设置为9600bps，校验（Parity）设置为none即不需要校验位，数据位（Databits）设置为8。 3.4网口无法连接 ,(1)请确认用户终端的串口是否插到了设备的Console口，如果插到AP的网口的话就不会有打印信息。 (2)检查用户终端的串口设置，特别是波特率需要设置为9600bps，校验（Parity）设置为none即不需要校验位，数据位（Databits）设置为8。 3.4网口无法连接 
AP设备信号弱,(1)根据设备的型号选择配置内置或外置天线。 (2)正确安装外置天线，并检查2.4GHz和5GHz天线是否安装错位置（比如把2.4GHz天线安装在了5GHz天馈口）。 (3)用max-power命令将AP的射频传输功率设置成最大。 3.8AP上电异常 ,(1)根据设备的型号选择配置内置或外置天线。 (2)正确安装外置天线，并检查2.4GHz和5GHz天线是否安装错位置（比如把2.4GHz天线安装在了5GHz天馈口）。 (3)用max-power命令将AP的射频传输功率设置成最大。 3.8AP上电异常 
AP设备信号弱。 ,(1)根据设备的型号选择配置内置或外置天线。 (2)正确安装外置天线，并检查2.4GHz和5GHz天线是否安装错位置（比如把2.4GHz天线安装在了5GHz天馈口）。 (3)用max-power命令将AP的射频传输功率设置成最大。 3.8AP上电异常 ,(1)根据设备的型号选择配置内置或外置天线。 (2)正确安装外置天线，并检查2.4GHz和5GHz天线是否安装错位置（比如把2.4GHz天线安装在了5GHz天馈口）。 (3)用max-power命令将AP的射频传输功率设置成最大。 3.8AP上电异常 
AP同时具备网口PoE供电和电源适配器供电的情况下，如果电源适配器处于供电工作状态，此时断开电源适配器时系统会重启，同时系统会切换到由网口PoE供电,AP存在网口PoE供电和电源适配器供电两种供电方式，如果AP处于电源适配器供电工作状态，而网口PoE在此次上电期间没有供过电，当断开电源适配器供电时，网口PoE会依次进行检测>分级>供电，在网口PoE重新供电过程中，设备经过了断电重新上电的过程，所以系统会重启。 可以通过系统的电源指示灯确认，因为电源指示灯会灭，然后再常亮。该问题属于系统网口PoE供电固有的特性造成，不算问题，无需解决。 5.4WMM不支持分片 ,AP存在网口PoE供电和电源适配器供电两种供电方式，如果AP处于电源适配器供电工作状态，而网口PoE在此次上电期间没有供过电，当断开电源适配器供电时，网口PoE会依次进行检测>分级>供电，在网口PoE重新供电过程中，设备经过了断电重新上电的过程，所以系统会重启。 可以通过系统的电源指示灯确认，因为电源指示灯会灭，然后再常亮。该问题属于系统网口PoE供电固有的特性造成，不算问题，无需解决。 5.4WMM不支持分片 
AP同时具备网口PoE供电和电源适配器供电的情况下，如果电源适配器处于供电工作状态，此时断开电源适配器时系统会重启，同时系统会切换到由网口PoE供电。 ,AP存在网口PoE供电和电源适配器供电两种供电方式，如果AP处于电源适配器供电工作状态，而网口PoE在此次上电期间没有供过电，当断开电源适配器供电时，网口PoE会依次进行检测>分级>供电，在网口PoE重新供电过程中，设备经过了断电重新上电的过程，所以系统会重启。 可以通过系统的电源指示灯确认，因为电源指示灯会灭，然后再常亮。该问题属于系统网口PoE供电固有的特性造成，不算问题，无需解决。 5.4WMM不支持分片 ,AP存在网口PoE供电和电源适配器供电两种供电方式，如果AP处于电源适配器供电工作状态，而网口PoE在此次上电期间没有供过电，当断开电源适配器供电时，网口PoE会依次进行检测>分级>供电，在网口PoE重新供电过程中，设备经过了断电重新上电的过程，所以系统会重启。 可以通过系统的电源指示灯确认，因为电源指示灯会灭，然后再常亮。该问题属于系统网口PoE供电固有的特性造成，不算问题，无需解决。 5.4WMM不支持分片 
AP完成启动并通过网线与交换机或其他网络设备相连后，无发与相连设备进行通信。 ,"本类故障的常见原因包括： •AP有线接口通信异常 •链路异常 3.故障分析 对于无Console口或不能通过Console方式登录的AP，在上行设备上，查看AP对端接口的端口状态，进而定位是以太网接口通信异常，还是接口状态异常。对于有Console口的AP，可以通过Console口进行本地登录，查看AP上行口的端口状态，进而定位是以太网接口通信异常，还是接口状态异常。 4.处理步骤 通过多次执行displayinterface查看物理端口状态，确认端口是否UP、入方向的报文统计是否增长。为方便查看，可以通过resetcounterinterface命令清空当前端口的报文统计结果再进行观察。 #查看AP上行口的端口状态。 <Sysname>displayinterfaceGigabitEthernet1/0/1GigabitEthernet1/0/1Currentstate:UPLineprotocolstate:UPIPpacketframetype:EthernetII,hardwareaddress:a4fa-7679-b6f0 …… Input(total):196packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput(normal):196packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput:0inputerrors,0runts,0giants,-throttles0CRC,-frame,0overruns,0aborts -ignored,-parityerrors Output(total):158packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput(normal):158packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput:0outputerrors,0underruns,-bufferfailures-aborts,0deferred,0collisions,0latecollisions -lostcarrier,-nocarrier 无Console口AP •在AP的上行设备上，通过displayinterface命令查看AP对端接口的端口状态。 •如果接口状态为UP，则查看接口入方向报文统计情况。若接口入方向的广播包未正常增长，替换其他同型号AP后测试入方向广播包增长，则考虑为AP以太网接口通信异常，建议更换 AP。 •如果AP的对端接口无法正常UP，需要进一步检查有线接口状态，具体请参见3.12AP接口状态异常。 有Console口AP •在AP上，通过displayinterface命令查看AP上行口的端口状态。 •如果接口状态为UP，则查看接口出方向报文统计情况。若接口出方向的广播包未正常增长，考虑为AP以太网接口通信异常，建议更换AP。 •如果AP上行口无法正常UP，需要进一步检查有线接口状态，具体请参见3.12AP接口状态异常。 3.12AP接口状态异常 ",Suggestion not provided
AP完成启动并通过网线与交换机或其他网络设备相连后，无法与相连设备进行通信 ,"本类故障的常见原因包括： •AP有线接口通信异常 •链路异常 3.故障分析 对于无Console口或不能通过Console方式登录的AP，在上行设备上，查看AP对端接口的端口状态，进而定位是以太网接口通信异常，还是接口状态异常。对于有Console口的AP，可以通过Console口进行本地登录，查看AP上行口的端口状态，进而定位是以太网接口通信异常，还是接口状态异常。 4.处理步骤 通过多次执行displayinterface查看物理端口状态，确认端口是否UP、入方向的报文统计是否增长。为方便查看，可以通过resetcounterinterface命令清空当前端口的报文统计结果再进行观察。 #查看AP上行口的端口状态。 <Sysname>displayinterfaceGigabitEthernet1/0/1GigabitEthernet1/0/1Currentstate:UPLineprotocolstate:UPIPpacketframetype:EthernetII,hardwareaddress:a4fa-7679-b6f0 …… Input(total):196packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput(normal):196packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput:0inputerrors,0runts,0giants,-throttles0CRC,-frame,0overruns,0aborts -ignored,-parityerrors Output(total):158packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput(normal):158packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput:0outputerrors,0underruns,-bufferfailures-aborts,0deferred,0collisions,0latecollisions -lostcarrier,-nocarrier 无Console口AP •在AP的上行设备上，通过displayinterface命令查看AP对端接口的端口状态。 •如果接口状态为UP，则查看接口入方向报文统计情况。若接口入方向的广播包未正常增长，替换其他同型号AP后测试入方向广播包增长，则考虑为AP以太网接口通信异常，建议更换 AP。 •如果AP的对端接口无法正常UP，需要进一步检查有线接口状态，具体请参见3.12AP接口状态异常。 有Console口AP •在AP上，通过displayinterface命令查看AP上行口的端口状态。 •如果接口状态为UP，则查看接口出方向报文统计情况。若接口出方向的广播包未正常增长，考虑为AP以太网接口通信异常，建议更换AP。 •如果AP上行口无法正常UP，需要进一步检查有线接口状态，具体请参见3.12AP接口状态异常。 3.12AP接口状态异常 ",Suggestion not provided
AP只采用电源适配器一种供电方式供电时，系统控制平台无打印信息，同时电源指示灯未亮,电源的输入电压在系统规格超出要求的范围,(1)请检查是否采用系统要求的电源适配器规格，需要确保电源的输入电压在系统规格要求的范围。 (2)AP外观是否有明显被摔痕迹，防止AP内部的器件被摔坏而导致系统不能上电。 (3)AP是否进过水或者设备工作环境温度是否超出规格要求，如果室内型AP被用于室外，有雨 水进入AP或者关键芯片环境温度不满足要求，会导致系统出现工作异常状态，AP无法上电。 3.3AP上电后，串口没有打印信息 
AP只采用电源适配器一种供电方式供电时，系统控制平台无打印信息，同时电源指示灯未亮。 ,(1)请检查是否采用系统要求的电源适配器规格，需要确保电源的输入电压在系统规格要求的范围。 (2)AP外观是否有明显被摔痕迹，防止AP内部的器件被摔坏而导致系统不能上电。 (3)AP是否进过水或者设备工作环境温度是否超出规格要求，如果室内型AP被用于室外，有雨 水进入AP或者关键芯片环境温度不满足要求，会导致系统出现工作异常状态，AP无法上电。 3.3AP上电后，串口没有打印信息 ,(1)请检查是否采用系统要求的电源适配器规格，需要确保电源的输入电压在系统规格要求的范围。 (2)AP外观是否有明显被摔痕迹，防止AP内部的器件被摔坏而导致系统不能上电。 (3)AP是否进过水或者设备工作环境温度是否超出规格要求，如果室内型AP被用于室外，有雨 水进入AP或者关键芯片环境温度不满足要求，会导致系统出现工作异常状态，AP无法上电。 3.3AP上电后，串口没有打印信息 
AP最多只能与两台AP建立Mesh连接，无法与第三台AP建立Mesh连接,AP默认最多只能与其他两台AP建立Mesh连接，如果想与多台AP建立Mesh连接，需要修改 Mesh策略。 •如果AP的射频口下配置了Mesh策略： a.首先使用undomesh-policy命令将Mesh策略与绑定的射频口解绑定； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略重新绑定到射频。 •如果AP的射频口下没有配置Mesh策略： a.首先使用wlanmesh-policy命令用创建一个新的Mesh策略； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略绑定到射频；d.使用radioenable命令开启射频。 4.7两台或更多台AP建立Mesh连接后，Mesh连接经常up/down ,AP默认最多只能与其他两台AP建立Mesh连接，如果想与多台AP建立Mesh连接，需要修改 Mesh策略。 •如果AP的射频口下配置了Mesh策略： a.首先使用undomesh-policy命令将Mesh策略与绑定的射频口解绑定； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略重新绑定到射频。 •如果AP的射频口下没有配置Mesh策略： a.首先使用wlanmesh-policy命令用创建一个新的Mesh策略； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略绑定到射频；d.使用radioenable命令开启射频。 4.7两台或更多台AP建立Mesh连接后，Mesh连接经常up/down 
AP最多只能与两台AP建立Mesh连接，无法与第三台AP建立Mesh连接。 ,AP默认最多只能与其他两台AP建立Mesh连接，如果想与多台AP建立Mesh连接，需要修改 Mesh策略。 •如果AP的射频口下配置了Mesh策略： a.首先使用undomesh-policy命令将Mesh策略与绑定的射频口解绑定； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略重新绑定到射频。 •如果AP的射频口下没有配置Mesh策略： a.首先使用wlanmesh-policy命令用创建一个新的Mesh策略； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略绑定到射频；d.使用radioenable命令开启射频。 4.7两台或更多台AP建立Mesh连接后，Mesh连接经常up/down ,AP默认最多只能与其他两台AP建立Mesh连接，如果想与多台AP建立Mesh连接，需要修改 Mesh策略。 •如果AP的射频口下配置了Mesh策略： a.首先使用undomesh-policy命令将Mesh策略与绑定的射频口解绑定； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略重新绑定到射频。 •如果AP的射频口下没有配置Mesh策略： a.首先使用wlanmesh-policy命令用创建一个新的Mesh策略； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立 c.最后使用mesh-(的最大链路数；)policy命令将Mesh策略绑定到射频；d.使用radioenable命令开启射频。 4.7两台或更多台AP建立Mesh连接后，Mesh连接经常up/down 
b.查看路由是否震荡。 根据路由类型，判断路由是否震荡。以IS-IS为例，执行displayiprouting-tableprotocolisis命令，查看路由信息。如果路由信息一直在显示和不显示两种情况切换，则表示路由震荡。 −如果路由震荡，请按照路由类型，参见“OSPF邻居Down”、“OSPFv3邻居Down”或“IS-IS路由震荡”故障处理，排除路由问题。−如果路由没有震荡，请执行步骤(2)。 (2)检查LDPLSP是否震荡。 建议每1秒执行一次displaymplsldppeer命令，连续执行5～10次，查看显示信息的State字段。如果该字段的取值在Operational状态和其他状态之间切换，则表示LDP会话震荡，导致LDPLSP震荡。 如果LDPLSP震荡，则请参见“LDPLSP震荡”故障进行定位。 如果LDPLSP没有震荡，则执行步骤(3)。 <Sysname>displaymplsldppeer VPNinstance:publicinstanceTotalnumberofpeers:1 PeerLDPIDStateRoleGRAUTKASent/Rcvd ,Cause not provided,Suggestion not provided
Client不能在AC间快速漫游，Client在切换AP时都是重新走认证上线流程，没有走快速漫游流程,快速漫游需要几个条件，必须满足这些条件才能快速漫游： •网卡要支持快速漫游。如果一个Client可以协商采用802.1X（RSN）认证方式，并且在发给 FA的reasso消息中携带了PMKID，则该终端具有AC间快速漫游能力； •AC间建立漫游组，且漫游组处于run状态； •服务模板是CCMP+WPA2+dot1x方式。 4.10Client不停的在几个AP间漫游或Client漫游困难 ,快速漫游需要几个条件，必须满足这些条件才能快速漫游： •网卡要支持快速漫游。如果一个Client可以协商采用802.1X（RSN）认证方式，并且在发给 FA的reasso消息中携带了PMKID，则该终端具有AC间快速漫游能力； •AC间建立漫游组，且漫游组处于run状态； •服务模板是CCMP+WPA2+dot1x方式。 4.10Client不停的在几个AP间漫游或Client漫游困难 
Client不能在AC间快速漫游，Client在切换AP时都是重新走认证上线流程，没有走快速漫游流程。 ,快速漫游需要几个条件，必须满足这些条件才能快速漫游： •网卡要支持快速漫游。如果一个Client可以协商采用802.1X（RSN）认证方式，并且在发给 FA的reasso消息中携带了PMKID，则该终端具有AC间快速漫游能力； •AC间建立漫游组，且漫游组处于run状态； •服务模板是CCMP+WPA2+dot1x方式。 4.10Client不停的在几个AP间漫游或Client漫游困难 ,快速漫游需要几个条件，必须满足这些条件才能快速漫游： •网卡要支持快速漫游。如果一个Client可以协商采用802.1X（RSN）认证方式，并且在发给 FA的reasso消息中携带了PMKID，则该终端具有AC间快速漫游能力； •AC间建立漫游组，且漫游组处于run状态； •服务模板是CCMP+WPA2+dot1x方式。 4.10Client不停的在几个AP间漫游或Client漫游困难 
Client不停的在几个AP间漫游 ,•如果Client不停的在几个AP间漫游，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调低。 •如果Client漫游困难，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调高。 4.11802.1X远程服务器认证失败问题 ,•如果Client不停的在几个AP间漫游，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调低。 •如果Client漫游困难，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，仅部分网卡支持，请以网卡的实际情况为准）调高。 4.11802.1X远程服务器认证失败问题 
Client连接到了一个信号相对较弱的AP上，而没有连接到相对信号较强且距离较近的AP上 ,(1)请确认客户端分布是否合理，不要造成大量客户端聚集在某个AP附近，否则即使负载均衡到其他的AP上，也会因为信号强度相差太大而触发频繁的漫游。 (2)如果发生Client无法连接的情况，要关闭负载均衡后再进行观察。 (3)基于流量的负载均衡不宜控制，不建议使用，尤其是有些加密、安全配置限制了AP的接入数量的情况下（例如TKIP加密使得AP只能接入28个用户），建议使用基于会话的负载均衡。 5.3同时支持网口PoE供电和电源适配器供电的AP设备，在电源适配器供电状态下，断开电源适配器时系统会重启 ,(1)请确认客户端分布是否合理，不要造成大量客户端聚集在某个AP附近，否则即使负载均衡到其他的AP上，也会因为信号强度相差太大而触发频繁的漫游。 (2)如果发生Client无法连接的情况，要关闭负载均衡后再进行观察。 (3)基于流量的负载均衡不宜控制，不建议使用，尤其是有些加密、安全配置限制了AP的接入数量的情况下（例如TKIP加密使得AP只能接入28个用户），建议使用基于会话的负载均衡。 5.3同时支持网口PoE供电和电源适配器供电的AP设备，在电源适配器供电状态下，断开电源适配器时系统会重启 
Client连接到了一个信号相对较弱的AP上，而没有连接到相对信号较强且距离较近的AP上。 ,(1)请确认客户端分布是否合理，不要造成大量客户端聚集在某个AP附近，否则即使负载均衡到其他的AP上，也会因为信号强度相差太大而触发频繁的漫游。 (2)如果发生Client无法连接的情况，要关闭负载均衡后再进行观察。 (3)基于流量的负载均衡不宜控制，不建议使用，尤其是有些加密、安全配置限制了AP的接入数量的情况下（例如TKIP加密使得AP只能接入28个用户），建议使用基于会话的负载均衡。 5.3同时支持网口PoE供电和电源适配器供电的AP设备，在电源适配器供电状态下，断开电源适配器时系统会重启 ,(1)请确认客户端分布是否合理，不要造成大量客户端聚集在某个AP附近，否则即使负载均衡到其他的AP上，也会因为信号强度相差太大而触发频繁的漫游。 (2)如果发生Client无法连接的情况，要关闭负载均衡后再进行观察。 (3)基于流量的负载均衡不宜控制，不建议使用，尤其是有些加密、安全配置限制了AP的接入数量的情况下（例如TKIP加密使得AP只能接入28个用户），建议使用基于会话的负载均衡。 5.3同时支持网口PoE供电和电源适配器供电的AP设备，在电源适配器供电状态下，断开电源适配器时系统会重启 
Console口采用Password认证或AAA本地认证的情况下，管理员通过Console口登录设备时，因密码不正确而无法成功登录,本类故障的常见原因主要包括： •管理员遗忘了Console口的登录密码或输入错误的密码。 •Console口的登录账户已过期。 3.故障分析 本类故障的诊断流程如图4-25所示。 图4-1Console口密码遗忘故障诊断流程图 4.处理步骤(1)确认是否能过通过Telnet/Stelnet方式登录设备。如果管理员拥有Telnet/Stelnet账号，并且该账号拥有network-admin/level-15用户角色，则可以通过Telnet/Stelnet方式登录到设备后修改Console口登录相关配置。具体的处理步骤如下： a.使用Telnet/Stelnet账号登录设备，执行displayline命令查看Console口所在用户线 的认证方式。 <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation 0CON09600-P-0/0+81VTY0-N-0/0... 以上显示信息中，“Auth”字段取值为P表示采用密码认证方式，取值为A表示采用AAA认证方式。 b.确认当前登录的Telnet/Stelnet用户是否具有network-admin/level-15用户角色。 对于采用none或者password认证方式登录的用户，可在当前登录的用户线视图下查看用户角色配置是否为network-admin/level-15；对于采用scheme认证方式登录的用户，用户角色由AAA授权，需要查看对应的本地账号或远程账号的授权用户角色属性。 <Sysname>system-view [Sysname]displayusers IdxLineIdleTimePidType1VTY001:15:52Aug0211:40:022203TELFollowingaremoredetails. VTY0: Userrolelist:network-adminLocation:192.168.100.24 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. [Sysname]linevty0 [Sysname-line-vty0]displaythis #linecon0 authentication-modepassworduser-rolenetwork-admin #linevty063authentication-modenoneuser-rolenetwork-admin #return 如果用户角色不是network-admin/level-15，则当前登录的账户没有更改Console口相关配置的权限，请执行步骤（2）；如果用户角色为network-admin/level-15，请根据Console口的认证方式采用不同的处理步骤。 c.Console口采用密码认证方式的情况下，修改Console口认证密码。进入Console口所在的用户线，设置新的密码（下例中为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 [Sysname]lineconsole0 [Sysname-line-console0]setauthenticationpasswordsimple1234567890! [Sysname-line-console0]user-rolenetwork-admin d.Console口采用AAA本地认证方式的情况下，修改Console口的本地用户密码。进入Console口登录所使用账户的本地用户视图，修改本地用户的密码（下例中用户名为 admin，用户密码为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin e.Console口采用AAA远程认证方式的情况下，请联系AAA服务器管理员获取登录密码。 f.为了防止重启后配置丢失，请执行save命令保存当前配置。 (2)通过Console口连接设备后，断电重启设备，进入BootWare菜单。 进入到BootWare菜单需要重启设备，会导致业务中断，请视具体情况做好备份，并尽量选择业务量较少的时间操作。 系统启动后，如果未及时选择进入基本段，则会直接运行BootWare扩展段程序。当显示信息出现“PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU...”时，键入<Ctrl+B>，系统会首先给出密码恢复功能是否开启的提示信息： Passwordrecoverycapabilityisenabled. Passwordrecoverycapabilityisdisabled. 密码恢复功能处于开启状态时，可以选择跳过Console口认证选项，或者跳过当前配置选项。具体操作过程请分别参见步骤（3）、（4）。 密码恢复功能处于关闭状态时，可以选择恢复出厂配置选项。具体操作过程请执行步骤（5）。 (3)通过BootWare扩展段菜单跳过Console口认证，登录后修改Console口密码。 直接回车，进入BootWare扩展段主菜单后，请按照系统提示选择相应的菜单选项跳过Console口认证（不同产品跳过Console口认证的菜单选项不同，请以实际情况为准）。系统启动后，不需要管理员输入Console口密码，会正常完成所有配置的加载。a.启动后，请尽快根据Console口采用的认证方式修改密码。−Console口采用密码认证方式的情况下，修改Console口认证密码。进入Console口所在的用户线，设置新的密码（下例中为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]setauthenticationpasswordsimple1234567890! [Sysname-line-console0]user-rolenetwork-admin −Console口采用AAA本地认证方式的情况下，修改Console口的本地用户密码。进入Console口登录所使用账户的本地用户视图，修改本地用户的密码（下例中用户名为 admin，用户密码为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 <Sysname>system-view [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin b.为了防止重启后配置丢失，请执行save命令保存当前配置。 (4)通过BootWare扩展段菜单跳过当前配置，登录后配置新的Console口密码。 直接回车，进入BootWare扩展段主菜单后，请按照系统提示选择相应的菜单选项跳过当前配置（不同产品跳过当前配置的菜单选项不同，请以实际情况为准）。系统启动时，将忽略配置文件中的所有配置以空配置进行启动（该选项每次设置后仅生效一次）。系统启动后，不需要管理员输入Console口密码。 a.启动后，请尽快将原配置文件导出。在此操作过程中不要对设备进行断电。−方式一：通过FTP/TFTP方式将原配置文件导出到本地。 −方式二：在用户视图下执行more命令查看原配置文件内容，将显示的所有原配置文件内容直接复制粘贴到本地文件中。 b.手动修改本地配置文件中关于Console口登录的配置，将修改后的配置文件上传至设备存储介质的根目录下。 c.配置下次启动时的配置文件为修改后的配置文件（假设修改后的配置文件为startup.cfg）。 <Sysname>startupsaved-configurationstartup.cfg d.重启设备。 (5)通过BootWare扩展段菜单恢复出厂配置，登录后配置新的Console口密码。 此操作下，系统启动时会自动删除下次启动配置文件和备份启动配置文件，再以出厂配置启动。 请确保当前业务不会受到影响时执行本操作。 直接回车，进入BootWare扩展段主菜单后，请按照系统提示选择相应的子菜单恢复出厂配置 （不同产品恢复出厂配置的菜单选项不同，请以实际情况为准）。系统启动后，不需要管理员输入Console口密码。 a.启动后，请根据实际需要配置Console口的登录认证方式，以及相关的登录密码或登录账 −认(户。)证方式为none <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modenone [Sysname-line-console0]user-rolenetwork-admin 该方式下，用户不需要输入用户名和密码，就可以使用该用户线登录设备，存在安全隐患，请谨慎配置。 −认证方式为密码认证 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modepassword [Sysname-line-console0]setauthenticationpasswordsimple1234567890! [Sysname-line-console0]user-rolenetwork-admin −认证方式为本地AAA认证 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modescheme [Sysname-line-console0]quit [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]service-typeterminal[Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin −认证方式为远程AAA认证 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modescheme [Sysname-line-console0]quit 除此之外，还需要配置Login用户的认证域，以及RADIUS、HWTACACS或LDAP方案。 相关配置的详细介绍请参见“安全配置指导”中的“AAA”。b.为了防止重启后配置丢失，请执行save命令保存当前配置。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.1.2Telnet登录密码遗忘 ,Suggestion not provided
Console口采用Password认证或AAA本地认证的情况下，管理员通过Console口登录设备时，因密码不正确而无法成功登录。 ,本类故障的常见原因主要包括： •管理员遗忘了Console口的登录密码或输入错误的密码。 •Console口的登录账户已过期。 3.故障分析 本类故障的诊断流程如图4-25所示。 图4-1Console口密码遗忘故障诊断流程图 4.处理步骤(1)确认是否能过通过Telnet/Stelnet方式登录设备。如果管理员拥有Telnet/Stelnet账号，并且该账号拥有network-admin/level-15用户角色，则可以通过Telnet/Stelnet方式登录到设备后修改Console口登录相关配置。具体的处理步骤如下： a.使用Telnet/Stelnet账号登录设备，执行displayline命令查看Console口所在用户线 的认证方式。 <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation 0CON09600-P-0/0+81VTY0-N-0/0... 以上显示信息中，“Auth”字段取值为P表示采用密码认证方式，取值为A表示采用AAA认证方式。 b.确认当前登录的Telnet/Stelnet用户是否具有network-admin/level-15用户角色。 对于采用none或者password认证方式登录的用户，可在当前登录的用户线视图下查看用户角色配置是否为network-admin/level-15；对于采用scheme认证方式登录的用户，用户角色由AAA授权，需要查看对应的本地账号或远程账号的授权用户角色属性。 <Sysname>system-view [Sysname]displayusers IdxLineIdleTimePidType1VTY001:15:52Aug0211:40:022203TELFollowingaremoredetails. VTY0: Userrolelist:network-adminLocation:192.168.100.24 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. [Sysname]linevty0 [Sysname-line-vty0]displaythis #linecon0 authentication-modepassworduser-rolenetwork-admin #linevty063authentication-modenoneuser-rolenetwork-admin #return 如果用户角色不是network-admin/level-15，则当前登录的账户没有更改Console口相关配置的权限，请执行步骤（2）；如果用户角色为network-admin/level-15，请根据Console口的认证方式采用不同的处理步骤。 c.Console口采用密码认证方式的情况下，修改Console口认证密码。进入Console口所在的用户线，设置新的密码（下例中为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 [Sysname]lineconsole0 [Sysname-line-console0]setauthenticationpasswordsimple1234567890! [Sysname-line-console0]user-rolenetwork-admin d.Console口采用AAA本地认证方式的情况下，修改Console口的本地用户密码。进入Console口登录所使用账户的本地用户视图，修改本地用户的密码（下例中用户名为 admin，用户密码为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin e.Console口采用AAA远程认证方式的情况下，请联系AAA服务器管理员获取登录密码。 f.为了防止重启后配置丢失，请执行save命令保存当前配置。 (2)通过Console口连接设备后，断电重启设备，进入BootWare菜单。 进入到BootWare菜单需要重启设备，会导致业务中断，请视具体情况做好备份，并尽量选择业务量较少的时间操作。 系统启动后，如果未及时选择进入基本段，则会直接运行BootWare扩展段程序。当显示信息出现“PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU...”时，键入<Ctrl+B>，系统会首先给出密码恢复功能是否开启的提示信息： Passwordrecoverycapabilityisenabled. Passwordrecoverycapabilityisdisabled. 密码恢复功能处于开启状态时，可以选择跳过Console口认证选项，或者跳过当前配置选项。具体操作过程请分别参见步骤（3）、（4）。 密码恢复功能处于关闭状态时，可以选择恢复出厂配置选项。具体操作过程请执行步骤（5）。 (3)通过BootWare扩展段菜单跳过Console口认证，登录后修改Console口密码。 直接回车，进入BootWare扩展段主菜单后，请按照系统提示选择相应的菜单选项跳过Console口认证（不同产品跳过Console口认证的菜单选项不同，请以实际情况为准）。系统启动后，不需要管理员输入Console口密码，会正常完成所有配置的加载。a.启动后，请尽快根据Console口采用的认证方式修改密码。−Console口采用密码认证方式的情况下，修改Console口认证密码。进入Console口所在的用户线，设置新的密码（下例中为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]setauthenticationpasswordsimple1234567890! [Sysname-line-console0]user-rolenetwork-admin −Console口采用AAA本地认证方式的情况下，修改Console口的本地用户密码。进入Console口登录所使用账户的本地用户视图，修改本地用户的密码（下例中用户名为 admin，用户密码为1234567890!）。同时，建议将用户角色设置为network-admin/level-15，避免Console口登录后用户权限过低。 <Sysname>system-view [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin b.为了防止重启后配置丢失，请执行save命令保存当前配置。 (4)通过BootWare扩展段菜单跳过当前配置，登录后配置新的Console口密码。 直接回车，进入BootWare扩展段主菜单后，请按照系统提示选择相应的菜单选项跳过当前配置（不同产品跳过当前配置的菜单选项不同，请以实际情况为准）。系统启动时，将忽略配置文件中的所有配置以空配置进行启动（该选项每次设置后仅生效一次）。系统启动后，不需要管理员输入Console口密码。 a.启动后，请尽快将原配置文件导出。在此操作过程中不要对设备进行断电。−方式一：通过FTP/TFTP方式将原配置文件导出到本地。 −方式二：在用户视图下执行more命令查看原配置文件内容，将显示的所有原配置文件内容直接复制粘贴到本地文件中。 b.手动修改本地配置文件中关于Console口登录的配置，将修改后的配置文件上传至设备存储介质的根目录下。 c.配置下次启动时的配置文件为修改后的配置文件（假设修改后的配置文件为startup.cfg）。 <Sysname>startupsaved-configurationstartup.cfg d.重启设备。 (5)通过BootWare扩展段菜单恢复出厂配置，登录后配置新的Console口密码。 此操作下，系统启动时会自动删除下次启动配置文件和备份启动配置文件，再以出厂配置启动。 请确保当前业务不会受到影响时执行本操作。 直接回车，进入BootWare扩展段主菜单后，请按照系统提示选择相应的子菜单恢复出厂配置 （不同产品恢复出厂配置的菜单选项不同，请以实际情况为准）。系统启动后，不需要管理员输入Console口密码。 a.启动后，请根据实际需要配置Console口的登录认证方式，以及相关的登录密码或登录账 −认(户。)证方式为none <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modenone [Sysname-line-console0]user-rolenetwork-admin 该方式下，用户不需要输入用户名和密码，就可以使用该用户线登录设备，存在安全隐患，请谨慎配置。 −认证方式为密码认证 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modepassword [Sysname-line-console0]setauthenticationpasswordsimple1234567890! [Sysname-line-console0]user-rolenetwork-admin −认证方式为本地AAA认证 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modescheme [Sysname-line-console0]quit [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]service-typeterminal[Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin −认证方式为远程AAA认证 <Sysname>system-view [Sysname]lineconsole0 [Sysname-line-console0]authentication-modescheme [Sysname-line-console0]quit 除此之外，还需要配置Login用户的认证域，以及RADIUS、HWTACACS或LDAP方案。 相关配置的详细介绍请参见“安全配置指导”中的“AAA”。b.为了防止重启后配置丢失，请执行save命令保存当前配置。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.1.2Telnet登录密码遗忘 ,Suggestion not provided
CPE5100接入5G网络后，E-Ch1/0/1:0接口没有正常获取到IP地址,"本类故障的常见原因主要包括： •无对应的路由或者ARP表项。 •中间设备未开启ICMP超时报文发送功能。 •目的端未开启ICMP目的不可达报文发送功能。 3.故障分析 本类故障的诊断思路如下： (1)检查中间设备是否开启了ICMP超时报文发送功能。 (2)检查目的端是否开启了ICMP目的不可达报文发送功能。 (3)检查是否存在达到目的端的ARP以及FIB表项。 本类故障的诊断流程如图4-13所示。 图4-13Tracert不通故障诊断流程图 4.处理步骤 (1)检查中间设备是否开启了ICMP超时报文发送功能。#查看报文从源端到目的端所经过的路径（假设源端到目的端只有两跳，目的端的IP地址为 1.1.2.2）。 <Sysname>tracert1.1.2.2 tracerouteto1.1.2.2(1.1.2.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak1*** 21.1.2.2(1.1.2.2)[AS100]580ms470ms80ms 出现以上显示信息时，请登录中间设备，在中间设备上执行ipttl-expiresenable命令开启ICMP超时报文发送功能。如果故障排除，则说明中间设备未开启ICMP超时报文发送功能导致Tracert不通；如果故障未排除，请继续执行下面的步骤。 (2)检查目的端是否开启了ICMP目的不可达报文发送功能。 #查看报文从源端到目的端所经过的路径（假设源端到目的端只有两跳，目的端的IP地址为 1.1.2.2）。 <Sysname>tracert1.1.2.2 tracerouteto1.1.2.2(1.1.2.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak 11.1.1.2(1.1.1.2)[AS99]560ms430ms50ms 2*** 出现以上显示信息时，请在目的端执行ipunreachablesenable命令开启ICMP目的不可达报文发送功能。如果故障排除，则说明目的端未开启ICMP目的不可达报文发送功能；如果故障未排除，请继续执行下面的步骤。 (3)在问题节点上检查是否存在对应的FIB表项和ARP表项。在未回应ICMP差错报文的设备（tracert命令执行结果中显示为“***”的设备）上执行displayfib命令，检查是否存在到目的地址的路由。 如果路由不存在，请检查OSPF、IS-IS、BGP等路由协议配置是否有误。 如果路由存在并且报文所经链路是以太链路，请执行displayarp命令查看Tracert的下一跳地址对应的ARP表项是否存在。如果不存在，请检查ARP配置是否有误。 (4)检查Tracert发起端是否收到ICMP差错报文。发起Tracert后，在Tracert发起端上多次执行displayicmpstatistics命令查看发起端是否收到ICMP差错报文，显示信息示例如下： <Sysname>displayicmpstatistics Input:badformats0badchecksum0echo0destinationunreachable9sourcequench0redirects0echoreplies7parameterproblem0timestamp0informationrequests0maskrequests0maskreplies0timeexceeded3invalidtype0routeradvert0routersolicit0broadcast/multicastechorequestsignored0broadcast/multicasttimestamprequestsignored0 其它显示信息略…… 观察以上ICMP报文的统计信息的变化，判断Input区段内的timeexceeded和destinationunreachable值的增量是否与Tracert报文发送个数相等，如果不等则表明发起端未收到 ICMP差错报文。 (5)根据收发包统计，确认丢包位置和丢包原因。 在Tracert报文途径的设备上： a.配置QoS策略，使用ACL源地址和目的地址过滤Tracert报文，然后在Tracert报文途径 b.通过displayqospolicyinterfa(接口的入方向和出方向应用QoS策略。)ce命令查看应用QoS策略的接口上QoS策略匹 配成功的报文个数。如果报文个数有增长，则说明设备收到了Tracert报文；如果报文个数无增长，则说明设备没有收到Tracert报文，此时，可以使用debuggingippacket命令打开IP报文调试信息开关，进一步排查设备没有收到Tracert报文的原因并解决问题。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.9广域网故障处理 4.9.1接入5G网络后E-Ch1/0/1:0接口未获取到IP地址 本类故障的常见原因主要包括： •拨号参数（APN、用户名、密码等）配置错误 •NR信号质量差 •IMS的APN配置影响 4.处理步骤 (1)检查拨号配置（APN、用户名、密码等）是否正确。如果不正确，则需要修改为正确的配置。 (2)检查接入小区的信号质量。在任意视图下执行displaycellular命令可以查看接入小区的信号质量信息。如果信号质量差，可以能会导致不能正常接入，建议将设备放置在好点。信号质量参考值如下： 极好点：RSRP>-85dBm；SINR>25。 好点：-85dBm≥RSRP>-95dBm；25≥SINR≥16。 中点：-95dBm≥RSRP>-105dBm；15≥SINR≥11。差点：-105dBm≥RSRP>-115dBm；10≥SINR≥3。 极差点：RSRP≤-115dBm；SINR<3。 (3)有些SIM卡（如物联网卡等）需要去除IMS的APN配置，否则可能会拨号失败。 a.进入Cellular接口视图。 b.在Cellular接口视图下执行“sendatat+qnvfw=\”/nv/item_files/ims/IMS_enable\”,00”。 c.掉电重启CPE。 (4)如果故障仍然未能排除，请联系技术支持人员。 4.10Portal故障处理 4.10.1Portal认证页面无法弹出 ",Suggestion not provided
CPE5100接入5G网络后，E-Ch1/0/1:0接口没有正常获取到IP地址。 ,"本类故障的常见原因主要包括： •无对应的路由或者ARP表项。 •中间设备未开启ICMP超时报文发送功能。 •目的端未开启ICMP目的不可达报文发送功能。 3.故障分析 本类故障的诊断思路如下： (1)检查中间设备是否开启了ICMP超时报文发送功能。 (2)检查目的端是否开启了ICMP目的不可达报文发送功能。 (3)检查是否存在达到目的端的ARP以及FIB表项。 本类故障的诊断流程如图4-13所示。 图4-13Tracert不通故障诊断流程图 4.处理步骤 (1)检查中间设备是否开启了ICMP超时报文发送功能。#查看报文从源端到目的端所经过的路径（假设源端到目的端只有两跳，目的端的IP地址为 1.1.2.2）。 <Sysname>tracert1.1.2.2 tracerouteto1.1.2.2(1.1.2.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak1*** 21.1.2.2(1.1.2.2)[AS100]580ms470ms80ms 出现以上显示信息时，请登录中间设备，在中间设备上执行ipttl-expiresenable命令开启ICMP超时报文发送功能。如果故障排除，则说明中间设备未开启ICMP超时报文发送功能导致Tracert不通；如果故障未排除，请继续执行下面的步骤。 (2)检查目的端是否开启了ICMP目的不可达报文发送功能。 #查看报文从源端到目的端所经过的路径（假设源端到目的端只有两跳，目的端的IP地址为 1.1.2.2）。 <Sysname>tracert1.1.2.2 tracerouteto1.1.2.2(1.1.2.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak 11.1.1.2(1.1.1.2)[AS99]560ms430ms50ms 2*** 出现以上显示信息时，请在目的端执行ipunreachablesenable命令开启ICMP目的不可达报文发送功能。如果故障排除，则说明目的端未开启ICMP目的不可达报文发送功能；如果故障未排除，请继续执行下面的步骤。 (3)在问题节点上检查是否存在对应的FIB表项和ARP表项。在未回应ICMP差错报文的设备（tracert命令执行结果中显示为“***”的设备）上执行displayfib命令，检查是否存在到目的地址的路由。 如果路由不存在，请检查OSPF、IS-IS、BGP等路由协议配置是否有误。 如果路由存在并且报文所经链路是以太链路，请执行displayarp命令查看Tracert的下一跳地址对应的ARP表项是否存在。如果不存在，请检查ARP配置是否有误。 (4)检查Tracert发起端是否收到ICMP差错报文。发起Tracert后，在Tracert发起端上多次执行displayicmpstatistics命令查看发起端是否收到ICMP差错报文，显示信息示例如下： <Sysname>displayicmpstatistics Input:badformats0badchecksum0echo0destinationunreachable9sourcequench0redirects0echoreplies7parameterproblem0timestamp0informationrequests0maskrequests0maskreplies0timeexceeded3invalidtype0routeradvert0routersolicit0broadcast/multicastechorequestsignored0broadcast/multicasttimestamprequestsignored0 其它显示信息略…… 观察以上ICMP报文的统计信息的变化，判断Input区段内的timeexceeded和destinationunreachable值的增量是否与Tracert报文发送个数相等，如果不等则表明发起端未收到 ICMP差错报文。 (5)根据收发包统计，确认丢包位置和丢包原因。 在Tracert报文途径的设备上： a.配置QoS策略，使用ACL源地址和目的地址过滤Tracert报文，然后在Tracert报文途径 b.通过displayqospolicyinterfa(接口的入方向和出方向应用QoS策略。)ce命令查看应用QoS策略的接口上QoS策略匹 配成功的报文个数。如果报文个数有增长，则说明设备收到了Tracert报文；如果报文个数无增长，则说明设备没有收到Tracert报文，此时，可以使用debuggingippacket命令打开IP报文调试信息开关，进一步排查设备没有收到Tracert报文的原因并解决问题。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.9广域网故障处理 4.9.1接入5G网络后E-Ch1/0/1:0接口未获取到IP地址 本类故障的常见原因主要包括： •拨号参数（APN、用户名、密码等）配置错误 •NR信号质量差 •IMS的APN配置影响 4.处理步骤 (1)检查拨号配置（APN、用户名、密码等）是否正确。如果不正确，则需要修改为正确的配置。 (2)检查接入小区的信号质量。在任意视图下执行displaycellular命令可以查看接入小区的信号质量信息。如果信号质量差，可以能会导致不能正常接入，建议将设备放置在好点。信号质量参考值如下： 极好点：RSRP>-85dBm；SINR>25。 好点：-85dBm≥RSRP>-95dBm；25≥SINR≥16。 中点：-95dBm≥RSRP>-105dBm；15≥SINR≥11。差点：-105dBm≥RSRP>-115dBm；10≥SINR≥3。 极差点：RSRP≤-115dBm；SINR<3。 (3)有些SIM卡（如物联网卡等）需要去除IMS的APN配置，否则可能会拨号失败。 a.进入Cellular接口视图。 b.在Cellular接口视图下执行“sendatat+qnvfw=\”/nv/item_files/ims/IMS_enable\”,00”。 c.掉电重启CPE。 (4)如果故障仍然未能排除，请联系技术支持人员。 4.10Portal故障处理 4.10.1Portal认证页面无法弹出 ",Suggestion not provided
CPE上电后，发现用户终端的串口接到CPE设备的RJ45口，但是没有打印信息,Cause not provided,Suggestion not provided
CPE上电后，发现用户终端的串口接到CPE设备的RJ45口，但是没有打印信息。 2.故障处理步骤 (1)请确认用户终端的串口是否插到了设备的CONSOLE口，如果插到CPE的网口的话就不会有打印信息。 (2)检查用户终端的串口设置，特别是波特率需要设置为115200bps，校验（Parity）设置为none即不需要校验位，数据位（Databits）设置为8。 (3)如果故障仍然未能排除，请联系技术工程师。 2.1.2网口无法连接 ,Cause not provided,Suggestion not provided
displayinterface使用命令(端口状态为UP，但不发送报文。)查看本端出方向的发送报文统计不增长。 ,•光模块异常。 •端口上的配置影响报文的接收。 •设备或单板硬件故障。 3.故障分析 本类故障的诊断流程如图20所示。 图20故障诊断流程图 4.处理步骤 (1)端口进行内部环回检查。 在端口下配置loopbackinternal命令开启内部环回功能，然后通过display interface查看本端出方向的发送报文统计是否增长。如果增长，则可能是设备或单板硬件故障，请联系技术支持人员。如果不增长，则不是端口内部问题。 (2)检查端口配置是否影响报文发送。 •STP功能，通过对于二层口，如果配置了display(可通过以下步骤检查端口配置是否影响报文的发送：)stpbrief命令，查看端口是否为 discarding状态。如果端口被STP设置为discarding状态，请根据STP的相关配置进一步排查。建议将连接终端设备的端口配置为边缘端口或关闭该端口的STP功能。 •如果该端口加入了聚合组，通过displaylink-aggregationsummary命令查看该端口是否为Selected选中状态。当该端口Status为Unselected状态时，该端口无法收发数据报文。请定位端口成为Unselected状态的原因，如聚合组内成员端口的属性类配置与参考端口不一致，进一步排查解决。 •如果配置了ACL过滤，请根据ACL的相关配置进一步排查。 •如果接口配置了PFC功能和流量控制功能，请关闭PFC功能和流量控制功能查看该故障端口是否能恢复正常。 •查看是否配置了接口出方向上阻断广播/未知组播/未知单播报文功能，某些协议（例如ARP、 DHCP、RIP、IGMP等）在运行过程中会交互广播/未知组播/未知单播报文，如果配置该功能将导致这些协议报文不能通过该接口发送，请关闭该功能查看故障端口是否能恢复正常。 (3)执行shutdown命令，再执行undoshutdown命令，查看端口是否能恢复正常。 (4)如果故障仍然未能排除，可能是设备或单板硬件故障，请收集信息，并联系技术支持人员。 (5)告警与日志相关告警无 相关日志无 3.6.440GE/100GE接口拆分、合并故障 ,Suggestion not provided
EVPN分布式网关场景，不同VXLAN内的VTEP之间隧道无法建立。 ,"本类故障的常见原因主要包括： •未收到EVPN的2类路由、5类路由（IP前缀路由）。 •VPN实例下的RT配置错误。 3.故障分析 本类故障的诊断思路如下： (1)检查是否收到2类路由。 (2)检查是否收到5类路由 (3)检查VPN实例下的RT是否配置错误。 不同VXLAN内VTEP之间的VXLAN隧道无法建立的故障诊断流程如图120所示。 图120不同VXLAN内VTEP之间的VXLAN隧道无法建立的故障诊断流程图 4.处理步骤 不同VXLAN内VTEP之间的VXLAN隧道无法建立时，故障处理步骤如下： (1)在本端执行displaybgpl2vpnevpn命令查看本端是否向对端发布了2类或5类路由。例如，下面的显示信息表示本端向4.4.4.4通告了2类和5类路由。如果组网中存在RR，则displaybgpl2vpnevpn命令需要指定RR的地址；否则，需要指定对端的地址。 <Sysname>displaybgpl2vpnevpnpeer4.4.4.4advertised-routes Totalnumberofroutes:3 BGPlocalrouterIDis1.1.1.1 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-external,a-additional-path Origin:i-IGP,e-EGP,?-incomplete Routedistinguisher:1:1 Totalnumberofroutes:1 NetworkNextHopMEDLocPrfPath/Ogn *>[5][0][24][10.1.1.0]/80 0.0.0.00100i Routedistinguisher:2:2 Totalnumberofroutes:2 NetworkNextHopMEDLocPrfPath/Ogn *>[2][0][48][0e86-19b6-0308][0][0.0.0.0]/104 0.0.0.00100i *>[3][0][32][1.1.1.1]/80 0.0.0.00100i 如果本端向对端发布了2类或5类路由，则执行第(2)步。 如果本端未向对端发布2类和5类路由，请检查EVPN功能中BGP的相关配置是否正确，具体配置参见“EVPN配置指导”中的“EVPNVXLAN”。 (2)在对端执行displaybgpl2vpnevpn命令查看对端是否向本端发布了2类或5类路由。例如，下面的显示信息表示对端向4.4.4.4通告了2类和5类路由。如果组网中存在RR，则displaybgpl2vpnevpn命令需要指定RR的地址；否则，需要指定对端的地址。 <Sysname>displaybgpl2vpnevpnpeer4.4.4.4advertised-routes Totalnumberofroutes:3 BGPlocalrouterIDis3.3.3.3 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-external,a-additional-path Origin:i-IGP,e-EGP,?-incomplete Routedistinguisher:1:1 Totalnumberofroutes:2 NetworkNextHopMEDLocPrfPath/Ogn *>[2][0][48][0e86-23cf-0507][0][0.0.0.0]/104 0.0.0.00100i *>[3][0][32][3.3.3.3]/80 0.0.0.00100i Routedistinguisher:3:3 Totalnumberofroutes:2 NetworkNextHopMEDLocPrfPath/Ogn *>[5][0][24][10.1.1.0]/80 0.0.0.00100i 如果对端向本端发布了2类或5类路由，则执行第(3)步。 如果对端未向本端发布2类和5类路由，请检查EVPN功能中BGP的相关配置是否正确，具体配置参见“EVPN配置指导”中的“EVPNVXLAN”。 (3)在关联L3VNI的VPN实例视图下执行displaythis命令查看两端的Exporttarget属性与Importtarget属性配置是否正确。 [Sysname-vpn-instance-vpna]displaythis # ipvpn-instancevpnaroute-distinguisher1:1 # address-familyevpn vpn-target1:1import-extcommunityvpn-target1:1export-extcommunity #return 如果两端的RT属性不匹配，请执行vpn-target命令修改RouteTarget属性配置。 如果两端的RT属性匹配，则执行第(4)步。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无。相关日志无。 15.1.3VXLAN网络中，二层VXLAN业务流量不通 ",Suggestion not provided
EVPN分布式网关场景，同一VXLAN内的VTEP之间隧道无法建立。 ,"本类故障的常见原因主要包括： •未收到EVPN的2类路由（MAC/IP发布路由）、3类路由（IMET路由）。 •EVPN实例下的RT配置错误。 3.故障分析 本类故障的诊断思路如下： (1)检查是否收到2类路由。 (2)检查是否收到3类路由。 (3)检查EVPN实例下的RT是否配置错误。 同一VXLAN内VTEP之间的VXLAN隧道无法建立的故障诊断流程如图119所示。 图119同一VXLAN内VTEP之间的VXLAN隧道无法建立的故障诊断流程图 4.处理步骤 同一VXLAN内VTEP之间的VXLAN隧道无法建立时，故障处理步骤如下： (1)在本端执行displaybgpl2vpnevpn命令查看本端是否向对端发布了2类或3类路由。例如，下面的显示信息表示本端向4.4.4.4通告了2类和3类路由。如果组网中存在RR，则displaybgpl2vpnevpn命令需要指定RR的地址；否则，需要指定对端的地址。 <Sysname>displaybgpl2vpnevpnpeer4.4.4.4advertised-routes Totalnumberofroutes:2 BGPlocalrouterIDis1.1.1.1 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-external,a-additional-path Origin:i-IGP,e-EGP,?-incomplete Routedistinguisher:2:2 Totalnumberofroutes:2 NetworkNextHopMEDLocPrfPath/Ogn *>[2][0][48][0e86-19b6-0308][0][0.0.0.0]/104 0.0.0.00100i *>[3][0][32][1.1.1.1]/80 0.0.0.00100i 如果本端向对端发布了2类或3类路由，则执行第(2)步。 如果本端未向对端发布2类和3类路由，请检查EVPN功能中BGP的相关配置是否正确，具体配置参见“EVPN配置指导”中的“EVPNVXLAN”。 (2)在对端执行displaybgpl2vpnevpn命令查看对端是否向本端发布了2类或3类路由。例如，下面的显示信息表示对端向4.4.4.4通告了2类和3类路由。如果组网中存在RR，则displaybgpl2vpnevpn命令需要指定RR的地址；否则，需要指定对端的地址。 <Sysname>displaybgpl2vpnevpnpeer4.4.4.4advertised-routes Totalnumberofroutes:2 BGPlocalrouterIDis3.3.3.3 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-external,a-additional-path Origin:i-IGP,e-EGP,?-incomplete Routedistinguisher:1:1 Totalnumberofroutes:2 NetworkNextHopMEDLocPrfPath/Ogn *>[2][0][48][0e86-23cf-0507][0][0.0.0.0]/104 0.0.0.00100i *>[3][0][32][3.3.3.3]/80 0.0.0.00100i 如果对端向本端发布了2类或3类路由，则执行第(3)步。 如果对端未向本端发布2类和3类路由，请检查EVPN功能中BGP的相关配置是否正确，具体配置参见“EVPN配置指导”中的“EVPNVXLAN”。 (3)在VSI视图下执行displaythis命令查看两端的Exporttarget属性与Importtarget属性配置是否正确。 [Sysname-vsi-aaa]displaythis #vsiaaavxlan10 evpnencapsulationvxlanroute-distinguisher2:2vpn-target1:1export-extcommunityvpn-target2:2import-extcommunity #return 如果两端的RT属性不匹配，请在VSI视图下执行vpn-target命令修改RouteTarget属性配置。 如果两端的RT属性匹配，则执行第(4)步。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警 无。 相关日志无。 15.1.2EVPN分布式网关场景，不同VXLAN内的VTEP之间隧道无法建立 ",Suggestion not provided
EVPN网络中，VM迁移到新的VTEP后，VTEP没有立刻学习到VM的MAC地址或者ARP。 ,本类故障的常见原因主要包括： •新的VTEP未学习到迁移VM的MAC地址表项和ARP表项。 •新的VTEP未通过BGPEVPN路由同步学习到迁移VM的MAC地址和ARP。 •VTEP之间同步的BGPEVPN路由不是最优路由。 3.故障分析 本类故障的诊断流程如图123所示。 图123VM迁移时间过长的故障诊断流程图 4.处理步骤 (1)在迁移后的VTEP设备上查看是否学习到迁移VM的MAC地址或ARP。 通过displayl2vpnmac-address命令查看VSI的MAC地址表中是否存在迁移VM的MAC地址表项。 <Sysname>displayl2vpnmac-address *-TheoutputinterfaceisissuedtoanotherVSI MACAddressStateVSINameLinkID/NameAging 52f6-bc1e-0d06EVPNaaaTunnel10NotAging 0001-0001-0001DynamicvpnaGE1/0/1Aging ---2macaddress(es)found--- 通过displayarp命令查看VSI的ARP表项中是否包含VM的ARP表项。 <Sysname>displayarp Type:S-StaticD-DynamicO-OpenflowR-RuleM-MultiportI-Invalid IPaddressMACaddressVLAN/VSInameInterfaceAgingType 10.1.1.30001-0001-0001vpnaGE1/0/1960D ,Suggestion not provided
EVPN组网中，报文不能通过多条等价路由进行ECMP转发。 ,•只有一条路由，无法形成ECMP •BGP团体属性和扩展团体属性配置不同 •路由中携带了default-gateway扩展团体属性 •存在其他路由协议干扰 3.故障分析 本类故障的诊断流程如图34所示。 图34故障处理流程图 4.故障处理步骤 (1)检查是否存在到达同一目的网络的多条路由 通过displaybgpl2vpnevpnroute-distinguisherroute-typeip-prefix 命令查看是都存在到达同一目的网络RD相同、下一跳不同的多条路由。如果只有一条路由，则无法进行ECMP；如果存在多条路由，则继续进行以下操作。 (2)检查路由的团体属性和扩展团体属性是否一致 通过displaybgpl2vpnevpnroute-distinguisherroute-distinguisherevpn-routeroute-length命令查看EVPN路由的详细信息。判断到达同一目的网络的多条路由携带的BGP团体属性和扩展团体属性是否相同。如果不同，则修改通过配置修改路由的BGP团体属性和扩展团体属性；否则，无法形成ECMP。 (3)检查路由是否携带default-gateway属性 通过displaybgpl2vpnevpnroute-distinguisherroute-distinguisherevpn-routeroute-length命令查看EVPN路由的详细信息，判断路由中是否携带default-gateway扩展团体属性。若携带该扩展团体属性，则路由之间不能形成ECMP。 (4)检查是否存在其他路由协议的路由通过displayiprouting-tablevpn-instance命令查看是否存在其他路由协议生成 的到达该目的网络的路由。如果存在，请通过preference命令修改BGP路由的优先级，使得BGP路由优于其他路由协议生成的路由（优先级数值越小表明优先级越高）。 (5)检查是否配置进行BGP负载分担的路由条数 通过displaybgprouting-tableipv4vpn-instance命令查看是否存在相同前缀 的多条路由，如果存在多条，但是只有一条为最优路由（带有“>”标记），则执行displaycurrent-configurationconfigurationbgp命令检查BGP-VPNIPv4单播地址族视 图下是否配置了balance命令。如果没有配置，则执行balance命令配置进行BGP负载分担的路由条数大于1。 5.告警与日志 相关告警无 相关日志 无 5基础配置类故障处理 5.1登录设备类故障处理 5.1.1Console口密码遗忘 ,Suggestion not provided
Fault Description,Fault Cause,Repair Suggestion/Analysis
FITAP启用本地转发后大约30秒后又切换为 “Idle”状态,这是由于下发到FITAP的本地配置文件将上行以太网接口的PVID修改了，不再是原来的VLAN1，最终导致AP和AC不通，AC的状态机超时，并断开连接。因此需要修改本地转发文件，保证上行接口PVID为1。 •目前FITAP使用VLAN1获取地址并和AC进行连接，所以必须保证AP上使用VLAN1能够成功从网络中获取地址，也就是上行口必须支持VLAN1。 •如果FITAP上行交换机为AP分配地址不在VLAN1中，则FITAP上行接口的PVID必须配置为VLAN1。 •如果FITAP上行交换机为AP分配地址在VLAN1中，且要将FITAP上行接口PVID修改为其他的VLAN，则FITAP上行接口必须设置支持VLAN1，而且为tag方式，同时上行交换机也必须保证接口为VLAN1的tag方式。 •对于无线用户接入的VLAN，尽量在FITAP上行接口使用tag方式，否则属于PVID的无线用户报文将在上行交换机被接入到上行交换机接口的PVID的VLAN中。 4.3主、备AC切换，主AC无法回切 ,这是由于下发到FITAP的本地配置文件将上行以太网接口的PVID修改了，不再是原来的VLAN1，最终导致AP和AC不通，AC的状态机超时，并断开连接。因此需要修改本地转发文件，保证上行接口PVID为1。 •目前FITAP使用VLAN1获取地址并和AC进行连接，所以必须保证AP上使用VLAN1能够成功从网络中获取地址，也就是上行口必须支持VLAN1。 •如果FITAP上行交换机为AP分配地址不在VLAN1中，则FITAP上行接口的PVID必须配置为VLAN1。 •如果FITAP上行交换机为AP分配地址在VLAN1中，且要将FITAP上行接口PVID修改为其他的VLAN，则FITAP上行接口必须设置支持VLAN1，而且为tag方式，同时上行交换机也必须保证接口为VLAN1的tag方式。 •对于无线用户接入的VLAN，尽量在FITAP上行接口使用tag方式，否则属于PVID的无线用户报文将在上行交换机被接入到上行交换机接口的PVID的VLAN中。 4.3主、备AC切换，主AC无法回切 
FITAP无法成功注册到AC上，AC收不到任何该AP的报文，该AP无法动态获取IP地址,(1)FITAP配置静态IP地址可以和AC互通，并且注册到AC设备上； (2)在DHCPserver位置挂一台PC1，将AP替换成PC2，两台PC都配置静态IP地址（IP地址为DHCPserver要分配的网段地址）； (3)清除两台PC的ARP，此时PC1无法ping通PC2，但是PC2可以ping通PC1； (4)因此可以断定广播上行OK，但是下行不通； (5)通过逐个设备上镜像抓包，确定丢包位置，排查下行广播报文丢失情况。 5.2Client连接到信号较弱的AP，而未连接到信号较强且距离较近的AP ,(1)FITAP配置静态IP地址可以和AC互通，并且注册到AC设备上； (2)在DHCPserver位置挂一台PC1，将AP替换成PC2，两台PC都配置静态IP地址（IP地址为DHCPserver要分配的网段地址）； (3)清除两台PC的ARP，此时PC1无法ping通PC2，但是PC2可以ping通PC1； (4)因此可以断定广播上行OK，但是下行不通； (5)通过逐个设备上镜像抓包，确定丢包位置，排查下行广播报文丢失情况。 5.2Client连接到信号较弱的AP，而未连接到信号较强且距离较近的AP 
FIT模式下的CPE接入AC后，无法修改其通过自动AP方式生成的AP服务模板。 ,"系统固有实现，不支持在AC上修改自动AP方式下的AP服务模板。 3.故障处理步骤 (1)登录ACCLI，在系统视图下执行wlanauto-appersistent命令将自动AP固化为手工 AP。 (2)如果故障仍然未能排除，请联系技术支持人员。 2Web类故障处理问题 2.1通过Web登录时，提示“用户数超限！” 2.1.1故障描述 用户通过Web方式登录时提示“用户数超限”，在设备上通过命令displaywebusers检查登录的Web用户数可能只有一个，甚至没有Web用户在登录。 2.1.2故障处理步骤 出现这个问题是由于其他用户登录Web后，退出Web时直接关闭了浏览器，没有点击Web右上角的<退出登录>按钮，造成设备上的用户没有真正退出。 在设备上使用命令freewebusersall强制在线Web用户下线，然后再次登录Web，问题解决。 2.2设备升级以后，重新登录Web时失败，提示“功能函数错误” 2.2.1故障描述 设备升级以后，用户终端能够Ping通设备，也可以远程Telnet登录设备，但是重新通过Web进行登录时，Web界面上会弹出一个错误提示对话框，提示“功能函数执行错误”。 2.2.2故障处理步骤 这个问题是由于用户没有清除浏览器缓存所致。由于两个不同的软件版本的Web界面可能存在着差异，重新用Web登录以后，浏览器里面缓存的信息与新版本的Web信息不兼容，因此重新用 Web登录设备以前，请先将浏览器缓存清理一下。 3设备硬件类故障处理 3.1同一台PoE交换机下的部分AP自动重启 3.1.1故障描述 同一台PoE交换机连接的部分AP会自动重新启动（和AC的连接断开）。 3.1.2故障处理步骤 PoE交换机有各自的供电规格及预留空间，所以当对外供电总量超过可以供电量时，交换机会自动断开低优先级的接口，而造成下挂的AP设备重启。 可以通过交换机上的Log信息确认： #Apr611:26:44:3682000YXY-WLAN-04DRV_DEM/5/POEWARNING:-1-Powerbudgetexceeded #Apr611:26:44:4182000YXY-WLAN-04DRV_DEM/5/POEWARNING:-1-PoefunctionofEthernet1/0/6isdisabled. 第一个表示总的功率超过预算，无法再给新的端口供电，第二个表示断掉了一个接口的PoE供电。 解决方案是增加PoE交换机或者使用PoE模块对AP进行单独供电。 3.2AP使用电源适配器供电，系统控制平台无打印信息，同时电源指示灯未亮 3.2.1故障描述 AP只采用电源适配器一种供电方式供电时，系统控制平台无打印信息，同时电源指示灯未亮。 3.2.2故障处理步骤 (1)请检查是否采用系统要求的电源适配器规格，需要确保电源的输入电压在系统规格要求的范围。 (2)AP外观是否有明显被摔痕迹，防止AP内部的器件被摔坏而导致系统不能上电。 (3)AP是否进过水或者设备工作环境温度是否超出规格要求，如果室内型AP被用于室外，有雨 水进入AP或者关键芯片环境温度不满足要求，会导致系统出现工作异常状态，AP无法上电。 3.3AP上电后，串口没有打印信息 3.3.1故障描述 AP上电后，发现用户终端的串口接到AP设备的RJ45口，但是没有打印信息。 3.3.2故障处理步骤 (1)请确认用户终端的串口是否插到了设备的Console口，如果插到AP的网口的话就不会有打印信息。 (2)检查用户终端的串口设置，特别是波特率需要设置为9600bps，校验（Parity）设置为none即不需要校验位，数据位（Databits）设置为8。 3.4网口无法连接 3.4.1故障描述 系统上电启动后，发现AP与其他设备对接时网口无法建立连接。 3.4.2故障处理步骤 (1)请确认网线是否插错，如果插到Console口就不会建立连接； (2)请确认网线长度是否超过了规格要求（如100米），如果网线长度超过了规格要求也可能会出现不能建立连接现象； (3)请检查一下网线的线序是否有误，如果既不是直连也不是交叉网线的线序也不能建立连接。 3.5采用PoE-MH通过网口给AP供电时，发现AP不能上电 3.5.1故障描述 采用电源适配器和PoE-MH通过网口给AP供电时，发现AP不能上电。 3.5.2故障处理步骤 确保给AP供电的网线接到PoE-MH的正确位置。PoE-MH除了供电源适配器插入的电源口外，还有两个RJ-45口，其中一个RJ-45（#1）和电源在一侧，另外一个RJ-45口（#2）在另外一侧。给设备供电的网线应该插在RJ-45#2，如果插到了RJ-45#1的话是无法给AP供电的。 3.6光模块插入设备的光口时反插导致设备光口工作异常 3.6.1故障描述 当光模块插入设备时，如果插反，会将光口的I2C总线的SCL时钟信号拉到GND，这样的话有的CPU的I2C就会挂死，导致后续光口的I2C工作异常，且CPU会一直在访问I2C的现象，影响CPU处理其他业务。设备的光口工作异常，不能link，同时串口打印也可能出现异常。 3.6.2故障处理步骤 重启设备，同时确保光模块的Tx和Rx没有插反。 3.7AP设备信号弱 3.7.1故障描述 AP设备信号弱。 3.7.2故障处理步骤 (1)根据设备的型号选择配置内置或外置天线。 (2)正确安装外置天线，并检查2.4GHz和5GHz天线是否安装错位置（比如把2.4GHz天线安装在了5GHz天馈口）。 (3)用max-power命令将AP的射频传输功率设置成大。 4设备软件配置类故障处理 4.1交换机通过OAP方式登录无线控制器业务板失败 4.1.1故障描述 登录到交换机上以后，试图通过OAP方式登录到无线控制器业务板上进行查询或者配置，却发现无法登录成功，提示“TheOAPconnectionisbusy,pleasetryagainlater!”。 <Sysname>oapconnectslot1 TheOAPconnectionisbusy,pleasetryagainlater! 4.1.2故障处理步骤 (1)确认当前是否有其他人在使用OAP连接。 (2)登录到无线控制器业务板，通过displayusers命令收集当前访问无线控制器业务板的用户信息： <Sysname>displayusers IdxLineIdleTimePidType 0CON000:00:00Aug1110:06:511249 +1VTY000:00:00Aug1110:09:241273TEL Followingaremoredetails. VTY0: Username:adminLocation:180.10.1.1 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. 通过该命令可以看到当前登录到无线控制器业务板的用户（此信息说明当前有两个用户，其中“+”开头的用户为自己）可以多次执行上面的命令，如果Idle时间始终为00:00:00，则很大可能是该用户使用了OAP链接。 上面给出了Console用户的显示信息，如果通过Telnet登录发现con0在线，而且Idle时间始终为00:00:00，则很有可能说明Console用户已经离开，但是使用了OAP连接，所以需要将该用户踢掉，以恢复OAP连接。 (3)在无线控制器业务板的用户视图下执行freeuser-interface命令踢掉怀疑使用OAP连接的用户，其中下面的参数VTY和0分别为displayusers中的Line信息： <Sysname>freeuser-interfacevty0 Areyousuretofreeuser-interfacevty0?[Y/N]:y [OK] (4)如果踢掉用户成功，再次进行OAP登录，应该可以连接成功，否则可以踢掉所有的用户进行测试。 (5)如果踢掉所有的用户也没有效果，只有重新启动设备或者联系厂商的维护人员确认。 4.2使用本地转发时FITAP注册成功后一会儿连接断开 4.2.1故障描述 (1)FITAP启用本地转发后，在AC上可以看到AP状态为“Run”，但是大约30秒后又切换为 “Idle”状态； (2)在设备上可以看到如下打印信息： %Aug1110:25:04:2252018H3CCWS/4/CWS_AP_DOWN:CAPWAPtunneltoAP2610iwentdown.Reason:Failedtoretransmitmessage. %Aug1110:25:04:2732018H3CAPMGR/6/APMGR_AP_OFFLINE:AP2610iwentoffline.StatechangedtoIdle. 4.2.2故障处理步骤 这是由于下发到FITAP的本地配置文件将上行以太网接口的PVID修改了，不再是原来的VLAN1，终导致AP和AC不通，AC的状态机超时，并断开连接。因此需要修改本地转发文件，保证上行接口PVID为1。 •目前的FITAP使用VLAN1获取地址并和AC进行注册，所以必须保证AP上使用VLAN1能够成功从网络中获取地址，也就是上行口必须支持VLAN1。 •如果FITAP上行交换机为AP分配地址不在VLAN1中，则FITAP上行接口的PVID必须配置为VLAN1。 •如果FITAP上行交换机为AP分配地址在VLAN1中，且要将FITAP上行接口PVID修改为其他的VLAN，则FITAP上行接口必须设置支持VLAN1，而且为tag方式，同时上行交换机也必须保证接口为VLAN1的tag方式。 •对于无线用户接入的VLAN，尽量在FITAP上行接口使用tag方式，否则属于PVID的无线用户报文将在上行交换机被接入到上行交换机接口的PVID的VLAN中。 4.3主、备AC切换，主AC无法回切 4.3.1故障描述 主AC故障恢复后，AP和Client仍然连在备AC上，不能自动回切。 4.3.2故障处理步骤 使用priority命令将主AC上配置的AP优先级设为7，在AC热备功能中，必须将优先级设置为7才支持回切。 <Master_AC>system-view [Master_AC]wlanapap1modelWA4320i-ACN [Master_AC-wlan-ap-ap1]priority7 4.4客户端无法弹出Portal认证页面 4.4.1故障描述 无线客户端上线后，无法触发Portal认证或者客户端无法弹出Portal认证页面。 4.4.2故障处理步骤 (1)首先检查客户端的设置。 •检查客户端是否分配到正确的VLANIP地址，检查所在VLAN是否是需要进行Portal认证的 VLAN，如果有误请检查DHCP服务器相关配置是否正确。 •如果客户端分配到的地址是正确的，检查客户端的网关IP地址是否是AC上启用Portal认证的接口IP地址。 •检查是否还有别的网卡在使用，导致路由有问题，可在DOS下修改客户端的路由配置。 (2)检查AC上Portal相关配置是否正确。 •无线服务模板下Portal配置：选择正确的PortalWeb服务器和认证方式； •全局下Portal配置：配置正确的Portal认证服务器IP地址和PortalWeb服务器URL，配置正确的免认证规则，放行免认证流量。 (3)确保以上无误后，仍无法弹出页面，进一步检查Portal认证服务器的配置。 •检查Portal认证服务器上配置的设备IP地址、密钥是否和AC上配置相同； •检查Portal认证服务器上配置IP地址组范围，必须是Portal认证VLAN的IP地址。 4.5Portal认证失败 4.5.1故障描述 无线客户端可以弹出Portal认证页面，但是输入用户名和密码，提示认证失败。 4.5.2故障处理步骤 (1)首先确保用户名和密码正确。 (2)如果用户名和密码无误，检查AC上的RADIUS和认证域相关配置：a.检查AC是否能和RADIUS服务器互相访问； b.检查AC配置的RADIUS认证、授权、计费服务器的IP地址、密钥是否正确； c.检查认证域是否配置正确； d.检查nas-ip地址是否和RADIUS服务器配置的接入设备IP地址相同。 (3)确保AC上的配置无误后，进一步检查RADIUS服务器配置： a.检查RADIUS服务器上配置的接入设备是否添加了该AC的IP地址以及密钥是否正确；b.检查RADIUS服务器上配置的接入服务配置中认证类型是否正确，有无下发不存在的 UserProfile、ACL等（AC上必须配置相应的UserProfile和ACL）； c.Portal认证不支持下发规则中匹配了源的ACL以及rule中带log参数的ACL。 4.6AP多只能与两台AP建立Mesh连接，无法与第三台AP建立Mesh连接 4.6.1故障描述 AP多只能与两台AP建立Mesh连接，无法与第三台AP建立Mesh连接。 4.6.2故障处理步骤 AP默认多只能与其他两台AP建立Mesh连接，如果想与多台AP建立Mesh连接，需要修改 Mesh策略。 •如果AP的射频口下配置了Mesh策略： a.首先使用undomesh-policy命令将Mesh策略与绑定的射频口解绑定； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立的大链路数； c.后使用mesh-policy命令将Mesh策略重新绑定到射频。 •如果AP的射频口下没有配置Mesh策略： a.首先使用wlanmesh-policy命令用创建一个新的Mesh策略； b.然后在Mesh策略视图中使用link-maximum-number命令根据实际情况配置允许建立的大链路数； c.后使用mesh-policy命令将Mesh策略绑定到射频；d.使用radioenable命令开启射频。 4.7两台或更多台AP建立Mesh连接后，Mesh连接经常up/down 4.7.1故障描述 使用两台或多台AP建立Mesh连接，虽然Mesh可以建立成功，但经常up/down。 4.7.2故障处理步骤 •两台AP建立Mesh连接后，可能一台AP启动了STP，另外一个没有启动STP协议，引起 Mesh不稳定，所以当只有两台AP建立Mesh连接时，可以不在AP上启动STP协议，或者在两台AP上都启动STP协议。 •多台AP建立Mesh连接后，可能没有启动STP，造成环路，此时需要在每台AP上都启动 STP协议，避免造成环路。 4.8两台FITAP无法建立Mesh连接或经过MAP的ping操作失败 4.8.1故障描述 与AC相连的MPPCAPWAP连接正常，MeshProfile也绑定到射频，但MAP却无法与其建立正常Mesh链路，或经过MAP的ping操作失败。 4.8.2故障处理步骤 (1)MPP上需要使用portal-serviceenable命令配置MPP停止发送邻居探测请求。 (2)MPP和MAP所在的信道应该相同。 4.9快速漫游失败 4.9.1故障描述 Client不能在AC间快速漫游，Client在切换AP时都是重新走认证上线流程，没有走快速漫游流程。 4.9.2故障处理步骤 快速漫游需要几个条件，必须满足这些条件才能快速漫游： •网卡要支持快速漫游。如果一个Client可以协商采用802.1X（RSN）认证方式，并且在发给 FA的reasso消息中携带了PMKID，则该终端具有AC间快速漫游能力； •AC间建立漫游组，且漫游组处于run状态； •服务模板是CCMP+WPA2+dot1x方式。 4.10Client不停的在几个AP间漫游或Client漫游困难 4.10.1故障描述 (1)Client不停的在几个AP间漫游； (2)Client漫游困难，Client原来关联的AP信号已经很差，但Client仍然不会主动漫游到信号较好的AP上。 4.10.2故障处理步骤 •如果Client不停的在几个AP间漫游，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，且仅部分网卡支持，请以网卡的实际情况为准）调低。 •如果Client漫游困难，需要将Client的漫游主动性（漫游趋势或漫游灵敏度，且仅部分网卡支持，请以网卡的实际情况为准）调高。 4.11802.1X远程服务器认证失败问题 4.11.1故障描述 端口安全配置802.1X采用RADIUS认证，用户关联不成功。 4.11.2故障处理步骤 (1)确认设备和RADIUS服务器之间可以互通。 (2)检查无线服务模板下配置的WLAN用户接入认证模式是否为dot1x。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)如果采用CHAP或PAP认证，需要检查AC上配置的是否携带域名与服务器上的配置是否保持一致。 (5)通过使用debuggingradiuspacket命令，查看RADIUS服务器和AC报文交互情况。 (6)检查AC上配置的port-mode和服务器上配置证书认证类型是否一致。 (7)查看服务器端配置是否和设备匹配。 (8)查看客户端的配置是否正确。 4.12802.1X和ACS配合认证时，Client关联成功并下线后，再关联时无法关联成功 4.12.1故障描述 802.1X和ACS配合认证时，Client关联到无线服务，下线后再关联，无法关联成功。 4.12.2故障处理步骤 在ACS的“SystemConfiguration->GlobalAuthenticationSetup“中将“EnableFastReconnect”后面的钩去除。 图4-1关闭快速重关联功能 4.13802.1X认证配置都正确，客户端上线时一直处于验证身份阶段 4.13.1故障描述 802.1X认证过程中，设备端的配置都是正确的，输入用户名和密码也是正确的，但客户端网卡显示一直处于验证身份阶段。 4.13.2故障处理步骤 在无线服务模板视图下配置了dot1xhandshakeenable命令，开启了802.1X在线用户握手功能，就会出现这样的情况，需要使用undodot1xhandshakeenable命令关闭802.1X在线用户握手功能。 4.14802.1X本地认证失败问题 4.14.1故障描述 端口安全配置802.1X采用本地认证，用户关联不成功。 4.14.2故障处理步骤 (1)使用debuggingport-security命令检查是否因为没有配置全局端口安全导致没有进行端口安全认证功能。 (2)确认是否是设备上配置的port-mode不正确，设备上没有PKI证书或者PKI证书过期。 (3)查看客户端的配置是否正确。 4.15使用RADIUS服务器进行MAC地址认证和PSK认证时，用户上不了线 4.15.1故障描述 端口安全配置MAC地址认证和PSK认证并采用RADIUS服务器，正确输入PSK密钥后用户关联不成功。 4.15.2故障处理描述 (1)确认设备和RADIUS服务器之间互通。 (2)检查是否配置了全局开启端口安全。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)用户名是否携带域名要和服务器上配置的用户名一致。 (5)查看RADIUS服务器端配置是否和设备匹配。 4.16采用本地MAC地址认证时，用户上不了线 4.16.1故障描述 端口安全采用MAC地址和PSK的认证方式，并采用本地认证，正确输入PSK密钥后，Client无法关联上线。 4.16.2故障处理步骤 (1)需要确认配置的local-user用户名是否和user-name-format配置的一致。如果不一致，需要使用mac-authenticationuser-name-format命令修改MAC地址认证用户的帐号格式。 (2)如果MAC地址中有字母的，在配置本地用户的时候有可能写成大写。此时需要使用 mac-authenticationuser-name-format命令将用户的MAC地址大写字母改为小写字母，同时将密码改为和用户名一致，如下所示。 [Sysname-luser-00-14-6c-72-29-5c]displaythis #local-user00-14-6c-72-29-5cpasswordsimple00-14-6c-72-29-5cauthorization-attributelevel3service-typelan-access # 4.17未开启自动AP配置功能造成AP无法注册 4.17.1故障描述 在AC上打开调试信息，AC上能够收到AP的报文，但无法注册。 4.17.2故障处理步骤 缺省情况下，自动AP功能处于关闭状态，这种情况的调试信息显示如下： *Aug1115:26:16:7662018H3CCWS/7/RCV_PKT:ReceiveddiscoveryrequestfromAP:IPaddress=180.10.1.67,MACaddress=c4ca-d98e-c350,serialID=219801A0CLC11B000010. *Aug1115:26:16:7672018H3CCWS/7/ERROR:FailedtoprocessdiscoveryrequestfromAPwithserialID219801A0CLC11B000010:在设备上使用wlanauto-apenable命令开启自动AP功能。5非设备故障类故障处理 5.1FITAP无法获取IP地址，但是用客户端替换FITAP后能够获取IP地址 5.1.1故障描述 (1)FITAP无法成功注册到AC上，AC收不到任何该AP的报文，该AP无法动态获取IP地址； (2)使用客户端替换FITAP后，客户端可以成功获取IP地址并使用网络资源； (3)通过抓包和调试可以发现AP已经正常发送了DHCPdiscover报文申请IP地址，然而却没有收到DHCPoffer报文，而通过DHCPserver信息发现已经收到了Discover报文并且回应offer报文。 5.1.2故障处理步骤 (1)FITAP配置静态IP地址可以和AC互通，并且注册到AC设备上； (2)在DHCPserver位置挂一台PC1，将AP替换成PC2，两台PC都配置静态IP地址（IP地址为DHCPserver要分配的网段地址）； (3)清除两台PC的ARP，此时PC1无法ping通PC2，但是PC2可以ping通PC1； (4)因此可以断定广播上行OK，但是下行不通； (5)通过逐个设备上镜像抓包，确定丢包位置，排查下行广播报文丢失情况。 5.2Client连接到信号较弱的AP，而未连接到信号较强且距离较近的AP 5.2.1故障描述 Client连接到了一个信号相对较弱的AP上，而没有连接到相对信号较强且距离较近的AP上。 5.2.2故障处理步骤 (1)请确认客户端分布是否合理，不要造成大量客户端聚集在某个AP附近，否则即使负载均衡到其他的AP上，也会因为信号强度相差太大而触发频繁的漫游。 (2)如果发生Client无法连接的情况，要关闭负载均衡后再进行观察。 (3)基于流量的负载均衡不宜控制，不建议使用，尤其是有些加密、安全配置限制了AP的接入数 量的情况下（例如TKIP加密使得AP只能接入28个用户），建议使用基于会话的负载均衡。5.3同时支持网口PSE供电和电源适配器供电的AP设备，在电源适配器供电状态下，断开电源适配器时系统会重启 5.3.1故障描述 AP同时具备网口PSE供电和电源适配器供电的情况下，如果电源适配器处于供电工作状态，此时断开电源适配器时系统会重启，同时系统会切换到由网口PSE供电。 5.3.2故障处理步骤 AP存在网口PSE供电和电源适配器供电两种供电方式，如果AP处于电源适配器供电工作状态，而网口PoE在此次上电期间没有供过电，当断开电源适配器供电时，网口PoE会依次进行检测>分级>供电，在网口PoE重新供电过程中，设备经过了断电重新上电的过程，所以系统会重启。 可以通过系统的电源指示灯确认，因为电源指示灯会灭，然后再常亮。该问题属于系统网口PoE供电固有的特性造成，不算问题，无需解决。 5.4WMM不支持分片 5.4.1故障描述 设置AP分片门限为256，Client关联到AP上后，从AP上ping客户端，指定选项–s500，抓包确认，发现ping包并未分片。 5.4.2故障处理步骤 WMM协议规定，开启WMM功能后不支持报文分片，所以需要使用wmmdisable命令将WMM功能关掉后再测试报文分片功能。 5.5无线网卡提示Windows无法配置无线连接，而WirelessZeroConfigure服务已经启动 5.5.1故障描述 打开客户端上的无线网卡后，刷新无线网络列表，提示Windows无法配置无线连接，而 WirelessZeroConfigure服务已经启动。 5.5.2故障处理步骤 客户端上安装了该无线网卡自己携带的或者其它无线网卡客户端管理软件（例如H3CiNode无线客户端软件）。此时需要卸载或者退出该无线网卡客户端管理软件和其它相关客户端管理软件（包括 H3CiNode客户端等），然后开启WirelessZeroConfigure服务。 5.6国家码为CN时，11n网卡在设置无线模式为仅11an模式后，无法关联到11an的网络 5.6.1故障描述 国家码设置为CN时，设备所支持的11an信道有149，153，157，161，165五个信道。而国内销售的一些宣称支持11a/b/g/n的网卡（比如intel）在11an模式下所支持的信道是36，40，44，48等非CN国家码下的信道，即这些网卡没有遵循当地的标准，导致无法扫描到11an的网络，而其它网卡能扫描到网络。 5.6.2故障处理步骤 (1)将国家码设置为HK或者US等，以支持36等信道。设置接入点的工作信道为网卡所支持的信道。 (2)更换为符合当地标准无线网卡。 5.7客户端可以ping通AC，也能telnet到AC，但是无法通过Web登录成功 5.7.1故障描述 客户端无法通过Web登录AC，提示无法显示网页，但是从客户端可以ping通AC，也可以telnet登录到AC。 5.7.2故障处理步骤 (1)关闭Windows防火墙，Windows系统自带的防火墙开启后偶尔会造成此现象。 (2)Telnet登录到AC，检查AC配置，将http功能开启。 5.8无法修改自动AP方式生成的AP服务模板 5.8.1故障描述 无法修改自动AP方式生成的AP服务模板。 5.8.2故障处理步骤 系统固有实现，不支持修改自动AP方式下的AP服务模板。用户需要通过wlanauto-appersistent命令将自动AP固化为手工AP后才能修改AP服务模板。 6设备常见启动问题 6.1启动过程中串口无输出或打印乱码 6.1.1故障描述 启动过程中串口无输出或打印乱码。 6.1.2故障处理步骤 (1)设备的默认串口速率是9600，但可能部分设备设置的串口速率不是9600，需要修改设备串口速率与登录软件的串口速率一致即可。 (2)部分设备会发生内存条接口接触不良或接口磨损情况，这个时候可以尝试拔出来擦拭接口再插入（该方法只适用于允许插拔内存条的设备），确保插入没有问题；如果内存条本身损坏了，开始启动（内存低端损坏）或者启动过程中（内存高端损坏）会打印乱码，可以在进入Bootware菜单后，按Ctrl+U进入如下菜单，测试内存是否完好（如下的菜单选择<1>即可）。如果内存损坏了，只能更换内存了。 ===========================<BASIC-ASSISTANTMENU>=========================== |<1>RAMTest| |<0>ExitToMainMenu| ============================================================================ Enteryourchoice(0-1):1 Warning:TestMemorywilltakealongtime?[Y/N]Y..................... 526385152bytesmemorytestok.Memorytestedsuccess. (3)Bootware菜单的基本段被破坏的情况，请参见6.2.2中的Bootware菜单的加载问题。 6.2系统启动不了 6.2.1故障描述 上电后，设备无法启动。 6.2.2故障处理步骤 查看Bootware菜单的加载信息，如果没有输出Systemimageisstarting...消息就停住了，则是Bootware菜单加载问题，如果已经输出了这个消息，则是版本文件有问题。 •针对Bootware被破坏的情况：如果基本段被破坏了，应该是什么都不输出或者输一行乱码，这个时候没有其它办法，返厂烧片才能解决。如果是扩展段破坏了，找到产品对应的Bootware文件，重新升级Bootware即可。 •针对启动文件信息破坏的情况：表现为扩展段找不到启动文件，可以进入扩展段重新设置启动文件，或者下载新的启动文件。 •针对文件系统损坏的情况：也表现为找不到启动文件，并且设置启动文件和下载文件不成功。 那么可以格式化文件系统，再下载启动文件。 •版本文件问题不常出现，如果开启了看门狗，表现为异常重启或直接地反复重启；如果没有开启看门狗，表现为系统阻塞。在排除下载了错误的版本原因后，只能联系研发的支持解决；更推荐的做法，就是更换其它的正常启动版本。 2硬件类故障处理 2.1.1CPE上电后，串口没有打印信息 ",Suggestion not provided
gRPCDial-out模式向采集器上送的订阅报文中，某些数据源的采样周期与用户配置的采样周期不一致。 ,"本类故障的常见原因主要包括： •部分采样路径无法达到配置的采样周期精度，以自身的最小采样周期进行采样。 •设备CPU繁忙。 •数据源对应的采样路径为ifmgr/interfaces、路由类或统计类路径，由于采样数据量庞大，需要使用多个采样周期。 例如route/ipv4routes，当路由表项达到100k时，采样数据量大，设备无法在一个较小的采样周期完成采集工作。 3.故障分析 本类故障的诊断流程如图179所示。 图179gRPC采样周期不准确的故障诊断流程图 4.处理步骤 (1)通过Probe命令displaysysteminternaltelemetry查看采样路径是否有最小采样周期。 例如，以下显示结果中，采样路径route/ipv4routes配置的采样周期（Samplinginterval，100毫秒）小于生效的采样周期（Effectivesamplinginterval，5秒），说明该采样路径存在最小采样周期（5秒），此时最小采样周期生效。 <Sysname>system-view [Sysname]probe [Sysname-probe]displaysysteminternaltelemetry Current-time:2021-12-25T15:51:45.530 --------------------Subscriptions---------------------- Subscriptionmode:non-gNMIDSCPvalue:0 Sourceaddressorinterface:Notconfigured Telemetrydatamodel:2-layerEncoding:JSON Protocol:GRPC Sensorgroup:s Samplinginterval:100milliseconds SamplingtypeEffectivesamplingintervalSensorpath Periodic5secondsroute/ipv4routesDestinationgroup:d... [Sysname-probe]quit (2)确认设备是否处于CPU繁忙状态。 通过displaycpu-usage命令查看CPU利用率。 [Sysname]displaycpu-usage Slot0CPU0CPUusage: 70%inlast5seconds 62%inlast1minute60%inlast5minutes... 如果主设备/全局主用主控板的CPU利用率超过60%，将会影响Telemetry功能的采样效率，导致设备不能在配置的采样周期内完成数据采样。用户可以选择：等待CPU利用率降到60%以下。 减少配置的采样路径数量，以降低CPU利用率。 (3)确认是否订阅了ifmgr/interfaces、路由类或统计类采样路径。进入Telemetry视图，通过displaythis命令查看配置。 [Sysname]telemetry [Sysname-telemetry]displaythis #telemetrysensor-groups sensorpathroute/ipv4routesdestination-groupd ipv4-address192.168.79.155port50051subscriptions sensor-groupssample-interval5destination-groupd # •统计类采样路径通常会包含statistics节点，例如ifmgr/statistics。 •路由类采样路径通常会包含route节点，例如route/ipv4routes。 当存在ifmgr/interfaces、路由类或统计类采样路径时，在网管侧查看设备上送给采集器的相邻的两个订阅报文之间的时间差是否为命令行配置的采样周期的整数倍。假设，设备上为采样路径route/ipv4routes配置的采样周期为5秒，上送给采集器的两个订阅报文之间的时间差为两个Timestamp（单位为毫秒）字段的差=(1641482427751–1641482417751)/1000=10秒，是5秒的整数倍。这就说明，该采样路径的采集数据量过大，需要使用多个配置的采样周期才能上送数据。 Producer-Name:H3C... Sensor-Path:route/ipv4routes Json-Data:{""Notification"":{""Timestamp"":""1641482417751"",... Producer-Name:H3C... Sensor-Path:route/ipv4routes Json-Data:{""Notification"":{""Timestamp"":""1641482427751"",... (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 ",Suggestion not provided
IRF分裂后，BFDMAD功能未生效，导致网络中存在配置相同的两台设备。 ,•未配置BFDMAD检测链路。 •用于BFDMAD检测的端口和VLAN配置不正确。 •用于BFDMAD检测的IP地址不在同一网段。 •IRF链路down延迟上报时间配置过长。 3.故障分析 本类故障的诊断流程如图42所示。 图42故障诊断流程图 4.处理步骤 (1)检查BFDMAD组网是否正确。 使用BFDMAD功能时，要求所有成员设备之间必须有一条BFDMAD检测链路，可以通过中间设备，也可以在成员设备之间使用全连接的组网。 (2)检查BFDMAD所使用的物理端口状态。 您可以通过displayinterface命令查看BFDMAD所使用的物理端口的状态。 a.如果物理端口状态为“DOWN(Administratively)”，则表示该端口已经通过shutdown命令关闭，您需要执行undoshutdown命令将其开启。 b.如果物理端口的状态为“DOWN”，您需要检查物理端口的连接是否正常。 (3)检查BFDMAD所使用的VLAN和端口配置。 用于BFDMAD检测的物理端口上不能开启生成树协议，也不能开启其它任何功能。一个IRF内所有BFDMAD链路上的物理端口必须属于同一个VLAN，该VLAN为BFDMAD专用，如果使用中间设备的话，中间设备与成员设备相连的端口也必须加入该VLAN。建议用于BFD MAD检测的VLAN中只包含BFDMAD链路上的端口，不要将其它端口加入该VLAN。 (4)检查BFDMAD所使用的VLAN接口。 使用displaymadverbose命令查看用于BFDMAD检测的VLAN接口，该接口不能为 VLAN1接口，并且该接口仅用于BFDMAD，即在该接口上不能配置其它任何二层或三层协议。 (5)检查BFDMADIP地址的配置。 使用displaymadverbose命令查看用于BFDMAD检测的IP地址，各成员设备的MADIP地址必须属于同一网段，同时不能为设备上已经存在的IP地址。通过displayinteface查看用于BFDMAD的VLAN接口配置，该接口上不能配置其它IP地址（包括使用ipaddress命令配置的普通IP地址、VRRP虚拟IP地址等）。 (6)当组网中存在多个IRF时，检查各IRF的BFDMADVLAN。 如果网络中存在多个IRF，在配置BFDMAD时，请为每个IRF配置不同的VLAN用于BFD MAD检测。 (7)检查IRF链路down延迟上报时间是否配置过长。 在IRF环境中使用RRPP、BFD或GR功能时，建议将IRF链路down延迟上报时间配置为0。 (8)检查成员设备的日志信息。 请使用displaytrapbuffer命令或者通过查看日志主机存储的信息，查找在IRF分裂的时间点附近是否存在BFDMAD所使用物理端口down的日志。通过该日志判断端口故障的原因，并排除该故障。 (9)收集信息并寻求技术支持。 如果完成上述检查后故障仍无法排除，请收集设备的运行信息，并联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志无 6.1.4IRF分裂后LACPMAD无法生效 ,Suggestion not provided
IRF分裂后，LACPMAD功能未生效，导致网络中存在配置相同的两台设备。 ,•中间设备不支持扩展LACP选项。 •用于LACPMAD检测的聚合组不是动态聚合组。 •端口或聚合组状态异常。 3.故障分析 本类故障的诊断流程如图43所示。 图43故障诊断流程图 4.处理步骤 (1)检查LACPMAD组网是否正确。 使用LACPMAD功能时，要求必须使用一台中间设备，所有成员设备与中间设备之间必须均存在物理连接。 (2)检查聚合组和物理端口的状态。 您可以通过displayinterface命令查看LACPMAD所使用的聚合组和物理端口的状态。a.如果物理端口状态为“DOWN(Administratively)”，则表示该聚合组或物理端口已经通过shutdown命令关闭，您需要执行undoshutdown命令将其开启。 b.如果聚合端口的状态为“DOWN”，则表示该聚合组内所有物理端口连接均有问题；如果物理端口的状态为“DOWN”，则表示该端口的物理连接存在问题。请检查物理连接并修复故障。 (3)检查中间设备是否支持扩展LACP选项。 由于LACPMAD使用扩展LACP选项实现，因此中间设备必须为能够识别并透传带有扩展 LACP选项的LACP报文的H3C设备。 (4)检查聚合组的聚合方式。 LACPMAD功能通过LACP报文实现，因此仅有动态聚合组能够用于LACPMAD检测。您可以在聚合接口视图下使用link-aggregationmodedynamic命令将聚合组的工作模式配置为动态聚合。 (5)当组网中存在多个IRF时，检查各IRF的域编号。 扩展LACP选项中会包含IRF的域编号，当组网中存在多个IRF时，如果各IRF的域编号相同，则LACPMAD检测功能将不能正常检测到IRF分裂。请确保组网中的每个IRF使用不同的域编号，您可以通过irfdomain命令配置IRF的域编号。 (6)检查成员设备的日志信息。 请使用displaytrapbuffer命令或者通过查看日志主机存储的信息，查找在IRF分裂的时间点附近是否存在LACPMAD所使用物理端口或聚合组down的日志。通过该日志判断端口故障的原因，并排除该故障。 (7)收集信息并寻求技术支持。 如果完成上述检查后故障仍无法排除，请收集设备的运行信息，并联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志无 6.2MDC故障处理 6.2.1Location业务板失败故障 ,Suggestion not provided
IS-IS路由反复增删。 ,本类故障的常见原因主要包括： •IS-IS邻居震荡。 •MPLSLSP隧道震荡。 •两台设备的IS-IS引入了相同的外部路由，并且外部路由的优先级比IS-IS协议的优先级低。 •两台设备配置的SystemID相同。 3.故障分析 本类故障的诊断流程如图73所示。 图73IS-IS路由震荡的故障诊断流程图 4.处理步骤 (1)检查路由震荡的情况。 执行displayiprouting-tableip-addressverbose命令，查看路由震荡的具体情 况，具体步骤如下： 如果路由震荡的前后，“TunnelID”字段发生了变化，请检查MPLSLSP隧道是否存在震 执行(荡。)displaymplslspverbose命令，通过“LastChgTime”字段查看LDP的LSP最近一次状态变化的时间。如果最近一次变化的时间距离执行displaymplslspverbose命令的时间较近，说明MPLSLSP隧道存在震荡）。 对于这种情况，请参考LDPLSP震荡的定位思路或TETunnel由Up突然变Down的定位思路，排查LSP震荡问题。 如果路由的“Cost”或者“Interface”字段发生变化，请检查该路由路径上的IS-IS邻居是否在震荡。 如果路由在路由表中时有时无（Age字段在震荡），执行displayisislsdbverbose命令，找到携带该路由的LSP，并记录此LSP报文的LSPID。然后，执行displayisislsdbverboselsp-id命令查看这条LSP的更新情况。 −如果LSP中一直携带指定的路由，请检查该路由路径上是否存在IS-IS邻居震荡。 −如果LSP的“SeqNum”字段的取值在不停的增加，并且LSP更新前后的内容差异很大，请检查网络中是否有两台设备配置了相同的SystemID。 −如果LSP的“SeqNum”字段的取值在不停的增加，并且LSP更新前后，指定的路由时有时无，请在产生该LSP的设备上执行步骤(2)。 如果路由的“Protocol”字段发生变化，请执行步骤(2)。 (2)检查IS-IS引入外部路由的配置。 如果指定的路由是作为外部路由引入到IS-IS的，在引入该路由的设备上，执行displayiprouting-tableip-addressverbose命令，查看路由震荡的具体情况，具体步骤如下： 如果路由表中处于“Active”状态的路由是IS-IS路由，而不是IS-IS引入的外部路由，说明网络中其他IS-IS设备发布了相同的路由。请根据网络规划修改路由协议的优先级，或者，在引入外部路由的IS-IS设备上配置路由过滤策略，控制下发到IP路由表的路由。 对于其它情况，请执行步骤(3)。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.3OSPFv3故障处理 10.3.1OSPFv3邻居Down ,Suggestion not provided
LDP会话无法Up。 ,"本类故障的常见原因主要包括：•建立会话的接口处于Down状态 •LSRID配置错误 •不存在LDP会话的相关配置 •传输地址配置错误 •LDPHello-hold定时器超时 •LDPKeepalive-hold定时器超时 •安全认证配置错误 3.故障分析 本类故障的诊断流程如图90所示。 图90LDP会话Down的故障诊断流程图 4.处理步骤 (1)检查建立LDP会话的接口是否处于Up状态。 执行displayinterface命令查看接口是否处于UP状态： 如果没有UP，则排除接口物理链路故障，使接口处于UP状态。 如果接口处于UP状态，则执行步骤(2)。 (2)检查LSRID配置是否正确。 LSRID包括LocalLSRID、LDPLSRID和MPLSLSRID。LSRID优先级从高到底依次为LocalLSRID、LDPLSRID、MPLSLSRID。设备上至少配置其中的一种LSRID，且该LSR 执行displaymp(ID必须路由可达。)lsldppeerverbose命令检查是否配置了LSRID： <Sysname>displaymplsldppeerverbose VPNinstance:publicinstance PeerLDPID:100.100.100.20:0 LocalLDPID:100.100.100.17:0 TCPConnection:100.100.100.20:47515->100.100.100.17:646 … 如果执行displaymplsldppeerverbose命令时无显示，则通过以下方法配置LSRID： 在系统视图下配置MPLSLSRID。请在系统视图下执行mplslsr-id命令。 在LDP视图下配置LDPLSRID。请在LDP视图下执行lsr-id命令。 如果是直连会话，在接口视图下配置LocalLSRID。请在接口视图下执行mplsldplocal-lsr-id命令。 如果是远程会话，在LDP对等体视图下配置LocalLSRID。 请在LDP对等体下执行mplsldplocal-lsr-idinterface命令。 如果至少配置了一种LSRID，则执行步骤(3)。 (3)检查是否存在LDP会话的相关配置。如果是直连会话，则在接口视图下执行displaythis命令，查看是否存在LDP会话的相关配置。 a.如果配置信息中没有包含mplsenable命令、mplsldpenable命令、mplsldpipv6enable命令或mplsldptransport-address命令，则部署对应的配置。 b.如果存在LDP会话的相关配置，则执行步骤(4)。如果是LDP远程会话，则在LDP视图下执行displaythis命令，查看是否存在LDP会话的相关配置。 c.如果配置信息中没有包含targeted-peer或mplsldptransport-address命令，则部署对应的配置。 d.如果存在LDP会话的相关配置，则执行步骤(4)。(4)检查传输地址配置是否正确。 如果是LDPIPv4会话，请执行displaymplsldpdiscoveryverbose命令检查传输地址配置是否正确： <Sysname>displaymplsldpdiscoveryverboseVPNinstance:publicinstance LinkHellos: InterfaceGigabitEthernet1/0/2 LocalLDPID:100.100.100.17:0 HelloInterval:5000msHelloSent/Rcvd:83/160 TransportAddress:100.100.100.17 PeerLDPID:100.100.100.18:0 SourceAddress:202.118.224.18TransportAddress:100.100.100.18 HelloHoldTime:15sec(Local:15sec,Peer:15sec) PeerLDPID:100.100.100.20:0 SourceAddress:202.118.224.20TransportAddress:100.100.100.20 HelloHoldTime:15sec(Local:15sec,Peer:15sec) TargetedHellos: 100.100.100.17->100.100.100.18(Active,Passive) LocalLDPID:100.100.100.17:0 HelloInterval:15000msHelloSent/Rcvd:23/20 TransportAddress:100.100.100.17 SessionSetup:Config/Tunnel PeerLDPID:100.100.100.18:0 SourceAddress:100.100.100.18TransportAddress:100.100.100.18 HelloHoldTime:45sec(Local:45sec,Peer:45sec) 如果是LDPIPv6会话，请执行displaymplsldpdiscoveryipv6verbose命令检查传输地址配置是否正确： <Sysname>displaymplsldpdiscoveryipv6verboseVPNinstance:publicinstance LinkHellos: InterfaceGigabitEthernet1/0/2 HelloInterval:5000msHelloSent/Rcvd:83/160 TransportAddress:2001::2 PeerLDPID:100.100.100.18:0 SourceAddress:FE80:130F:20C0:29FF:FEED:9E60:876A:130BTransportAddress:2001::1 HelloHoldTime:15sec(Local:15sec,Peer:15sec) TargetedHellos: 2001:0000:130F::09C0:876A:130B-> 2005:130F::09C0:876A:130B(Active,Passive) HelloInterval:15000msHelloSent/Rcvd:23/22 TransportAddress:2001:0000:130F::09C0:876A:130B PeerLDPID:100.100.100.18:0 SourceAddress:2005:130F::09C0:876A:130B DestinationAddress:2001:0000:130F::09C0:876A:130B TransportAddress:2005:130F::09C0:876A:130B HelloHoldTime:45sec(Local:45sec,Peer:45sec) 如果传输地址配置不正确，则可以在接口视图或LDP对等体视图下执行mplsldptransport-address命令配置传输地址。缺省情况下，传输地址为本LSR的LSRID。如果传输地址配置正确，则需要确认路由是否发布。执行displayiprouting-table命令，查看是否存在到达会话对端的路由。 a.如果不存在到达会话对端的路由，则请将传输地址配置成本机存在的IP地址，确保路由正确发布。 b.如果存在到达会话对端的路由，则执行步骤(5)。 (5)检查LDPHello-hold定时器是否超时。 建议每5秒执行一次displaymplsldpdiscovery命令，查看收发Hello消息的计数， 检查会话两端的Hello消息是否都正常发送。若连续几次执行命令后发现发送或接收的计数没有变化，则表示Hello消息收发异常，Hello-hold定时器超时。 如果Hello-hold定时器超时，请排除链路问题，并检查设备CPU利用率。如果CPU利用率过高，请关闭一些不必要功能；如果CPU利用率正常，则执行步骤(6)。 如果Hello-hold定时器没有超时，则执行步骤(6)。 (6)检查LDPKeepalive-hold定时器是否超时。 建议每15秒执行一次displaymplsldppeer命令，查看收发的Keepalive消息的计数，检查会话两端的Keepalive消息是否都正常发送。若连续几次执行命令后发现发送或接收的计数没有变化，则表示Keepalive消息收发异常，Keepalive-hold定时器超时。 如果Keepalive-hold定时器超时，则排除报文转发问题。 如果Keepalive-hold定时器没有超时，则执行步骤(7)。(7)安全认证配置是否正确。请执行displaymplsldppeer命令LDP会话之间的安全认证是否配置，以及配置的安全认证类型是否一致： <Sysname>displaymplsldppeer VPNinstance:publicinstanceTotalnumberofpeers:1 PeerLDPIDStateRoleGRAuthKASent/Rcvd 2.2.2.9:0OperationalPassiveOffKeychain39/39 如果LDP会话两端Auth字段显示不一致，则将LDP会话两端的安全认证修改为一致。 如果LDP会话两端Auth字段显示一致，则执行步骤(8)。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：MPLS-LDP-STD-MIB •mplsLdpSessionDown(1.3.6.1.2.1.10.166.4.0.4)相关日志 •LDP/4/LDP_SESSION_CHG 12.1.2LDP会话震荡 ",Suggestion not provided
LDP会话状态频繁震荡。 ,本类故障的常见原因主要包括： •接口震荡 •路由震荡 •CPU利用率过高 3.故障分析 本类故障的诊断流程如图91所示。 图91LDP会话震荡的故障诊断流程图 4.处理步骤 (1)检查接口是否震荡。 执行displayinterfacebrief命令，查看Physical和Protocol字段。Physical和 Protocol字段均显示Up，则表示接口状态为Up，否则表示接口状态为Down。若接口一直在 Up和Down两种状态间切换，则表示接口震荡。 如果接口震荡，则排除接口问题。 如果接口没有震荡，请执行步骤(2)。 (2)检查路由是否震荡。 执行displayiprouting-table命令，查看路由信息。如果路由信息一直在显示和不显 示两种情况切换，则表示路由震荡。 如果路由震荡，或者路由一直不存在，则排除链路问题和排除IGP路由问题。 如果路由没有震荡，则执行步骤(3)。 (3)TCP报文是否过大。 执行displaytcpstatistics命令，查看TCP连接的流量统计信息。通过Sentpackets信息中datapacketsretransmitted（重发的数据报文数）字段的值，判断TCP报文是否过大： 如果重发的数据报文数不断增加，则表示TCP报文过大，请在报文出接口下执行tcpmss命令调整TCPMSS值。 如果重发的数据报文数未增加，则表示TCP报文大小正常，请执行步骤(4)。 (4)检查CPU利用率是否过高。 执行displaycpu-usage命令，查看CPU利用率的统计信息。 如果CPU利用率过高，则关闭一些不必要的功能，降低设备CPU利用率。 如果CPU利用率正常，则执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：MPLS-LDP-STD-MIB •mplsLdpSessionDown(1.3.6.1.2.1.10.166.4.0.4) 相关日志 •LDP/4/LDP_SESSION_CHG 12.1.3LDPLSP无法Up ,Suggestion not provided
LDP网络中LDPLSP频繁震荡。 ,本类故障的常见原因主要包括：•路由震荡。 •LDP会话震荡。 3.故障分析 本类故障的诊断思路如下：(1)检查路由是否震荡。 (2)检查LDP会话是否震荡。本类故障的诊断流程如图93所示。图93LDPLSP震荡的故障诊断流程图 4.处理步骤(1)检查路由是否震荡。 建议每1秒执行一次displayiprouting-table命令，连续执行5～10次，查看到达 LSP目的地址的路由信息。路由存在时，会显示相关路由信息。路由不存在时，则不会显示相关路由信息。如果相关路由信息一直在显示和不显示两种情况切换，则表示路由震荡。 查看路由信息后，请执行displaymplsldpfec命令查看LSP下游信息，即DownstreamInfo中的State字段，确保与下游对等体建立的LSP处于激活状态（Established）。 <Sysname>displaymplsldpfec VPNinstance:publicinstance FEC:1.1.1.1/32Flags:0x112 InLabel:2175UpstreamInfo: Peer:1.1.1.1:0State:Established DownstreamInfo: Peer:1.1.1.1:0 OutLabel:3State:Established NextHops:10.1.1.1GE1/0/1 RIBInfo: Protocol:OSPFBGPAsNum:0 LabelProtoID:1NextHopCount:1 VNID:0x313000003 TunnelID:- 如果路由震荡，或者路由一直都不存在，则请排除路由问题。 如果路由没有震荡，则执行步骤(2)。 (2)检查LDP会话是否震荡。 建议每1秒执行一次displaymplsldppeer命令，连续执行5～10次，查看显示信息的State字段。如果该字段的取值在Operational状态和其他非Operational状态之间切换，则表示LDP会话震荡。 <Sysname>displaymplsldppeer VPNinstance:publicinstanceTotalnumberofpeers:1 PeerLDPIDStateRoleGRAUTKASent/Rcvd ,Suggestion not provided
LDP网络中LDPLSP无法Up。 ,本类故障的常见原因主要包括： •路由问题 •LDP会话Down •资源不足，如Label达到上限，内存不足等 •配置了LSP触发策略、标签接受控制策略、标签通告控制策略或LabelMapping消息的发送策略 •路由的出接口与LDP建立会话的接口不一致 3.故障分析 本类故障的诊断思路如下： (1)检查路由是否存在。 (2)检查LDP会话是否正常建立。 (3)检查是否存在资源不足，入Label达到上限，内存不足的问题。 (4)检查是否配置了LSP建立策略。 (5)检查路由的出接口与LDP建立会话的接口是否一致。本类故障的诊断流程如图92所示。 图92LDPLSPDown的故障诊断流程图 4.处理步骤 (1)检查路由是否存在。 执行displayiprouting-tableip-addressmaskverbose命令，查看是否存在 到达指定LSP目的地址的路由，并检查该路由是否处于激活状态（路由信息中的State字段为ActiveAdv，表示路由处于激活状态）。对于公网BGP路由，还需要检查路由是否带标签。如果Label字段非NULL，则表示BGP路由携带标签。路由存在时，会显示相关路由信息。路由不存在时，则不会显示相关路由信息。 <Sysname>displayiprouting-table1.1.1.132verbose Summarycount:1 Destination:1.1.1.1/32Protocol:O_INTRA ProcessID:1 SubProtID:0x1Age:00h00m16s FlushedAge:00h00m16s Cost:1Preference:10 IpPre:N/AQosLocalID:N/A Tag:0State:ActiveAdv OrigTblID:0x0OrigVrf:default-vrf… 如果路由不存在、路由存在但未处于激活状态或者BGP路由未携带标签，则请排除路由故障。 如果路由存在且处于激活状态，对于BGP路由也带标签，则执行步骤(2)。 (2)检查LDP会话是否正常建立。执行displaymplsldppeerverbose命令，查看LDP会话是否成功建立： <Sysname>displaymplsldppeerverbose VPNinstance:publicinstancePeerLDPID:1.1.1.1:0LocalLDPID:2.2.2.2:0 TCPConnection:2.2.2.2:14080->1.1.1.1:646 SessionState:OperationalSessionRole:Active SessionUpTime:0000:00:14(DD:HH:MM)… 如果State字段显示不是Operational，则表示LDP会话没有正常建立，请参见“12.1.1LDP会话无法Up”故障进行定位。 如果State字段的显示为Operational，则表示LDP会话已建立并处于Up状态，请执行步骤(3)。 (3)检查是否配置了LSP策略。 在LDP视图下执行displaythis命令，如果存在以下命令，则需要检查IP前缀列表是否过滤了指定的LSP： −lsp-triggerprefix-list −accept-labelpeerprefix-list −advertise-labelprefix-list −propagatemappingprefix-list 如果IP前缀列表过滤了指定的LSP，则请修改IP前缀列表，使其允许指定LSP目的地址通过；如果IP前缀列表没有过滤指定的LSP，则执行步骤(4)。 如果LDP视图下没有配置以上命令，则执行步骤(4)。 (4)检查路由的出接口与LDP建立会话的接口是否一致。 执行displayiprouting-tableip-addressmask命令，查看指定路由的出接口信息： <Sysname>displayiprouting-table1.1.1.132 Summarycount:1 Destination/MaskProtoPreCostNextHopInterface ,Suggestion not provided
Logout告警信息形如： Notificationhh3cLogOut(1.3.6.1.4.1.25506.2.2.1.1.3.0.2)withhh3cTerminalUserName(1.3.6.1.4.1.25506.2.2.1.1.2.1.0)=;hh3cTerminalSource(1.3.6. ,Cause not provided,Suggestion not provided
MAC地址认证用户认证成功在线后，异常掉线,•同一MAC地址的用户采用802.1X认证重新上线。 •设备上MAC地址认证的相关配置发生变化。 •MAC地址认证用户流量实时计费失败。 •MAC地址认证用户重认证失败。 •服务器强制用户下线。 •开启下线检测后用户下线。 •用户会话超时。 3.故障分析 本类故障的诊断流程如图图4-24所示。 图4-22MAC地址认证用户掉线的故障诊断流程图 4.处理步骤 •Debug开关不能在设备正常运行时随意开启，可在故障发生后复现故障场景时打开。 •请及时保存以下步骤的执行结果，以便在故障无法解决时快速收集和反馈信息。 (1)检查是否因为802.1x用户上线导致同一MAC地址认证用户下线。 当前端口默认的认证方式顺序为：802.1X认证->MAC地址认证->Web认证。 如果用户首先通过MAC地址认证，Web认证会立即终止，但802.1X认证仍会继续进行。如果802.1X认证成功，则端口上生成的802.1X认证用户信息会覆盖已存在的MAC地址认证用 通过disp(户信息。)laydot1xconnection命令查看当前MAC地址是否通过了802.1X认证成功 上线。如果已经在线，请判断是否需要通过MAC地址认证重新上线，如果需要，则将相应的 802.1X用户下线并关闭接口的802.1X认证功能，然后再尝试进行MAC地址认证。 (2)检查设备上MAC地址认证的相关配置是否发生变化。 a.通过displaymac-authentication命令查看设备上MAC地址认证的相关配置（使能 开关、认证方式等）是否发生变化。 b.通过displaydomain命令查看用户认证域下的配置（授权属性等）是否发生变化。 (3)检查实时计费是否失败。 执行debuggingmac-authenticationevent命令打开MAC地址认证事件调试信息开关。如果系统打印事件调试信息“Real-timeaccountingfailure.”，则表示实时计费失败。检查设备与计费服务器之间的链路状态，以及设备和计费服务器的相关计费配置是否发生过更改。 (4)检查是否是因为重认证失败而掉线。 a.执行displaymac-authentication命令通过“Periodicreauth”字段查看认证接口 b.通过mac-authenticationaccess(下是否开启了MAC地址重认证功能。)-userlogenablelogoff命令打开MAC地 址认证用户下线的日志信息功能。 c.参考“4.11.1MAC地址认证失败”故障处理定位重认证失败原因。 (5)检查是否为RADIUS服务器强制用户下线。 执行debuggingmac-authenticationevent命令打开MAC地址认证事件调试信息开关。如果系统打印事件调试信息“TheRADIUSserverforciblyloggedouttheuser.”，则表示服务器强制用户下线。请联系服务器管理员定位服务器强制用户下线原因。 (6)检查是否是因为下线检测定时器间隔内未收到用户报文。 a.执行displaymac-authentication命令查看认证接口下“Offlinedetection”字段， b.确认是否buggingmac-authenticationeve(开启了MAC地址认证下线检测功能。执行de)nt命令打开MAC地址认证事件调试信息 开关。如果系统打印事件调试信息“Offlinedetecttimerexpired.”，则表示下线检测定时器间隔内，未收到此端口下某MAC地址认证在线用户的报文，设备切断了用户连接，导致用户下线。 c.检查客户端与设备之间的链路状态，排查客户端未发送报文原因。 (7)检查用户会话是否超时。 a.执行debuggingradiuspacket命令打开RADIUS报文调试信息开关，确认服务器回 b.应的报ebuggingmac-authenticationev(文中是否携带Session-Timeout属性。执行d)ent命令打开MAC地址认证事件调试信息开关。如果系统打印事件调试信息“Usersessiontimedout.”，则表示用户会话超时下线。 c.用户会话超时触发的掉线情况属于正常现象，用户可重新发起上线。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 rlogenable命令收集的日志信息。 执行debuggingmac-authenticationall、debuggingradiusall命令收集的调试信息。 5.告警与日志 相关告警无 相关日志 •MACA_LOGOFF 4.12802.1X故障处理 4.12.1802.1X用户认证失败 ,Suggestion not provided
MAC地址认证用户认证成功在线后，异常掉线。 ,•同一MAC地址的用户采用802.1X认证重新上线。 •设备上MAC地址认证的相关配置发生变化。 •MAC地址认证用户流量实时计费失败。 •MAC地址认证用户重认证失败。 •服务器强制用户下线。 •开启下线检测后用户下线。 •用户会话超时。 3.故障分析 本类故障的诊断流程如图图4-24所示。 图4-22MAC地址认证用户掉线的故障诊断流程图 4.处理步骤 •Debug开关不能在设备正常运行时随意开启，可在故障发生后复现故障场景时打开。 •请及时保存以下步骤的执行结果，以便在故障无法解决时快速收集和反馈信息。 (1)检查是否因为802.1x用户上线导致同一MAC地址认证用户下线。 当前端口默认的认证方式顺序为：802.1X认证->MAC地址认证->Web认证。 如果用户首先通过MAC地址认证，Web认证会立即终止，但802.1X认证仍会继续进行。如果802.1X认证成功，则端口上生成的802.1X认证用户信息会覆盖已存在的MAC地址认证用 通过disp(户信息。)laydot1xconnection命令查看当前MAC地址是否通过了802.1X认证成功 上线。如果已经在线，请判断是否需要通过MAC地址认证重新上线，如果需要，则将相应的 802.1X用户下线并关闭接口的802.1X认证功能，然后再尝试进行MAC地址认证。 (2)检查设备上MAC地址认证的相关配置是否发生变化。 a.通过displaymac-authentication命令查看设备上MAC地址认证的相关配置（使能 开关、认证方式等）是否发生变化。 b.通过displaydomain命令查看用户认证域下的配置（授权属性等）是否发生变化。 (3)检查实时计费是否失败。 执行debuggingmac-authenticationevent命令打开MAC地址认证事件调试信息开关。如果系统打印事件调试信息“Real-timeaccountingfailure.”，则表示实时计费失败。检查设备与计费服务器之间的链路状态，以及设备和计费服务器的相关计费配置是否发生过更改。 (4)检查是否是因为重认证失败而掉线。 a.执行displaymac-authentication命令通过“Periodicreauth”字段查看认证接口 b.通过mac-authenticationaccess(下是否开启了MAC地址重认证功能。)-userlogenablelogoff命令打开MAC地 址认证用户下线的日志信息功能。 c.参考“4.11.1MAC地址认证失败”故障处理定位重认证失败原因。 (5)检查是否为RADIUS服务器强制用户下线。 执行debuggingmac-authenticationevent命令打开MAC地址认证事件调试信息开关。如果系统打印事件调试信息“TheRADIUSserverforciblyloggedouttheuser.”，则表示服务器强制用户下线。请联系服务器管理员定位服务器强制用户下线原因。 (6)检查是否是因为下线检测定时器间隔内未收到用户报文。 a.执行displaymac-authentication命令查看认证接口下“Offlinedetection”字段， b.确认是否buggingmac-authenticationeve(开启了MAC地址认证下线检测功能。执行de)nt命令打开MAC地址认证事件调试信息 开关。如果系统打印事件调试信息“Offlinedetecttimerexpired.”，则表示下线检测定时器间隔内，未收到此端口下某MAC地址认证在线用户的报文，设备切断了用户连接，导致用户下线。 c.检查客户端与设备之间的链路状态，排查客户端未发送报文原因。 (7)检查用户会话是否超时。 a.执行debuggingradiuspacket命令打开RADIUS报文调试信息开关，确认服务器回 b.应的报ebuggingmac-authenticationev(文中是否携带Session-Timeout属性。执行d)ent命令打开MAC地址认证事件调试信息开关。如果系统打印事件调试信息“Usersessiontimedout.”，则表示用户会话超时下线。 c.用户会话超时触发的掉线情况属于正常现象，用户可重新发起上线。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 rlogenable命令收集的日志信息。 执行debuggingmac-authenticationall、debuggingradiusall命令收集的调试信息。 5.告警与日志 相关告警无 相关日志 •MACA_LOGOFF 4.12802.1X故障处理 4.12.1802.1X用户认证失败 ,Suggestion not provided
MAC地址认证用户认证失败或认证异常 ,"本类故障的常见原因主要包括： •用户已通过其它认证方式上线。 •全局或接口MAC地址认证功能未开启。 •设备配置的认证方式与RADIUS服务器不一致。 •MAC地址认证用户使用的认证域及相关配置错误。 •RADIUS服务器无回应。 •本地认证或RADIUS服务器认证拒绝。 •授权属性下发失败。 •用户MAC地址被设置为静默MAC。 •MAC地址认证在线用户数达到最大值。 3.故障分析 本类故障的诊断流程如图4-23所示。 图4-21MAC地址认证用户认证失败的故障诊断流程图 4.处理步骤 •Debug开关不能在设备正常运行时随意开启，可在故障发生后复现故障场景时打开。 •请及时保存以下步骤的执行结果，以便在故障无法解决时快速收集和反馈信息。 (1)检查用户是否已通过其它认证方式上线。 当前端口默认的认证方式顺序为：802.1X认证->MAC地址认证->Web认证。通过displaydot1xconnection命令查看当前MAC地址是否已经通过了802.1X认证 成功上线。如果已经在线，请判断是否需要通过MAC地址认证重新上线，如果需要，则将相应的802.1X用户下线并关闭802.1X认证功能，然后再尝试进行MAC地址认证。 (2)检查全局或接口MAC地址认证功能是否开启。 a.执行displaymac-authentication命令，如果提示“MACauthenticationisnotconfigured.”，表示全局MAC地址认证未开启，需要在系统视图下执行mac-authentication命令。 b.执行displaymac-authentication命令，如果有全局配置信息，无接口下的配置信息显示，则需要在用户认证的接口视图下执行mac-authentication命令。 (3)检查设备上配置的认证方法与RADIUS服务器是否一致。 设备上MAC地址认证支持entication命令查看“执行Authenticatio(两种认证方法：CHAP和PAP。dismac-auth)nmethod”字段显示的当前MAC 地址认证的认证方法与RADIUS服务器上配置的认证方法是否一致。如果不一致，则可以执行mac-authenticationauthentication-method命令修改设备上的配置。 (4)检查认证域及相关是否配置错误。端口上接入的MAC地址认证用户将按照如下先后顺序选择认证域：端口上指定的认证域>系统视图下指定的认证域>系统缺省的认证域。 a.通过在设备上执行displaymac-authentication命令查看系统和认证接口下是否配 置了MAC地址认证用户使用的认证域。 <Sysname>displaymac-authentication GlobalMACauthenticationparameters: MACauthentication:EnabledAuthenticationmethod:PAP Authenticationdomain:Notconfigured,usedefaultdomain … GigabitEthernet1/0/1islink-up MACauthentication:Enabled CarryUser-IP:Disabled Authenticationdomain:Notconfigured … b.如果认证接口下配置了MAC地址认证用户使用的认证域，请执行displaydomain命令检查认证域下的认证方案是否配置准确；如果认证接口下未配置认证域，而系统视图下配置了认证域，则同样通过displaydomain命令检查该认证域下的认证方案。 c.如果认证接口和系统视图下都没有配置MAC地址认证用户使用的认证域，则检查缺省认 d.如果不存在缺(证域的配置。)省认证域，若通过domainif-unknown命令配置了unknown域，则检查unknown域下的认证方案是否正确。 e.如果根据以上原则决定的认证域在设备上都不存在，则用户无法完成认证。 (5)检查RADIUS服务器有无响应。 请参见《AAA故障处理》的“RADIUS服务器无响应”进行故障定位和处理。 (6)检查下线原因是否为认证拒绝。 执行debuggingmac-autheticationevent命令打开MAC地址认证事件调试开关： 若系统打印调试信息“Localauthenticationrequestwasrejected.”，则表示本地认证拒绝。导致本地认证拒绝的原因有本地用户不存在、用户名密码错误、服务类型错误等。 若系统打印调试信息“TheRADIUSserverrejectedtheauthenticationrequest.”，则表示RADIUS服务器认证拒绝。服务器认证拒绝有多种原因，最常见的有服务器上未添加用户名、用户名格式不一致、用户名密码错误、RADIUS服务器授权策略无法匹配等。在设备上通过debuggingradiuserror命令打开RADIUS错误调试信息开关查看相关的Debug信息，并且同时可以在设备上执行test-aaa命令发起RADIUS请求测试，定位故障问题后，调整服务器、设备及客户端配置。 (7)检查授权属性是否下发失败。 通过debuggingmac-authenticationevent命令打开MAC地址认证事件调试开关。 如果设备上打印了“Authorizationfailure.”的调试信息，则表示授权失败。 a.检查设备的系统视图下是否通过port-securityauthorization-failoffline命 令配置了授权失败用户下线功能。如果未配置授权失败用户下线功能，缺省情况下授权失败用户也可以保持在线，则用户不是因为授权失败而导致认证失败，继续定位其它可能原 b.如果(因。)配置了授权失败用户下线功能，执行mac-authenticationaccess-userlogenablefailed-login命令打开MAC地址认证上线失败日志功能，确认授权失败的属性有哪些（例如授权ACL、VLAN）。 c.检查RADIUS服务器上的授权属性设置是否正确，确保服务器下发的授权属性内容准确。 d.通过displayacl或displayvlan等命令查看设备上对应的授权属性是否存在，如 果不存在，需要在设备上创建相应的授权属性，确保用户能够获取到授权的信息。 (8)检查用户的MAC地址是否被设置为静默MAC。 执行displaymac-authentication命令查看“SilentMACusers“字段显示的静默MAC信息。如果用户的MAC地址属于静默MAC，则需要等待静默时间老化后，才能再次进行MAC地址认证。用户可通过mac-authenticationtimerquiet命令重新配置静默时间。 (9)检查MAC地址认证用户数是否达到了最大用户数限制。 a.执行displaymac-authentication查看认证接口下的信息，“Maxonlineusers”字段为该接口下配置的最大用户数，“Currentonlineusers”字段为接口下当前在线用户数，对比两组数据判断MAC地址认证在线用户数是否已经达到最大值。 b.如果已经达到最大用户数，可以执行mac-authenticationmax-user命令增大最多允许同时接入的MAC地址认证用户数。 c.如果MAC地址认证的在线用户数无法再增大，则需要等其他用户下线或切换用户的接入端口。 (10)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 rlogenable命令收集的日志信息。 执行debuggingmac-authenticationall、debuggingradiusall命令收集 的调试信息。 5.告警和日志相关告警无 相关日志 •MACA_ENABLE_NOT_EFFECTIVE •MACA_LOGIN_FAILURE 4.11.2MAC认证用户掉线 ",Suggestion not provided
MAC地址认证用户认证失败或认证异常。 ,"本类故障的常见原因主要包括： •用户已通过其它认证方式上线。 •全局或接口MAC地址认证功能未开启。 •设备配置的认证方式与RADIUS服务器不一致。 •MAC地址认证用户使用的认证域及相关配置错误。 •RADIUS服务器无回应。 •本地认证或RADIUS服务器认证拒绝。 •授权属性下发失败。 •用户MAC地址被设置为静默MAC。 •MAC地址认证在线用户数达到最大值。 3.故障分析 本类故障的诊断流程如图4-23所示。 图4-21MAC地址认证用户认证失败的故障诊断流程图 4.处理步骤 •Debug开关不能在设备正常运行时随意开启，可在故障发生后复现故障场景时打开。 •请及时保存以下步骤的执行结果，以便在故障无法解决时快速收集和反馈信息。 (1)检查用户是否已通过其它认证方式上线。 当前端口默认的认证方式顺序为：802.1X认证->MAC地址认证->Web认证。通过displaydot1xconnection命令查看当前MAC地址是否已经通过了802.1X认证 成功上线。如果已经在线，请判断是否需要通过MAC地址认证重新上线，如果需要，则将相应的802.1X用户下线并关闭802.1X认证功能，然后再尝试进行MAC地址认证。 (2)检查全局或接口MAC地址认证功能是否开启。 a.执行displaymac-authentication命令，如果提示“MACauthenticationisnotconfigured.”，表示全局MAC地址认证未开启，需要在系统视图下执行mac-authentication命令。 b.执行displaymac-authentication命令，如果有全局配置信息，无接口下的配置信息显示，则需要在用户认证的接口视图下执行mac-authentication命令。 (3)检查设备上配置的认证方法与RADIUS服务器是否一致。 设备上MAC地址认证支持entication命令查看“执行Authenticatio(两种认证方法：CHAP和PAP。dismac-auth)nmethod”字段显示的当前MAC 地址认证的认证方法与RADIUS服务器上配置的认证方法是否一致。如果不一致，则可以执行mac-authenticationauthentication-method命令修改设备上的配置。 (4)检查认证域及相关是否配置错误。端口上接入的MAC地址认证用户将按照如下先后顺序选择认证域：端口上指定的认证域>系统视图下指定的认证域>系统缺省的认证域。 a.通过在设备上执行displaymac-authentication命令查看系统和认证接口下是否配 置了MAC地址认证用户使用的认证域。 <Sysname>displaymac-authentication GlobalMACauthenticationparameters: MACauthentication:EnabledAuthenticationmethod:PAP Authenticationdomain:Notconfigured,usedefaultdomain … GigabitEthernet1/0/1islink-up MACauthentication:Enabled CarryUser-IP:Disabled Authenticationdomain:Notconfigured … b.如果认证接口下配置了MAC地址认证用户使用的认证域，请执行displaydomain命令检查认证域下的认证方案是否配置准确；如果认证接口下未配置认证域，而系统视图下配置了认证域，则同样通过displaydomain命令检查该认证域下的认证方案。 c.如果认证接口和系统视图下都没有配置MAC地址认证用户使用的认证域，则检查缺省认 d.如果不存在缺(证域的配置。)省认证域，若通过domainif-unknown命令配置了unknown域，则检查unknown域下的认证方案是否正确。 e.如果根据以上原则决定的认证域在设备上都不存在，则用户无法完成认证。 (5)检查RADIUS服务器有无响应。 请参见《AAA故障处理》的“RADIUS服务器无响应”进行故障定位和处理。 (6)检查下线原因是否为认证拒绝。 执行debuggingmac-autheticationevent命令打开MAC地址认证事件调试开关： 若系统打印调试信息“Localauthenticationrequestwasrejected.”，则表示本地认证拒绝。导致本地认证拒绝的原因有本地用户不存在、用户名密码错误、服务类型错误等。 若系统打印调试信息“TheRADIUSserverrejectedtheauthenticationrequest.”，则表示RADIUS服务器认证拒绝。服务器认证拒绝有多种原因，最常见的有服务器上未添加用户名、用户名格式不一致、用户名密码错误、RADIUS服务器授权策略无法匹配等。在设备上通过debuggingradiuserror命令打开RADIUS错误调试信息开关查看相关的Debug信息，并且同时可以在设备上执行test-aaa命令发起RADIUS请求测试，定位故障问题后，调整服务器、设备及客户端配置。 (7)检查授权属性是否下发失败。 通过debuggingmac-authenticationevent命令打开MAC地址认证事件调试开关。 如果设备上打印了“Authorizationfailure.”的调试信息，则表示授权失败。 a.检查设备的系统视图下是否通过port-securityauthorization-failoffline命 令配置了授权失败用户下线功能。如果未配置授权失败用户下线功能，缺省情况下授权失败用户也可以保持在线，则用户不是因为授权失败而导致认证失败，继续定位其它可能原 b.如果(因。)配置了授权失败用户下线功能，执行mac-authenticationaccess-userlogenablefailed-login命令打开MAC地址认证上线失败日志功能，确认授权失败的属性有哪些（例如授权ACL、VLAN）。 c.检查RADIUS服务器上的授权属性设置是否正确，确保服务器下发的授权属性内容准确。 d.通过displayacl或displayvlan等命令查看设备上对应的授权属性是否存在，如 果不存在，需要在设备上创建相应的授权属性，确保用户能够获取到授权的信息。 (8)检查用户的MAC地址是否被设置为静默MAC。 执行displaymac-authentication命令查看“SilentMACusers“字段显示的静默MAC信息。如果用户的MAC地址属于静默MAC，则需要等待静默时间老化后，才能再次进行MAC地址认证。用户可通过mac-authenticationtimerquiet命令重新配置静默时间。 (9)检查MAC地址认证用户数是否达到了最大用户数限制。 a.执行displaymac-authentication查看认证接口下的信息，“Maxonlineusers”字段为该接口下配置的最大用户数，“Currentonlineusers”字段为接口下当前在线用户数，对比两组数据判断MAC地址认证在线用户数是否已经达到最大值。 b.如果已经达到最大用户数，可以执行mac-authenticationmax-user命令增大最多允许同时接入的MAC地址认证用户数。 c.如果MAC地址认证的在线用户数无法再增大，则需要等其他用户下线或切换用户的接入端口。 (10)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 rlogenable命令收集的日志信息。 执行debuggingmac-authenticationall、debuggingradiusall命令收集 的调试信息。 5.告警和日志相关告警无 相关日志 •MACA_ENABLE_NOT_EFFECTIVE •MACA_LOGIN_FAILURE 4.11.2MAC认证用户掉线 ",Suggestion not provided
MDC视图下location业务板，系统提示硬件资源不足或location失败的提示信息。 ,"•分配给MDC的资源不足。 •业务板已属于其他MDC。 •业务板上存在IRF物理端口。 3.故障分析 本类故障的诊断流程如图44所示。 图44故障诊断流程图 4.处理步骤(1)检查系统硬件资源信息。 通过displaymdcresource命令行查看缺省MDC以及非缺省MDC的可用内存大小，CPU可用值以及Disk的可用大小，如果分配过小，可能会导致location业务板失败。 <H3C>dismdcresourceMemoryusage:Slot0CPU0: Used788.4MB,Free15164.2MB,Total15952.6MBIDNameQuota(MB)Used(MB)Available(MB)1Admin15952.6788.415164.2Slot14CPU0:Used143.0MB,Free7757.7MB,Total7900.6MBIDNameQuota(MB)Used(MB)Available(MB)1Admin7900.6143.07757.7CPUusage:Slot0CPU0:IDNameWeightUsage(%)1Admin100Slot14CPU0:IDNameWeightUsage(%)1Admin1010重新分配资源后，若故障仍未排除，请执行步骤2。 (2)检查业务板是否已分配给其他MDC。部分机型一块业务板仅可分配给一个MDC，对于此类机型，需要检查当前业务板是否已属于其他MDC。可通过displaycurrent-configurationconfigurationmdc命令查看当前业务板的所属MDC。 [Sysname]displaycurrent-configurationconfigurationmdc # mdcAdminid1 #mdcmdcAid2locationchassis3slot3mdcstart# Return 上述显示信息表示所有业务板均属于缺省MDC且3号成员设备的3号槽位业务板属于mdcA。在为其他非缺省MDC分配业务板时，需使用undolocation命令取消已有MDC对该业务板的使用权限。重新配置后若故障仍未排除，请执行步骤3。 (3)检查业务板上是否存在IRF物理端口。部分机型支持IRF+MDC搭配使用，在IRF模式下undolocation业务板时，业务板上不能存 在IRF物理端口，否则会出现如下告警信息： [Syaname-mdc-1-admin]undolocationchassis1slot0 PerformingthiscommandisequivalenttoremovingthecardfromtheMDC.Continue? [Y/N]:y OperationdeniedbyIRF. 此时可先切换为IRF独立模式后再重新配置，或者undolocation其他没有IRF物理端口的业务板。执行本步骤后若故障仍未排除，请执行步骤4。 (4)收集信息并寻求技术支持。 若完成上述步骤后故障仍无法排除，请收集设备的运行信息，并联系H3C的技术支持工程师。 5.告警与日志 相关告警无 相关日志无 6.2.2Allocate接口失败故障 ",Suggestion not provided
MPLSL3VPN/IPv6MPLSL3VPN网络中同时存在我司设备和其他厂商设备，用户访问跨站点的私网资源时，不能打开部分网站，也不能通过FTP下载文件。执行ping命令检验发现，在指定ICMP报文的净荷为1464字节以上时Ping不通，指定ICMP报文的净荷小于1464字节时，可以Ping通。 ,本类故障的常见原因主要为：流量转发路径上设备接口的MTU值过小。 3.故障分析 本故障的处理流程如图102所示。图102私网间大包不通故障诊断流程图 4.操作步骤 (1)在流量转发路径上，将设备接口的MTU值修改为大于或等于1508字节。 在我司设备上，可通过displayinterface命令查看接口的MTU。例如： <Sysname>displayinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1 Currentstate:AdministrativelyUP Lineprotocolstate:UP Description:GigabitEthernet1/0/1Interface Bandwidth:1000000kbps Maximumtransmissionunit:1500...需要修改接口的MTU值时，请在该接口视图下执行ipmtu或ipv6mtu命令。 其他厂商的设备配置请参考相关的资料。 如果故障仍未能排除，请执行步骤（2）。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 12.3.8PE设备Ping不通远端CE网段 ,Suggestion not provided
MPLSTE隧道的转发路径上存在环路，导致流量无法通过MPLSTE隧道转发到目的地址。 ,MPLSTE隧道经过的不同设备上存在相同的IP地址。 ,(1)请检查MPLSTE隧道经过的不同设备上是否配置了相同的IP地址。若存在相同的IP地址，则需要修改IP地址，保证MPLSTE隧道经过的不同设备上不存在相同的IP地址。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 nostic-information命令收集诊断信息。 4.告警与日志 相关告警无 相关日志无 12.4.4Tunnel路径计算失败 
MPLSTE隧道路径计算失败，导致隧道DOWN。 ,本类故障的常见原因主要包括：•没有建立IGP邻居。 •没有MPLSTEDB信息。 •MPLSTE配置错误。 3.故障分析 本类故障的诊断流程如图107所示。 图107Tunnel路径计算失败的故障诊断流程图 4.处理步骤 (1)查看是否建立了IGP邻居。执行displayospfpeer和displayisispeer命令，查看是否建立了IGP邻居。 若建立了IGP邻居，请继续执行第(2)步。 若没有建立了IGP邻居，请先完成OSPF或IS-IS配置，建立IGP邻居。OSPF的详细介绍，请参见“三层技术-IP路由”中的“OSPF”；IS-IS的详细介绍，请参见“三层技术-IP (2)执行displaymplstet(路由”中的“IS-IS”。。)edb命令，查看MPLSTEDB信息。 若存在MPLSTEDB信息，请继续执行第(3)步。若不存在MPLSTEDB信息，请依次检查如下配置： a.OSPF/IS-IS区域和MPLSTE隧道经过的接口下是否配置mplsenable、mplsteenable命令。 b.LSRID、RouterID是否为同一LoopBack接口的地址。 (3)检查MPLSTE配置。 a.若使用RSVP-TE协议建立MPLSTE隧道，则需要检查设备和接口是否配置了rsvp、rsvpenable命令。 b.若使用SegmentRouting协议建立MPLSTE隧道，则需要检查设备IGP区域下是否配置了segment-routingmpls命令。 c.若隧道接口下配置了mplstebandwidth命令，检查设备出接口是否配置了mplstemax-linkbandwidth以及mplstemax-reservablebandwidth命令。 d.若隧道接口下配置了mplsteaffinity-attribute命令，检查设备出接口是否配置合理的mplstelink-attribute命令。如果希望某条链路能够被隧道所用，则需要 满足如下要求： −对于隧道亲和属性掩码为1的位，亲和属性为1的位中链路属性至少有1位也为1，亲和属性为0的位对应的链路属性位不能为1。 −对于隧道亲和属性掩码为0的位，链路属性可以是任意值。 e.若使用mplstepath命令指定显式路径来建立MPLSTE隧道，则需要检查显式路径配置是否合理：使用strict方式时，需要逐跳指定入接口的IP地址；使用loose方式时，需要指定经过的设备的节点地址。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 nostic-information命令收集诊断信息。 5.告警与日志相关告警无 相关日志无 12.4.5热备份CRLSP无法建立 ,Suggestion not provided
MPLSTE隧道下配置mplstebackuphot-standby命令，但是无法建立备份CRLSP。 ,本类故障的常见原因主要包括： •只存在一个与邻居相邻的接口。 •MPLSTE配置错误。 3.故障分析 本类故障的诊断流程如图108所示。 图108热备份CRLSP无法建立的故障诊断流程图 4.处理步骤 (1)根据配置的IGP协议，执行displayospfpeer或displayisispeer命令，查看与同一邻居（同一SystemID或同一RouterID）相连的接口信息（interface）。 #显示IS-IS邻居的概要信息。 <Sysname>displayisispeer PeerinformationforIS-IS(1)----------------------------- SystemID:0000.0000.0001 Interface:GE1/0/1CircuitId:0000.0000.0001.01 State:UpHoldTime:27sType:L1(L1L2)PRI:64 SystemID:0000.0000.0001 Interface:GE1/0/2CircuitId:0000.0000.0001.01State:UpHoldTime:27sType:L2(L1L2)PRI:64 #显示OSPF邻居概要信息。 <Sysname>displayospfpeer OSPFProcess1withRouterID1.1.1.1 NeighborBriefInformation Area:0.0.0.0 RouterIDAddressPriDead-TimeStateInterface ,Suggestion not provided
MPLSTE隧道由UP状态变为Down状态。 ,本类故障的常见原因主要包括： •MPLSTE隧道所在的链路Down。 •MPLSTE隧道的配置被删除或配置错误。 •RSVP消息超时或错误。 •物理链路不满足MPLSTE隧道所需的带宽。 •MPLSTE隧道或隧道所在物理接口BFDdown。 3.故障分析 本类故障的诊断流程如图图106所示。 图106MPLSTE隧道由UP状态突然变为Down状态的故障诊断流程图 4.处理步骤 (1)查看MPLSTE隧道对应的接口是否为Up状态。 执行displayinterface命令，查看MPLSTE隧道对应的接口否为Up状态。 (2)检查MPLSTE配置。依次检查如下配置： a.OSPF/IS-IS区域和MPLSTE隧道经过的接口下是否配置mplsteenable命令。 b.LSRID、RouterID是否为同一LoopBack接口的地址。 c.若使用RSVP-TE协议建立MPLSTE隧道，则需要检查设备和接口是否配置了rsvp、rsvpenable命令。 d.若隧道接口下配置了mplstebandwidth命令，检查设备出接口是否配置了mplstemax-linkbandwidth以及mplstemax-reservablebandwidth命令。 e.若隧道接口下配置了mplsteaffinity-attribute命令，检查设备出接口是否配置 合理的mplstelink-attribute命令。如果希望某条链路能够被隧道所用，则需要满足如下要求： −对于隧道亲和属性掩码为1的位，亲和属性为1的位中链路属性至少有1位也为1，亲和属性为0的位对应的链路属性位不能为1。 −对于隧道亲和属性掩码为0的位，不对链路属性的相应位进行检查。 f.若使用SegmentRouting协议建立MPLSTE隧道，则需要检查设备IGP区域下是否配置了Segment-Routing相关功能。 g.若使用mplstepath命令指定显式路径来建立MPLSTE隧道，则需要检查显式路径配置是否合理：使用strict方式时，需要逐跳指定入接口的IP地址；使用loose方式时，需要指定经过的设备的节点地址。(3)检查是否存在RSVP消息超时或错误。 通过displayrsvpstatistics命令查看是否存在RSVP消息超时（即发送的Path消息和收到的Resv消息个数不一致、收到的Path消息和发送的Resv消息个数不一致）或RSVP消息错误（即收到PathError消息或ResvError消息）的问题。若存在RSVP消息超时或错误，请抓包查看PathError消息或ResvError报文携带的错误信息，并根据报文携带的错误码，参照RFC2205和RFC3209解决问题。 <Sysname>displayrsvpstatistics P2Pstatistics: ObjectAddedDeleted PSB31 RSB31LSP31 P2MPstatistics: ObjectAddedDeleted PSB00RSB00 LSP00 PacketReceivedSent Path55 Resv55PathError00 ResvError00 PathTear00ResvTear00ResvConf00Bundle00Ack00Srefresh00Hello00Challenge00Response00 Error00 (4)检查物理链路是否满足MPLSTE隧道所需的带宽。当设备上建立了更高优先级的MPLSTE隧道时，该隧道可能会抢占低优先级MPLSTE隧道的带宽，导致低优先级MPLSTE隧道的状态变为down。通过displaymplstelink-managementbandwidth-allocation命令查看链路上各个优先级的剩余可用带宽， 确保链路剩余可用带宽大于该优先级的隧道所需的带宽。如果链路上的剩余可用带宽不能满足MPLSTE隧道的需求，则需要修改配置，调整隧道路径，或为链路提供更大的带宽。 (5)检查MPLSTE隧道或隧道所在物理接口是否BFDdown。 通过displaymplsbfdtetunneltunnel-number命令查看MPLSTE隧道的BFD状态。若MPLSTE隧道的BFD状态为down，则需要通过displaybfdsession命令查看BFD状态为down的原因，检查并修改BFD配置或检查物理链路是否存在链路故障、链路质量问题。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：MPLS-TE-STD-MIB •mplsTunnelUp(1.3.6.1.2.1.10.166.3.0.1)•mplsTunnelDown(11.3.6.1.2.1.10.166.3.0.2)相关日志 •IFNET/5/LINK_UPDOWN •IFNET/3/PHY_UPDOWN 12.4.3MPLSTE隧道存在环路 ,Suggestion not provided
ONU设备注册正常，下挂的用户设备通过ONU设备接入，但不能接入网络。 ,•ONU未正确绑定。•关闭了厂商兼容功能。 •物理链路异常。 3.故障分析 本类故障的诊断流程如图24所示：图24故障诊断流程图 4.处理步骤 (1)检查ONU绑定是否正确 如果ONU设备是通过bindonu-id命令手动绑定的，请通过displayonu命令检查绑定的 MAC地址，确保该地址与ONU设备的MAC地址一致。 如果ONU设备是通过onubindbatch或onubindauto命令批量/自动绑定的，请再次执行 onubindbatch或onubindauto命令，以确认绑定是否生效。需要注意的是：一个OLT端口上可注册的ONU设备有限，具体数量限制请参见各产品的配置命令手册。 (2)检查光模块 根据3.7.1光口不UP故障的故障定位处理方法，定位是否是光模块故障。 (3)检查兼容性 H3COLT设备上厂商兼容功能缺省为开启状态，如果关闭了厂商兼容功能（undo vendor-compatible），则非H3C的ONU设备不能注册到该OLT，对应ONU端口down。关闭厂商兼容功能后，如果使用bindonu-id命令在ONU端口上绑定了非H3C的ONU设备，那么再开启厂商兼容功能时（执行vendor-compatible），需要注销该ONU端口（执行 deregisteronu命令）或关闭再打开该ONU端口（执行shutdown、undoshutdown命令），才能使该ONU注册到OLT。 (4)检查物理线路 插入EPON光模块，OLT端口UP，但是所有ONU无法注册，对端ONU设备PON灯不亮，说明ONU没有收到光，排查是否插入了不符合要求的光模块（参考“3.6.7OLT端口不支持光模块”），分光器是否存在异常。 如果部分ONU无法注册，需要排查ONU设备是否正常，采用替换ONU的方式验证。另外需要排查光纤线路是否有问题：如果一个分光器下部分ONU能够正常注册UP，可以交换ONU设备的光纤查看效果。 (5)如果执行上述步骤后故障无法排除，请联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志无 3.6.11EPON系统用户设备不能上网 设备MAC地址配置错误。 ,(1)检查用户设备MAC地址。 如果MAC地址前两个字节的第7bit为1，为异常MAC地址，例如：02xx-xxxx-xxxx。符合此规则的异常源MAC地址报文在OLT设备会被丢弃。出现此种异常MAC地址，一般是由于用户修改MAC地址导致。 (2)如果故障无法排除，请收集设备的运行信息，并联系H3C的技术支持工程师。 4.告警与日志相关告警无 相关日志无 3.7光模块故障 3.7.1光口不UP故障 
OSPFv3的状态机包括Down、Init、2-way、Exstart、Exchange、Loading和Full。其中，稳定状态包括Down、2-way和Full： •	Down：表示未使能OSPFv3。 •	2-way：DRother之间的邻居关系。 •	Full：形成邻接关系。 对于使用OSPFv3进行路由计算和路由转发的网络中，只有2-way和Full是正常的邻居状态。如果邻居状态既未处于2-way状态，也未处于Full状态，说明邻居关系不正常。 ,本类故障的常见原因主要包括：•链路故障，OSPFv3报文被丢弃。 •	接口的DR优先级配置不合理。 •	两端配置的OSPFv3MTU值不同。3.故障分析 本类故障的诊断流程如图75所示。 图75OSPFv3邻居Down的故障诊断流程图 ,(1)	使用displayospfv3peer命令查看OSPFv3邻居信息，并根据不同的邻居状态进行相应的处理。 	没有邻居信息。 请检查是否在OSPFv3进程下设置了RouterID，如果未设置RouterID，则OSPFv3进程无法运行。如果设置了RouterID，则表示OSPFv3邻居Down或者邻居震荡，请参见“10.3.1 OSPFv3邻居Down”故障处理。 	邻居状态一直为Init。 表示对端设备收不到本端发送的Hello报文，此时请排查链路和对端设备是否故障。 	邻居状态一直为2-way。 执行命令displayospfv3interfaceverbose命令查看设备在OSPFv3接口的DR 优先级是否为0： 如果OSPFv3接口的DR优先级为0，那么邻居状态为2-way属于正常情况。 如果OSPFv3接口的DR优先级不为0，请执行步骤(2)。 	邻居状态一直是Exstart。 表示设备一直在进行DD协商，但无法进行DD同步，出现该情况有两种可能性： −接口无法正常收发超大报文 可以通过多次执行命令ping-spacket-sizeneighbor-address查看超大报文收发情况，将packet-size设置为1500或更大数值。如果无法Ping通，请先解决链路问题。 −两端OSPFv3MTU配置值不一致如果OSPFv3接口下配置了ospfv3mtu-ignore命令，则无需检查两端的OSPFv3MTU值是否相等；否则，需要检查两端的OSPFv3MTU值是否相等，如果不相等则修改接口下的MTU值。 如果故障没有解决，请执行步骤(2)。 	邻居状态一直是Exchange。 表示设备在进行DD交换，请参见邻居状态一直为Exstart状态的处理。 如果故障没有解决，请执行步骤(2)。 	邻居状态一直是Loading。 如果使用displayospfv3peer命令查看到邻居状态一直处于Loading，可以尝试执行resetospfv3[process-id]process命令重启OSPFv3进程。 如果故障没有解决，请执行步骤(2)。 (2)	如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.4OSPF故障处理 10.4.1OSPF邻居Down 
OSPFv3的状态机包括Down、Init、2-way、Exstart、Exchange、Loading和Full。其中，稳定状态包括Down、2-way和Full： •Down：表示未使能OSPFv3。 •2-way：DRother之间的邻居关系。 •Full：形成邻接关系。 对于使用OSPFv3进行路由计算和路由转发的网络中，只有2-way和Full是正常的邻居状态。如果邻居状态既未处于2-way状态，也未处于Full状态，说明邻居关系不正常。 ,本类故障的常见原因主要包括：•链路故障，OSPFv3报文被丢弃。 •接口的DR优先级配置不合理。 •两端配置的OSPFv3MTU值不同。3.故障分析 本类故障的诊断流程如图75所示。 图75OSPFv3邻居Down的故障诊断流程图 4.处理步骤 (1)使用displayospfv3peer命令查看OSPFv3邻居信息，并根据不同的邻居状态进行相应的处理。 没有邻居信息。 请检查是否在OSPFv3进程下设置了RouterID，如果未设置RouterID，则OSPFv3进程无法运行。如果设置了RouterID，则表示OSPFv3邻居Down或者邻居震荡，请参见“10.3.1 OSPFv3邻居Down”故障处理。 邻居状态一直为Init。 表示对端设备收不到本端发送的Hello报文，此时请排查链路和对端设备是否故障。 邻居状态一直为2-way。 执行命令displayospfv3interfaceverbose命令查看设备在OSPFv3接口的DR 优先级是否为0： 如果OSPFv3接口的DR优先级为0，那么邻居状态为2-way属于正常情况。 如果OSPFv3接口的DR优先级不为0，请执行步骤(2)。 邻居状态一直是Exstart。 表示设备一直在进行DD协商，但无法进行DD同步，出现该情况有两种可能性： −接口无法正常收发超大报文 可以通过多次执行命令ping-spacket-sizeneighbor-address查看超大报文收发情况，将packet-size设置为1500或更大数值。如果无法Ping通，请先解决链路问题。 −两端OSPFv3MTU配置值不一致如果OSPFv3接口下配置了ospfv3mtu-ignore命令，则无需检查两端的OSPFv3MTU值是否相等；否则，需要检查两端的OSPFv3MTU值是否相等，如果不相等则修改接口下的MTU值。 如果故障没有解决，请执行步骤(2)。 邻居状态一直是Exchange。 表示设备在进行DD交换，请参见邻居状态一直为Exstart状态的处理。 如果故障没有解决，请执行步骤(2)。 邻居状态一直是Loading。 如果使用displayospfv3peer命令查看到邻居状态一直处于Loading，可以尝试执行resetospfv3[process-id]process命令重启OSPFv3进程。 如果故障没有解决，请执行步骤(2)。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.4OSPF故障处理 10.4.1OSPF邻居Down ,Suggestion not provided
OSPF的状态机包括Down、Init、2-way、Exstart、Exchange、Loading和Full。其中，稳定状态包括Down、2-way和Full： •	Down：表示未使能OSPF。 •	2-way：DRother之间的邻居关系。 •	Full：形成邻接关系。 对于使用OSPF进行路由计算和路由转发的网络中，只有2-way和Full是正常的邻居状态。如果邻居状态既未处于2-way状态、也未处于Full状态，说明邻居关系不正常。 ,本类故障的常见原因主要包括： •	链路故障，OSPF报文被丢弃。 •	接口的DR优先级配置不合理。 •	两端配置的OSPFMTU值不同。 3.	故障分析 本类故障的诊断流程如图77所示：图77OSPF邻居无法达到FULL状态的故障诊断流程图 ,(1)	使用displayospfpeer命令查看OSPF邻居信息，并根据不同的邻居状态进行相应的处理。 	没有邻居信息。 表示OSPF邻居Down或者邻居震荡，请参见“10.4.1OSPF邻居Down”故障处理。 	邻居状态一直为Init。 表示对端设备收不到本端发送的Hello报文，此时请排查链路和对端设备是否故障。 	邻居状态一直为2-way。 执行命令displayospfinterfaceverbose查看设备在OSPF接口的DR优先级 是否为0： −如果OSPF接口的DR优先级为0，那么邻居状态为2-way属于正常情况。 −如果OSPF接口的DR优先级不为0，请执行步骤(2)。 	邻居状态一直是Exstart。 表示设备一直在进行DD协商，但无法进行DD同步，出现该情况有两种可能性： −接口无法正常收发超大报文。 可以通过多次执行命令ping-spacket-sizeneighbor-address查看超大报文收发情况，将packet-size设置为1500或更大数值。如果无法Ping通，请先解决链路问题。 −两端OSPFMTU配置值不一致。 如果OSPF接口下配置了ospfmtu-enable命令，请检查两端的OSPFMTU值是 否相等。如果不相等，则修改接口下的MTU值。 如果故障没有解决，请执行步骤(2)。 	邻居状态一直是Exchange。 表示设备在进行DD交换，请参见邻居状态一直为Exstart状态的处理。 如果故障没有解决，请执行步骤(2)。 	邻居状态一直是Loading。 如果使用displayospfpeer命令查看邻居状态一直处于Loading，可以尝试执行resetospf[process-id]process命令重启OSPF进程。 如果故障没有解决，请执行步骤(2)。 (2)	如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.4.3设备学习不到部分OSPF路由 
OSPF的状态机包括Down、Init、2-way、Exstart、Exchange、Loading和Full。其中，稳定状态包括Down、2-way和Full： •Down：表示未使能OSPF。 •2-way：DRother之间的邻居关系。 •Full：形成邻接关系。 对于使用OSPF进行路由计算和路由转发的网络中，只有2-way和Full是正常的邻居状态。如果邻居状态既未处于2-way状态、也未处于Full状态，说明邻居关系不正常。 ,本类故障的常见原因主要包括： •链路故障，OSPF报文被丢弃。 •接口的DR优先级配置不合理。 •两端配置的OSPFMTU值不同。 3.故障分析 本类故障的诊断流程如图77所示：图77OSPF邻居无法达到FULL状态的故障诊断流程图 4.处理步骤 (1)使用displayospfpeer命令查看OSPF邻居信息，并根据不同的邻居状态进行相应的处理。 没有邻居信息。 表示OSPF邻居Down或者邻居震荡，请参见“10.4.1OSPF邻居Down”故障处理。 邻居状态一直为Init。 表示对端设备收不到本端发送的Hello报文，此时请排查链路和对端设备是否故障。 邻居状态一直为2-way。 执行命令displayospfinterfaceverbose查看设备在OSPF接口的DR优先级 是否为0： −如果OSPF接口的DR优先级为0，那么邻居状态为2-way属于正常情况。 −如果OSPF接口的DR优先级不为0，请执行步骤(2)。 邻居状态一直是Exstart。 表示设备一直在进行DD协商，但无法进行DD同步，出现该情况有两种可能性： −接口无法正常收发超大报文。 可以通过多次执行命令ping-spacket-sizeneighbor-address查看超大报文收发情况，将packet-size设置为1500或更大数值。如果无法Ping通，请先解决链路问题。 −两端OSPFMTU配置值不一致。 如果OSPF接口下配置了ospfmtu-enable命令，请检查两端的OSPFMTU值是 否相等。如果不相等，则修改接口下的MTU值。 如果故障没有解决，请执行步骤(2)。 邻居状态一直是Exchange。 表示设备在进行DD交换，请参见邻居状态一直为Exstart状态的处理。 如果故障没有解决，请执行步骤(2)。 邻居状态一直是Loading。 如果使用displayospfpeer命令查看邻居状态一直处于Loading，可以尝试执行resetospf[process-id]process命令重启OSPF进程。 如果故障没有解决，请执行步骤(2)。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.4.3设备学习不到部分OSPF路由 ,Suggestion not provided
OSPF组网中不同设备上配置相同的接口IP地址，会导致OSPF路由震荡。出现此问题时，设备 •	ycpu-usage查看到设备CPU使用率较高。 •	OSPF频繁地老化LSA、重新生成LSA。 •	设备路由频繁刷新、路由计算出错。 2.处理步骤 以图80为示例说明此类故障的处理方式。其他组网与该组网处理此类故障的思路是相同的。 图80网络中IP地址冲突导致路由震荡组网示例 DeviceA	DeviceB	DeviceC	DeviceD (2)	在OSPF网络中的各个设备上每隔一秒执行一次displayospf[process-id]lsdb命令，查看每台设备的OSPF链路状态数据库（LSDB）信息。 (3)	检查是否存在LSA老化异常的情况。同时满足如下条件时，说明LSA老化异常。 a.在DeviceA上发现同一个AdvRouter通告的NetworkLSA（Type-2）的老化时间（Age）非自然增长，一直为最小值，且Sequence字段增加很快。例如在如下显示信息中， LinkStateID为172.168.0.1的NetworkLSA的Age非自然增长，短时间内Sequence从8000002D快速增长为8000002F。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.379748800000090 Router1.1.1.11.1.1.183536800000050 Router4.4.4.44.4.4.479836800000040 Router10.1.1.110.1.1.141536800000070 Router2.2.2.22.2.2.241548800000150 Network192.168.0.23.3.3.380232800000020 Network172.168.0.34.4.4.479132800000020 Network172.168.0.110.1.1.17328000002D0 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.381048800000090 Router1.1.1.11.1.1.184836800000050 Router4.4.4.44.4.4.481136800000040 Router10.1.1.110.1.1.142836800000070 Router2.2.2.22.2.2.242848800000150 Network192.168.0.23.3.3.381532800000020 Network172.168.0.34.4.4.480432800000020 Network172.168.0.110.1.1.14328000002F0 b.在DeviceB上相同NetworkLSA的Age不断在3600和其他较小值之间切换，而且 Sequence字段增加很快。例如在如下显示信息中，LinkStateID为172.168.0.1的 NetworkLSA的Age在3600和其他较小值之间切换，短时间内Sequence从80000023快速增长为80000041。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID2.2.2.2LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.370848800000090 Router1.1.1.11.1.1.174636800000050 Router4.4.4.44.4.4.470936800000040 Router10.1.1.110.1.1.132936800000070Router2.2.2.22.2.2.232748800000150Network172.168.0.34.4.4.470232800000020 Network192.168.0.23.3.3.371332800000020 Network172.168.0.110.1.1.1360032800000230 <Sysname>displayospf100lsdb OSPFProcess100withRouterID2.2.2.2LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.374848800000090 Router1.1.1.11.1.1.178636800000050 Router4.4.4.44.4.4.474936800000040 Router10.1.1.110.1.1.136936800000070 Router2.2.2.22.2.2.236748800000150 Network172.168.0.34.4.4.474232800000020 Network192.168.0.23.3.3.375332800000020 Network172.168.0.110.1.1.1732800000410 c.在DeviceC上，相同NetworkLSA的Age一直为3600，或者偶尔没有这条LSA，而且 Sequence字段增加很快。例如在如下显示信息中，LinkStateID为172.168.0.1的NetworkLSA的Age为3600，或者偶尔没有这条LSA；存在这条LSA时，短时间内Sequence从 80000309增长到80000346。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.3740488000000D0Router4.4.4.44.4.4.475936800000080Router10.1.1.110.1.1.1364368000000B0 Router2.2.2.22.2.2.236648800000190 Network172.168.0.34.4.4.475532800000060 Network192.168.0.23.3.3.374432800000060 Network172.168.0.110.1.1.1360032800003090 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.3745488000000D0 Router4.4.4.44.4.4.476436800000080 Router10.1.1.110.1.1.1369368000000B0 Router2.2.2.22.2.2.237148800000190 Network172.168.0.34.4.4.476032800000060 Network192.168.0.23.3.3.374932800000060 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.31302488000000D0Router4.4.4.44.4.4.4132136800000080Router10.1.1.110.1.1.1926368000000B0 Router2.2.2.22.2.2.292848800000190Network172.168.0.34.4.4.4131732800000060 Network192.168.0.23.3.3.3130632800000060 Network172.168.0.110.1.1.1360032800003460 (4)检查是否存在OSPF路由震荡。 在DeviceB上每隔一秒执行一次displayospf[process-id]routing命令，查看路由是否震荡。 <Sysname>displayospf100routing OSPFProcess100withRouterID2.2.2.2 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.0.0/241Transit0.0.0.03.3.3.30.0.0.0 172.168.0.0/241Transit0.0.0.010.1.1.10.0.0.0 Totalnets:2 Intraarea:2Interarea:0ASE:0NSSA:0 <Sysname>displayospf100routing OSPFProcess100withRouterID2.2.2.2 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.0.0/241Transit0.0.0.03.3.3.30.0.0.0 172.168.0.0/242Transit192.168.0.24.4.4.40.0.0.0 Totalnets:2 Intraarea:2Interarea:0ASE:0NSSA:0 当OSPF路由发生震荡，且多次执行displayospfpeer命令发现邻居关系没有发生震荡时，可以判断该OSPF组网中存在IP地址冲突。同时，由于NetworkLSA（Type-2）是由DR发布的，说明产生冲突的设备中有一台设备是DR。 如果任一台设备上出现两个LinkStateID相同的NetworkLSA，并且这两个NetworkLSA老化异常。说明产生冲突的设备均为DR。<Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.336748800000210 Router4.4.4.44.4.4.436936800000130 Router10.1.1.110.1.1.147736800000120 Router2.2.2.22.2.2.2403488000002B0 Network192.168.0.12.2.2.239532800000020 Network172.168.0.13.3.3.33600328000002B0 Network172.168.0.110.1.1.1932800000360 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.346048800000210 Router4.4.4.44.4.4.446236800000130 Router10.1.1.110.1.1.157036800000120 Router2.2.2.22.2.2.2496488000002B0 Network192.168.0.12.2.2.248832800000020 Network172.168.0.13.3.3.3360032800000340 Network172.168.0.110.1.1.1632800000410 (5)	定位产生冲突的设备。结合displayospflsdb的显示信息，找到产生IP地址冲突的设备。 	产生冲突的设备中，仅有一台设备为DR。 根据异常NetworkLSA的AdvRouter，可以找到产生该NetworkLSA的DR设备；然后根据NetworkLSA中的LinkStateID找到产生IP地址冲突的接口，确定该接口的IP地址。 根据接口的IP地址以及网络IP地址规划，找到另外一台产生冲突的设备。 在本例中，可以判断RouterID为10.1.1.1的DR设备接口IP地址与其他设备接口IP地址冲突，产生冲突的IP地址是172.168.0.1。然后根据网络IP地址规划，找到与DR设备接口IP地址冲突的另外一台设备。 	产生冲突的设备均为DR。 根据异常NetworkLSA的AdvRouter，可以找到产生该NetworkLSA的DR设备；然后根据NetworkLSA中的LinkStateID找到产生IP地址冲突的接口。 (6)	根据网络IP地址规划修改冲突一方的IP地址。 (7)	如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 3.告警与日志相关告警无 相关日志 无 11	组播类故障处理 11.1MSDP故障处理 11.1.1MSDP对等体无法正确建立（S，G）表项 ,Cause not provided,Suggestion not provided
OSPF组网中不同设备上配置相同的接口IP地址，会导致OSPF路由震荡。出现此问题时，设备 •ycpu-usage查看到设备CPU使用率较高。 •OSPF频繁地老化LSA、重新生成LSA。 •设备路由频繁刷新、路由计算出错。 ,以图80为示例说明此类故障的处理方式。其他组网与该组网处理此类故障的思路是相同的。 图80网络中IP地址冲突导致路由震荡组网示例 DeviceADeviceBDeviceCDeviceD (2)在OSPF网络中的各个设备上每隔一秒执行一次displayospf[process-id]lsdb命令，查看每台设备的OSPF链路状态数据库（LSDB）信息。 (3)检查是否存在LSA老化异常的情况。同时满足如下条件时，说明LSA老化异常。 a.在DeviceA上发现同一个AdvRouter通告的NetworkLSA（Type-2）的老化时间（Age）非自然增长，一直为最小值，且Sequence字段增加很快。例如在如下显示信息中， LinkStateID为172.168.0.1的NetworkLSA的Age非自然增长，短时间内Sequence从8000002D快速增长为8000002F。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.379748800000090 Router1.1.1.11.1.1.183536800000050 Router4.4.4.44.4.4.479836800000040 Router10.1.1.110.1.1.141536800000070 Router2.2.2.22.2.2.241548800000150 Network192.168.0.23.3.3.380232800000020 Network172.168.0.34.4.4.479132800000020 Network172.168.0.110.1.1.17328000002D0 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.381048800000090 Router1.1.1.11.1.1.184836800000050 Router4.4.4.44.4.4.481136800000040 Router10.1.1.110.1.1.142836800000070 Router2.2.2.22.2.2.242848800000150 Network192.168.0.23.3.3.381532800000020 Network172.168.0.34.4.4.480432800000020 Network172.168.0.110.1.1.14328000002F0 b.在DeviceB上相同NetworkLSA的Age不断在3600和其他较小值之间切换，而且 Sequence字段增加很快。例如在如下显示信息中，LinkStateID为172.168.0.1的 NetworkLSA的Age在3600和其他较小值之间切换，短时间内Sequence从80000023快速增长为80000041。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID2.2.2.2LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.370848800000090 Router1.1.1.11.1.1.174636800000050 Router4.4.4.44.4.4.470936800000040 Router10.1.1.110.1.1.132936800000070Router2.2.2.22.2.2.232748800000150Network172.168.0.34.4.4.470232800000020 Network192.168.0.23.3.3.371332800000020 Network172.168.0.110.1.1.1360032800000230 <Sysname>displayospf100lsdb OSPFProcess100withRouterID2.2.2.2LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.374848800000090 Router1.1.1.11.1.1.178636800000050 Router4.4.4.44.4.4.474936800000040 Router10.1.1.110.1.1.136936800000070 Router2.2.2.22.2.2.236748800000150 Network172.168.0.34.4.4.474232800000020 Network192.168.0.23.3.3.375332800000020 Network172.168.0.110.1.1.1732800000410 c.在DeviceC上，相同NetworkLSA的Age一直为3600，或者偶尔没有这条LSA，而且 Sequence字段增加很快。例如在如下显示信息中，LinkStateID为172.168.0.1的NetworkLSA的Age为3600，或者偶尔没有这条LSA；存在这条LSA时，短时间内Sequence从 80000309增长到80000346。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.3740488000000D0Router4.4.4.44.4.4.475936800000080Router10.1.1.110.1.1.1364368000000B0 Router2.2.2.22.2.2.236648800000190 Network172.168.0.34.4.4.475532800000060 Network192.168.0.23.3.3.374432800000060 Network172.168.0.110.1.1.1360032800003090 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.3745488000000D0 Router4.4.4.44.4.4.476436800000080 Router10.1.1.110.1.1.1369368000000B0 Router2.2.2.22.2.2.237148800000190 Network172.168.0.34.4.4.476032800000060 Network192.168.0.23.3.3.374932800000060 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.31302488000000D0Router4.4.4.44.4.4.4132136800000080Router10.1.1.110.1.1.1926368000000B0 Router2.2.2.22.2.2.292848800000190Network172.168.0.34.4.4.4131732800000060 Network192.168.0.23.3.3.3130632800000060 Network172.168.0.110.1.1.1360032800003460 (4)检查是否存在OSPF路由震荡。 在DeviceB上每隔一秒执行一次displayospf[process-id]routing命令，查看路由是否震荡。 <Sysname>displayospf100routing OSPFProcess100withRouterID2.2.2.2 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.0.0/241Transit0.0.0.03.3.3.30.0.0.0 172.168.0.0/241Transit0.0.0.010.1.1.10.0.0.0 Totalnets:2 Intraarea:2Interarea:0ASE:0NSSA:0 <Sysname>displayospf100routing OSPFProcess100withRouterID2.2.2.2 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.0.0/241Transit0.0.0.03.3.3.30.0.0.0 172.168.0.0/242Transit192.168.0.24.4.4.40.0.0.0 Totalnets:2 Intraarea:2Interarea:0ASE:0NSSA:0 当OSPF路由发生震荡，且多次执行displayospfpeer命令发现邻居关系没有发生震荡时，可以判断该OSPF组网中存在IP地址冲突。同时，由于NetworkLSA（Type-2）是由DR发布的，说明产生冲突的设备中有一台设备是DR。 如果任一台设备上出现两个LinkStateID相同的NetworkLSA，并且这两个NetworkLSA老化异常。说明产生冲突的设备均为DR。<Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.336748800000210 Router4.4.4.44.4.4.436936800000130 Router10.1.1.110.1.1.147736800000120 Router2.2.2.22.2.2.2403488000002B0 Network192.168.0.12.2.2.239532800000020 Network172.168.0.13.3.3.33600328000002B0 Network172.168.0.110.1.1.1932800000360 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.346048800000210 Router4.4.4.44.4.4.446236800000130 Router10.1.1.110.1.1.157036800000120 Router2.2.2.22.2.2.2496488000002B0 Network192.168.0.12.2.2.248832800000020 Network172.168.0.13.3.3.3360032800000340 Network172.168.0.110.1.1.1632800000410 (5)定位产生冲突的设备。结合displayospflsdb的显示信息，找到产生IP地址冲突的设备。 产生冲突的设备中，仅有一台设备为DR。 根据异常NetworkLSA的AdvRouter，可以找到产生该NetworkLSA的DR设备；然后根据NetworkLSA中的LinkStateID找到产生IP地址冲突的接口，确定该接口的IP地址。 根据接口的IP地址以及网络IP地址规划，找到另外一台产生冲突的设备。 在本例中，可以判断RouterID为10.1.1.1的DR设备接口IP地址与其他设备接口IP地址冲突，产生冲突的IP地址是172.168.0.1。然后根据网络IP地址规划，找到与DR设备接口IP地址冲突的另外一台设备。 产生冲突的设备均为DR。 根据异常NetworkLSA的AdvRouter，可以找到产生该NetworkLSA的DR设备；然后根据NetworkLSA中的LinkStateID找到产生IP地址冲突的接口。 (6)根据网络IP地址规划修改冲突一方的IP地址。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 3.告警与日志相关告警无 相关日志 无 11组播类故障处理 11.1MSDP故障处理 11.1.1MSDP对等体无法正确建立（S，G）表项 ,以图80为示例说明此类故障的处理方式。其他组网与该组网处理此类故障的思路是相同的。 图80网络中IP地址冲突导致路由震荡组网示例 DeviceADeviceBDeviceCDeviceD (2)在OSPF网络中的各个设备上每隔一秒执行一次displayospf[process-id]lsdb命令，查看每台设备的OSPF链路状态数据库（LSDB）信息。 (3)检查是否存在LSA老化异常的情况。同时满足如下条件时，说明LSA老化异常。 a.在DeviceA上发现同一个AdvRouter通告的NetworkLSA（Type-2）的老化时间（Age）非自然增长，一直为最小值，且Sequence字段增加很快。例如在如下显示信息中， LinkStateID为172.168.0.1的NetworkLSA的Age非自然增长，短时间内Sequence从8000002D快速增长为8000002F。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.379748800000090 Router1.1.1.11.1.1.183536800000050 Router4.4.4.44.4.4.479836800000040 Router10.1.1.110.1.1.141536800000070 Router2.2.2.22.2.2.241548800000150 Network192.168.0.23.3.3.380232800000020 Network172.168.0.34.4.4.479132800000020 Network172.168.0.110.1.1.17328000002D0 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.381048800000090 Router1.1.1.11.1.1.184836800000050 Router4.4.4.44.4.4.481136800000040 Router10.1.1.110.1.1.142836800000070 Router2.2.2.22.2.2.242848800000150 Network192.168.0.23.3.3.381532800000020 Network172.168.0.34.4.4.480432800000020 Network172.168.0.110.1.1.14328000002F0 b.在DeviceB上相同NetworkLSA的Age不断在3600和其他较小值之间切换，而且 Sequence字段增加很快。例如在如下显示信息中，LinkStateID为172.168.0.1的 NetworkLSA的Age在3600和其他较小值之间切换，短时间内Sequence从80000023快速增长为80000041。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID2.2.2.2LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.370848800000090 Router1.1.1.11.1.1.174636800000050 Router4.4.4.44.4.4.470936800000040 Router10.1.1.110.1.1.132936800000070Router2.2.2.22.2.2.232748800000150Network172.168.0.34.4.4.470232800000020 Network192.168.0.23.3.3.371332800000020 Network172.168.0.110.1.1.1360032800000230 <Sysname>displayospf100lsdb OSPFProcess100withRouterID2.2.2.2LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.374848800000090 Router1.1.1.11.1.1.178636800000050 Router4.4.4.44.4.4.474936800000040 Router10.1.1.110.1.1.136936800000070 Router2.2.2.22.2.2.236748800000150 Network172.168.0.34.4.4.474232800000020 Network192.168.0.23.3.3.375332800000020 Network172.168.0.110.1.1.1732800000410 c.在DeviceC上，相同NetworkLSA的Age一直为3600，或者偶尔没有这条LSA，而且 Sequence字段增加很快。例如在如下显示信息中，LinkStateID为172.168.0.1的NetworkLSA的Age为3600，或者偶尔没有这条LSA；存在这条LSA时，短时间内Sequence从 80000309增长到80000346。 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.3740488000000D0Router4.4.4.44.4.4.475936800000080Router10.1.1.110.1.1.1364368000000B0 Router2.2.2.22.2.2.236648800000190 Network172.168.0.34.4.4.475532800000060 Network192.168.0.23.3.3.374432800000060 Network172.168.0.110.1.1.1360032800003090 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.3745488000000D0 Router4.4.4.44.4.4.476436800000080 Router10.1.1.110.1.1.1369368000000B0 Router2.2.2.22.2.2.237148800000190 Network172.168.0.34.4.4.476032800000060 Network192.168.0.23.3.3.374932800000060 <Sysname>displayospf100lsdb OSPFProcess100withRouterID3.3.3.3LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.31302488000000D0Router4.4.4.44.4.4.4132136800000080Router10.1.1.110.1.1.1926368000000B0 Router2.2.2.22.2.2.292848800000190Network172.168.0.34.4.4.4131732800000060 Network192.168.0.23.3.3.3130632800000060 Network172.168.0.110.1.1.1360032800003460 (4)检查是否存在OSPF路由震荡。 在DeviceB上每隔一秒执行一次displayospf[process-id]routing命令，查看路由是否震荡。 <Sysname>displayospf100routing OSPFProcess100withRouterID2.2.2.2 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.0.0/241Transit0.0.0.03.3.3.30.0.0.0 172.168.0.0/241Transit0.0.0.010.1.1.10.0.0.0 Totalnets:2 Intraarea:2Interarea:0ASE:0NSSA:0 <Sysname>displayospf100routing OSPFProcess100withRouterID2.2.2.2 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.0.0/241Transit0.0.0.03.3.3.30.0.0.0 172.168.0.0/242Transit192.168.0.24.4.4.40.0.0.0 Totalnets:2 Intraarea:2Interarea:0ASE:0NSSA:0 当OSPF路由发生震荡，且多次执行displayospfpeer命令发现邻居关系没有发生震荡时，可以判断该OSPF组网中存在IP地址冲突。同时，由于NetworkLSA（Type-2）是由DR发布的，说明产生冲突的设备中有一台设备是DR。 如果任一台设备上出现两个LinkStateID相同的NetworkLSA，并且这两个NetworkLSA老化异常。说明产生冲突的设备均为DR。<Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.336748800000210 Router4.4.4.44.4.4.436936800000130 Router10.1.1.110.1.1.147736800000120 Router2.2.2.22.2.2.2403488000002B0 Network192.168.0.12.2.2.239532800000020 Network172.168.0.13.3.3.33600328000002B0 Network172.168.0.110.1.1.1932800000360 <Sysname>displayospf100lsdb OSPFProcess100withRouterID10.1.1.1 LinkStateDatabase Area:0.0.0.0 TypeLinkStateIDAdvRouterAgeLenSequenceMetric Router3.3.3.33.3.3.346048800000210 Router4.4.4.44.4.4.446236800000130 Router10.1.1.110.1.1.157036800000120 Router2.2.2.22.2.2.2496488000002B0 Network192.168.0.12.2.2.248832800000020 Network172.168.0.13.3.3.3360032800000340 Network172.168.0.110.1.1.1632800000410 (5)定位产生冲突的设备。结合displayospflsdb的显示信息，找到产生IP地址冲突的设备。 产生冲突的设备中，仅有一台设备为DR。 根据异常NetworkLSA的AdvRouter，可以找到产生该NetworkLSA的DR设备；然后根据NetworkLSA中的LinkStateID找到产生IP地址冲突的接口，确定该接口的IP地址。 根据接口的IP地址以及网络IP地址规划，找到另外一台产生冲突的设备。 在本例中，可以判断RouterID为10.1.1.1的DR设备接口IP地址与其他设备接口IP地址冲突，产生冲突的IP地址是172.168.0.1。然后根据网络IP地址规划，找到与DR设备接口IP地址冲突的另外一台设备。 产生冲突的设备均为DR。 根据异常NetworkLSA的AdvRouter，可以找到产生该NetworkLSA的DR设备；然后根据NetworkLSA中的LinkStateID找到产生IP地址冲突的接口。 (6)根据网络IP地址规划修改冲突一方的IP地址。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 3.告警与日志相关告警无 相关日志 无 11组播类故障处理 11.1MSDP故障处理 11.1.1MSDP对等体无法正确建立（S，G）表项 
PE间无法交换VPNv4或VPNv6路由。 ,本类故障的常见原因主要包括：•公网IGP路由未发布 •公网LSP不存在 •BGP对等体未建立 •未学习到VPNv4或VPNv6路由 3.故障分析 本类故障的诊断流程如图97所示。 图97PE间无法交换私网路由故障诊断流程图 4.处理步骤(1)检查IGP路由是否存在。 执行displayiprouting-table命令，查看是否存在到达对端PE的Loopback接口的网段路由： <Sysname>displayiprouting-table1.1.1.1 Summarycount:1Destination/MaskProtoPreCostNextHopInterface ,Suggestion not provided
PE设备发布的MVPN路由、VPNv4/VPNv6路由、BGPL2VPN信息、VPNFlowspec路由以及EVPN路由无法通过路由反射器反射给远端PE。 ,路由反射器缺省会对MVPN路由、VPNv4/VPNv6路由、BGPL2VPN信息、VPNFlowspec路由以及EVPN路由进行VPN-Target过滤，即只将ExportRouteTarget属性与本地ImportRouteTarget属性匹配的路由信息加入到路由表。路由反射器上不存在与接收路由匹配的RouteTarget时，接收到的路由将被丢弃，导致无法转发该路由信息给远端PE。 3.故障分析 关闭路由反射器的VPN-Target过滤功能，可以解决本类故障，本故障的处理流程如图100所示。 图100路由反射器进行VPN-Target过滤导致PE无法学习到路由故障处理流程 4.处理步骤 (2)检查对应地址族配置，确保配置了undopolicyvpn-target命令： a.在BGP实例视图下，执行displaythis命令，查看在各地址族视图下是否存在undopolicyvpn-target配置。如果不存在，请执行步骤b；如果存在，请执行步骤（2）。 b.进入相应的地址族视图，通过undopolicyvpn-target命令关闭VPN-Target过滤，使得路由反射器可以转发RT不匹配的路由信息。如果故障仍不能排除，请执行步骤（2）。 (3)请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 12.3.6PE的私网IP路由表中没有远端PE发布的路由 ,Suggestion not provided
PIM-SM网络中RPT无法正常转发数据，组播流量不通。 ,本类故障的常见原因主要包括： •PIM-SM域内组播设备到RP的单播路由不通。 •PIM-SM域内各组播设备上为某一组播组服务配置的RP地址不一致。 •PIM-SM域内组播设备的下游接口没有收到PIM加入报文。 •PIM-SM域内组播设备上的接口没有开启PIM-SM。 •PIM-SM域内组播设备到RP的RPF路由不正确。 •配置不正确（比如组播转发边界配置不正确、组播数据过滤器配置不正确等）。 3.故障分析 本类故障的诊断流程如图86所示。 图86PIM-SM网络中RPT无法正常转发数据故障诊断流程图 4.处理步骤 (1)检查PIM路由表中是否存在正确的（*，G）表项。 在设备上执行displaypimrouting-table命令，查看PIM路由表中是否存在正确的（*， G）表项。请检查下游接口列表中，是否包含到达所有连接（*，G）组成员的下游接口。 如果PIM路由表中的（*，G）表项存在且信息完全正确，则建议每隔15秒执行一次 displaymulticastforwarding-table命令，查看组播转发表中是否存在与（*，G）表项相同组播组的（S，G）表项，同时查看（S，G）表项匹配的报文数量是否保持增长。如果转发表中不存在（S，G）表项或（S，G）表项匹配的报文数量停止增长，则表示上游设备转发给此设备的组播数据不正常。此时，需要判断当前设备是否为RP： −如果不是，则表示当前设备没有收到组播数据，故障可能出在上游设备，请检查上游设备的PIM路由表中是否存在正确的（S，G）表项。 −如果是，则表示RPT已成功建立，但由于某种原因（例如源DR没有注册成功）导致 RP未收到组播源发出的组播数据。此时，需要寻求技术支持排除故障。 如果PIM路由表中不存在正确的（*，G）表项，请执行步骤(2)。 (2)检查连接下游设备的接口是否收到PIM加入报文。 联系技术支持，在专业人士的指导下使用抓包工具（例如Wireshark）在设备连接下游设备的接口上进行抓包，查看连接下游设备接口是否收到PIM加入/剪枝报文。 如果没有收到PIM加入/剪枝报文，则在下游设备连接本设备的接口上，使用抓包工具（例如Wireshark）进行抓包，查看是否发送PIM加入/剪枝报文给本设备。如果下游设备没有发送PIM加入/剪枝报文，则表示下游设备存在问题，请排查下游设备故障。如果下游设备已经发送PIM加入/剪枝报文，但是本设备没有收到，则表示与本设备之间PIM邻居通信有问题，请执行步骤(10)。 如果连接下游设备接口收到了PIM加入/剪枝报文，请执行步骤(3)。 (3)检查接口是否开启PIM-SM。 在当前设备上执行displaypiminterfaceverbose命令，查看接口上的PIM信息。a.重点查看到达RP的RPF邻居接口、到达RP的RPF接口和直连用户主机网段的接口（接收者侧DR的下游接口）上的PIM相关配置信息。如果这些接口上没有开启PIM-SM，请通过pimsm命令开启。同时，检查设备上是否使能IP组播路由（通过multicast routing命令配置）、PIM邻居是否建立成功（通过displaypimneighbor命令查 看）。 b.如果设备上述重点查看的接口都开启了PIM-SM，请执行步骤(4)。 (4)检查RP信息是否正确。 在设备上执行displaypimrp-info命令，查看设备上是否生成了为某个组播组服务的 RP信息表项，并检查PIM-SM域中其它所有设备上，为此组播组服务的RP信息是否配置一致。 如果不一致，且PIM-SM网络中使用静态RP，请在PIM-SM域的所有设备上的PIM视图下执行static-rp命令，将为某组播组服务的RP地址配置为相同的地址；如果PIM-SM网络中使用动态RP，请执行步骤(10)。 如果一致，请执行步骤11.2.24.(6)。 (5)检查是否存在到达RP的RPF路由。 在设备上执行displaymulticastrpf-info命令，查看是否存在到达RP的RPF路由。 如果不存在，检查单播路由配置。请在当前设备和RP上分别执行ping命令，检查是否能够互相ping通。如果ping不通，请修改单播路由配置，直到ping通为止。 如果存在，通过执行displaymulticastrpf-info命令，查看显示信息中的 Referencedroutetype字段，确认RPF为组播静态路由还是单播路由。 −如果RPF路由为组播静态路由，请执行displaymulticastrouting-table static命令查看组播静态路由配置是否合理。 −如果RPF路由为单播路由，请执行displayiprouting-table命令查看单播路 由是否与RPF路由一致。 如果到达RP的RPF路由存在且配置合理，请执行步骤(6)。 (6)检查转发组播数据的接口对应的DR是否为接收者侧DR。 在设备上执行displaypiminterface命令，查看转发组播数据的接口对应的DR是否为接收者侧DR。判断方法为查看显示信息中DR-Address字段是否携带local标记，如果携带，则为接收者侧DR。 如果不是接收者侧DR，请根据显示信息中的DR地址找到对应的DR设备，并在该DR设备上执行步骤(7)。 如果是接收者侧DR，请在当前设备上执行步骤(7)。 (7)检查RPF接口和RPF邻居接口上是否配置组播转发边界。 在设备上执行displaymulticastboundary命令，查看接口上是否配置了组播转发边 配置，建议在接口上执行undomulticastboundary命令删除对应配置或重新进行网络规划，确保RPF接口和RPF邻居接口没有配置组播边界。 如果未配置，请执行步骤(8)。 (8)检查是否配置组播数据过滤器。 在PIM视图下执行displaythis命令，查看是否配置组播数据过滤器（通过PIM视图下的source-policy命令配置）。 如果已配置，继续确认接收到的组播数据是否在过滤器指定的允许范围之内。如果不在，建议根据实际组网需要执行undosource-policy命令删除该配置或重新配置ACL规 则，确保用户需要的组播数据正常转发。 如果未配置，请执行步骤(9)。 (9)再次检查PIM路由表是否存在正确的（*，G）表项。 在设备上再次执行displaypimrouting-table命令，查看PIM路由表中是否存在（*， G）表项。具体方法请参见步骤(1)。 (10)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 11.3三层组播故障处理 11.3.1三层组播业务不通 ,Suggestion not provided
PIM邻居Down。 ,本类故障的常见原因主要包括： •接口物理状态为Down。 •接口上未配置主IP地址。 •接口上PIM功能没有生效。 •接口没有使能PIM。 •接口上PIM相关配置不正确。 3.故障分析 本类故障的诊断流程如图82所示。 图82PIM邻居Down的故障诊断流程图 4.处理步骤 (1)检查接口的物理状态是否为Up。 请在设备上执行displayinterfaceinterface-typeinterface-number命令查看 显示信息中的“Currentstate”字段，确认接口的物理状态是否为Up。 a.如果为Up，请执行步骤(2)。 b.如果为Down，请排查处理接口物理Down的问题。 (2)检查接口上是否配置了主IP地址。 在设备直连用户主机网段接口的接口视图下执行displaythis命令，查看是否通过ipaddress命令配置了接口的主IP地址。 a.如果没有配置，请在接口上通过ipaddress命令进行配置。 b.如果已配置，请执行步骤(3)。 (3)检查接口是否使能PIM。 在设备上执行displaycurrent-configurationinterface命令，查看接口上是否 使能PIM。 a.如果没有使能，请在接口视图下执行pimdm或pimsm命令开启PIM功能。 b.如果已使能，请执行步骤(4)。 (4)检查接口PIM功能是否生效。 在设备上执行displaypiminterface命令，通过查看显示信息中是否存在该接口对应的PIM相关信息确认接口上PIM功能是否生效。 a.如果没有生效，请在设备上执行displaycurrent-configuration|include multicast命令，查看是否开启IP组播路由功能。 −如果没有开启，请在系统视图下执行multicastrouting命令开启IP组播路由功能。 −如果已开启，请执行步骤(5)。b.如果已生效，请执行步骤(5)。 (5)检查接口上PIM相关配置是否正确。 在接口上因配置错误导致无法建立PIM邻居的常见原因如下： 直连接口的IP地址有没有配置在同一网段内，请将需要建立PIM邻居的设备直连口的IP 接口上通过pimneighb(地址配置在同一网段内。)or-policy命令配置了Hello报文过滤器，但PIM邻居IP地址不在ACL的permit规则中，接口发送的Hello报文被当作非法报文过滤掉，从而建立邻居失败。请确认是否需要配置Hello报文过滤器： −如果需要，请修改ACL配置，使得PIM邻居的IP地址在ACL的permit规则中。 −如果不需要，请执行undopimneighbor-policy命令删除对Hello报文的过滤规 接口上通(则。)过pimrequire-genid命令配置了拒绝无GenerationID的Hello报文功能，而PIM邻居发送的Hello报文中未携带GenerationID，导致PIM邻居无法建立。请确认是否需要配置拒绝无GenerationID的Hello报文功能： −如果需要，请执行步骤(6)。 −如果不需要，请在设备上执行undopimrequire-genid命令删除此配置。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 11.2.2PIM域内三层组播流量不通 ,Suggestion not provided
PoE供电功率不足或无法供电。 ,•光模块未插紧。 •光模块/设备故障。 3.故障分析 本类故障的诊断流程如图28所示。 图28故障诊断流程图 4.处理步骤 (1)检查光模块是否完全插入光口。 可通过插紧光模块，或更换光口解决。 (2)检查光模块是否故障。 可通过使用相同型号光模块插在本设备端口或者其他正常运行且支持该光模块的设备上来判断。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的告警信息。 5.告警与日志相关告警无 相关日志无 3.8PoE供电故障 3.8.1PoE供电异常 •供电电源与设备不匹配或供电电源供电能力不足。 •PSE固件故障。 •受电设备为非标准PD，PoE接口没有开启非标准PD检测功能。 3.故障分析 本类故障的诊断流程如图29所示。 图29故障诊断流程图 4.处理步骤 (1)确定电源配备是否正确。检查设备配备的电源模块对于PoE设备，必须按照电源配置方案配置电源。关于电源模块的适配情况，请参见对应产品的安装指导或硬件描述手册。 (2)查看PSE固件运行是否正常。执行displaypoedevice命令查看显示PSE的工作状态。如果工作状态显示为faulty，则说明PSE故障。如下所示： <Sysname>displaypoedevice Slot1: PSEIDSlotNo.SSlotNo.PortNumMaxPower(W)StateModel 100480FaultyLSP1POEA以上显示信息说明该PSE存在故障。用户可联系H3C用服或设备供应商获取对应版本的PSE固件，然后使用poeupdate命令升级PSE固件。升级方法如下所示： <Sysname>system-view [Sysname]poeupdatefullPOE-168.binpse4 ThiscommandwillrefreshthePSEfirmware.Continue?[Y/N]:y …… 以上显示信息说明PSE软件升级成功。再次执行displaypoedevice命令查看显示PSE的工作状 态。如果工作状态显示为on或off，则说明PSE故障已修复。如下所示： [Sysname]displaypoedevice Slot1: PSEIDSlotNo.SSlotNo.PortNumMaxPower(W)StateModel 100480onLSP1POEA (3)在任意视图中执行displaypoepse命令查看显示PSE的信息。确认当前整机供电功率、平均功率、峰值功率是否正常、PSE检测非标准PD功能是否打开等。如下所示： <Sysname>displaypoepse PSEID:1 SlotNO.:0 PSEModel:LSBMPOEGV48TP PSEStatus:EnabledPSEPreempted:No PowerPriority:Low CurrentPower:130WAveragePower:20WPeakPower:240WMaxPower:200W RemainingGuaranteedPower:120W PSECPLDVersion:100 PSESoftwareVersion:200 PSEHardwareVersion:100 LegacyPDDetection:Disabled PowerUtilizationThreshold:80 PSEPowerPolicy:Disabled PDPowerPolicy:Disabled PDDisconnect-DetectionMode:DC •如果PSE当前供电功率、PSE平均功率、PSE峰值功率都达到或接近PSE最大供电功率，说明PoE电源模块供电不足，此时请选配更大供电功率的PoE电源模块。 •如果PSELegacyPDDetection字段显示为Disable，请执行poelegacyenable命令， (4)在任意视图中执行displa(开启非标准PD检测功能。)ypoeinterface命令查看显示PoE端口的相关信息。确认当前端口供电功率、平均功率、峰值功率是否正常，端口的电流、电压是否正常。如下所示： <Sysname>displaypoeinterfacegigabitethernet1/0/1 PoEStatus:Enabled PowerPriority:Critical Oper:On IEEEClass:1 DetectionStatus:Deliveringpower PowerMode:Signal CurrentPower:11592mWAveragePower:11610mWPeakPower:11684mWMaxPower:15400mW ElectricCurrent:244mAVoltage:51.7V PDDescription:IPPhoneForRoom101 如果当前端口供电功率、平均功率、峰值功率都达到或接近端口最大供电功率，说明PoE端口供电不足，此时请执行poemax-power命令重新配置PoE端口的最大供电功率。 (5)如果故障仍然未能排除： 当受电设备为标准PD时，请收集上述步骤的执行结果，并联系技术支持人员。 当受电设备为非标准PD时，请收集PD厂家、型号、所用网线和上述步骤的执行结果等信息，并联系技术支持人员。 5.告警与日志相关告警无 相关日志无 3.8.2外置PoE电源异常断电 ,Suggestion not provided
Portal用户认证失败或者认证异常,"本类故障的常见原因主要包括： •设备上Portal服务器视图下配置的共享密钥和Portal认证服务器上配置的不一致。 •设备上Portal服务器视图下配置的Portal认证服务器地址不存在。 •Portal报文非法。 •Portal用户使用的认证域配置错误。 •RADIUS视图下配置共享密钥与RADIUS服务器上配置的不一致。 •获取用户物理信息失败。 •RADIUS服务器认证拒绝。 •RADIUS服务器无响应。 •授权ACL或者UserProfile下发失败。 3.故障分析 本类故障的诊断流程如图4-15所示。 图4-15Portal认证失败的故障诊断流程图 4.处理步骤 (1)检查设备上Portal服务器视图下配置的共享密钥与Portal认证服务器上配置的是否一致。如图4-16所示，以iMC服务器为例，当输入“用户名”和“账号密码”，点击“上线”后登录界面上出现“向设备发送请求超时”的提示，表示设备上Portal服务器视图下配置的共享密钥有可能与服务器上配置的不一致。 图4-16Portal登录界面打印错误提示 lerror命令，打开Portal错误调试信息开关。如果 设备上打印如下信息，则可以确认设备和Portal服务器配置的共享密钥不一致。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Packetvaliditycheckfailedduetoinvalidkey. 通过displayportalauth-error-record命令查看用户Portal认证异常记录中的 Autherrorreason字段是否显示为“Packetvaliditycheckfailedduetoinvalidauthenticator”。 如果确认不一致，请修改设备上Portal服务器视图下配置的共享密钥或者Portal认证服务器上配置的共享密钥，使其两者保持一致。 (2)检查设备上Portal服务器视图下配置的Portal认证服务器地址是否存在。 当设备收到Portal服务器发送的认证报文时，设备会校验报文的源IP地址是否在设备上已配置的Portal认证服务器地址列表中。如果不在，则认为认证报文是非法报文，会将它丢弃。如图4-17所示，以iMC服务器为例，当输入“用户名”和“账号密码”，点击“上线”后登录界面上出现“向设备发送请求超时”的提示，表示设备上Portal服务器视图下配置的Portal认证服务器地址可能不存在。 图4-17Portal登录界面打印错误提示 lerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认设备上配置的Portal认证服务器IP地址错误。 *Jul2819:15:10:6652021SysnamePORTAL/7/ERROR:-MDC=1;Packetsourceunknown.ServerIP:192.168.161.188,VRFIndex:0. 通过displayportalauth-error-record命令查看用户Portal认证异常记录，查 看Autherrorreason字段中是否显示为“Packetsourceunknown.ServerIP:X.X.X.X,VRFindex:0”。 如果确认不正确，请在设备的Portal服务器视图下，执行ip命令修改Portal服务器的IP地址。 (3)检查Portal报文是否非法。设备收到Portal服务器发送的Portal协议报文后，会对报文做合法性校验。如果报文长度不对、报文校验段错误，则该报文将被视为非法报文而丢弃。 查看是否存在非法报文计数增长，如果存在，可通过在设备上执行debuggingportalerror命令，打开Portal错误调 通过displayportalau(试信息开关排查具体原因。)th-error-record命令查看用户Portal认证异常记录，查 看Autherrorreason字段是否显示为“Packettypeinvalid”或者“Packetvaliditycheckfailedbecausepacketlengthandversiondon'tmatch”。 如果Portal协议报文非法，请确认报文非法的原因并进行修改，使Portal协议报文成为合法报文。 (4)检查Portal用户使用的认证域配置。 Portal用户将按照如下先后顺序选择认证域：接口或无线服务模板上指定的Portal用户使用的ISP域-->用户名中携带的ISP域-->系统缺省的ISP域。如果根据以上原则决定的认证域在设备上不存在，且设备上为未知域名的用户指定了此不存在的ISP域，将会导致用户将无法认证。 通过displayportal命令查看认证接口上是否引用了认证域。 如果引用了认证域，确认设备上是否存在该认证域以及该域下的认证、授权、计费方案是否配置准确。 如果没有引用认证域，请检查用户名中携带的域是否存在，如果不存在，请检查是否存在缺省认证域并确认缺省域下配置是否正确。 如图4-18所示，以iMC为例，当输入“用户名”和“账号密码”，点击“上线”后登录界面上出现“设备拒绝请求”的提示，表示设备上认证域可能配置不正确。 图4-18Portal登录界面打印错误提示 lerror命令，打开Portal错误调试信息开关。如果 设备上打印如下信息，则可能是设备上认证域配置错误，需要进一步排查。 *Jul2819:49:12:7252021SysnamePORTAL/7/ERROR:-MDC=1;User-SM[21.0.0.21]:AAAprocessedauthenticationrequestandreturnederror. 通过displayportalauth-fail-record命令查看Autherrorreason字段是否显示为“AAAauthenticationfailed”或“AAAreturnedanerror”。 如果认证域配置不正确，请执行相应的命令将Portal用户使用的认证域配置修改正确。 (5)检查RADIUS视图下配置共享密钥是否与RADIUS服务器上配置的一致。 如图4-19所示，以iMC服务器为例，当输入“用户名”和“账号密码”，点击“上线”后登录界面上出现“向设备发送请求超时”的提示，表示RADIUS视图下共享密钥和服务器上配置的不一致。 图4-19Portal登录界面打印错误提示 在设备上执行debuggingradiuserror命令，打开RADIUS错误调试信息开关。如果设备上打印如下信息，则可以确认设备上RADIUS视图下配置共享密钥和RADIUS服务器上配置的不一致。 *Jul2819:49:12:7252021SysnameRADIUS/7/ERROR:-MDC=1;TheresponsepackethasaninvalidResponseAuthenticatorvalue. 当设备向RADIUS服务器发起认证请求时，服务器会首先对请求报文使用共享密钥进行校验，如果校验失败，服务器会通知设备校验失败。如果共享密钥配置错误，请将RADIUS视图下共享密钥和服务器上配置的保持一致。 (6)检查是否获取用户物理信息失败。用户上线过程中Portal会查找用户物理信息，并根据对应的物理信息确定用户所在的接口等信息。如果查找物理信息失败，则用户会上线失败。 portalevent命令，打开Portal事件调试信息开关。如果设备上打印如下信息，表示获取用户物理信息失败。 *Jul2819:49:12:7252021SysnamePORTAL/7/ERROR:-MDC=1;User-SM[21.0.0.21]:Failedtofindphysicalinfoforack_info. 通过displayportalauth-error-record或者displayportalauth-fail-record命令查看Autherrorreason字段是否显示为“Failedtoobtainuserphysicalinformation”或“Failedtogetphysicalinformation”。 确认获取用户物理信息失败后，请排查设备是否存在该认证用户的表项，如果不存在，请进一步排查具体原因。 (7)检查RADIUS服务器是否认证拒绝。 a.RADIUS服务器回应认证拒绝有多种原因，最常见的有用户名密码错误、RADIUS服务器授权策略无法匹配等。这些问题，首先需要查看服务器端的认证日志或者在设备上通过 debuggingradiuserror命令打开RADIUS错误调试信息开关查看相关的Debug信b.息找到根本原yportalauth-fail-record执行命令，(因后，再调整服务器、终端或设备配置。displa)通过查看显示信息中的Autherrorreason字段确认用户Portal认证失败原因。 (8)检查RADIUS服务器是否无响应。 段查看服务器状态。如果为Blocked，则表示服务器不可用。 查看设备是否打印如下日志： RADIUS/4/RADIUS_AUTH_SERVER_DOWN:-MDC=1;RADIUSauthenticationserverwasblocked:serverIP=192.168.161.188,port=1812,VPNinstance=public. 在设备上执行debuggingradiusevent命令打开RADIUS事件调试信息开关，如果设备上打印如下信息，表示RADIUS服务器无回应。 *Jul2819:49:12:7252021SysnameRADIUS/7/evnet:-MDC=1;Reachedthemaximumretries. 确认RADIUS服务器无响应后，可根据如下步骤进行处理：a.确认服务器是否添加了设备IP地址。 −如果没有添加，请添加正确的设备IP地址。如果已经添加，那么需要确定服务器添加的设备IP地址与认证请求的源IP地址是否一致（设备默认出接口的IP地址作为向RADIUS服务器发送RADIUS报文时使用的源IP地址）。 −如果已添加，则需确认服务器上添加的设备IP地址必须为认证请求的源IP地址。 b.确认设备和服务器上同时获取报文确认中间链路是否存在问题，例如中间网络存在防火墙，防火墙未放通RADIUS（默认认证端口：1812）报文。如果出现大量用户无法认证，设备上的日志里出现RADIUS服务器Down记录，那么大概率是服务器或中间网络出现异常，需要逐一排查。 (9)检查是否授权ACL或者UserProfile下发失败。 如果设备上开启了Portal的授权信息严格检查模式，当认证服务器下发的授权ACL、UserProfile在设备上不存在或者设备下发UserProfile失败时，设备将强制Portal用户下线。 a.通过查看displayportal命令的Strictchecking字段确认设备上是否开启了严格检查，再根据用户需求判断是否需要开启。如果不需要，直接关闭。如果需要，请执行步骤b。 b.通过在设备上执行displayacl或者displayuser-profile命令，确认AAA服务 器是否授权了不存在的ACL或者UserProfile。如果不存在，请确认服务器是否需要授权或者在设备上增加相应的ACL或UserProfile配置。 (10)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 、displayportalauth-fail-record 收集信息。 Portal服务器上Portal相关配置截图。 设备与AAA服务器间的抓包文件。 调试信息。 5.告警与日志相关告警无 相关日志 •RADIUS/4/RADIUS_AUTH_SERVER_DOWN 4.10.3Portal认证用户掉线 Portal用户上线一段时间后掉线。 ",Suggestion not provided
PW处于Up状态时两个PE间报文转发失败。 ,本类故障的常见原因主要包括： •MAC地址表达到允许VSI学习到的最大MAC地址数，并且配置当VSI学习到的MAC地址数达到最大值后，禁止转发源MAC地址不在MAC地址表里的报文，即丢弃该报文。 •PW信息没有下发到转发模块。 3.故障分析 本类故障的诊断流程如图111所示。 图111PW处于Up状态时两个PE间报文转发失败故障诊断流程图 4.处理步骤 (1)执行displayl2vpnmac-address命令，查看是否存在相应的MAC地址表项和学习的 MAC地址表项总数。可以通过指定具体的AC接口和PW信息，来显示从指定AC和PW上学习的MAC地址表项总数。 查看所有L2VPNMAC地址表项信息。 <Sysname>displayl2vpnmac-address *-TheoutputinterfaceisissuedtoanotherVSI MACAddressStateVSINameLinkID/NameAging0000-0000-000aDynamicvpn1GE1/0/1Aging 0000-0000-0009Dynamicvpn1GE1/0/1Aging---2macaddress(es)found--- #显示L2VPNMAC地址表项总数。 <Sysname>displayl2vpnmac-addresscount 2macaddress(es)found (2)查看是否配置了允许学习到的最大MAC地址数，及达到最大MAC地址数后的转发。 在VSI视图下执行displaythis命令，查看当前VSI下是否配置了mac-tablelimit命令和mac-tablelimitdrop-unknown命令，如果配置了上述命令且当前已经学习到的MAC地址已经达到最大值，则需要将允许VSI学习到的最大MAC地址数调大或删除 mac-tablelimitdrop-unknown命令。（不支持mac-tablelimit和mac-tablelimitdrop-unknown命令的产品请忽略此步骤） 在AC和PW视图下执行displaythis命令，查看当前视图下是否配置了mac-limit命令，如果配置了该述命令且当前已经学习到的MAC地址已经达到最大值，则需要将允 许学习到的最大MAC地址数调大或删除actiondiscard参数。（不支持mac-limit (3)执行displayl2vpnforwa(命令的产品请忽略此步骤）)rdingpwverbose命令，查看PW是否存在转发信息，即承载PW的隧道对应的NHLFE表项索引列表（TunnelNHLFEIDs）。 如果存在转发信息，请执行步骤(5)。 如果不存在转发信息，请执行步骤(4)。 <Sysname>displayl2vpnforwardingpwverbose VSIName:aaaLinkID:8 PWType:VLANPWState:Up InLabel:1272OutLabel:1275 MTU:1500PWAttributes:Main VCCVCC:Router-Alert VCCVBFD:FaultDetectionwithBFD FlowLabel:Send TunnelGroupID:0x960000000 TunnelNHLFEIDs:1034 MAClimit:maximum=2000alarm=enabledaction=discard (4)执行displaymplslsp命令，查看是否存在承载PW的隧道，即是否存在FEC为PW对端IP地址的LSP，若不存在，则需要先完成承载PW的隧道的建立。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 100.100.100.100/24LDP-/1049GE1/0/1 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警 无 相关日志 •L2VPN/4/L2VPN_MACLIMIT_MAX_AC •L2VPN/4/L2VPN_MACLIMIT_MAX_PW•L2VPN/4/L2VPN_MACLIMIT_MAX_VSI 12.6.4LDPPW不能Up ,Suggestion not provided
PW两端的PE设备中只有一个PE上的VSI处于Up状态。 ,•VSI下至少有一个PWUp和一个ACup。 •VSI下至少有两个ACUp。因此本类故障的常见原因为：Up的VSI上虽然PWdown，但是存在两个Up的AC；Down的VSI上PWdown，且无两个Up的AC。 3.故障分析 本类故障的诊断思路为：检查状态为Down的VSI下的AC和PW的状态。 4.处理步骤 (1)执行displayl2vpnvsi命令，查看VSI下AC和PW的状态。 <Sysname>displayl2vpnvsiverbose VSIName:vpls1 VSIIndex:0 VSIDescription:vsiforvpls1 VSIState:DownMTU:1500 Bandwidth:- BroadcastRestrain:- MulticastRestrain:- UnknownUnicastRestrain:- MACLearning:EnabledMACTableLimit:- MACLearningrate:- DropUnknown:- PWRedundancy:Master Flooding:Enabled Statistics:DisabledVXLANID:- LDPPWs: PeerPWIDLinkIDState192.3.3.318Down ACs: ACLinkIDStateType GE1/0/3srv11UpManual (2)执行displayl2vpnpwverbose命令，查看PW状态变为Down的原因。 <Sysname>displayl2vpnpwverbose VSIName:aaa Peer:2.2.2.9RemoteSite:2 SignalingProtocol:BGP LinkID:9PWState:Down InLabel:1420OutLabel:1419 MTU:1500 PWAttributes:Main VCCVCC:- VCCVBFD:- FlowLabel:Send ControlWord:Disabled TunnelGroupID:0x800000960000000 TunnelNHLFEIDs:1038 AdminPW:-E-TreeMode:- E-TreeRole:root RootVLAN:- LeafVLAN:- DownReasons:Controlwordnotmatch 常见的故障原因及处理方法如下： BFDsessionforPWdown：用来检测PW的BFD会话状态为down，此类故障的处理方式为，通过displaybfdsession命令查看BFD状态为down的原因，检查并修改BFD配置或检查物理链路是否存在链路故障、链路质量问题。 BGPRDwasdeleted：BGP的RD被删除，此类故障的处理方式为，在交叉连接组自动发现视图下配置route-distinguisherroute-distinguisher命令。 BGPRDwasempty：未配置BGP的RD，此类故障的处理方式为，在交叉连接组自动发现视图下配置route-distinguisherroute-distinguisher命令。 Controlwordnotmatch：PW两端控制字功能配置不一致，此类故障的处理方式为，将PW两端引用的PW模板下的控制字功能（通过control-wordenable命令开启）配置一致。（不支持control-wordenable命令的产品请忽略此步骤） Encapsulationnotmatch：PW两端封装类型不一致，此类故障的处理方式为，将PW两端引用的PW模板下的PW数据封装类型（通过pw-type命令配置）配置一致。（不支持pw-type命令的产品请忽略此步骤） LDPinterfaceparameternotmatch：PW两端接口LDP协商参数不一致，此类故障的处 理方式为，将PW两端引用的PW模板下的VCCV控制通道类型（通过vccvcc命令配置）配置一致或将PW两端关联的电路仿真接口下引用的电路仿真类中的配置保持一致。 Non-existentremoteLDPPW：对端设备已删除LDPPW，此类故障的处理方式为，在对端设备上重新配置PW。 LocalACDown：本地AC状态为down，此类故障的处理方式为，检查并修改AC接口上的配置或排除AC所在的接口的故障，保障接口为Up状态。 LocalACwasnon-existent：未配置本地AC，此类故障的处理方式为，配置本地的AC并关联VSI。 MTUnotmatch：PW两端MTU不一致，此类故障的处理方式为，将PW两端的MTU配置一致或者通过mtu-negotiatedisable命令关闭PWMTU协商功能。（不支持mtu-negotiatedisable命令的产品请忽略此步骤） RemoteACDown：对端AC状态down，此类故障的处理方式为，检查并修改对端AC接口上的配置或排除AC所在的接口的故障，保障接口为Up状态。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警 无 相关日志 •L2VPN/2/L2VPN_PWSTATE_CHANGE •L2VPN/4/L2VPN_BGPVC_CONFLICT_LOCAL •L2VPN/4/L2VPN_BGPVC_CONFLICT_REMOTE •L2VPN/4/L2VPN_HARD_RESOURCE_NOENOUGH •L2VPN/2/L2VPN_HARD_RESOURCE_RESTORE •L2VPN/4/L2VPN_LABEL_DUPLICATE 12.6.2VPLS业务不通 ,Suggestion not provided
RADIUS认证服务器通过Filter-Id属性向用户下发ACL，用户认证登录后无法正常访问网络资源。 ,"本类故障的常见原因主要包括： •RADIUS下发的授权属性内容不正确。 •接入用户未获取到ACL。 •授权的ACL不存在。 3.故障分析 本类故障的诊断流程如图147所示。 图147认证登录后无法正常访问授权ACL网络资源故障诊断流程图 4.处理步骤 (1)检查RADIUS服务器下发的Filter-ID属性内容是否准确。执行debuggingradiuspacket命令打开RADIUS报文调试信息开关，同时让RADIUS服务器尝试再次下发Filter-ID属性，查看设备上打印的RADIUS报文调试信息： 如果下发的Filter-ID属性为纯数字，则表示下发了ACL编号。 *Aug1816:54:49:6702021SysnameRADIUS/7/PACKET:-MDC=1; ReceivedaRADIUSpacket ServerIP:128.11.3.48 NAS-IP:128.11.30.69 VPNinstance:--(public) Serverport:54175 Type:COArequest Length:32 PacketID:200User-Name=""user"" Filter-Id=""2001"" 如果下发的Filter-ID属性值不全为数字，且同时下发的下一个属性为H3c-ACL-Version（取值为整数1～4），则表示下发了ACL名称。 （部分设备上如果下发的Filter-ID属性值不全为数字，也不包含等号，且同时下发的下一个属性为H3c-ACL-Version（取值为整数1～4），则表示下发了ACL名称；部分设备上如果下发的Filter-ID属性值不全为数字，则表示下发了UserProfile名称，请跳过本步骤） *Aug1816:55:19:7982021SysnameRADIUS/7/PACKET:-MDC=1; ReceivedaRADIUSpacket ServerIP:128.11.3.48 NAS-IP:128.11.30.69 VPNinstance:--(public) Serverport:54176 Type:COArequest Length:48 PacketID:157 User-Name=""user"" Filter-Id=""aclname1"" H3c-ACL-Version=1 如果未下发预期取值的Filter-ID属性，或者下发的ACL类型为设备不支持的类型，请联系RADIUS服务器管理员修改授权ACL配置并尝试重新下发Filter-ID，否则继续定位。(2)检查用户是否成功获得下发的ACL信息。 执行displaydot1xconnection或displaymac-authenticationconnection 命令，查看相关在线用户信息中是否存在授权的ACL信息：如果存在授权ACL信息，说明ACL下发成功。 如果不存在授权ACL信息，说明ACL没有下发成功。此时，建议在技术支持人员的指导下，结合RADIUS调试信息继续定位故障发生的原因。 (3)检查设备上对应的ACL是否已创建。 执行displayaclall命令查看下发的ACL是否存在： 如果未创建，请在系统视图下执行aclnumberacl-number[nameacl-name]命令创建相应的ACL。 如果已创建，请确认ACL配置是否正确。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、调试信息、诊断信息。 5.告警与日志 相关告警无 相关日志无 18.2.20802.1X、MAC地址认证、Web认证用户进行RADIUS认证时逃生失败 ",Suggestion not provided
RemoteAP功能不生效，即当AC与AP间隧道断开后，出现在线终端下线和新终端无法接入的故障,报文转发位置配置在AC上，导致RemoteAP功能不生效。 3.故障分析 本类故障的诊断流程如图4-15所示。 图4-15RemoteAP功能不生效故障排查流程图 4.处理步骤 (1)检查是否开启RemoteAP功能 查看AP/AP组配置，确认在需要RemoteAP功能的AP上开启了功能。具体操作步骤为进入 AP/AP组视图，执行displaythis命令查看AP/AP组当前配置，以下文的操作为例。 <AC>system-view [AC]wlanapap1 [AC-wlan-ap-ap1]displaythis # wlanapap1modelWA5320vlan1bonjourenablehybrid-remote-apenablerfid-trackingaeroscoutenablerfid-trackingcupidenableradio1typedot11aradioenableradio2gigabitethernet1gigabitethernet2 # 如果没有在AP/AP组配置RemoteAP功能，则需要在AP/AP组视图下执行hybrid-remote-apenable命令开启RemoteAP功能。 如果AP/AP组配置了RemoteAP功能，则继续执行步骤(2)。 (2)检查报文转发位置查看终端接入的的无线服务模板配置，仅当终端数据报文的转发位置在AP上时，RemoteAP功能才会生效。具体操作步骤为进入无线服务模板视图，执行displaythis命令查看当前配置，以下文的操作为例。 <AC>system-view [AC]wlanservice-template1 [AC-wlan-st-1]displaythis # wlanservice-template1ssidservice clientforwarding-locationapakmmodepsk preshared-keypass-phrasecipher$c$3$X2Rlxl49vpJ158WfBfCMdjt0NpHVdUHApNcScipher-suiteccmpsecurity-iersnipverifysourceservice-templateenable # 如果终端数据报文转发位置为AC，则在无线服务模板视图下，通过clientforwarding-locationap命令配置数据报文转发位置为AP。 如果终端数据报文转发位置为AP，请继续执行步骤(3)。 (3)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.22开启RemoteAP功能后，新终端无法接入 ,Suggestion not provided
RemoteAP功能不生效，即当AC与AP间隧道断开后，出现在线终端下线和新终端无法接入的故障。 ,报文转发位置配置在AC上，导致RemoteAP功能不生效。 3.故障分析 本类故障的诊断流程如图4-15所示。 图4-15RemoteAP功能不生效故障排查流程图 4.处理步骤 (1)检查是否开启RemoteAP功能 查看AP/AP组配置，确认在需要RemoteAP功能的AP上开启了功能。具体操作步骤为进入 AP/AP组视图，执行displaythis命令查看AP/AP组当前配置，以下文的操作为例。 <AC>system-view [AC]wlanapap1 [AC-wlan-ap-ap1]displaythis # wlanapap1modelWA5320vlan1bonjourenablehybrid-remote-apenablerfid-trackingaeroscoutenablerfid-trackingcupidenableradio1typedot11aradioenableradio2gigabitethernet1gigabitethernet2 # 如果没有在AP/AP组配置RemoteAP功能，则需要在AP/AP组视图下执行hybrid-remote-apenable命令开启RemoteAP功能。 如果AP/AP组配置了RemoteAP功能，则继续执行步骤(2)。 (2)检查报文转发位置查看终端接入的的无线服务模板配置，仅当终端数据报文的转发位置在AP上时，RemoteAP功能才会生效。具体操作步骤为进入无线服务模板视图，执行displaythis命令查看当前配置，以下文的操作为例。 <AC>system-view [AC]wlanservice-template1 [AC-wlan-st-1]displaythis # wlanservice-template1ssidservice clientforwarding-locationapakmmodepsk preshared-keypass-phrasecipher$c$3$X2Rlxl49vpJ158WfBfCMdjt0NpHVdUHApNcScipher-suiteccmpsecurity-iersnipverifysourceservice-templateenable # 如果终端数据报文转发位置为AC，则在无线服务模板视图下，通过clientforwarding-locationap命令配置数据报文转发位置为AP。 如果终端数据报文转发位置为AP，请继续执行步骤(3)。 (3)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.22开启RemoteAP功能后，新终端无法接入 ,Suggestion not provided
VPLS使用LDP信令协议，VSI不能Up。 ,本类故障的常见原因主要包括：•PW两端封装类型不一致。 •PW两端MTU值不一致。 •LDPsession状态没有Up。 •PW没有可用的公网隧道。 •AC接口没有Up。 3.故障分析 本类故障的诊断思路为：执行displayl2vpnpwverbose命令查看PW状态变为Down的原因，根据具体原因对故障进行排查。 4.处理步骤 (1)通过displayl2vpnpwverbose命令查看PW对端的IP地址（Peer）和PW状态变为Down的原因（DownReasons）。 <Sysname>displayl2vpnpwverbose VSIName:aaa Peer:2.2.2.9VPLSID:100:100 SignalingProtocol:LDP LinkID:8PWState:DownInLabel:1553OutLabel:1553 MTU:1500 PWAttributes:Main VCCVCC:- VCCVBFD:- FlowLabel:- TunnelGroupID:0x800000960000000 TunnelNHLFEIDs:1038 AdminPW:-E-TreeMode:- E-TreeRole:root RootVLAN:- LeafVLAN:- DownReasons:Controlwordnotmatch (2)如表16所示，常见的故障原因及处理方法如下。表16常见的故障原因及处理方法 DownReasons故障描述故障处理方法 通过displaybfdsession命令查 BFDsessionforPWdown用来检测PW的BFD会话状态为down看改BFDBFD状态为配置或检查物理链路是否存在down的原因，检查并修 链路故障、链路质量问题 DownReasons故障描述故障处理方法 将PW两端引用的PW模板下的控制字 ControlwordnotPW两端控制字功能配置不一致功能（通过命令开启）配置一致（不支持control-wordenablematch control-wordenable命令的产品 请忽略此步骤）将PW两端引用的PW模板下的PW数 matchEncapsulationnotPW两端封装类型不一致据封装类型（通过配置一致（不支持pw-typepw-type命令的产品命令配置） 请忽略此步骤）将PW两端引用的PW模板下的VCCV LDPinterfacePW两端接口LDP协商参数不一致控制通道类型（通过置）配置一致或将PWvccvcc两端关联的电路命令配parameternotmatch仿真接口下引用的电路仿真类配置一 致 Non-existentremoteLDPPW对端设备已删除LDPPW在对端设备上重新配置PW LocalACDown本地AC状态为down检查并修改所在的接口的故障，保证口为AC接口上的配置或排除Up状态AC LocalACwasnon-existent未配置本地AC配置本地的AC并关联VSI 将PW两端的MTU配置一致或者通过 mtu-negotiatedisable命令关闭 MTUnotmatchPW两端MTU不一致PWMTU协商功能（不支持mtu-negotiatedisable命令的产品请忽略此步骤）检查并修改对端AC接口上的配置或排 RemoteACDown对端AC状态down除AC所在的接口的故障，保证接口为 Up状态 Labelnotallocated标签未分配请联系技术支持人员处理 请参见VPLS故障处理中的“PW两端的 LocalVSIDown本地VSI状态为downPE设备中只有一个PE上的VSI处于Up状态” LocalandremoteLDPPWshavedifferentAII本端携带的SAII与对端携带的TAII不同请参见法Up”LDP故障处理中的“LDP会话无 LocalLDPPWwasmessage本端未发送LDPmapping消息请参见法Up”LDP故障处理中的“LDP会话无 notsentmapping LocalLDPPWVirtualNexthopdefect本地LDPPW存在虚拟下一跳缺陷请参见步骤(3)(4) RemoteLDPPWVirtualNexthopdefect远端LDPPW存在虚拟下一跳缺陷请参见步骤(3)(4) TunnelDown承载PW的隧道down此类故障处理方法请参见步骤(4) (3)请通过displayl2vpnforwardingpwverbose命令查看PW是否存在转发信息，即承载PW的隧道对应的NHLFE表项索引列表（TunnelNHLFEIDs）。 如果存在转发信息，请执行步骤(5)。 如果不存在转发信息，请执行步骤(4)。 <Sysname>displayl2vpnforwardingpwverbose VSIName:aaaLinkID:8 PWType:VLANPWState:Up InLabel:1272OutLabel:1275 MTU:1500PWAttributes:Main VCCVCC:Router-Alert VCCVBFD:FaultDetectionwithBFD FlowLabel:Send TunnelGroupID:0x960000000 TunnelNHLFEIDs:1034 MAClimit:maximum=2000alarm=enabledaction=discard (4)执行displaymplslsp命令，查看是否存在承载PW的隧道，即是否存在FEC为步骤(1)中Peer地址的LSP，若不存在，则需要先完成承载PW的隧道的建立。目前支持的公网隧道类型有LSP、MPLSTE、GRE隧道等，LSP类型的公网隧道创建，请参见“MPLS”中的“静态LSP”和“LDP”；MPLSTE类型的公网隧道创建，请参见“MPLSTE”；GRE类型的公网隧道创建，请参见“三层技术-IP业务”中的“GRE”。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 100.100.100.100/24LDP-/1049GE1/0/1 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无 相关日志无 12.6.5VPLS使用LDP信令协议，VSI不能Up 满足如下任一条件，VSI即为Up状态：•VSI下至少有一个PWUp和一个ACUp。 •VSI下至少有两个ACUp。 •VSI下至少有两个PWUp（多段PW组网）。 因此本类故障的常见原因为：•VSI下Up的AC和PW的总数小于2。 •VSI下执行了shutdown命令。 3.故障分析 本类故障的诊断思路为： (1)检查VSI下是否执行了shutdown命令 (2)查看VSI下的AC、PW的状态和数量。 4.处理步骤 (1)在VSI视图下执行displaythis命令，查看当前视图是否配置了shutdown命令。 如果配置shutdown命令，请执行undoshutdown命令。 如果未配置shutdown命令，请执行步骤(2)。 (2)执行displayl2vpnvsi命令，查看VSI关联的AC、PW的状态和数量。 <Sysname>displayl2vpnvsiverbose VSIName:vpls1 VSIIndex:0 VSIDescription:vsiforvpls1 VSIState:Up MTU:1500 Bandwidth:- BroadcastRestrain:- MulticastRestrain:- UnknownUnicastRestrain:- MACLearning:Enabled MACTableLimit:-MACLearningrate:- DropUnknown:- PWRedundancy:Master Flooding:Enabled Statistics:DisabledVXLANID:- LDPPWs: PeerPWIDLinkIDState192.3.3.318Down ACs: ACLinkIDStateTypeGE1/0/3srv11UpManual 若VSI下关联的AC和PW的数量小于2，请先创建AC和PW。 若AC的状态为Down，则检查AC配置是否正确，并检查AC所在的接口是否Up。如果AC配置不正确或AC所在的接口为Down状态，请修改AC配置或排查接口故障。 若PW的状态为Down，请参见12.6.4LDPPW不能Up对故障进行处理。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 使用displaydiagnostic-information命令收集诊断信息。 5.告警与日志相关告警 无 相关日志 无 13SegmentRouting故障处理 13.1EVPNL3VPNoverSRv6故障处理 13.1.1EVPNL3VPNoverSRv6BE流量转发不通 ,Suggestion not provided
VPLS业务流量转发不通。 ,本类故障的常见原因主要包括： •AC没有Up •PW没有Up。 •PW没有生成转发信息。 •PW没有可迭代的公网隧道。 •PW迭代的公网隧道异常。 3.故障分析 本类故障的诊断思路如下： (1)查看VSI详细信息，确认VSI下至少关联了一个AC和一个PW。 (2)检查AC状态是否Up。 (3)检查PW状态是否Up。 (4)检查PW转发信息。 (5)检查PW迭代的公网隧道信息。本类故障的诊断流程如图110所示。 图110VPLS业务不通的故障诊断流程图 4.处理步骤 (1)执行displayl2vpnvsi命令，查看VSI关联的AC、PW的状态和数量。 <Sysname>displayl2vpnvsiverbose VSIName:vpls1 VSIIndex:0 VSIDescription:vsiforvpls1 VSIState:Up MTU:1500 Bandwidth:- BroadcastRestrain:- MulticastRestrain:- UnknownUnicastRestrain:- MACLearning:Enabled MACTableLimit:-MACLearningrate:- DropUnknown:- PWRedundancy:Master Flooding:Enabled Statistics:DisabledVXLANID:- LDPPWs: PeerPWIDLinkIDState192.3.3.318Down ACs: ACLinkIDStateType GE1/0/3srv11UpManual (2)若AC的状态为Down，则检查AC配置是否正确和并检查AC所在的接口是否Up。如果AC配置不正确或AC所在的接口为Down状态，请修改AC配置或排查接口故障。 (3)若PW的状态为Down，请通过displayl2vpnpwverbose命令查看PW状态变为Down的原因。 <Sysname>displayl2vpnpwverbose VSIName:aaa Peer:2.2.2.9RemoteSite:2 SignalingProtocol:BGP LinkID:9PWState:DownInLabel:1420OutLabel:1419 MTU:1500 PWAttributes:Main VCCVCC:- VCCVBFD:- FlowLabel:Send ControlWord:Disabled TunnelGroupID:0x800000960000000 TunnelNHLFEIDs:1038 AdminPW:-E-TreeMode:- E-TreeRole:root RootVLAN:- LeafVLAN:- DownReasons:Controlwordnotmatch 常见的故障原因及处理方法如下： BFDsessionforPWdown：用来检测PW的BFD会话状态为down，此类故障的处理方式为，通过displaybfdsession命令查看BFD状态为down的原因，检查并修改BFD配置或检查物理链路是否存在链路故障、链路质量问题。 BGPRDwasdeleted：BGP的RD被删除，此类故障的处理方式为，在交叉连接组自动发现视图下配置route-distinguisherroute-distinguisher命令。 BGPRDwasempty：未配置BGP的RD，此类故障的处理方式为，在交叉连接组自动发现视图下配置route-distinguisherroute-distinguisher命令。 Controlwordnotmatch：PW两端控制字功能配置不一致，此类故障的处理方式为，将PW两端引用的PW模板下的控制字功能（通过control-wordenable命令开启）配置一致。（不支持control-wordenable命令的产品请忽略此步骤） Encapsulationnotmatch：PW两端封装类型不一致，此类故障的处理方式为，将PW两端引用的PW模板下的PW数据封装类型（通过pw-type命令配置）配置一致。（不支持pw-type命令的产品请忽略此步骤） LDPinterfaceparameternotmatch：PW两端接口LDP协商参数不一致，此类故障的处理方式为，将PW两端引用的PW模板下的VCCV控制通道类型（通过vccvcc命令配置）配置一致或将PW两端关联的电路仿真接口下引用的电路仿真类中的配置保持一致。 Non-existentremoteLDPPW：对端设备已删除LDPPW，此类故障的处理方式为，在对端设备上重新配置PW。 LocalACDown：本地AC状态为down，此类故障的处理方式为，检查并修改AC接口上的配置或排除AC所在的接口的故障，保障接口为Up状态。 LocalACwasnon-existent：未配置本地AC，此类故障的处理方式为，配置本地的AC并关联VSI。 MTUnotmatch：PW两端MTU不一致，此类故障的处理方式为，将PW两端的MTU配置一致或者通过mtu-negotiatedisable命令关闭PWMTU协商功能。（不支持mtu-negotiatedisable命令的产品请忽略此步骤） RemoteACDown：对端AC状态down，此类故障的处理方式为，检查并修改对端AC接 (4)若口上的配置或排除状态，请通过ACdisplayl2vpnforwardi(AC所在的接口的故障，保障接口为Up状态。和PW均处于Up)ngpwverbose命令查看PW是否存在转发信息，即承载PW的隧道对应的NHLFE表项索引列表（TunnelNHLFE IDs）。 如果存在转发信息，请执行步骤(6)。 如果不存在转发信息，请执行步骤(5)。 <Sysname>displayl2vpnforwardingpwverbose VSIName:aaaLinkID:8 PWType:VLANPWState:Up InLabel:1272OutLabel:1275 MTU:1500PWAttributes:Main VCCVCC:Router-Alert VCCVBFD:FaultDetectionwithBFD FlowLabel:Send TunnelGroupID:0x960000000 TunnelNHLFEIDs:1034 MAClimit:maximum=2000alarm=enabledaction=discard (5)执行displaymplslsp命令，查看是否存在承载PW的隧道，即是否存在FEC为PW对端IP地址的LSP，若不存在，则需要先完成承载PW的隧道的建立。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX100.100.100.100/24LDP-/1049GE1/0/1 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警 无 相关日志 •L2VPN/2/L2VPN_PWSTATE_CHANGE •L2VPN/4/L2VPN_BGPVC_CONFLICT_LOCAL •L2VPN/4/L2VPN_BGPVC_CONFLICT_REMOTE •L2VPN/4/L2VPN_HARD_RESOURCE_NOENOUGH •L2VPN/2/L2VPN_HARD_RESOURCE_RESTORE •L2VPN/4/L2VPN_LABEL_DUPLICATE 12.6.3PW处于Up状态时两个PE间报文转发失败 ,Suggestion not provided
VTEP设备上存在MAC迁移，导致其他终端访问VM业务异常。 ,"本类故障的常见原因主要为：流量异常或者网络攻击导致学习到的VM的MAC地址表项出接口错误。 3.故障分析 本类故障的诊断思路如下： (1)查看MAC地址迁移信息。 (2)查看VM的MAC表项出接口是否正确。 4.处理步骤 (1)通过displayevpnroutemac-mobility命令查看MAC地址迁移信息。如下信息表示MAC地址1000-0000-0000从接口GE1/0/1迁移到本地。 <Sysname>displayevpnroutemac-mobilityFlags:S-Suppressed,N-Notsuppressed Suppressionthreshold:5 Detectioncycle:180s Suppressiontime:Permanent VSIname:vsiaEVPNinstance:- MACaddressMovecountMovedfromFlagsSuppressedat 1000-0000-000010GE1/0/1S15:30:302018/03/30 (2)通过displayl2vpnmac-address命令查看VM的MAC地址表项的出接口是否正确。LinkID/Name为学习到MAC地址的接口名称或隧道接口名称。 <Sysname>displayl2vpnmac-address *-TheoutputinterfaceisissuedtoanotherVSI MACAddressStateVSINameLinkID/NameAging 1000-0000-0000EVPNaaaTunnel10NotAging 52f6-bc1e-0d06DynamicvpnaGE1/0/1Aging---2macaddress(es)found--- 若出接口正确，则执行第(3)步。 若出接口不正确，则需要VM在迁移后的VTEP上重新上线，触发表项学习和更新。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无。相关日志无。 15.1.7VXLANDCI隧道未成功建立 ",Suggestion not provided
VXLANDCI隧道未成功建立。 ,•dcienable命令。 •与ED对等体之间配置的peerrouter-mac-local命令未指定dci参数。 3.故障分析 本类故障的诊断思路为：检查ED间互连的三层接口上是否开启DCI功能或与ED对等体之间配置的peerrouter-mac-local命令是否指定了dci参数。以上两个功能只需开启一个就可以在 ED之间建立VXLANDCI隧道。 4.处理步骤 (1)检查设备上是否开启了如下任何一个功能： 检查ED间互连的三层接口（三层以太网接口及其子接口、三层以太网聚合接口及其子接口、VLAN接口）上是否配置了dcienable命令。若未配置，则执行dcienable命 ED对等体之间配置的检查p(令，开启接口的DCI功能。)eerrouter-mac-local命令是否指定了dci参数。若未指定，则需要重新配置本命令并指定dci参数。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警 无。 相关日志 无。 16ACL和QoS故障处理 16.1ACL故障处理 16.1.1ACL下发失败故障 ,Suggestion not provided
VXLAN网络中，二层VXLAN业务流量不通。 ,本类故障的常见原因主要包括：•AC或VXLAN隧道未建立。 •未学习到MAC地址。 3.故障分析 本类故障的诊断流程如图121所示。 图121二层VXLAN业务流量不通的故障诊断流程图 4.处理步骤 二层VXLAN业务流量不通时，故障处理步骤如下： (1)通过displayl2vpnvsiverbose命令查看VSI关联的VXLAN隧道和AC信息。 <Sysname>displayl2vpnvsiverbose VSIName:vpna VSIIndex:0 VSIState:Up MTU:1500 Bandwidth:UnlimitedBroadcastRestrain:UnlimitedMulticastRestrain:UnlimitedUnknownUnicastRestrain:UnlimitedMACLearning:Enabled MACTableLimit:-MACLearningrate:-DropUnknown:- Flooding:Enabled Statistics:DisabledVXLANID:10 Tunnels: TunnelNameLinkIDStateTypeFloodproxy Tunnel10x5000001UpManualDisabled ACs: ACLinkIDStateTypeGE1/0/1srv10000UpManual 若AC和VXLAN隧道均为Up状态，则执行第(2)步。 若AC为Down状态，请检查并修改AC配置。 若VXLAN隧道为Down状态，请根据“15.1.1EVPN分布式网关场景，同一VXLAN内 (2)通的VTEPayl2vpnmac-address命令查看VSI的过M(之间隧道无法建立”故障处理步骤解决问题。displ)AC地址表中是否存在被访问终端的MAC地址表项和学习的MAC地址表项总数。 <Sysname>displayl2vpnmac-address *-TheoutputinterfaceisissuedtoanotherVSI MACAddressStateVSINameLinkID/NameAging 0001-0001-0001StaticaaaTunnel1NotAging 52f6-bc1e-0d06DynamicvpnaGE1/0/1Aging---3macaddress(es)found--- 若存在指定的MAC地址表项，则执行第(3)步。 若不存在指定的MAC地址表项，请在VSI视图下执行displaythis命令，查看当前 VSI下是否配置了mac-tablelimit命令和mac-tablelimitdrop-unknown命 令，如果配置了上述命令且当前已经学习到的MAC地址已经达到最大值，则需要将允许 VSI学习到的最大MAC地址数调大或删除mac-tablelimitdrop-unknown命令。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无。相关日志无。 15.1.4VXLAN网络中，三层VXLAN业务流量不通 ,Suggestion not provided
VXLAN网络中，三层VXLAN业务流量不通。 ,本类故障的常见原因主要包括： •AC或VXLAN隧道未建立。 •设备的RouteMAC配置错误。 3.故障分析 本类故障的诊断流程如图122所示。 图122三层VXLAN业务流量不通的故障诊断流程图 4.处理步骤 三层VXLAN业务流量不通时，故障处理步骤如下： (1)通过displayl2vpnvsiverbose命令查看VSI关联的VXLAN隧道和AC信息。 <Sysname>displayl2vpnvsiverbose VSIName:vpna VSIIndex:0 VSIState:Up MTU:1500 Bandwidth:UnlimitedBroadcastRestrain:UnlimitedMulticastRestrain:UnlimitedUnknownUnicastRestrain:Unlimited MACLearning:EnabledMACTableLimit:-MACLearningrate:-DropUnknown:- Flooding:Enabled Statistics:DisabledVXLANID:10 Tunnels: TunnelNameLinkIDStateTypeFloodproxy Tunnel10x5000001UpManualDisabled ACs: ACLinkIDStateTypeGE1/0/1srv10000UpManual 若AC和VXLAN隧道均为Up状态，则执行第(2)步。 若AC为Down状态，请检查并修改AC配置。 若VXLAN隧道为Down状态，请根据“15.1.2EVPN分布式网关场景，不同VXLAN内 (2)通的VTEP之间evpnrouting-table命令查看L3VNI过关(隧道无法建立”故障处理步骤解决问题。display)联的VPN实例的路由表中目的IP地址（IPaddress）为被访问终端的IP地址的路由表项的下一跳地址（Nexthop）。 <Sysname>displayevpnrouting-tablevpn-instancevpn1 Flags:E-withvalidESIA–A-DreadyL-LocalESexists VPNinstancename:vpn1LocalL3VNI:7 IPaddressNexthopOutgoinginterfaceNibIDFlags 10.1.1.111.1.1.1Vsi-interface30x18000000EAL (3)通过displayarp命令查看下一跳地址的ARP信息。 <Sysname>displayarp Type:S-StaticD-DynamicO-OpenflowR-RuleM-MultiportI-Invalid IPaddressMACaddressVLAN/VSInameInterfaceAgingType ,Suggestion not provided
WA4320E无法连接上行网络,本类故障的常见原因主要包括： •WA4320E工作模式与上行无线网络环境不匹配。 •Client模式的连接配置不正确。 •Client模式的漫游配置不正确。 •上行网络AC侧配置不正确。 3.故障分析 本类故障的诊断流程如图4-7所示。 图4-7WA4320E无法连接上行网络的故障诊断流程图 4.处理步骤 (1)查看WA4320E工作模式。 连接WA4320E的管理Wi-Fi并登录到本地WEB页面，登录信息如下： Wi-Fi名称：H3C_XXXXXX（XXXXXX为设备MAC地址的后六位）。 本地WEB页面的管理IP地址：10.40.94.1。 超级AGV模式即快速模式下，2.4G频段仅做扫描使用，不提供任何无线接入服务，只有5G频段提供管理Wi-Fi。设备缺省工作在超级AGV模式下，所以进行配置时需要终端支持5G频段。 图4-8管理Wi-Fi示例 图4-9查看工作模式 (2)确认现场无线网络环境。 AGV小车CPE设备上的工作模式分为普通AGV模式和快速AGV模式： 普通AGV模式：除了提供对外无线连接功能、接入任意第三方WLAN网络外，本身还可以向外提供无线接入服务。 快速AGV模式：只提供对外无线连接功能，但相对于普通AGV模式其漫游的性能指标更佳，适合已经部署、或计划与CPE设备一起部署H3CWLAN网络的使用场景。如果现场无线环境是第三方无线网络，只能使用普通AGV模式，无法使用快速AGV模式。 (3)检查Client模式的连接配置 a.检查普通AGV模式下的连接配置。 检查连接的对端无线网络的信息，确认配置的网络名称和密码是否正确。 图4-10检查普通AGV模式下的连接配置 b.检查快速AGV模式的连接配置。 快速AGV模式下，设备支持零配置，在零配置模式下，由于使用的射频策略与快速AGV模式相同，因此两者的漫游性能一样。区别在于2.4G频段的扫描结果新增了“5G是否加密标志位”，WA4320E在5G频段会发送报文询问网络侧提供的无线服务的接入密码，在网络侧的AC设备上开启了无线客户端智能接入功能后，网络侧的AP设备会回复携带无线服务密码的报文，待收到此报文后WA4320E解析报文并完成上线。此功能需要结合H3C WLAN网络使用并且需要在AC上进行额外的配置。 图4-11检查快速AGV模式的连接配置 (4)检查WA4320E漫游的相关配置。 表4-2漫游配置项说明 配置项说明 （5G）扫描信道配置扫描信道 信道扫描周期射频信道扫描持续的时间 决策时间间隔（仅“快速”工作方式支持）设备决定是否进行漫游的时间间隔，每隔一个决策时间间隔，设备会自动检测是否进行漫游 扫描时间间隔（仅“普通”工作方式支持）每个信道扫描所间隔的时间 配置项说明 保活时间间隔AP给上行设备发送保活报文的时间间隔 最大保活次数保活报文超时的最大次数，当链路连接成功后，发送保活报文超时达到最大次数后，则认为此链路不通 漫游切换差值（仅“快速”工作方式支持）漫游切换门限，漫游后与漫游前的无线信号的RSSI （ReceivedSingnalStrengthIndication，接收信号强度指示）差值，只有差值大于等于配置的漫游切换差值，才会漫游切换 触发扫描RSSI（仅“普通”工作方式支持）触发扫描的RSSI值 大多数场景不需要对漫游参数进行修改，但是也可根据现场实际环境进行调整，注意事项如下： 信道扫描周期配置过低可能会导致网络扫描不全的情况，影响漫游质量。 普通AGV模式只需WA4320E的5G进行扫描连接，无需2.4G辅助连接。 5G信道中雷达信道不支持扫描使用，请勿配置。 图4-12漫游配置示例 (5)检查AC侧的配置。 如果WA4320E工作在普通AGV模式，则AC按照正常无线接入配置即可；如果WA4320E工作在快速AGV模式，则AC需要进行额外配置。 配置无线服务 #创建无线服务模板h3c-agv，用于为WA4320E提供无线接入服务。 [AC]wlanservice-templateh3c-agv #配置无线服务模板h3c-agv的SSID为h3c-agv。 [AC-wlan-st-h3c-agv]ssidh3c-agv #开启无线客户端智能接入功能（仅在快速AGV零配置模式下需要配置，开启本功能后，可以在仅创建无线服务模板或身份认证与密钥管理模式配置为PSK的情况下，自动将我司配套的无线客户端接入到无线网络）。 [AC-wlan-st-h3c-agv]clientsmart-accessenable #配置AKM为PSK，配置PSK密钥，使用明文的字符串12345678作为共享密钥。 [AC-wlan-st-h3c-agv]akmmodepsk [AC-wlan-st-h3c-agv]preshared-keypass-phrasesimple12345678 #配置CCMP为加密套件，配置RSN为安全信息元素。 [AC-wlan-st-h3c-agv]cipher-suiteccmp [AC-wlan-st-h3c-agv]security-iersn #开启无线服务。 [AC-wlan-st-h3c-agv]service-templateenable [AC-wlan-st-h3c-agv]quit #创建无线服务模板h3c-agv-2g，用于为WA4320E提供漫游辅助无线服务。 [AC]wlanservice-templateh3c-agv-2g [AC-wlan-st-h3c-agv-2g]ssidh3c-agv-2g [AC-wlan-st-h3c-agv-2g]service-templateenable [AC-wlan-st-h3c-agv-2g]quit 配置Radio #进入AP组g1的5GHz射频视图。 [AC]wlanap-groupg1 [AC-wlan-ap-group-g1]ap-modelWA5320-SI [AC-wlan-ap-group-g1-ap-model-WA5320-SI]radio1 #配置固定信道（请根据实际组网情况避开干扰信道，避免干扰）。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-1]channel36 #将网络侧的无线接入服务h3c-agv绑定到AP组g1的5GHz射频下。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-1]service-templateh3c-agv #开启射频功能。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-1]radioenable [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-1]quit #进入AP组g1的2.4GHz射频视图。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI]radio2 #配置固定信道（请根据实际组网情况干扰避开，避免干扰）。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-2]channel1 #将网络侧的漫游辅助无线服务h3c-agv-2g绑定到AP组g1的2.4GHz射频下。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-2]service-templateh3c-agv-2g #开启射频功能。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-2]radioenable #在2.4GHz射频上开启漫游增强功能，指定携带网络侧的无线接入服务h3c-agv的信息（快速AGV模式和快速AGV零配置模式必须配置此命令）。 [AC-wlan-ap-group-g1-ap-model-WA5320-SI-radio-2]roam-enhancessidh3c-agv (6)收集WA4320E系统日志信息。 可以通过本地WEB的高级功能获取设备的系统日志信息。 图4-13获取系统日志 图4-14系统日志包含信息 (7)拨打热线400-810-0504寻求帮助。 若上述故障处理方法均无法解决WA4320E故障问题，则需要收集如下信息并联系 400-810-0504进行处理。需要收集的信息如下： 具体故障现象； AC配置； WA4320E系统日志。 4.21RemeoteAP功能不生效 ,Suggestion not provided
Web界面提示“功能函数执行错误”,用户没有清除浏览器缓存,重新通过Web登录设备之前，先将浏览器缓存清理一下。
WIPS反制不生效,"本类故障的常见原因主要包括： •超出了SensorAP的反制覆盖范围。 •SensorAP的配置不正确。 •WIPS规则的相关配置不正确。 •SensorAP未向终端以及AP发送deauth帧。 3.故障分析 本类故障的诊断流程如图4-5所示。图4-5WIPS反制故障诊断流程图 4.处理步骤 (1)检查SensorAP的覆盖范围。WIPS反制功能的覆盖范围大概是30到50米，超出该范围反制效果就不明显甚至失效。现场可以在开启反制的AP上释放一个测试用SSID，然后使用终端扫描该AP覆盖范围，信号强度大于-75dBm的情况下为满足反制功能的覆盖范围。 (2)检查SensorAP的配置。检查SensorAP上是否开启了无线反制的功能，是否在指定的Radio口开启了WIPS功能，是否将SensorAP加入到指定的VSD中。 #创建AP名称为Sensor，开启WIPS功能。 [AC]wlanapSensormodelWA6320 [AC-wlan-ap-Sensor]serial-id219801A28N819CE0002T [AC-wlan-ap-Sensor]radio1 [AC-wlan-ap-Sensor-radio-1]radioenable [AC-wlan-ap-Sensor-radio-1]wipsenable [AC-wlan-ap-Sensor-radio-1]quit #配置Sensor加入虚拟安全域vsd1。 [AC-wlan-ap-Sensor]wipsvirtual-security-domainvsd1 [AC-wlan-ap-Sensor]quit (3)检查WIPS规则的相关配置。 检查WIPS规则的相关配置，是否正确定义了分类规则，是否正确的将分类规则关联到分类策略上，是否正确的定义了反制策略，是否正确的将分类策略和反制策略应用于WIPS虚拟安全域中。 #检查WIPS规则的相关配置。 #定义WIPS的AP分类规则 wips ap-classificationrule1ssidequalrwfz #定义WIPS分类策略 classificationpolicyclass1applyap-classificationrule1rogue-ap #定义WIPS反制策略 countermeasurepolicy1countermeasurerogue-ap #定义WIPS虚拟安全域 virtual-security-domainvsd1applyclassificationpolicyclass1 applycountermeasurepolicy1 (4)在AC上查看被反制设备的信息。 在AC上通过命令displaywipsvirtual-security-domaincountermeasurerecord来显示指定VSD内被反制设备的信息，以明确下一步操作。 <Sysname>displaywipsvirtual-security-domainvsd1countermeasurerecordTotal3timescountermeasure,current3countermeasurerecordinvirtual-security-domainvsd1 Reason:Att-attack;Ass-associated;Black-blacklist; Class-classification;Manu-manual; MACaddressTypeReasonCountermeasureAPRadioIDTime 1000-0000-00e3APManuap112016-05-03/09:32:011000-0000-00e4APManuap212016-05-03/09:32:11 2000-0000-f282ClientBlackap312016-05-03/09:31:56 (5)在AC上查看被反制设备的详细信息。 通过命令displaywipsvirtual-security-domaindevice显示指定VSD内检测到的无线设备的信息，以明确下一步操作。 <Sysname>displaywipsvirtual-security-domainvsd1deviceverbose Total1detecteddevicesinvirtual-security-domainvsd1 Client:2000-0000-0000 LastreportedassociatedAP:1000-0000-0000 Classification:Uncate Severitylevel:0 Classifyway:Auto Dissociativestatus:No Status:Active Statusduration:00h00m02s Vendor:Notfound Radiotype:802.11a 40mhzintolerance:No Countermeasuring:No Maninthemiddle:No Totalnumberofreportedsensors:1 Sensor1: SensorID:2 Sensorname:1RadioID:1 RSSI:50 Channel:149 Firstreportedtime:2014-06-03/14:52:56 Lastreportedtime:2014-06-03/14:52:56ReportedassociatedAP:1000-0000-0000 (6)空口抓包查看SensorAP是否发出deauth帧。 当WIPS反制功能没有生效的时候，可以使用无线抓包软件进行空口抓包，查看SensorAP是否向终端以及AP发送了deauth帧。空口抓包是个比较有效的手段，但是现场通常都没有空口抓包的软件和网卡，如果条件不允许，可以不进行这一步。 图4-6无线抓包 从deauth帧的Extrabyte字段可以看出countermeasureframe的字样，表示该帧是由 SensorAP发出的deauth帧，即反制帧。 (7)优化操作。 V7不再有对应的命令指定SensorAP的工作模式。如果AP射频不绑定无线服务模板，则表示只工作在检测反制模式；如果绑定无线服务模板，则表示AP工作在检测反制和接入服务都有的混合模式。如果指定具体信道，AP也能在多个信道进行扫描和反制。AP同时提供WIPS和接入服务时，需要分配接入和探测的时间，会减弱探测反制的功能，所以为了达到更好的防入侵效果，建议AP单独提供WIPS服务。 表4-1优化操作 接入服务时长(ms)工作信道扫描时长(ms)轮询信道扫描时长 (ms) 普通模式5000100100 服务优先通过命令scanidle-timeidle-time判断接入服务空闲了，再扫描100100 纯探针及反制自动检测到没有配置接入服务模板，直接周期轮询所有信道0100 (8)版本升级。 新版本对WIPS功能做过优化调整，如果通过以上步骤排查后WIPS反制效果依然不明显，可以考虑将AC版本升级至官网最新版本。新版本针对WIPS功能的调整优化，可以参考版本说明书中的解决问题列表。 (9)拨打热线400-810-0504寻求帮助。 若上述故障处理方法均无法解决问题，则需要收集如下信息并联系客户服务热线 400-810-0504进行处理。 需要收集的信息如下： ingwipscountermeasure收集调试信息； AC的诊断信息。 4.20无线AGV小车方案故障处理 ",Suggestion not provided
linkUP、linkDown告警信息。您可以通过在物理状态为UP的接口上执行shutdown、undoshutdown命令，触发设备自动生成对应的linkDown、linkUP告警信息，来验证网管能否正常收到设备生成的告警信息。linkUP告警信息形如： NotificationlinkUp(1.3.6.1.6.3.1.1.5.4)with ifIndex(1.3.6.1.2.1.2.2.1.1.961)=961;ifAdminStatus(1.3.6.1.2.1.2.2.1.7.961)=1;ifOperStatus(1.3.6.1.2.1.2.2.1.8.961)=1.linkDown告警信息形如： NotificationlinkDown(1.3.6.1.6.3.1.1.5.3)with ifIndex(1.3.6.1.2.1.2.2.1.1.961)=961;ifAdminStatus(1.3.6.1.2.1.2.2.1.7.961)=2;ifOperStatus(1.3.6.1.2.1.2.2.1.8.961)=2. 检查RMON事件表的配置是否正确。 在设备端执行命令displayrmonevent查看是否配置了RMON事件表。如果事件表为空，请使用命令rmonevent创建事件表表项，表项对应的动作中需要包含生成告警信息。 (3)检查RMON告警表或者RMON扩展告警表的配置是否正确。在设备端执行命令displayrmonalarm查看是否配置了RMON告警表以及监控的变量、触发条件是否与网络规划一致。如果告警表为空，或者监控的变量、触发条件和网络规划不一致（例如，监控变量不存在、监控变量配置错误，或者告警触发条件不可能达到），请在系统视图下使用命令rmonalarm创建、修改告警表表项。 在设备端执行命令displayrmonprialarm查看是否配置了RMON扩展告警表以及监控的变量、触发条件是否与网络规划一致。如果告警表为空，或者监控的变量、触发条件和网络规划不一致（例如，监控变量不存在、监控变量配置错误，或者告警触发条件不可能达到），请使用命令rmonprialarm创建、修改扩展告警表表项。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 •risingAlarm（1.3.6.1.2.1.16.0.1） •fallingAlarm（1.3.6.1.2.1.16.0.2） 相关日志无 21.5SNMP故障处理 21.5.1SNMP连接失败 ,Cause not provided,Suggestion not provided
如果LDP会话震荡，则请参见“12.1.2LDP会话震荡”故障进行定位。 如果LDP会话没有震荡，则执行步骤(3)。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：MPLS-LSR-STD-MIB •节点名称(OID)mplsXCDown(1.3.6.1.2.1.10.166.2.0.2)相关日志无 12.2MPLSL2VPN/VPLS故障处理 12.2.1PWping不通 ,Cause not provided,Suggestion not provided
如果不存在，则在Loopback接口和公网接口下使能IGP协议，确保发布对应网段路由。 如果存在，则执行步骤(2)。 (2)检查LSP是否存在。执行displaymplslsp命令，查看是否存在到达目的节点的Loopback接口的LSP： 如果不存在，则确保建立指定类型的LSP： −对于LDPLSP，请在接口下使能MPLS功能和MPLSLDP功能。 −对于SRLSP，请在IS-ISIPv4单播地址族视图、OSPF视图或BGPIPv4单播地址族视图下执行segment-routingmpls命令用来开启基于MPLS的SR功能。 −对于SR-MPLSTEPolicy，请在SR-TE视图下创建正确的SR-MPLSTEPolicy。 如果存在，则执行步骤(3)。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX ,Cause not provided,Suggestion not provided
如果不存在，则在Loopback接口和公网接口下使能IGP协议，确保发布对应网段路由。 如果存在，则执行步骤(2)。 (2)检查公网LSP是否存在。执行displaymplslsp命令，查看是否存在到达远端PE的Loopback接口的公网LSP： 如果不存在，则在公网接口下使能MPLS功能和MPLSLDP功能，确保建立公网LSP。 如果存在，则执行步骤(3)。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX ,Cause not provided,Suggestion not provided
"若存在迁移VM的MAC地址或ARP表项，则执行第(2)步。 若不存在迁移VM的MAC地址和ARP表项，则表示本端未学习到迁移VM的MAC地址和ARP，需要VM在迁移后的VTEP上上线完成VM的MAC地址和ARP表项学习。 (2)在迁移前的VTEP设备上查看是否通过BGPEVPN路由同步学习到迁移VM的MAC地址或 ARP。 通过displayevpnroutemac命令查看是否通过BGPEVPN路由同步学习到迁移VM的MAC地址。Flags中的B表示存在通过BGPEVPN路由学习的MAC表项。 <Sysname>displayevpnroutemac Flags:D-DynamicB-BGPL-Localactive G-GatewayS-StaticM-MappingI-Invalid VSIname:bbb EVPNinstance:- MACaddressLinkID/NameFlagsEncapNexthop 0000-0000-000a1DLVXLAN- 0001-0001-0001Tunnel1BVXLAN2.2.2.2 通过displayevpnroutearp命令查看是否通过BGPEVPN路由同步学习到迁移VM的ARP信息。Flags中的B表示存在通过BGPEVPN路由学习的ARP表项。 <Sysname>displayevpnroutearp Flags:D-DynamicB-BGPL-Localactive G-GatewayS-StaticM-MappingI-Invalid VPNinstance:vpn1Interface:Vsi-interface1 IPaddressMACaddressRouterMACVSIindexFlags 10.1.1.10001-0001-0001a0ce-7e40-04000B 10.1.1.110001-0001-0002a0ce-7e40-04000DL 10.1.1.1010001-0011-0101a0ce-7e40-04000SL10.1.1.1020001-0011-01020011-9999-00000BS 若通过BGPEVPN路由同步学习到迁移VM的MAC地址或ARP，则执行第(3)步。 若未通过BGPEVPN路由同步学习到迁移VM的MAC地址和ARP，请通过vpn-target命令修改本端EVPN实例下的RT配置，保证本端和对端EVPN实例下的RT属性匹配。 (3)通过displaybgpl2vpnevpn命令查看VM的MAC地址和ARP信息的MAC/IP发布路 由是否为最优路由，即检查显示信息的State字段取值是否包括best。如下举例中，路由通 告的MAC地址为0001-0203-0405（MACaddress），IP地址为5.5.5.5/32（IPaddress），且该路由为best路由（State）。 <Sysname>displaybgpl2vpnevpnroute-distinguisher1.1.1.1:100 [2][5][48][0001-0203-0405][32][5.5.5.5]136 BGPlocalrouterID:172.16.250.133 LocalASnumber:100 Routedistinguisher:1.1.1.1:100 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof[2][5][48][0001-0203-0405][32][5.5.5.5]/136: From:10.1.1.2(192.168.56.17) Relynexthop:10.1.1.2Originalnexthop:10.1.1.2 OutLabel:NULL Ext-Community:<RT:1:2>,<RT:1:3>,<RT:1:4>,<RT:1:5>,<RT:1:6>,<RT:1:7 >,<EncapsulationType:VXLAN>,<Router'sMac:0006-0708-0910 >,<MACMobility:Flag0,SeqNum2>,<DefaultGateWay> RxPathID:0x0 TxPathID:0x0AS-path:200Origin:igp Attributevalue:MED0,pref-val0 State:valid,external,best IPprecedence:N/A QoSlocalID:N/A Trafficindex:N/A EVPNroutetype:MAC/IPadvertisementroute ESI:0001.0203.0405.0607.0809EthernettagID:5 MACaddress:0001-0001-0001 IPaddress:10.1.1.1/32 MPLSlabel1:10 MPLSlabel2:100 Re-origination:Enable 若MAC/IP发布路由是最优路由，则执行第(4)步。 若MAC/IP发布路由不是最优路由，请修改路由配置，确保通告的MAC/IP发布路由为最优路由。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无。相关日志无。 15.1.6VTEP设备上存在MAC迁移，导致其他终端访问VM业务异常 ",Cause not provided,Suggestion not provided
若下一跳地址对应的MAC地址为RouterMAC，则执行第(4)步。通过displayinterfacevsi-interface命令查看承载L3VNI的VSI虚接口的MAC地址，该地址就是RouterMAC地址。 若下一跳地址对应的MAC地址不是RouterMAC，则将设备上承载L3VNI的VSI虚接口的MAC地址配置一致或通过evpnglobal-mac命令配置EVPN的全局MAC地址。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警 无。 相关日志无。 15.1.5EVPN网络中，VM迁移时间过长 ,Cause not provided,Suggestion not provided
若与邻居相连的接口数量≥2，请继续执行第(2)步。 若与邻居相连的接口数量＜2，请增加与邻居之间的物理链路，确保存在可以建立备份 CRLSP的路径。 (2)检查MPLSTE配置。依次检查如下配置： a.OSPF/IS-IS区域和MPLSTE隧道经过的接口下是否配置mplsteenable命令。 b.LSRID、RouterID是否为同一LoopBack接口的地址。 c.若使用RSVP-TE协议建立MPLSTE隧道，则需要检查设备和接口是否配置了rsvp、rsvpenable命令。 d.若隧道接口下配置了mplstebandwidth命令，检查设备出接口是否配置了mplstemax-linkbandwidth以及mplstemax-reservablebandwidth命令。 e.若隧道接口下配置了mplsteaffinity-attribute命令，检查设备出接口是否配置合理的mplstelink-attribute命令。如果希望某条链路能够被隧道所用，则需要 满足如下要求： −对于隧道亲和属性掩码为1的位，亲和属性为1的位中链路属性至少有1位也为1，亲和属性为0的位对应的链路属性位不能为1。 −对于隧道亲和属性掩码为0的位，链路属性可以是任意值。 f.若使用SegmentRouting协议建立MPLSTE隧道，则需要检查设备IGP区域下是否配置了segment-routingmpls命令。 g.若使用mplstepath命令指定显式路径来建立MPLSTE隧道，则需要检查显式路径配置是否合理：使用strict方式时，需要逐跳指定入接口的IP地址；使用loose方式时，需要指定经过的设备的节点地址。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 nostic-information命令收集诊断信息。 5.告警与日志相关告警无 相关日志 •TE/5/TE_BACKUP_SWITCH 12.5MPLS基础故障处理 12.5.1报文通过LSP隧道转发不通 ,Cause not provided,Suggestion not provided
板卡插入线缆或光模块后，端口频繁UP/DOWN。 ,本类故障的常见原因主要包括： •光模块或线缆故障 •电口自协商不稳定 3.故障分析 本类故障的诊断流程如图23所示：图23故障诊断流程图 4.处理步骤 (1)对于光口，需要确认光模块是否异常。通过查看光模块alarm信息来排查两者光模块以及中间光纤问题。告警信息中如果存在接收有问题那一般是对端端口、光纤或中转传输设备导致；如果是发送有问题或者电流、电压异常那就需要排查本端端口。 <Sysname>displaytransceiveralarminterfacegigabitethernet1/0/1 GigabitEthernet1/0/1transceivercurrentalarminformation: RXlossofsignal RXpowerlow (2)检查光模块的接收、发送光功率是否正常（即在该光模块的光功率上下门限值之内）。如果发送光功率处于临界值，请更换光纤、光模块做交叉验证；如接收光功率处于临界值，请排查对端光模块及中间光纤链路。 <Sysname>displaytransceiverdiagnosisinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1transceiverdiagnosticinformation: Currentdiagnosticparameters: Temp(°C)Voltage(V)Bias(mA)RXpower(dBm)TXpower(dBm)363.316.13-35.64-5.19 Alarmthresholds: Temp(°C)Voltage(V)Bias(mA)RXpower(dBM)TXpower(dBM) High503.551.44-10.005.00 Low303.011.01-30.000.00 (3)对于电口，一般在自协商情况下容易出现协商不稳定，这种情况请尝试设置强制速率双工。 (4)如果故障依存在，请排查链路、对端设备、中间设备。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 3.6.7OLT端口不支持光模块 ,Suggestion not provided
本地路由器与对等体/对等体组建立的BGP会话无法进入Established状态。 ,"本类故障的常见原因主要包括： •BGP报文转发受阻。 •建立/维持BGPTCP连接的报文被ACL过滤。 •自治系统内，BGP邻居间的RouterID产生冲突。 •地址时，对端未通过peerconnect-interface 命令将建立TCP连接所使用的源接口配置为Loopback接口，或者对端未通过peer source-address命令将建立TCP连接所使用的源地址配置为Loopback接口的地址。 •建立BGPTCP连接时，BGP会话两端发送的TCP报文长度过大，在转发时被出接口MTU较小且无法对报文分片的中间节点丢弃，导致BGPTCP连接失败。 •指定EBGP对等体的地址为Loopback接口的IP地址时，对端未配置peerebgp-max-hop 命令，以允许本地路由器同非直连邻居建立EBGP会话。 •BGP会话的两端未通过peerpassword命令配置相同的密钥，导致MD5认证失败。 •配置peerttl-security命令以开启指定对等体/对等体组的GTSM功能时，到达对等体/ 对等体组的最大跳数配置错误，导致对等体/对等体组无法通过GTSM检查。 •对等体向本地路由器发送的BGP路由数量超过了peerroute-limit命令设定的最大值， •路由器上配置了BGP(导致BGP会话断开。)peerignore、ignoreall-peers或shutdownprocess命令， 禁止建立BGP会话。 •本地路由器与对端路由器没有在相同的地址族视图下使能路由信息交换能力。 3.故障分析 本类故障的诊断流程如图65所示： 图65BGP会话无法进入Established状态的故障诊断流程图 4.处理步骤 (1)检查与BGP邻居之间的通信链路是否正常。 a.检查与邻居建立BGP会话的相关接口是否处于UP状态。 b.通过ping命令方式检查与BGP邻居的连通性。如果Ping的结果为可达，则说明本地路由器与BGP邻居之间的通信链路正常，请执行步骤（2）。如果Ping的结果为不可达，请执行步骤c。 建议使用ping–asource-ip–spacket-size命令和pingipv6–asource-ipv6 –spacket-size命令来检测与BGP邻居的连通性。–asource-ip和–asource-ipv6参数指定了ICMP回显请求报文的源地址，方便用户同时检测两端的链路是否都正常；–spacket-size参数指定了发送的ICMP回显请求报文的长度，方便用户检测长报文在链路中的传输情况。Ping操作的源IP地址取用本端建立BGP会话使用的接口的IP地址，目的IP地址取用对端建立BGP会话使用的接口的IP地址。 c.执行ping–asource-ip–spacket-size命令进行Ping操作，并逐步减小–s packet-size参数输入的值，当该参数减小到某个值时，Ping的结果变为可达，则表示建立BGPTCP连接时发送的TCP报文由于长度过长，在转发过程中被设备丢弃，导致了 BGP会话无法进入Established状态。 −此时可以重复执行ping–asource-ip–spacket-size命令，调整–spacket-size参数的取值，直至找到一个合适的取值（Ping的结果为可达的前提下，取尽量大的值，以提高转发效率），然后将该值设置为BGP报文转发出接口的MTU值。可通过在接口上执行ip/ipv6mtumtu-size或tcpmssvalue命令，或者在BGP实例视图/BGP-VPN实例视图下执行peertcp-mss命令来设置出接口的MTU值；其中，ip/ipv6mtumtu-size命令配置的是MTU值，tcpmssvalue和peertcp-mss命令配置的是TCPMSS值（TCPMSS＝MTU值－IP头部长度－TCP头部 −也可以无(长度）。)需重复进行Ping操作，直接在系统视图下执行tcppath-mtu-discovery命令，开启TCP连接的PathMTU探测功能。之后，设备会根据探测机制自动获得建立TCP连接的路径上最小的MTU值，并计算得到MSS值，后续建立BGPTCP连接时，会使用计算得到的MSS值作为TCP报文的长度。 如果无论怎么调整–spacket-size参数的取值，Ping的结果均为不可达，请参见“三层技术-IP业务类故障处理”手册中的“Ping不通的定位思路”进行后续的检查。 d.如果故障仍不能排除，请执行步骤（2）(2)检查BGPTCP连接是否建立。执行displaytcp命令，查看显示信息中是否存在地址为本地路由器地址以及BGP邻居的 地址、对端端口号为179、TCP连接状态为ESTABLISHED的条目。例如： <Sysname>displaytcp *:TCPconnectionwithauthentication LocalAddr:portForeignAddr:portStatePCB 0.0.0.0:17912.1.1.2:0LISTEN0xffffffffffffff9d12.1.1.1:2816012.1.1.2:179ESTABLISHED0xffffffffffffff9e ting-table命令，查看 路由表中是否存在对端建立BGP会话使用的IPv4/IPv6地址的IGP路由，如果不存在，请检查IGP路由的配置。常见的IGP路由协议故障处理方法，请参见“三层技术-IP路由类故障处理”手册中的“OSPF故障处理”、“OSPFv3故障处理”或“IS-IS故障处理”。 执行displayaclall命令，查看是否存在拒绝端口号为bgp的规则，例如： <Sysname>displayaclall AdvancedIPv4ACL3077,2rules,ACL'sstepis5 rule1denytcpdestination-porteqbgp rule2denytcpsource-porteqbgp如果存在这样的规则，请执行undorule命令取消这些配置。 执行debuggingtcppacket命令，根据Debug信息判断BGP建立TCP连接时是否存在安全认证失败，例如： <Sysname>debuggingtcppacketacl3000 *Feb520:03:39:2892021SysnameSOCKET/7/INET:-MDC=1; TCPInput:Failedtocheckmd5,dropthepacket. 上述信息表明BGP建立TCP连接时MD5认证失败。请在建立BGPTCP连接的两端设备上均执行peerpassword命令配置相同的密钥。 <Sysname>debuggingtcppacketacl3000 *Feb520:03:39:2892021SysnameSOCKET/7/INET:-MDC=1;TCPInput:Failedtocheckkeychain,dropthepacket. 上述信息表明BGP建立TCP连接时keychain认证失败。请确保建立BGPTCP连接的两端设备上均通过执行peerkeychain命令配置了keychain认证，并且同一时间内使用的key的标识符相同，以及相同标识符的key的认证算法和认证密钥一致。 <Sysname>debuggingtcppacketacl3000 *Feb520:03:39:2892021SysnameSOCKET/7/INET:-MDC=1; TCPInput:FailedtogetIPSECprofile,index500,nameprofile1(inpcbprofile2),return0x3fff. 上述信息表明BGP建立TCP连接时IPsec认证失败。请检查BGP会话两端设备的IPsec配置并确保在两端设备上均通过执行peeripsec-profile命令应用了IPsec安全框架。 如果故障仍不能排除，请执行步骤（3）。 (3)检查RouterID是否存在冲突，AS号是否配置错误。 a.执行displaybgppeer命令，根据显示信息中的“BGPlocalrouterID”字段，判断是否存在RouterID配置冲突，如果存在冲突，请在需要建立BGP会话的BGP实例视图或BGP-VPN实例视图下执行router-id命令，修改BGP路由器的RouterID。例如： <Sysname>displaybgppeeripv4unicast BGPlocalrouterID:12.1.1.1 LocalASnumber:10 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState 12.1.1.220330000:00:25Established b.执行displaybgppeer命令，根据显示信息中的“AS”字段，判断是否为BGP对等 体/对等体组指定了错误的AS号。如果AS号配置错误，则执行peeras-number命令为BGP对等体/对等体组指定正确的AS号。例如： <Sysname>displaybgppeeripv4unicast BGPlocalrouterID:12.1.1.1 LocalASnumber:10 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState 12.1.1.220330000:00:25Established c.如果故障仍不能排除，请执行步骤（4）。 (4)在BGP实例视图下执行displaythis命令，检查是否存在影响BGP会话的配置。表11影响BGP会话的配置检查项检查项 描述 peer{group-name|ipv4-address本端存在该配置时，BGP邻居也需要使用Loopback [mask-length]|ipv6-address接口的地址建立BGP会话，可通过本命令或peer [prefix-length]}connect-interfacesource-address命令配置interface-typeinterface-number peeripv4-address[mask-length]本端存在该配置时，BGP邻居也需要使用Loopbacksource-addresssource-ipv4-address接口的地址建立BGP会话，可通过本命令或peerpeeripv6-address[prefix-length]connect-interface命令配置source-addresssource-ipv6-address peer{group-name|ipv4-address非直连网络上的邻居建立EBGP会话，或者直连网[mask-length]|ipv6-address络设备使用Loopback接口建立EBGP会话时，BGP [prefix-length]}ebgp-max-hop会话两端均需要配置本命令，为EBGP会话指定相 [hop-count]应的最大跳数 peer{group-name|ipv4-address存在该配置时，本地路由器从指定对等体收到的BGP报文中，TTL需要在255-“hop-count”+1到 [mask-length]|ipv6-address255之间，否则BGP报文将会被丢弃，如果本地路 [prefix-length]}ttl-securityhops由器与对等体之间的跳数超过了hop-count，请通hop-count 过本命令进行配置修改 peer{group-name|ipv4-address存在该配置时，表示如果本地路由器从指定对等体/[mask-length]|ipv6-address对等体组接收的路由数量大于prefix-number [prefix-length]|link-local-address值，路由器会自动断开与指定对等体/对等体组的会interfaceinterface-type话。可通过降低对等体/对等体组发送的路由数量，interface-number}route-limit或配置更大的prefix-number值，来避免BGP会 prefix-number[reconnect reconnect-time|percentage-value]*话断开peer{group-name|ipv4-address[mask-length]|ipv6-address [prefix-length]|link-local-address存在该配置时，BGP将不会与指定的对等体/对等体interfaceinterface-type interface-number}ignore[graceful组建立BGP会话，此时可以通过执行undopeer graceful-time{communityignore命令允许建立与对等体/对等体组的会话 {community-number|aa:nn}|local-preferencepreference|medmed} *] ignoreall-peers[gracefulgraceful-time{community{community-number|aa:nn}|存在该配置时，表明BGP禁止与所有对等体建立BGP会话。此时设备可能处于网络升级维护中， BGP进程暂时不可用，建议在网络升级维护完成后， local-preferencepreference|medmed}执行all-undopeerignorepeers命令允许建立BGP命令或会话undoignore*] 存在该配置时，表明BGP禁止与所有对等体建立 shutdownprocessBGP进程暂时不可用，建议在网络升级维护完成(BGP会话。此时设备可能处于网络升级维护中，)后， 执行undoshutdownprocess命令允许建立BGP会话 建立BGP会话时，两端需要在同一个地址族下指定 地址族下的peerenable命令对端配置力。存在该配置时，请检查对端是否也在相同地址peerenable命令使能路由信息交互能族下配置了peerenable命令 如果故障仍不能排除，请执行步骤（5）。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警在系统视图下执行snmp-agenttrapenablebgp命令后，BGP会话的状态机发生变化时会产 生如下告警信息。 模块名：BGP4-MIB •bgpBackwardTransition(1.3.6.1.2.1.15.7.2) 相关日志无 10.1.2BGP会话Down ",Suggestion not provided
本类故障常见如下三种情况： •用reboot命令重启主用主控板时，备用主控板也重启。 •主、备倒换异常。 ,本类故障的常见原因主要包括： •原备用主控板未启动完成的情况下，因重启主用主控而被动变成主用主控板。 •备用主控板未收到主用主控板的报文而切换成主用主控板。 •主用主控板自身异常导致重启。 •主用主控板和备用主控板版本不一致。 3.故障分析 用reboot命令重启主用主控板时，备用主控板也重启，此类故障的诊断流程如图14所示。 图14 4.处理步骤 •对于用reboot命令重启主用主控板时备用主控板也重启，此类故障的处理步骤如下： (1)在原主用主控板启动完成后，使用ftp或tftp命令将存储介质中logfile目录下最新的logfile文件上传到文件服务器。 (2)查看logfile中reboot命令日志（类似Commandisrebootslot0）到上次启动开始（类似SYSLOG_RESTART:Systemrestarted）这段时间是否出现过类似Batchbackupofstandbyboardinslot1hasfinished字符串。 a.如果没出现过，则表示是在原备用主控板未启动完成的情况下，因重启主用主控而被动变成主用主控板，这种情况下备用主控重启属于正常现象，无需处理。下次重启前注意确保 备用主控板批量备份完成（即已经出现过类似Batchbackupofstandbyboardinslot1hasfinished日志），再用rebootslot命令重启主用主控板。 b.如果出现过，请联系H3C技术支持人员。 •对于主、备倒换异常，此类故障的处理步骤如下： (3)通过displaysystemstablestate命令收集主用主控、备用主控状态信息： <H3C>displaysystemstablestateSystemstate:Stable Redundancystate:Stable SlotCPURoleState00ActiveStable 10StandbyStable 根据显示信息查看： a.双主控的Role是否为Active和Standby。 b.主用主控、备用主控状态是否Stable。 (4)通过displayboot-loader命令收集主用主控、备用主控版本信息，查看主用主控、备用主控版本是否一致。 5.告警与日志 相关告警 无 相关日志无 3.5.5业务板无法启动 ,Suggestion not provided
本类故障的常见原因主要包括： •用户会话超时时间超时。 •用户闲置切断。 •计费更新失败。 •用户流量达到阈值。 •服务器强制用户下线。 •用户在线探测失败下线。 •用户上线的接口down。 2.故障分析 本类故障的诊断流程如图160所示。 图160Portal认证用户掉线的故障诊断流程图 ,(1)通过portallogout-recordenable命令，开启Portal用户下线信息记录功能。（部分 设备不支持本命令请跳过本步骤） (2)检查用户会话超时时间是否超时。 如果AAA服务器给Portal用户下发了会话时长，即用户单次在线时长。用户在线时长超过会话时长后，设备会触发用户下线。 可通过如下三种方法确认是否因会话超时导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Sessiontimeout 在设备上执行debuggingportalerr(（部分设备不支持本命令请跳过本步骤）)or命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Sessiontimertimedoutandtheuserwillbeloggedoff.用户会话超时触发的下线属于正常下线，用户重新上线即可。 (3)检查是否为用户闲置切断。如果设备或者AAA服务器授权了用户闲置切断时长，用户上线后，设备会周期性检测用户的流量，若某用户在指定的闲置检测时间内产生的流量小于指定的数据流量，则会被强制下线。可通过如下三种方法确认是否因用户闲置切换功能导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:Idletimeout 在设备上执行debuggingportalerr(（部分设备不支持本命令请跳过本步骤）)or命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Idle-cuttimertimedoutandtheuserwillbeloggedoff.用户闲置切断触发的下线属于正常下线，用户重新上线即可。 (4)检查是否为计费更新失败。远程Portal认证用户上线，设备会定期向AAA服务器发送计费更新报文。当设备与AAA服务器链路不通或者服务器故障时，计费更新报文会发送失败。当达到最大重传次数后，如果计费更新报文还是发送失败并且设备上配置了用户计费更新失败策略（通过accountingupdate-failoffline命令配置），则触发用户下线。可通过如下方法确认是否因计费更新失败导致用户下线： 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/ASSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Accountingupdatefailure displayinterface通过查看设备上连(（部分设备不支持本命令请跳过本步骤）)接AAA服务器的端口是否发生过变化，检查AAA服务器否有异常记录等。或者通过displayradiusscheme命令显示的State字段查看服务器状态是否为Block，如果是，则可能是计费更新失败导致的下线。 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Processedaccounting-updatefailedanduserlogout. 如果确认是计费更新失败导致的用户下线，请检查设备与服务器之间的链路状态，以及设备和AAA服务器的相关计费配置是否发生过更改。 (5)检查是否为用户流量达到阈值。用户上线时，如果AAA服务器下发了流量阈值，当用户的流量超过AAA服务器下发的流量阈值时，设备就会强制用户下线。可通过如下方法确认是否因用户流量达到阈值导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Usertrafficreachedthreshold （部分设备不支持本命令请跳过本步骤）用户流量达到阈值触发的下线属于正常下线，用户重新上线即可。 (6)检查是否为AAA服务器主动踢用户下线。设备上开启了RADIUSsessioncontrol功能后，若收到AAA服务器的断开连接请求，则会立马强制对应的用户下线。首先查看设备上是否开启了（通过radiussession-controlenable命令配置）。如果开启了，则可以通过如下方法查看是否因AAA服务器强制用户下线导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordallTotallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:ForcelogoutbyRADIUSserver （部分设备不支持本命令请跳过本步骤）服务器为何强制用户下线，请联系服务器管理员进行确认。 (7)检查是否为Portal用户在线探测失败导致用户下线。 如果设备上开启了Portal用户在线探测功能（通过portaluser-detect命令配置），设备会定期向用户终端发送探测报文。若在指定探测次数内，设备未收到终端的回应，则强制用户下线。确认设备上是否开启了Portal用户在线探测功能。如果开启了，则可以通过如下方法确认是否因用户在线探测失败导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Userdetectionfailure （部分设备不支持本命令请跳过本步骤）如果确认是因Portal用户在线探测导致用户下线，请检查终端和设备之间的链路状态，排查终端没有回应探测报文的原因。 (8)检查Portal用户上线的接口是否down。如果Portal用户上线的接口down了一段时间后，设备会强制从该接口接入的Portal用户全部下线。 可通过如下方法确认是否因接口down导致用户下线：查看AAA服务器上的用户下线记录。 通过displayinterface命令查看接口的状态是否发生过变化，如果发生变化的时间正好和用户下线的时间接近，则可能是接口down触发的用户下线。 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58Logoutreason:Interfacedown （部分设备不支持本命令请跳过本步骤）如果确认是接口down导致的下线，请排查接口down的原因，如网线口松动等。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Portal服务器上Portal相关配置截图。 AAA服务器上记录的用户下线记录。 设备与服务器间的抓包文件。 调试信息。 4.告警与日志 相关告警无 相关日志 无 19安全类故障处理 19.1SSH故障处理 19.1.1SSH客户端登录设备失败 ,(1)通过portallogout-recordenable命令，开启Portal用户下线信息记录功能。（部分 设备不支持本命令请跳过本步骤） (2)检查用户会话超时时间是否超时。 如果AAA服务器给Portal用户下发了会话时长，即用户单次在线时长。用户在线时长超过会话时长后，设备会触发用户下线。 可通过如下三种方法确认是否因会话超时导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Sessiontimeout 在设备上执行debuggingportalerr(（部分设备不支持本命令请跳过本步骤）)or命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Sessiontimertimedoutandtheuserwillbeloggedoff.用户会话超时触发的下线属于正常下线，用户重新上线即可。 (3)检查是否为用户闲置切断。如果设备或者AAA服务器授权了用户闲置切断时长，用户上线后，设备会周期性检测用户的流量，若某用户在指定的闲置检测时间内产生的流量小于指定的数据流量，则会被强制下线。可通过如下三种方法确认是否因用户闲置切换功能导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:Idletimeout 在设备上执行debuggingportalerr(（部分设备不支持本命令请跳过本步骤）)or命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Idle-cuttimertimedoutandtheuserwillbeloggedoff.用户闲置切断触发的下线属于正常下线，用户重新上线即可。 (4)检查是否为计费更新失败。远程Portal认证用户上线，设备会定期向AAA服务器发送计费更新报文。当设备与AAA服务器链路不通或者服务器故障时，计费更新报文会发送失败。当达到最大重传次数后，如果计费更新报文还是发送失败并且设备上配置了用户计费更新失败策略（通过accountingupdate-failoffline命令配置），则触发用户下线。可通过如下方法确认是否因计费更新失败导致用户下线： 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/ASSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Accountingupdatefailure displayinterface通过查看设备上连(（部分设备不支持本命令请跳过本步骤）)接AAA服务器的端口是否发生过变化，检查AAA服务器否有异常记录等。或者通过displayradiusscheme命令显示的State字段查看服务器状态是否为Block，如果是，则可能是计费更新失败导致的下线。 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Processedaccounting-updatefailedanduserlogout. 如果确认是计费更新失败导致的用户下线，请检查设备与服务器之间的链路状态，以及设备和AAA服务器的相关计费配置是否发生过更改。 (5)检查是否为用户流量达到阈值。用户上线时，如果AAA服务器下发了流量阈值，当用户的流量超过AAA服务器下发的流量阈值时，设备就会强制用户下线。可通过如下方法确认是否因用户流量达到阈值导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Usertrafficreachedthreshold （部分设备不支持本命令请跳过本步骤）用户流量达到阈值触发的下线属于正常下线，用户重新上线即可。 (6)检查是否为AAA服务器主动踢用户下线。设备上开启了RADIUSsessioncontrol功能后，若收到AAA服务器的断开连接请求，则会立马强制对应的用户下线。首先查看设备上是否开启了（通过radiussession-controlenable命令配置）。如果开启了，则可以通过如下方法查看是否因AAA服务器强制用户下线导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordallTotallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:ForcelogoutbyRADIUSserver （部分设备不支持本命令请跳过本步骤）服务器为何强制用户下线，请联系服务器管理员进行确认。 (7)检查是否为Portal用户在线探测失败导致用户下线。 如果设备上开启了Portal用户在线探测功能（通过portaluser-detect命令配置），设备会定期向用户终端发送探测报文。若在指定探测次数内，设备未收到终端的回应，则强制用户下线。确认设备上是否开启了Portal用户在线探测功能。如果开启了，则可以通过如下方法确认是否因用户在线探测失败导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Userdetectionfailure （部分设备不支持本命令请跳过本步骤）如果确认是因Portal用户在线探测导致用户下线，请检查终端和设备之间的链路状态，排查终端没有回应探测报文的原因。 (8)检查Portal用户上线的接口是否down。如果Portal用户上线的接口down了一段时间后，设备会强制从该接口接入的Portal用户全部下线。 可通过如下方法确认是否因接口down导致用户下线：查看AAA服务器上的用户下线记录。 通过displayinterface命令查看接口的状态是否发生过变化，如果发生变化的时间正好和用户下线的时间接近，则可能是接口down触发的用户下线。 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58Logoutreason:Interfacedown （部分设备不支持本命令请跳过本步骤）如果确认是接口down导致的下线，请排查接口down的原因，如网线口松动等。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Portal服务器上Portal相关配置截图。 AAA服务器上记录的用户下线记录。 设备与服务器间的抓包文件。 调试信息。 4.告警与日志 相关告警无 相关日志 无 19安全类故障处理 19.1SSH故障处理 19.1.1SSH客户端登录设备失败 
采用SR-BE方式建立SRLSP时，依次在SRLSP经过的各个节点上使用displaymplslsp命令检查SRLSP的标签交换信息，发现某个节点没有去往SRLSP的Egress节点的出标签（OutLabel）或者该出标签并非SR-MPLS分配。例如，Egress节点FEC为5.5.5.5/32，如下显示表示该节点上不存在去往5.5.5.5/32的SR-MPLS出标签，即不存在去往5.5.5.5/32的SRLSP。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 12.1.1.2Local-/-GE0/0/1Tunnel1Local-/-NHLFE2Tunnel10Local-/-NHLFE1 ,Cause not provided,Suggestion not provided
采用SR-BE方式建立SRLSP时，依次在SRLSP经过的各个节点上使用displaymplslsp命令检查SRLSP的标签交换信息，发现某个节点没有去往SRLSP的Egress节点的出标签（OutLabel）或者该出标签并非SR-MPLS分配。例如，Egress节点FEC为5.5.5.5/32，如下显示表示该节点上不存在去往5.5.5.5/32的SR-MPLS出标签，即不存在去往5.5.5.5/32的SRLSP。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 12.1.1.2Local-/-GE0/0/1Tunnel1Local-/-NHLFE2Tunnel10Local-/-NHLFE1 1.1.1.1/32ISIS16010/-- 2.2.2.2/32ISIS16020/3GE0/0/1 2.2.2.2/32ISIS-/3GE0/0/13.3.3.3/32ISIS16030/16030GE0/0/1 3.3.3.3/32ISIS-/16030GE0/0/1 4.4.4.4/32ISIS16040/16040GE0/0/1 4.4.4.4/32ISIS-/16040GE0/0/11.1.1.1/1/4122SR-TE-/16030GE0/0/1 16040 ,本类故障的常见原因主要包括：•物理链路故障。 •	IGP或BGP邻居关系未正常建立导致SR-MPLS标签发布失败。 •	SR-MPLS配置缺少或错误。采用SR-BE方式建立SRLSP完全依赖于IGP或BGP路由的发布，在IGP或BGP邻居之间通告路由信息时，需要携带SR-MPLS标签信息以建立SRLSP。因此，IGP或BGP邻居关系是否正常建立、IGP路由是否正常发布是本类故障最重要的原因。 3.	故障分析 本类故障的诊断流程如图114所示。 图114采用SR-BE方式无法建立SRLSP的故障诊断流程图 ,(1)	在SRLSP经过的各个节点上通过命令displayinterfacebrief检查物理链路状态，确保SRLSP转发路径上各接口的物理状态和数据链路层协议状态均为UP。如果链路正常，或链路恢复后问题仍未解决，请继续执行以下操作。 (2)	在SRLSP经过的各个节点上检查IGP/BGP邻居关系是否正常建立，IGP/BGP配置是否正确。 SR-MPLS采用不同的路由协议发布标签时，故障处理方法有所不同： 如果使用OSPF作为IGP来通告路由信息并发布SR-MPLS标签： −通过displayospf命令来判断OSPF是否使能OpaqueLSA发布接收能力。如果displayospf命令显示信息中存在Opaquecapable字段，表示OpaqueLSA发布 接收能力处于开启状态。若未使能该功能，则需要在OSPF视图下执行opaque-capabilityenable命令。 −执行displayospfpeer命令确认OSPF邻接关系是否正常。如果显示信息中邻居状态字段State显示为Full，表示OSPF邻居关系正常。否则，请参见OSPF故障处理手册中“OSPF邻居无法达到FULL状态”的处理过程。 −执行displaymplslsp命令检查是否存在OSPF协议发布的SRPrefix方式的LSP信息。各节点的SRPrefixSID是管理员为Loopback地址手工指定的SID。如果没有SRPrefix方式的LSP信息，请在各节点的Loopback接口视图下检查是否使用ospfarea命令使能OSPF或在OSPF视图下是否使用network命令引入Loopback接口网段地址。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 1.1.1.9/32OSPF16010/-- 1.1.1.9/32ISIS16010/-- 2.2.2.9/32OSPF16020/17020RAGG1.4 −如果displaymplslsp命令的显示信息中不仅存在OSPF协议发布的SRLSP信息，同时也存在BGP协议发布的相同Prefix的SRLSP信息，则可能因PrefixSID冲突导致SRLSP生成失败。此时请通过peerroute-policy命令过滤掉从BGP对等体学习的该路由信息。 如果使用IS-IS作为IGP来通告路由信息并发布SR-MPLS标签： −通过displayisis命令的显示信息中Coststyle字段来判断IS-IS开销值的类型是否为wide、compatible或wide-compatible。如果Coststyle字段的开销值类型不是以上三种，请执行cost-style命令来修改IS-IS开销值的类型。 −执行displayisispeer命令确认IS-IS邻居关系是否正常。如果displayisispeer命令邻居状态字段State显示为Up，表示IS-IS邻居关系正常。否则，请参见IS-IS −故障splaymplslsp命令检查是否存在IS-IS执行协(处理手册中“IS-IS邻居无法建立”的处理过程。di)议发布的SRPrefix方式的LSP信息。各节点的SRPrefixSID是管理员为Loopback地址手工指定的SID。如果没有SRPrefix方式的LSP信息，请在各节点的Loopback接口视图下检查是否使用isisenable命令使能IS-IS功能。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 1.1.1.9/32OSPF16010/-- 1.1.1.9/32ISIS16010/-- 2.2.2.9/32ISIS16020/17020RAGG1.4 −如果displaymplslsp命令的显示信息中不仅存在IS-IS协议发布的SRLSP信息，同时也存在BGP协议发布的相同Prefix的SRLSP信息，则可能因PrefixSID冲突导致SRLSP生成失败。此时请通过peerroute-policy命令过滤掉从BGP对等体学习的该路由信息。 	如果使用BGP来通告路由信息并发布SR-MPLS标签： −执行displaybgppeer命令检查BGP对等体或对等体组的邻居关系是否正常。如果displaybgppeer命令BGP会话的状态字段State显示为Established，表示BGP对等体或对等体组邻居关系正常。否则，请参见BGP故障处理手册中“BGP邻居无法建立”的处理过程。 −执行displaymplslsp命令检查是否存在BGP协议发布的SRPrefix方式的LSP信息。如果没有，请检查BGP的指定对等体/对等体组配置了peerlabel-route-capability命令来使能交换带标签路由的能力，并且通过路由策略为引入BGP的Loopback地址配置了标签索引值。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 1.1.1.9/32OSPF16010/-- 1.1.1.9/32ISIS16010/-- 2.2.2.9/32BGP16020/17020RAGG1.4如果执行以上操作后，问题仍未解决，则请继续执行以下操作。 (3)在SRLSP经过的各个节点上检查SR-MPLS配置。 a.	在IS-IS视图、OSPF视图或BGP视图下检查是否开启支持SR-MPLS功能。如果未开启支持SR-MPLS功能，则在IS-IS视图、OSPF视图或BGP视图下执行segment-routingmpls命令开启该功能。 b.	SR-BELSP使用前缀SID方式建立SRLSP转发路径，请在LoopBack接口视图下检查是否配置前缀SID。如果未配置，则在OSPF视图下执行ospfprefix-sid命令或在IS-IS视图下执行isisprefix-sid命令配置前缀SID。 c.	执行displaysegment-routinglabel-block命令检查LoopBack接口下配置的前 缀SID是否在SRGB标签段范围内。如果前缀SID未在SRGB范围内，则请修改配置的前缀SID，否则该SID不会生效。 d.	如果执行以上操作后，问题仍未解决，则请继续执行以下操作。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 13.2.2SR-MPLS-TETunnel状态为Down 
采用电源适配器和PoE-MH通过网口给AP供电时，发现AP不能上电,确保给AP供电的网线接到PoE-MH的正确位置。PoE-MH除了供电源适配器插入的电源口外，还有两个RJ-45口，其中一个RJ-45（#1）和电源在一侧，另外一个RJ-45口（#2）在另外一侧。给设备供电的网线应该插在RJ-45#2，如果插到了RJ-45#1的话是无法给AP供电的。 3.6光模块插入设备的光口时反插导致设备光口工作异常 ,确保给AP供电的网线接到PoE-MH的正确位置。PoE-MH除了供电源适配器插入的电源口外，还有两个RJ-45口，其中一个RJ-45（#1）和电源在一侧，另外一个RJ-45口（#2）在另外一侧。给设备供电的网线应该插在RJ-45#2，如果插到了RJ-45#1的话是无法给AP供电的。 3.6光模块插入设备的光口时反插导致设备光口工作异常 
采用电源适配器和PoE-MH通过网口给AP供电时，发现AP不能上电。 ,确保给AP供电的网线接到PoE-MH的正确位置。PoE-MH除了供电源适配器插入的电源口外，还有两个RJ-45口，其中一个RJ-45（#1）和电源在一侧，另外一个RJ-45口（#2）在另外一侧。给设备供电的网线应该插在RJ-45#2，如果插到了RJ-45#1的话是无法给AP供电的。 3.6光模块插入设备的光口时反插导致设备光口工作异常 ,确保给AP供电的网线接到PoE-MH的正确位置。PoE-MH除了供电源适配器插入的电源口外，还有两个RJ-45口，其中一个RJ-45（#1）和电源在一侧，另外一个RJ-45口（#2）在另外一侧。给设备供电的网线应该插在RJ-45#2，如果插到了RJ-45#1的话是无法给AP供电的。 3.6光模块插入设备的光口时反插导致设备光口工作异常 
创建MDC后，执行allocate接口操作，无法在该MDC下找到预分配接口或提示失败。 ,•待分配接口已属于其他MDC。 •未按接口分组整组分配或删除。 3.故障分析 本类故障的诊断流程如图45所示。 图45故障诊断流程图 4.处理步骤 下面以一个举例来展示故障处理步骤，涉及的端口号请以实际组网需求为准。 假如需要将接口Ten-GigabitEthernet1/3/0/1～Ten-GigabitEthernet1/3/0/48分配给mdcB。但现在这些接口位于mdcA中。分配步骤如下： (1)使用displaymdcinterface命令查看待分配物理接口是否已被分配给其他非缺省MDC。 [Sysname]displaymdcinterface MDCAdmin'sinterface(s): M-GigabitEthernet1/0/0/0 MDCmdcA'sinterface(s): M-GigabitEthernet1/0/0/0Ten-GigabitEthernet1/3/0/1 Ten-GigabitEthernet1/3/0/2Ten-GigabitEthernet1/3/0/3Ten-GigabitEthernet1/3/0/4Ten-GigabitEthernet1/3/0/5 Ten-GigabitEthernet1/3/0/6Ten-GigabitEthernet1/3/0/7 Ten-GigabitEthernet1/3/0/8Ten-GigabitEthernet1/3/0/9 Ten-GigabitEthernet1/3/0/10Ten-GigabitEthernet1/3/0/11 Ten-GigabitEthernet1/3/0/12Ten-GigabitEthernet1/3/0/13 Ten-GigabitEthernet1/3/0/14Ten-GigabitEthernet1/3/0/15 Ten-GigabitEthernet1/3/0/16Ten-GigabitEthernet1/3/0/17 Ten-GigabitEthernet1/3/0/18Ten-GigabitEthernet1/3/0/19 Ten-GigabitEthernet1/3/0/20Ten-GigabitEthernet1/3/0/21Ten-GigabitEthernet1/3/0/22Ten-GigabitEthernet1/3/0/23Ten-GigabitEthernet1/3/0/24Ten-GigabitEthernet1/3/0/25 Ten-GigabitEthernet1/3/0/26Ten-GigabitEthernet1/3/0/27 Ten-GigabitEthernet1/3/0/28Ten-GigabitEthernet1/3/0/29Ten-GigabitEthernet1/3/0/30Ten-GigabitEthernet1/3/0/31 Ten-GigabitEthernet1/3/0/32Ten-GigabitEthernet1/3/0/33Ten-GigabitEthernet1/3/0/34Ten-GigabitEthernet1/3/0/35Ten-GigabitEthernet1/3/0/36Ten-GigabitEthernet1/3/0/37 Ten-GigabitEthernet1/3/0/38Ten-GigabitEthernet1/3/0/39 Ten-GigabitEthernet1/3/0/40Ten-GigabitEthernet1/3/0/41 Ten-GigabitEthernet1/3/0/42Ten-GigabitEthernet1/3/0/43 Ten-GigabitEthernet1/3/0/44Ten-GigabitEthernet1/3/0/45 Ten-GigabitEthernet1/3/0/46Ten-GigabitEthernet1/3/0/47Ten-GigabitEthernet1/3/0/48 MDCmdcB'sinterface(s): M-GigabitEthernet1/0/0/0 上述显示信息表示，接口Ten-GigabitEthernet1/3/0/1～Ten-GigabitEthernet1/3/0/48位于mdcA中。 (2)使用displaythis命令查看mdcA下的配置。 [Sysname-mdc-2-mdcA]displaythis #mdcmdcAid2locationchassis1slot3mdcstart allocateinterfaceTen-GigabitEthernet1/3/0/1toTen-GigabitEthernet1/3/0/48 #return上述显示信息表示，mdcA下分配了1号成员设备的3号槽位业务板。 (3)将此业务板和接口从mdcA中删除。 [Sysname-mdc-2-mdcA]undolocationchassis1slot3 TheconfigurationassociatedwiththespecifiedslotofMDCwillbelost.Continue? [Y/N]:y [Sysname-mdc-2-mdcA]undoallocateinterfaceTen-GigabitEthernet1/3/0/1to Ten-GigabitEthernet1/3/0/48 Configurationoftheinterfaceswillbelost.Continue?[Y/N]:y (4)为mdcB分配此业务板和物理接口。 [Sysname]mdcmdcB [Sysname-mdc-3-mdcB]allocateinterfaceTen-GigabitEthernet1/3/0/1to Ten-GigabitEthernet1/3/0/48 Configurationoftheinterfaceswillbelost.Continue?[Y/N]:y [Sysname-mdc-3-mdcB]quit [Sysname-mdc-3-mdcB]locationchassis1slot3 (5)若分配接口时提示失败，请按组划分接口。 同一业务板上的接口需要按组分配给不同的MDC，并且需要将该业务板也分配给这些MDC（需要注意的是，部分设备一块业务板仅能分配给一个MDC，即此类设备同一业务板上的接口只能属于一个MDC）。 若按组分配接口时仍提示失败，请执行步骤6。 (6)收集信息并寻求技术支持。 若完成上述步骤后故障仍无法排除，请通收集设备的运行信息，并联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志 无 7接口类故障处理 7.1隧道接口故障处理 7.1.1隧道接口工作不稳定 ,Suggestion not provided
打开客户端上的无线网卡后，刷新无线网络列表，提示Windows无法配置无线连接，而 WirelessZeroConfigure服务已经启动,客户端上安装了该无线网卡自己携带的或者其它无线网卡客户端管理软件（例如H3CiNode无线客户端软件）。此时需要卸载或者退出该无线网卡客户端管理软件和其它相关客户端管理软件（包括 H3CiNode客户端等），然后开启WirelessZeroConfigure服务。 5.6客户端可以Ping通AC，也能Telnet到AC，但是无法通过Web登录成功 ,客户端上安装了该无线网卡自己携带的或者其它无线网卡客户端管理软件（例如H3CiNode无线客户端软件）。此时需要卸载或者退出该无线网卡客户端管理软件和其它相关客户端管理软件（包括 H3CiNode客户端等），然后开启WirelessZeroConfigure服务。 5.6客户端可以Ping通AC，也能Telnet到AC，但是无法通过Web登录成功 
打开客户端上的无线网卡后，刷新无线网络列表，提示Windows无法配置无线连接，而 WirelessZeroConfigure服务已经启动。 ,客户端上安装了该无线网卡自己携带的或者其它无线网卡客户端管理软件（例如H3CiNode无线客户端软件）。此时需要卸载或者退出该无线网卡客户端管理软件和其它相关客户端管理软件（包括 H3CiNode客户端等），然后开启WirelessZeroConfigure服务。 5.6客户端可以Ping通AC，也能Telnet到AC，但是无法通过Web登录成功 ,客户端上安装了该无线网卡自己携带的或者其它无线网卡客户端管理软件（例如H3CiNode无线客户端软件）。此时需要卸载或者退出该无线网卡客户端管理软件和其它相关客户端管理软件（包括 H3CiNode客户端等），然后开启WirelessZeroConfigure服务。 5.6客户端可以Ping通AC，也能Telnet到AC，但是无法通过Web登录成功 
当AC与AP间隧道断开，RemoteAP功能生效后，原有终端业务不受影响，新终端出现无法接入的故障,本类故障的常见原因主要包括： •终端认证/关联位置没有配置在AP上，导致新终端无法完成关联/认证流程。 •当使用远程认证时，没有将相关配置下发给AP，导致新终端无法接入。 •当使用本地MAC认证时，没有将相关配置下发给AP，导致新终端无法接入。 图4-16原有终端业务不受影响，新终端无法接入故障排查流程图 ,(1)查看终端关联/认证位置 查看终端接入的的无线服务模板配置。具体操作步骤为进入无线服务模板视图，执行displaythis命令查看当前配置，以下文的操作为例。 <AC>system-view [AC]wlanservice-template1 [AC-wlan-st-1]displaythis # wlanservice-template1ssidservice clientforwarding-locationapclientassociation-locationapclient-securityauthentication-locationapakmmodepsk preshared-keypass-phrasecipher$c$3$X2Rlxl49vpJ158WfBfCMdjt0NpHVdUHApNcScipher-suiteccmpsecurity-iersnipverifysourceservice-templateenable # 如果终端关联位置或用户接入认证位置为AC，则在无线服务模板视图下，通过clientassociation-locationap配置终端关联位置为AP，通过client-securityauthentication-locationap命令配置用户接入认证位置为AP。 如果如果终端关联位置和用户接入认证位置为AP，请继续执行步骤(2)。 (2)查看远程认证配置 使用远程认证对于原有终端业务不受影响，对于新接入终端则需要保证以下两点，才能接入。a.AP和远程认证服务器网络互通。 b.全部的远程认证配置通过map文件等方式下发AP。因为远程认证对AP的资源占用和性能影响较大，故不建议在RemoteAP场景下使用远程认证。 如果配置了远程认证，建议修改配置，采用本地认证。 如果没有配置远程认证，请继续执行步骤(3)。 (3)查看本地认证配置 如果配置了本地MAC认证，需要将domain以及local-user都通过map文件等方式下发到AP，才能保证新终端的正常接入。下文以map文件方式下发配置的操作为例。 #编辑apcfg.txt配置文件，内容为： system-viewvlan44 InterfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan44 # domainmac1 Authorization-attributeidle-cut151024Authenticationlan-accesslocal # local-user3cf0114e7811classnetworkpasswordsimple3cf0114e7811service-typelan-access #将配置文件apcfg.txt上传至AC。（略）#在AC上将配置文件apcfg.txt下发到AP。 [AC-wlan-ap-ap1]map-configurationapcfg.txt[AC-wlan-ap-ap1]quit 如果没有配置本地认证，请继续执行步骤(4)。 (4)如果故障仍不能排除，请收集如下信息，并拨打热线400-810-0504求助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.23802.1X认证下发ACL失败 
当AC与AP间隧道断开，RemoteAP功能生效后，原有终端业务不受影响，新终端出现无法接入的故障。 ,本类故障的常见原因主要包括： •终端认证/关联位置没有配置在AP上，导致新终端无法完成关联/认证流程。 •当使用远程认证时，没有将相关配置下发给AP，导致新终端无法接入。 •当使用本地MAC认证时，没有将相关配置下发给AP，导致新终端无法接入。 图4-16原有终端业务不受影响，新终端无法接入故障排查流程图 ,(1)查看终端关联/认证位置 查看终端接入的的无线服务模板配置。具体操作步骤为进入无线服务模板视图，执行displaythis命令查看当前配置，以下文的操作为例。 <AC>system-view [AC]wlanservice-template1 [AC-wlan-st-1]displaythis # wlanservice-template1ssidservice clientforwarding-locationapclientassociation-locationapclient-securityauthentication-locationapakmmodepsk preshared-keypass-phrasecipher$c$3$X2Rlxl49vpJ158WfBfCMdjt0NpHVdUHApNcScipher-suiteccmpsecurity-iersnipverifysourceservice-templateenable # 如果终端关联位置或用户接入认证位置为AC，则在无线服务模板视图下，通过clientassociation-locationap配置终端关联位置为AP，通过client-securityauthentication-locationap命令配置用户接入认证位置为AP。 如果如果终端关联位置和用户接入认证位置为AP，请继续执行步骤(2)。 (2)查看远程认证配置 使用远程认证对于原有终端业务不受影响，对于新接入终端则需要保证以下两点，才能接入。a.AP和远程认证服务器网络互通。 b.全部的远程认证配置通过map文件等方式下发AP。因为远程认证对AP的资源占用和性能影响较大，故不建议在RemoteAP场景下使用远程认证。 如果配置了远程认证，建议修改配置，采用本地认证。 如果没有配置远程认证，请继续执行步骤(3)。 (3)查看本地认证配置 如果配置了本地MAC认证，需要将domain以及local-user都通过map文件等方式下发到AP，才能保证新终端的正常接入。下文以map文件方式下发配置的操作为例。 #编辑apcfg.txt配置文件，内容为： system-viewvlan44 InterfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan44 # domainmac1 Authorization-attributeidle-cut151024Authenticationlan-accesslocal # local-user3cf0114e7811classnetworkpasswordsimple3cf0114e7811service-typelan-access #将配置文件apcfg.txt上传至AC。（略）#在AC上将配置文件apcfg.txt下发到AP。 [AC-wlan-ap-ap1]map-configurationapcfg.txt[AC-wlan-ap-ap1]quit 如果没有配置本地认证，请继续执行步骤(4)。 (4)如果故障仍不能排除，请收集如下信息，并拨打热线400-810-0504求助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.23802.1X认证下发ACL失败 
当AP通过AC自动从V7旧版本升级到V7新版本时，AP出现版本升级失败的现象,"本类故障的常见原因主要包括： •AC未升级到最新版本 •AC的ipe文件里没有对应AP的ipe文件 •AC已关闭AP版本升级功能 •AC的版本和AP要升级版本不一致 3.故障分析 本类故障的诊断流程如图5-2所示。 图5-2AP通过AC自动升级版本失败故障诊断流程图 4.处理步骤 (1)执行displayversion命令确认AC版本是否已经升级到新版本。 如果AC已经升级到最新版本，请参见步骤（2）。 [Sysname]displayversion H3CComwareSoftware,Version7.1.064,ESS5568Copyright(c)2004-2021NewH3CTechnologiesCo.,Ltd.Allrightsreserved. H3CWX2560Xuptimeis1week,0days,8hours,10minutes 如果AC没有升级到最新版本，请参考对应软件版本说明书重新升级AC到最新版本。 (2)通过查看软件版本说明书，了解待升级AP的ipe文件相关信息，并执行dirapimge命令查看AC的ipe文件里是否有对应AP的ipe文件，以及确认文件大小是否正确。 如果AC的ipe文件里存在对应AP的ipe文件且文件无问题，请参见步骤（3）。 <Sysname>dirapimge Directoryofcfa0:/apimge 0-rw-14518272Jun07202103:56:22wa4300h.ipe1-rw-14533632Jun07202103:56:16wa4300s.ipe2-rw-23323648Jun07202103:56:18wa5300.ipe 3-rw-48217088Jun07202103:56:32wa6300.ipe 4-rw-48883712Jun07202103:57:00wa6300a.ipe5-rw-36919296Jun07202103:56:26wa6500.ipe6-rw-52670464Jun07202103:57:06wa6500a.ipe7-rw-50496512Jun07202103:57:12wa6500b.ipe8-rw-63531008Jun07202103:56:38wa6600.ipe 如果AC的ipe文件里不存在对应AP的ipe文件或文件异常，请到官网“产品支持与服务/文档与软件/软件下载/无线”路径下载对应产品的版本文件压缩包，解压后将需要的AP文件上传到设备的\apimge路径下即可。 WX2500H系列、3010H等系列的AC的ipe文件中无部分型号AP的ipe文件，具体可参见对应版本说明书。其它系列的AC默认都会包含所有AP的ipe文件，不需要单独上传 AP的ipe文件。 (3)查看AC的AP视图、AP组视图或者全局视图下是否配置了firmware-upgradedisable命令（系统默认是firmware-upgradeenable）。 如果配置了firmware-upgradedisable命令，则AC不会检测AP的版本匹配情况，且不会通知AP下载新版本。请执行undofirmware-upgrade，开启AP版本升级功能。 #AP视图 <Sysname>system-view [Sysname]wlanapap3modelWA6320 [Sysname-wlan-ap-ap3]firmware-upgradedisable #AP组视图 <Sysname>system-view [Sysname]wlanap-groupgroup1 [Sysname-wlan-ap-group-group1]firmware-upgradedisable #全局配置视图 <Sysname>system-view [Sysname]wlanglobal-configuration [Sysname-wlan-global-configuration]firmware-upgradedisable 如果没有配置firmware-updatedisable命令，请参见步骤（4）。 (4)执行displaywlanap-modelnamemodel-name命令，确认该AP要升级的版本与当前AC的配套版本是否一致。 当apdb命令指定的软件版本优先于AC和AP默认匹配的版本时，请先开启版本检查功能 （firmware-updateenable）。 如果该AP要升级的版本与当前AC的配套版本不一致，需要在AC上执行apdb命令指定要单独升级的AP版本。 <Sysname>system-view [Sysname]wlanapdbWA6320Ver.CE2108 [Sysname]wlanimage-loadfilepathlocal//下载目录下的文件 如果该AP要升级的版本与当前AC的配套版本一致，则删除AC的apdb命令和 image-loadfilepathlocal命令，只保留firmware-updateenable命令。 (5)通过以上步骤分析依旧无法解决问题，请在AC、AP上收集版本升级失败的完整过程信息，并联系H3C售后技术人员分析处理。 <Sysname>debuggingwlancapwaperrorall <Sysname>terminaldebugging Thecurrentterminalisenabledtodisplaydebugginglogs. <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 5.10AP通过BootWare菜单手动升级版本失败 ",Suggestion not provided
当AP通过AC自动从V7旧版本升级到V7新版本时，AP出现版本升级失败的现象。 ,"本类故障的常见原因主要包括： •AC未升级到最新版本 •AC的ipe文件里没有对应AP的ipe文件 •AC已关闭AP版本升级功能 •AC的版本和AP要升级版本不一致 3.故障分析 本类故障的诊断流程如图5-2所示。 图5-2AP通过AC自动升级版本失败故障诊断流程图 4.处理步骤 (1)执行displayversion命令确认AC版本是否已经升级到新版本。 如果AC已经升级到最新版本，请参见步骤（2）。 [Sysname]displayversion H3CComwareSoftware,Version7.1.064,ESS5568Copyright(c)2004-2021NewH3CTechnologiesCo.,Ltd.Allrightsreserved. H3CWX2560Xuptimeis1week,0days,8hours,10minutes 如果AC没有升级到最新版本，请参考对应软件版本说明书重新升级AC到最新版本。 (2)通过查看软件版本说明书，了解待升级AP的ipe文件相关信息，并执行dirapimge命令查看AC的ipe文件里是否有对应AP的ipe文件，以及确认文件大小是否正确。 如果AC的ipe文件里存在对应AP的ipe文件且文件无问题，请参见步骤（3）。 <Sysname>dirapimge Directoryofcfa0:/apimge 0-rw-14518272Jun07202103:56:22wa4300h.ipe1-rw-14533632Jun07202103:56:16wa4300s.ipe2-rw-23323648Jun07202103:56:18wa5300.ipe 3-rw-48217088Jun07202103:56:32wa6300.ipe 4-rw-48883712Jun07202103:57:00wa6300a.ipe5-rw-36919296Jun07202103:56:26wa6500.ipe6-rw-52670464Jun07202103:57:06wa6500a.ipe7-rw-50496512Jun07202103:57:12wa6500b.ipe8-rw-63531008Jun07202103:56:38wa6600.ipe 如果AC的ipe文件里不存在对应AP的ipe文件或文件异常，请到官网“产品支持与服务/文档与软件/软件下载/无线”路径下载对应产品的版本文件压缩包，解压后将需要的AP文件上传到设备的\apimge路径下即可。 WX2500H系列、3010H等系列的AC的ipe文件中无部分型号AP的ipe文件，具体可参见对应版本说明书。其它系列的AC默认都会包含所有AP的ipe文件，不需要单独上传 AP的ipe文件。 (3)查看AC的AP视图、AP组视图或者全局视图下是否配置了firmware-upgradedisable命令（系统默认是firmware-upgradeenable）。 如果配置了firmware-upgradedisable命令，则AC不会检测AP的版本匹配情况，且不会通知AP下载新版本。请执行undofirmware-upgrade，开启AP版本升级功能。 #AP视图 <Sysname>system-view [Sysname]wlanapap3modelWA6320 [Sysname-wlan-ap-ap3]firmware-upgradedisable #AP组视图 <Sysname>system-view [Sysname]wlanap-groupgroup1 [Sysname-wlan-ap-group-group1]firmware-upgradedisable #全局配置视图 <Sysname>system-view [Sysname]wlanglobal-configuration [Sysname-wlan-global-configuration]firmware-upgradedisable 如果没有配置firmware-updatedisable命令，请参见步骤（4）。 (4)执行displaywlanap-modelnamemodel-name命令，确认该AP要升级的版本与当前AC的配套版本是否一致。 当apdb命令指定的软件版本优先于AC和AP默认匹配的版本时，请先开启版本检查功能 （firmware-updateenable）。 如果该AP要升级的版本与当前AC的配套版本不一致，需要在AC上执行apdb命令指定要单独升级的AP版本。 <Sysname>system-view [Sysname]wlanapdbWA6320Ver.CE2108 [Sysname]wlanimage-loadfilepathlocal//下载目录下的文件 如果该AP要升级的版本与当前AC的配套版本一致，则删除AC的apdb命令和 image-loadfilepathlocal命令，只保留firmware-updateenable命令。 (5)通过以上步骤分析依旧无法解决问题，请在AC、AP上收集版本升级失败的完整过程信息，并联系H3C售后技术人员分析处理。 <Sysname>debuggingwlancapwaperrorall <Sysname>terminaldebugging Thecurrentterminalisenabledtodisplaydebugginglogs. <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 5.10AP通过BootWare菜单手动升级版本失败 ",Suggestion not provided
当AP通过bootware菜单手动从V7旧版本升级到V7新版本时，AP出现版本升级失败的现象,"本类故障的常见原因主要包括：•未导入正确AP版本升级文件 •IP、下载路径等设置错误 •AP版本升级文件出现异常 •AP存储空间不足 3.故障分析 本类故障的诊断流程如图5-3所示。 图5-3AP通过bootware菜单手动升级版本失败故障诊断流程图 4.故障处理步骤 由于V7的软件包里没有单独存放AP的ipe文件，如果需要手动给AP导入新版本，首先需要获取正确的ipe文件，然后通过bootware菜单导入版本文件。AP的ipe文件可以在AC的apimge文件夹中下载，也可联系售后技术支持人员获取。 (1)执行displayversion命令检查版本信息，确保所导入的版本文件是正确的AP版本升级文件。 如果版本信息正确，请参见步骤（2）。 如果版本信息不正确，请将正确的AP版本升级文件拷贝到服务器，并参考对应版本说明书重新升级AP到最新版本。 <H3C>displayversion H3CComwareSoftware,Version7.1.064,Release2449P01 Copyright(c)2004-2022NewH3CTechnologiesCo.,Ltd.Allrightsreserved. H3CWA6320uptimeis0weeks,0days,0hours,0minutes Lastrebootreason:Usersoftreboot Bootimage:flash:/wa6300-boot.bin Bootimageversion:7.1.064,Release2449P01CompiledJul19202116:00:00 Systemimage:flash:/wa6300-system.bin Systemimageversion:7.1.064,Release2449P01 CompiledJul19202116:00:00 以协议方式选择TFTP为例，LoadFileName表示下载文件名，要与下载的实际文件名一致；TargetFileName表示存储的目标文件名，缺省情况下与服务器端文件名一致； ServerIPAddress表示TFTP/FTP服务器的IP地址；LocalIPAddress表示本地IP地址，且必须保证和ServerIPAddress在同一网段；GatewayIPAddress保持0.0.0.0即可。 ==========================<ETHERNETPARAMETERSET>========================== |Note:'.'=Clearfield.| |'-'=Gotopreviousfield.| |Ctrl+D=Quit.| ============================================================================ Protocol(FTPorTFTP):tftpLoadFileName:wa6300.ipe: TargetFileName:wa6300.ipe: ServerIPAddress:192.168.1.1 LocalIPAddress:192.168.1.253 SubnetMask:0.0.0.0 GatewayIPAddress:0.0.0.0 (2)确认升级过程中，是否出现以下提示内容。 如果出现提示“LoadingFailed!”，表示版本下载失败，请检查以下内容。 −请检查TFTP下载路径是否正确； −请检查TFTP端口是否处于监听状态； −请检查PC是否和AP二层有线互通； −请检查ServerIPAddress设置是否有问题； −请检查LocalIPAddress是否和ServerIPAddress在同一网段。 如果出现提示“Somethingwrongwiththefile！”，表示上传的版本文件有问题导致运行异常。同时，当版本文件出现问题时，设备在启动时会提示“BootingAppfails!”。−请检查版本的TargetFileName是否写错，尤其注意下划线和连字符的区别； −请注意fit和fat的区别，例如在fit模式下上传了一个fat版本，或在fat模式下上传了一个fit版本； −请检查文件的大小，查看下载的文件是否完整，上传的版本文件是否和AP型号匹配等。 如果提示“ThespaceisnotenoughFailed!”，表示存储空间不够。需要删除AP里面不用的版本或格式化后再重新导入版本。 如果没有相关提示，且当版本下载成功后，将显示如下信息。 Loading..................................................................... ............................................................................ ........................................................................................................................................................ ............................................................................ ............................................................................ ............................................................................ ............................................................................ .................................................................................................................Done. 36462592bytesdownloaded! Imagefilewa6300-boot.binisself-decompressing... Savingfileflash:/wa6300-boot.bin.................................Done. Imagefilewa6300-system.binisself-decompressing... Savingfileflash:/wa6300-system.bin....................................... ................................Done. (3)通过以上步骤分析依旧无法解决问题，请记录下AP升级过程中的打印信息和其它相关信息，反馈给售后技术支持人员。以AP启动的打印信息为例： BootWareValidating... PressCtrl+Btoenterextendedbootmenu... ..略.. Systemimageisstarting... Startupconfigurationfiledoesn'texistorisinvalid. Linecon0isavailable. PressENTERtogetstarted. 5.11FitAP异常掉线 ",Suggestion not provided
当AP通过bootware菜单手动从V7旧版本升级到V7新版本时，AP出现版本升级失败的现象。 ,"本类故障的常见原因主要包括：•未导入正确AP版本升级文件 •IP、下载路径等设置错误 •AP版本升级文件出现异常 •AP存储空间不足 3.故障分析 本类故障的诊断流程如图5-3所示。 图5-3AP通过bootware菜单手动升级版本失败故障诊断流程图 4.故障处理步骤 由于V7的软件包里没有单独存放AP的ipe文件，如果需要手动给AP导入新版本，首先需要获取正确的ipe文件，然后通过bootware菜单导入版本文件。AP的ipe文件可以在AC的apimge文件夹中下载，也可联系售后技术支持人员获取。 (1)执行displayversion命令检查版本信息，确保所导入的版本文件是正确的AP版本升级文件。 如果版本信息正确，请参见步骤（2）。 如果版本信息不正确，请将正确的AP版本升级文件拷贝到服务器，并参考对应版本说明书重新升级AP到最新版本。 <H3C>displayversion H3CComwareSoftware,Version7.1.064,Release2449P01 Copyright(c)2004-2022NewH3CTechnologiesCo.,Ltd.Allrightsreserved. H3CWA6320uptimeis0weeks,0days,0hours,0minutes Lastrebootreason:Usersoftreboot Bootimage:flash:/wa6300-boot.bin Bootimageversion:7.1.064,Release2449P01CompiledJul19202116:00:00 Systemimage:flash:/wa6300-system.bin Systemimageversion:7.1.064,Release2449P01 CompiledJul19202116:00:00 以协议方式选择TFTP为例，LoadFileName表示下载文件名，要与下载的实际文件名一致；TargetFileName表示存储的目标文件名，缺省情况下与服务器端文件名一致； ServerIPAddress表示TFTP/FTP服务器的IP地址；LocalIPAddress表示本地IP地址，且必须保证和ServerIPAddress在同一网段；GatewayIPAddress保持0.0.0.0即可。 ==========================<ETHERNETPARAMETERSET>========================== |Note:'.'=Clearfield.| |'-'=Gotopreviousfield.| |Ctrl+D=Quit.| ============================================================================ Protocol(FTPorTFTP):tftpLoadFileName:wa6300.ipe: TargetFileName:wa6300.ipe: ServerIPAddress:192.168.1.1 LocalIPAddress:192.168.1.253 SubnetMask:0.0.0.0 GatewayIPAddress:0.0.0.0 (2)确认升级过程中，是否出现以下提示内容。 如果出现提示“LoadingFailed!”，表示版本下载失败，请检查以下内容。 −请检查TFTP下载路径是否正确； −请检查TFTP端口是否处于监听状态； −请检查PC是否和AP二层有线互通； −请检查ServerIPAddress设置是否有问题； −请检查LocalIPAddress是否和ServerIPAddress在同一网段。 如果出现提示“Somethingwrongwiththefile！”，表示上传的版本文件有问题导致运行异常。同时，当版本文件出现问题时，设备在启动时会提示“BootingAppfails!”。−请检查版本的TargetFileName是否写错，尤其注意下划线和连字符的区别； −请注意fit和fat的区别，例如在fit模式下上传了一个fat版本，或在fat模式下上传了一个fit版本； −请检查文件的大小，查看下载的文件是否完整，上传的版本文件是否和AP型号匹配等。 如果提示“ThespaceisnotenoughFailed!”，表示存储空间不够。需要删除AP里面不用的版本或格式化后再重新导入版本。 如果没有相关提示，且当版本下载成功后，将显示如下信息。 Loading..................................................................... ............................................................................ ........................................................................................................................................................ ............................................................................ ............................................................................ ............................................................................ ............................................................................ .................................................................................................................Done. 36462592bytesdownloaded! Imagefilewa6300-boot.binisself-decompressing... Savingfileflash:/wa6300-boot.bin.................................Done. Imagefilewa6300-system.binisself-decompressing... Savingfileflash:/wa6300-system.bin....................................... ................................Done. (3)通过以上步骤分析依旧无法解决问题，请记录下AP升级过程中的打印信息和其它相关信息，反馈给售后技术支持人员。以AP启动的打印信息为例： BootWareValidating... PressCtrl+Btoenterextendedbootmenu... ..略.. Systemimageisstarting... Startupconfigurationfiledoesn'texistorisinvalid. Linecon0isavailable. PressENTERtogetstarted. 5.11FitAP异常掉线 ",Suggestion not provided
当AP通过版本预下载方式从V7旧版本升级到V7新版本时，AP出现版本升级失败的现象,本类故障的常见原因主要包括： •下载过程中AP掉线 •AP内存不足 •预下载文件不存在 •AP版本重传失败 •AP应答版本下载报文超时 3.故障分析 本类故障的诊断流程如图5-1所示。 图5-1AP通过版本预下载方式升级版本失败故障诊断流程图 4.处理步骤 当AP开始进行版本预下载时，可通过执行displaywlanapstatisticsimage-download 命令查看AP软件版本预下载进度、花费时间、本次需要进行版本升级的AP的数量、下载成功的AP的数量、正在下载版本的AP的数量，下载版本失败的AP的数量。 (1)当AP出现版本预下载失败时，请执行displaywlanapstatisticsimage-downloadfailed命令查看AP预下载失败的原因。 [Sysname]displaywlanapstatisticsimage-downloadfailed APnameFailurereasonap1Tunneldownap2APmemorynotenoughap3Imagefiledoesnotexist 如果提示失败原因为“Tunneldown”，表示AP下线。请检查AP链路，并使AP在AC上重新上线，然后重新配置AC给AP下发版本。 如果提示失败原因为“APmemorynotenough”，表示AP内存不足。建议重启AP或删除不用的文件，等AP重新上线后再进行预下载。 如果提示失败原因为“Imagefiledoesnotexist”，表示文件不存在。请检查文件是否存在或出现异常，具体可参见5.9(2)。 如果提示失败原因为“Retransmissionfailed”，表示AP版本重传失败。请检查网络，确认网络是否存在大延时或丢包。 如果提示失败原因为“Timeout”，表示AP应答版本下载报文超时。请检查网络，确认网络是否存在大延时或丢包。 (2)通过以上步骤分析依旧无法解决问题，请在AC、AP上收集版本升级失败的完整过程信息，并联系H3C售后技术人员分析处理。 <Sysname>debuggingwlancapwaperrorall <Sysname>terminaldebugging Thecurrentterminalisenabledtodisplaydebugginglogs. <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 5.9AP通过AC自动升级版本失败 ,Suggestion not provided
当AP通过版本预下载方式从V7旧版本升级到V7新版本时，AP出现版本升级失败的现象。 ,本类故障的常见原因主要包括： •下载过程中AP掉线 •AP内存不足 •预下载文件不存在 •AP版本重传失败 •AP应答版本下载报文超时 3.故障分析 本类故障的诊断流程如图5-1所示。 图5-1AP通过版本预下载方式升级版本失败故障诊断流程图 4.处理步骤 当AP开始进行版本预下载时，可通过执行displaywlanapstatisticsimage-download 命令查看AP软件版本预下载进度、花费时间、本次需要进行版本升级的AP的数量、下载成功的AP的数量、正在下载版本的AP的数量，下载版本失败的AP的数量。 (1)当AP出现版本预下载失败时，请执行displaywlanapstatisticsimage-downloadfailed命令查看AP预下载失败的原因。 [Sysname]displaywlanapstatisticsimage-downloadfailed APnameFailurereasonap1Tunneldownap2APmemorynotenoughap3Imagefiledoesnotexist 如果提示失败原因为“Tunneldown”，表示AP下线。请检查AP链路，并使AP在AC上重新上线，然后重新配置AC给AP下发版本。 如果提示失败原因为“APmemorynotenough”，表示AP内存不足。建议重启AP或删除不用的文件，等AP重新上线后再进行预下载。 如果提示失败原因为“Imagefiledoesnotexist”，表示文件不存在。请检查文件是否存在或出现异常，具体可参见5.9(2)。 如果提示失败原因为“Retransmissionfailed”，表示AP版本重传失败。请检查网络，确认网络是否存在大延时或丢包。 如果提示失败原因为“Timeout”，表示AP应答版本下载报文超时。请检查网络，确认网络是否存在大延时或丢包。 (2)通过以上步骤分析依旧无法解决问题，请在AC、AP上收集版本升级失败的完整过程信息，并联系H3C售后技术人员分析处理。 <Sysname>debuggingwlancapwaperrorall <Sysname>terminaldebugging Thecurrentterminalisenabledtodisplaydebugginglogs. <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 5.9AP通过AC自动升级版本失败 ,Suggestion not provided
当出现以下情况时，说明设备的CPU控制核占用率高，需要确认CPU占用率高的具体原因。•对设备进行每日巡检时，连续使用displaycpu-usage命令查看CPU的占用率，CPU占 执行#displaycpu-usa(用率明显比日常平均值高。)gesummary命令显示最近5秒、1分钟、5分钟内CPU占用率的平均值。 <Sysname>displaycpu-usagesummary SlotCPULast5secLast1minLast5min 105%5%4% #执行displaycpu-usagehistory命令以图表的方式显示最近60个采样点的CPU占用率，观察到CPU占用率持续在增长或者明显比日常平均值高。 •	通过Telnet/SSH等方式登录设备，并执行命令行时，设备反应缓慢，出现卡顿现象。 •	设备上打印CPU占用率高的相关日志。 •	SNMP网管上出现CPU占用率高的相关告警。 ,本类故障的常见原因主要包括： •	Telnet客户端和设备间网络不畅通。 •	Telnet客户端未启用Telnet相关功能。 •	设备未开启Telnet服务。 •	VTY用户线下未配置支持Telnet协议。 •	登录用户名、密码不正确。 •	登录设备的用户数达到了上限。 •	设备上配置了对Telnet用户的访问控制，Telnet客户端不在所引用ACL的规则中permit的用户范围之内。 •	认证方式配置不正确。 •	当Telnet客户端和Telnet服务器均为我司设备时，用户未从Telnet客户端上指定的发送Telnet报文的源地址或源接口登录Telnet服务器。 3.	故障分析 本类故障的诊断流程如图37所示。 图37Telnet登录失败的故障诊断流程图 本类故障的常见原因主要包括： •	网络攻击。 •	协议震荡，通常为STP震荡、路由协议震荡等。 •	网络环路。 •	设备上配置了流采样功能，需要处理的流量太大或者设备采样频率太高，导致采样功能占用大量CPU资源。 •	设备产生海量日志，设备生成和管理这些日志需要占用大量CPU资源。 3.	故障分析 本类故障的诊断流程如图38所示。 图38CPU占用率高的故障诊断流程图 ,"(1)	检查客户端能否Ping通设备。 用户在Telnet客户端上执行ping命令查看Telnet客户端和设备之间网络连接情况。如果不能Ping通设备的IP地址，表示Telnet客户端和设备无法建立Telnet连接，则Telnet客户端登录将失败。无法Ping通设备，也可能是终端设备禁Ping导致。请参见“Ping和Tracert故障处理手册”继续定位，确保Telnet客户端与设备之间的网络畅通。 (2)	检查客户端上是否启用Telnet相关功能。通常，在PC机上新建Telnet连接前，需要在PC上的“打开或关闭Windows功能”中启用“Telnet客户端”功能。移动端等其他类型的设备作为Telnet客户端时，开启Telnet相关功能的详细介绍和使用方法请参见该设备的使用指导。 (3)	检查设备侧是否开启Telnet服务。缺省情况下，Telnet服务处于关闭状态。如果系统视图下执行displaythis命令后，没有显示telnetserverenable的配置信息，表示Telnet服务处于关闭状态。请先执行telnetserverenable命令开启Telnet服务，确保设备允许客户端通过Telnet登录。 (4)	查看VTY用户线支持的协议是否包含Telnet协议。 在VTY用户线或VTY用户线类视图下执行displaythis命令， 	如果显示配置信息中不包含protocolinboundtelnet或protocolinboundall，表示用户线下不支持Telnet协议。 	非FIPS模式下，由于系统默认支持所有协议，如果显示配置信息中包含undoprotocolinbound，或者不包含protocolinbound相关配置，表示系统支持所有协议。若用户线下不支持Telnet协议，请配置protocolinboundtelnet或protocolinboundall命令来允许Telnet协议类型的登录用户接入。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modescheme [Sysname-line-vty0-63]protocolinboundall 需要注意的是，修改protocolinbound的配置将在用户下次使用该用户线登录时生效。 (5)	检查客户端登录设备的用户名和密码是否正确。当用户向设备发起Telnet连接，在Telnet客户端按照提示输入登录设备的用户名和密码后，若系统提示认证失败，则建议重新输入用户名和密码，再次尝试登录设备。如果依旧登录失败， 可以查看LOGIN/5/LOGIN_INVALID_USERNAME_PWD日志，若日志中显示类似如下内容时表示用户输入无效的用户名或密码： LOGIN/5/LOGIN_INVALID_USERNAME_PWD:Invalidusernameorpasswordfromvty0. 如果忘记正确的登录用户名或密码，请修改认证方式为不认证，或重置密码，并通知用户再次 	户线类视图下执行authentication-modenone命令，设置用户登 录设备时的认证方式为不认证，用户不需要输入用户名和密码，就可以使用该用户线登录设备，但这种方式存在安全隐患，请谨慎配置。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modenone 	如果登录用户的认证方式为密码认证，在用户线视图或用户线类视图下执行setauthenticationpassword命令来重新设置认证密码。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modepassword [Sysname-line-vty0-63]setauthenticationpasswordsimplehello12345&！ 	如果登录用户的认证方式为AAA认证，请参见“AAA&PasswordControl故障处理手册”重置密码。(6)检查登录设备的用户数是否达到了上限。从Console口登录到设备，在任意视图下执行displayusers命令查看当前的Telnet用户数。缺省情况下，同时在线的Telnet用户数上限为32个。可以查看TELNETD/6/TELNETD_REACH_SESSION_LIMIT日志，若日志中显示类似如下内容，表示Telnet登录用户达到上限： TELNETD/6/TELNETD_REACH_SESSION_LIMIT:Telnetclient1.1.1.1failedtologin.ThecurrentnumberofTelnetsessionsis10.Themaximumnumberallowedis(10). 如果登录设备的用户数已经达到了上限，可以先断开其他空闲Telnet用户的连接，或者执行aaasession-limittelnet命令增加允许同时在线的最大用户连接数，然后再向设备发起Telnet连接。(7)查看设备上是否引用了ACL对Telnet用户的访问进行控制。 在系统视图下执行displaythis命令，如果显示telnetserveracl、telnetserveripv6acl相关配置信息，表示引用了ACL对访问设备的Telnet的用户进行控制。 	确认所引用的ACL规则中允许了Telnet客户端的IP地址、端口号、协议号等。可以查看TELNETD_ACL_DENY日志，若日志中显示类似如下内容，表示TelnetACL规则限制登录IP地址： TELNETD/5/TELNETD_ACL_DENY:TheTelnetConnection1.2.3.4(vpn1)requestwasdeniedaccordingtoACLrules. 	执行undotelnetserveracl或undotelnetserveripv6acl命令来取消 ACL对Telnet用户的访问限制。(8)检查设备上认证方式配置是否正确。在任意视图下执行displayline命令查看用户线下用户登录设备时的认证方式，其中“Auth”字段表示使用该用户线登录的用户的认证方式，取值为“A”表示使用AAA认证方式，取值为“N”表示无需认证，取值为“P”表示使用当前用户线的密码进行认证。 	如果使用命令authentication-modepassword配置了VTY用户线下的登录认证方 	如果使用命令authentication-modesche(式为密码认证，还需要确保设置了认证密码。)me设置认证方式为AAA，则必须确保已经创建了AAA认证用户。具体请参见“AAA&PasswordControl故障处理手册”。 (9)	当Telnet客户端和Telnet服务器均为我司设备时，检查Telnet客户端上是否配置了发送Telnet 在系统视图下执行displ(报文的源地址或源接口。)aythis命令，如果显示中包含telnetclientsource的相关配置信息，表示Telnet客户端上指定了发送Telnet报文的源IPv4地址和源接口，请确保用户从Telnet客户端上指定的源IPv4地址或源接口登录Telnet服务器。若登录失败，请选择以下配置后重新尝试登录： 	执行telnetclientsource命令重新配置发送Telnet报文的源IPv4地址或源接口。 	执行undotelnetclientsource命令来恢复缺省情况，即不指定发送Telnet报文的源IPv4地址和源接口，使用报文路由出接口的主IPv4地址作为Telnet报文的源地址。需要注意的是， 	在用户视图下执行telnet命令也可以指定Telnet报文的源接口或源IPv4地址，若同时使用telnetclientsource命令和telnet命令指定源IPv4地址或源接口，则以telnet命令指定的源IP地址或源接口为准。 	在IPv6组网环境下，可以通过用户视图下的telnetipv6命令来指定Telnet报文的源接口或源IPv6地址。 (10)	如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •	LOGIN/5/LOGIN_FAILED •	LOGIN/5/LOGIN_INVALID_USERNAME_PWD •	TELNETD/5/TELNETD_ACL_DENY •	TELNETD/6/TELNETD_REACH_SESSION_LIMIT 5.2硬件资源管理故障处理 5.2.1CPU占用率高 (1)	确认设备是否受到网络攻击。 现网中，导致设备CPU占用率高最常见的原因是网络攻击。攻击者发起大量非正常网络交互对设备产生冲击，例如短时间内发送大量TCP连接建立请求报文或者ICMP请求报文，设备忙于处理这些攻击报文，导致CPU占用率高，从而影响设备正常业务的运行。 	如果受到了网络攻击，则先解决网络攻击问题。 	如果未受到网络攻击，则执行步骤(2)。 (2)	确认设备是否出现协议震荡。协议震荡会导致设备不断地处理协议报文、计算拓扑、更新表项，引起CPU占用率高。在实际应用中，最常见的协议震荡为STP协议震荡和OSPF协议震荡。 	对于STP协议震荡，在系统视图执行stpport-log命令打开端口状态变化日志显示开关，如果命令行界面频繁输出以下日志，则说明出现了STP协议震荡。 STP/6/STP_DETECTED_TC:Instance0'sportGigabitEthernet1/0/1detectedatopologychange. STP/6/STP_DISCARDING:Instance0'sportGigabitEthernet1/0/1hasbeensettodiscardingstate. STP/6/STP_NOTIFIED_TC:Instance0'sportGigabitEthernet1/0/1wasnotifiedatopologychange. −如果STP协议震荡，请先排除STP协议震荡问题。 	对(−)OSPF协议震荡，执行于displayip(如果STP协议没有震荡，则继续定位。)routing-table命令，查看路由信息。如果路由表项中相同网段的路由条目被频繁反复地创建和删除，则表示路由震荡。 −如果路由震荡，或者路由一直不存在，则先排除链路问题和IGP路由问题。−如果路由没有震荡，则执行步骤(3)。 (3)	确认是否存在网络环路。 当以太网接口工作在二层模式并且链路存在环路时，可能出现广播风暴和网络振荡。大量的协议报文上送CPU处理，从而导致CPU占用率升高。当存在网络环路时，设备很多端口的流量会明显变大，且广播和组播报文占比较大。可通过以下步骤来确认设备是否存在网络环路，设备是否存在广播、组播、未知单播报文风暴。a.清除接口的统计信息。 <Sysname>resetcountersinterface b.多次执行displaycountersrateinboundinterface命令查看端口使用率是否 明显增大。 <Sysname>displaycountersrateinboundinterfaceUsage:Bandwidthutilizationinpercentage InterfaceUsage(%)Total(pps)Broadcast(pps)Multicast(pps)GE5/3/00.017----MGE0/31/00.011----MGE0/32/00.015---- VMC1/1/00.0560---- VMC1/2/00.0452---- Overflow:Morethan14digits. --:Notsupported. c.如果端口使用率明显增大，可继续多次执行displaycountersinboundinterface 命令查看接口收到的总报文数、广播和组播报文的数量，分别对应显示信息中Total(pkt)、Broadcast(pkt)、Multicast(pkt)字段的取值。如果广播和组播报文的增长速度快，广播、组播报文在接口收到的总报文数中占比大，则可能出现广播/组播风暴。如果广播和组播报文数量没有明显增加，但是接口收到的总报文数明显增加，则可能出现未知单播报文风暴。 <Sysname>displaycountersinboundinterface InterfaceTotal(pkt)Broadcast(pkt)Multicast(pkt)Err(pkt)GE5/3/0141271110MGE0/31/0274866476960--MGE0/32/010630346848082--VMC1/1/0111577977274558500 VMC1/2/096538985619640520 Overflow:Morethan14digits(7digitsforcolumn""Err""). --:Notsupported. 如链路出现环路，可进行如下处理：−排查链路连接，避免物理拓扑出现环路。 −使用displaystp命令检查STP协议是否使能，配置是否正确。如果配置错误，请 −使用displ(修改配置。)aystpbrief和displaystpabnormal-port命令检查邻接设备STP状态是否正常。请根据displaystpabnormal-port命令显示信息中的BlockReason字段的取值，定位并解决STP异常问题。如STP配置均正确，可能为STP协议计算错误或协议计算正确但端口驱动层没有正常Block阻塞，可以在发生环路的接口上执行shutdown/undoshutdown命令或者拔插网线让STP重新计算来快速恢复STP功能，消除环路。 −在以太网接口视图下，使用broadcast-suppression命令开启端口广播风暴抑制功能，使用multicast-suppression命令开启端口组播风暴抑制功能，使用unicast-suppression命令开启端口未知单播风暴抑制功能。或者使用flow-control命令配置流量控制功能。（broadcast-suppression、multicast-suppression、unicast-suppression和flow-control命令仅部 分设备支持，如不支持这些命令请忽略此处理方式）−使用QoS策略针对组播、广播和未知单播报文进行限速。 如未出现环路，请执行步骤(4)或步骤（5）。 (4)	对于支持流统计和采样功能的设备：确认是否配置了流统计和采样功能，以及配置的参数是否合适。当设备上配置了NetStream、sFlow等网络流量监控功能后，设备会对网络流量进行统计分析。如果网络流量较高，可能会导致CPU占用率偏高。此时，可进行以下处理：配置过滤条件来精确匹配流量，仅统计分析用户关心的流量。 	配置采样器，调整采样比例，使得NetStream、sFlow收集到的统计信息既能基本反映整个网络的状况，又能避免统计报文过多影响设备转发性能。 (5)	对于仅支持采样功能的设备：确认是否配置了采样功能，以及配置的参数是否合适。当设备上配置了sFlow等网络流量监控功能后，设备会对网络流量进行统计分析。如果网络流量较高，可能会导致CPU占用率偏高。此时，可进行以下处理：配置采样器，调整采样比例，使得sFlow收集到的统计信息既能基本反映整个网络的状况，又能避免统计报文过多影响设备转发性能。 (6)	确认设备当前是否正在生成海量日志。某些异常情况下，例如，设备受到攻击、运行中发生了错误、端口频繁Up/Down等，设备会不停地产生诊断信息或日志信息。此时系统软件要频繁的读写存储器，会造成CPU占用率升高。 	允许日志信息输出到当前终端。 <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 配置该命令后，如果有大量异常日志或者重复日志输出到命令行界面，则说明设备正在生 	重复执行dis(成海量日志。)playlogbuffersummary命令，如果日志信息总量有明显的增加，再使用displaylogbufferreverse命令查看日志详情，确认是否有大量异常日志或者某一条信息大量重复出现。 <Sysname>displaylogbuffersummary SlotEMERGALERTCRITERRORWARNNOTIFINFODEBUG 1002924121280 5000417282097004211147400 <Sysname>displaylogbufferreverse Logbuffer:Enabled Maxbuffersize:1024 Actualbuffersize:512 Droppedmessages:0 Overwrittenmessages:0 Currentmessages:410 %Jan1508:17:24:2592021SysnameSHELL/6/SHELL_CMD: -Line=vty0-IPAddr=192.168.2.108-User=**;Commandisdisplaylogbuffer %Jan1508:17:19:7432021SysnameSHELL/4/SHELL_CMD_MATCHFAIL: -User=**-IPAddr=192.168.2.108;Commanddisplaylogfileinviewshellfailedtobematched. ... 如果设备正在生成海量日志，可以通过以下方法减少日志的生成： 	ess命令禁止指定模块日志的输出。 	使用info-centerloggingsuppressduplicates命令开启重复日志抑制功能。如果设备未生成海量日志，则执行步骤(6)。 (7)收集CPU占用率相关信息，找到CPU占用率高的业务模块。 a.确定对CPU占用率高的任务。 #在设备上执行displayprocesscpu命令查看一段时间内占用CPU最多的任务。下面以slot1上的操作为例。 <Sysname>displayprocesscpuslot1 CPUutilizationin5secs:0.4%;1min:0.2%;5mins:0.2% JID5Sec1Min5MinName 1	0.0%0.0%0.0%scmd 2	5.5%5.1%5.0%[kthreadd]30.0%0.0%0.0%[ksoftirqd/0] ...如果某个进程的CPU占用率高于3%（经验值供参考），则需要针对该进程继续定位。#在设备上执行monitorprocessdumbtty命令实时查看进程在指定CPU上的占用率。下面以slot1CPU0为例。 <Sysname>system-view [Sysname]monitorprocessdumbttyslot1cpu0 206processes;342threads;5134fds Threadstates:4running,338sleeping,0stopped,0zombie CPU0:99.04%idle,0.00%user,0.96%kernel,0.00%interrupt,0.00%steal CPU1:98.06%idle,0.00%user,1.94%kernel,0.00%interrupt,0.00%steal CPU2:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%stealCPU3:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal CPU4:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal Memory:7940Mtotal,5273Mavailable,pagesize4K JIDPIDPRIStateFDsMEMHH:MM:SSCPUName 322	322115R00K01:48:0320.02%[kdrvfwdd2] 323	323115R00K01:48:0320.02%[kdrvfwdd3] 324	324115R00K01:48:0320.02%[kdrvfwdd4] 376376120S22159288K00:00:070.37%diagd 1	1120S1830836K00:00:020.18%scmd 379379120S22173492K00:00:110.18%devd 2	2120S00K00:00:000.00%[kthreadd] 3	3120S00K00:00:020.00%[ksoftirqd/0] … −在monitorprocessdumbtty命令显示信息中找到CPU占用率超过3%（经验值供参考）的进程的JID，再对这些进程执行displayprocessjob命令，收集进程的详细信息，并确认该进程是否运行在控制核上。 如果displayprocessjob命令的显示信息中LAST_CPU字段的取值为控制核的编号（例如0～1），则说明该进程运行在CPU控制核上，则需要进一步定位；如果显示信息中LAST_CPU字段的取值为非控制核的编号，则说明该进程运行在CPU转发核上，无需关注，请执行步骤(7)。下面以pppd进程为例，通过显示信息可以看到，该进程包含多个线程，这些线程都运行在控制核上。 <Sysname>displayprocessnamepppd JobID:515PID:515 ParentJID:1 ParentPID:1 Executablepath:/sbin/pppd Instance:0 Respawn:ON Respawncount:1 Max.spawnsperminute:12 Laststarted:WedNov309:52:002021 Processstate:sleeping Max.core:1 ARGS:--MaxTotalLimit=2000000 --MaxIfLimit=65534--CmdOption=0x01047fbf--bSaveRunDb--pppoechastenflag=1 --pppoechastennum=6--pppoechastenperiod=60--pppoechastenblocktime=300 --pppchastenflag=1--pppchastennum=6--pppchastenperiod=60 --pppchastenblocktime=300--PppoeKChasten--bSoftRateLimit--RateLimitToken=2048 TIDLAST_CPUStackPRIStateHH:MM:SS:MSECName5150136K115S0:0:0:90pppd 5490136K115S0:0:0:0ppp_misc 5570136K115S0:0:0:10ppp_chasten 6100136K115S0:0:0:0ppp_work06111136K115S0:0:0:0ppp_work1 612	1136K115S0:0:0:0ppp_work2 613	1136K115S0:0:0:0mp_main 6181136K115S0:0:0:110pppoes_main6191136K115S0:0:0:100pppoes_mesh 620	1136K115S0:0:0:120l2tp_mesh 621	1136K115S0:0:0:20l2tp_main −对于运行在控制核、CPU占用率超过5%的进程，查看进程的Name字段的取值来确定该进程是否为用户态进程。 如果Process的Name取值中包含“[]”，表示它是内核线程，无需执行monitorthreaddumbtty命令；如果Process的Name取值中未包含“[]”，表示它是用户态进程，它可能包含多个线程。对于多线程的用户态进程，还需要对该用户态进程执行monitorthreaddumbtty命令，如果显示信息中某线程LAST_CPU字段的取值为CPU控制核的编号，且CPU字段取值大于5%，则该线程可能为导致CPU控制核占用率高的线程，需要进一步定位。 <Sysname>monitorthreaddumbttyslot1cpu0 206processes;342threads;5134fds Threadstates:4running,338sleeping,0stopped,0zombie CPU0:98.06%idle,0.97%user,0.97%kernel,0.00%interrupt,0.00%steal CPU1:97.12%idle,0.96%user,0.96%kernel,0.96%interrupt,0.00%steal CPU2:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%stealCPU3:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal CPU4:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal Memory:7940Mtotal,5315Mavailable,pagesize4K JIDTIDLAST_CPUPRIStateHH:MM:SSMAXCPUName 3223222115R00:04:21020.15%[kdrvfwdd2]3233233115R00:04:21020.15%[kdrvfwdd3] 3243244115R00:04:21020.15%[kdrvfwdd4] 111120S00:00:02210.19%scmd 3763761120S00:00:0010.19%diagd220120S00:00:0000.00%[kthreadd] ... b.确认异常任务的调用栈。 在Probe视图下执行followjob命令确认异常任务的调用栈。下面以Sysname上（slot 1）pppd进程（进程编号为515）的操作为例。 <Sysname>system-view [Sysname]probe [Sysname-probe]followjob515slot1 Attachingtoprocess515(pppd) Iteration1of5 ------------------------------ ThreadLWP515:Switches:3205 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x0000000000441745inppp_EpollSched+0x35/0x5c #20x0000000000000004in?? Kernelstack: [<ffffffff811f0573>]ep_poll+0x2f3/0x370 [<ffffffff811f06c0>]SyS_epoll_wait+0xd0/0xe0 [<ffffffff814aed79>]system_call_fastpath+0x16/0x1b[<ffffffffffffffff>]0xffffffffffffffff ThreadLWP549:Switches:20 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x00000000004435d4inppp_misc_EpollSched+0x44/0x6c Kernelstack: [<ffffffffffffffff>]0xffffffffffffffff ... c.根据a和b步骤找到任务名称，再根据任务名称找到对应的业务模块，定位并处理业务模块的问题。例如，如果任务snmpd的CPU占用率较高，可能是因为设备受到了SNMP攻击，或者NMS对设备的访问太频繁。需要进一步定位SNMP业务模块的问题；如果任务nqad的CPU占用率较高，可能是因为NQA探测太频繁，需要进一步定位NQA业务模块的问题。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 •	hh3cEntityExtCpuUsageThresholdNotfication •	hh3cEntityExtCpuUsageThresholdRecover •	hh3cCpuUsageSevereNotification •	hh3cCpuUsageSevereRecoverNotification •	hh3cCpuUsageMinorNotification •	hh3cCpuUsageMinorRecoverNotification 相关日志 •	DIAG/5/CPU_MINOR_RECOVERY •	DIAG/4/CPU_MINOR_THRESHOLD •	DIAG/5/CPU_SEVERE_RECOVERY •	DIAG/3/CPU_SEVERE_THRESHOLD 5.3软件升级故障处理 5.3.1设备启动失败 "
当光模块插入设备时，如果插反，会将光口的I2C总线的SCL时钟信号拉到GND，这样的话有的CPU的I2C就会挂死，导致后续光口的I2C工作异常，且CPU会一直在访问I2C的现象，影响 CPU处理其他业务。设备的光口工作异常，不能link，同时串口打印也可能出现异常。 ,重启设备，同时确保光模块的Tx和Rx没有插反。 3.7AP设备信号弱 ,重启设备，同时确保光模块的Tx和Rx没有插反。 3.7AP设备信号弱 
"当链路不稳定时，命令行界面可能会频繁输出BFD会话DOWN的日志信息。例如： %Jul2816:03:50:8562022H3CBFD/4/BFD_CHANGE_FSM:Sess[192.168.24.4/192.168.24.2, LD/RD:33793/33793,Interface:GE1/0/1,SessType:Ctrl,LinkType:INET],Ver:1,Sta:UP->DOWN,Diag:7(AdministrativelyDown) ","本类故障的常见原因主要包括：•物理链路故障。•上层协议故障。 •硬件故障。 3.故障分析 本类故障的诊断思路如下： (1)根据具体打印的BFD日志，初步判断问题故障原因。 (2)现场检查单板硬件、物理链路、上层协议状态、路由是否可达、隧道是否正确建立等问题。 本类故障的诊断流程如图167所示。 图167BFD会话震荡的故障诊断流程图 4.处理步骤 •过多的调试信息的输出会影响系统的运行效率，建议仅在进行网络故障诊断时根据需要打开某个功能模块的调试开关，不要在系统正常运行时打开多个功能模块的调试开关，以免导致设备 CPU利用率上升，影响设备正常运行。 •请及时保存以下步骤的执行结果，以便在故障暂时无法解决时，可快速地将历史信息及时反馈给技术支持人员。 BFD在两台网络设备上建立会话，用来检测网络设备间的双向转发路径，为上层应用服务。BFD本身并没有发现机制，而是靠被服务的上层协议通知来建立会话。上层协议在建立新的邻居关系后，将邻居的参数及检测参数（包括目的地址和源地址等）通告给BFD；BFD根据收到的参数建立BFD会话。会话建立后会周期性地快速发送BFD报文，如果在检测时间内没有收到BFD报文，则认为该双向转发路径发生了故障，并将故障信息通知给该会话所服务的上层应用，由上层应用采取相应的措施。因此，在排除BFD会话震荡的故障前，请保证上层协议工作正常，否则无法准确定位BFD会话故障原因。 (1)确认BFD会话状态是否从Init变为Down。 如果命令行界面输出如下日志信息，说明BFD会话状态从Init变为Down。 BFD/4/BFD_CHANGE_FSM:Sess[20.0.4.2/20.0.4.1,LD/RD:533/532,Interface:Vlan204,SessType:Ctrl,LinkType:INET],Ver.1,Sta:INIT->DOWN,Diag:1(ControlDetectionTimeExpired). a.检查BFD会话检测的链路是否能够正常转发报文。使用ping工具检查BFD会话之间的链路是否能够正常转发报文。对于不同的链路类型，需要使用不同的ping工具，具体如表19所示。表19不同的链路类型使用的ping工具 链路类型Ping工具 IP链路IPPing或IPv6地址是否可达工具。即执行pingip命令或行pingipv6命令检查指定IPv4地址 LSP隧道MPLSPing工具。即执行pingmplsipv4命令检测LSP隧道的连通性 MPLSTE隧道MPLSPing工具。即执行pingmplste命令检测MPLSTE隧道的连通性 PWMPLSPing工具。即执行pingmplspw命令检测PW隧道的连通性 SRv6TEPolicy转发路径的连通性SRv6TEPolicyPing工具。即执行pingsrv6-tepolicy命令检测SRv6 −如果ping不通，请参见“Ping和Tracert—Ping不通”故障手册、“MPLS类”故障处理手册和“SegmentRouting类故障处理”排除隧道故障。−如果能ping通，请执行步骤b。 b.检查本端接收BFD报文的情况。执行debuggingbfdpacketreceive命令打开BFD接收报文的调试信息开关。 −如果调试信息中“Sta”字段取值为1，或者未打印调试信息，则说明本端收到状态为Down的报文或者收不到BFD报文。对于这种情况，请执行步骤c。 −如果调试信息中“Sta”字段取值为2或3，则说明本端收到状态为Init或者Up的报文，但本端BFD会话无法UP。对于这种情况，请执行步骤(4)。 c.请参考“BFD会话无法建立故障处理”检查对端接收BFD报文的情况。−如果收不到BFD报文，请参考“BFD会话无法建立故障处理”排除BFD报文接收故障。 −如果能收到BFD报文，请执行displaysysteminternalbfdpacket statistics命令查看“Thedetaileddiscardedpacketstatistics”中显示的丢包原因，并根据具体的丢包原因排除故障。如果无法排除故障或不存在丢包，请执行步骤(4)。 (2)确认BFD会话状态是否从Up变为Down。 命令行界面输出如下日志信息，说明BFD会话状态从Up变为Down。 BFD/4/BFD_CHANGE_FSM:Sess[20.0.4.2/20.0.4.1,LD/RD:533/532,Interface:Vlan204,SessType:Ctrl,LinkType:INET],Ver.1,Sta:UP->DOWN,Diag:1(ControlDetectionTimeExpired). BFD会话状态从Up变为Down的常见原因为会话协商阶段出现问题。此时可以根据BFD系统日志信息中“Diag”字段的取值辅助判断故障原因。 表20“Diag”字段的不同取值对应的诊断信息 “Diag”字段取值诊断信息 1(ControlDetectionTimeExpired)送过来的报文表示Ctrl会话本端检测时间超时，即在检测时间内未收到对端发 2(EchoFunctionFailed)表示Echo会话检测时间超时，即在检测时间内未收到对端报文 3(NeighborSignaledSessionDown)对端通知本端BFD会话DOWN “Diag”字段取值为1的处理步骤如下： a.首先删除上层协议联动BFD的配置，然后根据链路类型选择合适的工具检测链路连通性。 −如果链路震荡，请排除链路震荡问题。 −如果链路正常，且重新配置上层协议联动BFD的命令后，BFD会话仍然震荡，请执行步骤(4)。 b.检查本端接收BFD报文的情况。 请参考“BFD会话无法建立故障处理”检查本端接收BFD报文的情况。 −如果本端能够收到报文，但是存在丢包情况，请执行displaysysteminternalbfdpacketstatistics命令查看“Thedetaileddiscardedpacketstatistics”中显示的 丢包原因，并根据具体的丢包原因排除故障。如果无法排除故障或不存在丢包，请执行步骤(4)。 −如果本端无法收到报文，请执行步骤(4)。 “Diag”字段取值为2的处理步骤如下： 如果使用BFD检测单跳IP链路，请在对端ping本端echo会话的源地址。 −如果ping不通，说明链路故障，请排除链路故障。 −如果能ping通，请执行步骤(4)。 如果使用BFD检测MPLS隧道，由于本端通过MPLS隧道发送BFDecho报文，对端通过IP链路转发收到的BFDecho报文。这种情况下，请检查本端MPLS隧道和对端转发 BFDecho报文的IP链路的连通性。 −如果MPLS隧道或IP链路故障，请排除隧道故障或IP链路故障。 −如果MPLS隧道以及IP链路正常，请执行步骤(4)。 如果使用BFD检测SRv6隧道，由于本地通过SRv6隧道发送BFDecho报文，对端通过IP链路转发收到的BFDecho报文。这种情况下，请检查本端SRv6隧道和对端转发BFDecho报文的IP链路的连通性。 −如果SRv6隧道或IP链路故障，请排除隧道故障或IP链路故障。 −如果SRv6隧道以及IP链路正常，请执行步骤(4)。 如果设备配置了uRPF功能，会将对端转发回来的echo报文丢弃。这种情况下，请执行displayipurpf命令检查uRPF是否引用了允许源IP为echo会话源地址通过的ACL规则。此配置用于抑制uRPF丢弃匹配ACL规则的报文。 −如果uRPF未引用允许源IP为echo会话源地址通过的ACL规则，请通过ipurpf命令修改配置。 −如果uRPF引用了允许源IP为echo会话源地址通过的ACL规则，请执行步骤(4)。“Diag”字段取值为3的处理步骤与“Diag”字段取值为1的处理步骤相同。 (3)确认BFD会话状态是否变为AdministrativelyDown。 命令行界面输出如下日志信息，说明BFD会话状态变为AdministrativelyDown。 BFD/5/BFD_CHANGE_SESS:Sess[17.1.1.2/17.1.1.1,LD/RD:1537/1537,Interface:GE1/0/1, SessType:Ctrl,LinkType:INET],Ver:1,Sta:Deleted,Diag:7(AdministrativelyDown)此情况一般是上层协议故障，间接导致BFD震荡。首先删除上层协议创建BFD会话的配置，观察上层协议是否稳定。如果上层协议震荡，请参考“三层技术-IP路由类故障处理”、“MPLS类故障处理”、“SegmentRouting类故障处理”排除上层协议故障。 如果上层协议稳定，但是BFD会话无法UP，请执行步骤(4)。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：HH3C-BFD-STD-MIB •hh3cBfdSessStateUp(1.3.6.1.4.1.25506.2.72.0.3)•hh3cBfdSessStateDown(1.3.6.1.4.1.25506.2.72.0.4)相关日志 •BFD/4/BFD_CHANGE_FSM •BFD/5/BFD_CHANGE_SESS 21网络管理和监控类故障处理 21.1NETCONF故障处理 21.1.1SOAP方式登录失败 ",Suggestion not provided
当两台设备间通过链路聚合连接时，通过displayinterface命令查看聚合接口处于down状态。 ,"本类故障的常见原因主要包括： •聚合接口配置错误。 •成员端口物理链路故障。 •LACP协议报文收发故障。 3.故障分析 本类故障的诊断思路如下： (1)通过displaylink-aggregationverbose查看成员端口是否处于选中状态，如果处于非选中状态，则通过displayinterface命令查询成员端口物理状态是否UP，排除端口物理故障影响。 (2)检查本端和对端聚合接口配置，排除配置问题。 (3)使用debugginglink-aggregationlacppacket命令查看动态聚合的成员端口LACP 协议交互情况。 本类故障的诊断流程如图53所示。 图53聚合接口无法UP的故障诊断流程图 4.处理步骤 (1)排查物理连线是否准确。 根据聚合接口的组网规划进行线路检查，确认物理链接线路是否完全按照规划连接。 如果物理连线正确，则执行步骤(2)。 (2)聚合接口是否被手工关闭。 执行displayinterface命令查看聚合接口的物理状态，如果显示为“Administratively DOWN”，则表示聚合接口被手工关闭，请执行undoshutdown命令开启聚合接口。如果聚合接口未被手工关闭，则执行步骤(3)。 (3)聚合组中成员端口是否UP。执行displayinterface命令查看聚合组中的成员端口是否处于UP状态，如果没有UP，请按照端口不UP故障流程处理。如果端口处于UP状态，则执行步骤(4)。以如下显示为例，二层聚合组1中成员端口GigabitEthernet1/0/1处于非选中状态。执行displayinterface命令查看GigabitEthernet1/0/1的物理状态时，物理状态显示为 “DOWN”，使成员端口GigabitEthernet1/0/1处于非选中状态。 <Sysname>displaylink-aggregationverbose LoadsharingType:Shar--Loadsharing,NonS--Non-Loadsharing PortStatus:S--Selected,U--Unselected,I--Individual Port:A--Autoport,M--Managementport,R--Referenceport Flags:A--LACP_Activity,B--LACP_Timeout,C--Aggregation, D--Synchronization,E--Collecting,F--Distributing, G--Defaulted,H--Expired AggregateInterface:Bridge-Aggregation1 AggregationMode:Static LoadsharingType:Shar ManagementVLANs:None PortStatusPriorityOper-Key GE1/0/1U327681 <Sysname>displayinterfaceGigabitEthernet1/0/1GigabitEthernet1/0/1 Currentstate:DOWN Lineprotocolstate:DOWN IPpacketframetype:EthernetII,hardwareaddress:2a41-21c1-0100Description:GigabitEthernet1/0/1Interface Bandwidth:1000000kbpsLoopbackisnotset Unknown-speedmode,full-duplexmode Linkspeedtypeisautonegotiation,linkduplextypeisforcelink Flow-controlisnotenabled Maximumframelength:9216 AllowjumboframestopassBroadcastmax-ratio:100% Multicastmax-ratio:100%Unicastmax-ratio:100% Known-unicastmax-ratio:100% PVID:1 MDItype:Automdix Portlink-type:Access TaggedVLANs:None UntaggedVLANs:1Portpriority:2 Lastlinkflapping:0hours0minutes15secondsLastclearingofcounters:Never Currentsystemtime:2021-08-1010:15:02 Lasttimewhenphysicalstatechangedtoup:2021-08-0918:31:43 Lasttimewhenphysicalstatechangedtodown:2021-08-1010:14:47 Peakinputrate:0bytes/sec,at00-00-0000:00:00 Peakoutputrate:0bytes/sec,at00-00-0000:00:00 Last300secondsinput:5000packets/sec5000bytes/sec-% Last300secondsoutput:5000packets/sec5000bytes/sec-% Input(total):5000packets,5000bytes 5000unicasts,5000broadcasts,5000multicasts,0pauses Input(normal):0packets,0bytes 0unicasts,0broadcasts,0multicasts,0pauses Input:5000inputerrors,0runts,0giants,0throttles0CRC,0frame,0overruns,0aborts 5000ignored,0parityerrors Output(total):5000packets,5000bytes 5000unicasts,5000broadcasts,5000multicasts,0pauses Output(normal):0packets,0bytes 0unicasts,0broadcasts,0multicasts,0pauses Output:5000outputerrors,0underruns,0bufferfailures 5000aborts,0deferred,0collisions,0latecollisions 0lostcarrier,0nocarrier (4)判断聚合接口是否为动态聚合。 如果聚合接口为动态聚合，则检查对端聚合接口的配置是否正确，即对端聚合接口是否为动态聚合。在任意视图下执行displaylink-aggregationverbose命令，查看链路两端聚合接口的聚合模式，确保两端聚合模式相同。 以二层聚合接口为例，显示“AggregationMode:Dynamic”时，表示该聚合接口为动态聚合： <Sysname>displaylink-aggregationverbosebridge-aggregation10 LoadsharingType:Shar--Loadsharing,NonS--Non-Loadsharing PortStatus:S--Selected,U--Unselected,I--Individual Port:A--Autoport,M--Managementport,R--Referenceport Flags:A--LACP_Activity,B--LACP_Timeout,C--Aggregation, D--Synchronization,E--Collecting,F--Distributing, G--Defaulted,H--Expired AggregateInterface:Bridge-Aggregation10CreationMode:Manual AggregationMode:Dynamic LoadsharingType:Shar ManagementVLANs:None SystemID:0x8000,000f-e267-6c6a Local: PortStatusPriorityIndexOper-KeyFlag GE1/0/1S32768612{ACDEF} GE1/0/2S32768622{ACDEF} GE1/0/3S32768632{ACDEF}Remote: ActorPriorityIndexOper-KeySystemIDFlag GE1/0/1(R)3276811120x8000,000f-e267-57ad{ACDEF} GE1/0/23276811220x8000,000f-e267-57ad{ACDEF} GE1/0/33276811320x8000,000f-e267-57ad{ACDEF} 如果配置不正确，则修改对端聚合接口为动态聚合；如果配置正确，则执行debugginglink-aggregationlacppacket命令确认LACP报文收发是否正确。 执行debugginglink-aggregationlacppacket命令后，查看成员端口send信息中Actor信息和receive信息中Partner信息。如果sys-mac、key和port-index字段的显示不一致，则LACP协议报文收发不正常，请排除收发光纤错接问题；如果sys-mac、key和port-index字段的显示一致，则LACP协议报文收发正常，请执行步骤(5)。打开聚合组成员端口GigabitEthernet1/0/1的LACP报文调试信息开关，查看该端口收发LACP协议报文的情况。 <Sysname>debugginglink-aggregationlacppacketallinterfacegigabitethernet1/0/1*Nov215:51:21:152007SysnameLAGG/7/Packet:PACKET.GigabitEthernet1/0/1.send.size=110,subtype=1,version=1 Actor:type=1,len=20,sys-pri=0x8000,sys-mac=00e0-fc02-0300,key=0x1,pri=0x8000,port-index=0x2,state=0xc5 Partner:type=2,len=20,sys-pri=0x0,sys-mac=0000-0000-0000,key=0x0,pri=0x0,port-index=0x0,state=0x32 Collector:type=3,len=16,col-max-delay=0x0Terminator:type=0,len=0 *Nov215:55:21:152007SysnameLAGG/7/Packet:PACKET.GigabitEthernet1/0/1.receive.size=110,subtype=1,version=1 Actor:type=1,len=20,sys-pri=0x8000,sys-mac=00e0-fc00-0000,key=0x1,pri=0x8000,port-index=0x6,state=0xd Partner:type=2,len=20,sys-pri=0x8000,sys-mac=00e0-fc02-0300,key=0x1,pri=0x8000,port-index=0x2,state=0xc5Collector:type=3,len=16,col-max-delay=0x0Terminator:type=0,len=0 如果聚合接口为静态聚合，则执行步骤(5)。(5)查看聚合接口下最小选中端口的配置是否影响成员端口选中。 在聚合接口视图下执行displaythis命令，如果存在link-aggregationselected-portminimum的配置，请修改最小选中端口数值，使其满足最小选中要求。当聚合组内能够被选中的成员端口数增加至不小于配置值时，这些成员端口都将变为选中状态，对应聚合接口的链路状态也将变为UP。 如果聚合接口下最小选中端口的配置未影响成员端口选中，则执行步骤(6)。以如下显示为例，二层聚合接口1下配置的最小选中端口数为2，而二层聚合接口1对应的聚合组的成员端口仅有一个，所以该成员端口处于非选中状态。 [Sysname-Bridge-Aggregation1]displaythis # interfaceBridge-Aggregation1 link-aggregationselected-portminimum2 #return [H3C-Bridge-Aggregation1]displaylink-aggregationverbose LoadsharingType:Shar--Loadsharing,NonS--Non-Loadsharing PortStatus:S--Selected,U--Unselected,I--Individual Port:A--Autoport,M--Managementport,R--Referenceport Flags:A--LACP_Activity,B--LACP_Timeout,C--Aggregation, D--Synchronization,E--Collecting,F--Distributing, G--Defaulted,H--Expired AggregateInterface:Bridge-Aggregation1 AggregationMode:Static LoadsharingType:Shar ManagementVLANs:None PortStatusPriorityOper-Key GE1/0/1U327681 (6)聚合组内是否存在选中的成员端口。如果聚合组内不存在选中的成员端口，则请参见“8.2.3聚合成员端口无法选中”故障进行定位；如果聚合组内存在选中的成员端口，则执行步骤(7)。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 8.2.2聚合接口流量负载分担不均 ",Suggestion not provided
当两台设备通过链路聚合连接时，发现聚合组成员端口处于非选中状态，聚合失败。 ,"本类故障的常见原因主要包括： •链路连通性故障。 •本端和对端的操作key、属性类配置不一致。 •聚合成员端口数配置错误。 3.故障分析 本类故障的诊断思路如下： (1)查看成员端口是否UP，排除端口物理故障影响。 (2)使用debugginglink-aggregationlacppacket命令查看动态聚合的成员端口LACP 协议交互情况。 (3)检查本端和对端聚合接口配置，排除配置影响。 本类故障的诊断流程如图55所示。 图55聚合成员端口无法选中的故障诊断流程图 4.处理步骤 (1)排查物理连线是否正确。 根据聚合接口的组网规划进行线路检查，确认物理链接线路是否完全按照规划连接。 如果物理连线正确，则执行步骤(2)。 (2)聚合组中成员端口是否UP。通过displayinterface命令查看聚合组中的成员端口是否处于UP状态，如果没有UP，请按照端口不UP故障流程处理。 如果端口处于UP状态，则执行步骤(3)。 (3)本端成员端口的属性类配置与聚合接口是否相同。 a.执行displaylink-aggregationverbose命令查看本端处于Unselected状态的成员端口。 以二层聚合接口为例，Status字段显示为“U”时，表示该成员处于Unselected状态： <Sysname>displaylink-aggregationverbose LoadsharingType:Shar--Loadsharing,NonS--Non-Loadsharing PortStatus:S--Selected,U--Unselected,I--Individual Port:A--Autoport,M--Managementport,R--Referenceport Flags:A--LACP_Activity,B--LACP_Timeout,C--Aggregation, D--Synchronization,E--Collecting,F--Distributing, G--Defaulted,H--Expired AggregateInterface:Bridge-Aggregation1CreationMode:Manual AggregationMode:DynamicLoadsharingType:Shar ManagementVLANs:None SystemID:0x8000,2a41-21c1-0100 Local: PortStatusPriorityIndexOper-KeyFlag GE1/0/1(R)S3276811{ACDEF} GE1/0/2S3276821{ACDEF}GE1/0/3U3276832{AC}Remote: ActorPriorityIndexOper-KeySystemIDFlag GE1/0/132768110x8000,36f6-c0aa-0200{ACDEF} GE1/0/232768210x8000,36f6-c0aa-0200{ACDEF} GE1/0/332768310x8000,36f6-c0aa-0200{AC} b.执行displaycurrent-configurationinterface命令查看本端处于Unselected 状态的成员端口的属性类配置（VLAN等配置）与聚合接口是否相同，如果不同，则将其配置相同。 以如下显示为例，处于Unselected状态的成员端口GigabitEthernet1/0/3与参考端口GigabitEthernet1/0/1的属性类配置不同，导致该成员端口无法选中，需要修改成员端口 GigabitEthernet1/0/3的属性类配置。 <Sysname>displaycurrent-configurationinterfacegigabitethernet1/0/1 # interfaceGigabitEthernet1/0/1 portlink-modebridgeportlink-typetrunkporttrunkpermitvlan1to20portlink-aggregationgroup1 #return <Sysname>displaycurrent-configurationinterfacegigabitethernet1/0/3 # interfaceGigabitEthernet1/0/3portlink-typetrunkporttrunkpermitvlan1to100portlink-aggregationgroup1 #return如果本端成员端口的属性类配置与聚合接口相同，则执行步骤(4)。 (4)本端成员端口的操作key与参考端口是否相同。 a.执行displaylink-aggregationverbose命令查看本端处于Unselected状态的成员端口。 以二层聚合接口为例，Status字段显示为“U”时，表示该成员处于Unselected状态： <Sysname>displaylink-aggregationverbose LoadsharingType:Shar--Loadsharing,NonS--Non-Loadsharing PortStatus:S--Selected,U--Unselected,I--Individual Port:A--Autoport,M--Managementport,R--Referenceport Flags:A--LACP_Activity,B--LACP_Timeout,C--Aggregation, D--Synchronization,E--Collecting,F--Distributing, G--Defaulted,H--Expired AggregateInterface:Bridge-Aggregation11CreationMode:Manual AggregationMode:DynamicLoadsharingType:Shar ManagementVLANs:None SystemID:0x8000,2a41-21c1-0100 Local: PortStatusPriorityIndexOper-KeyFlag GE1/0/1(R)S3276811{ACDEF} GE1/0/2S3276821{ACDEF}GE1/0/3U3276832{AC}Remote: ActorPriorityIndexOper-KeySystemIDFlag GE1/0/132768110x8000,36f6-c0aa-0200{ACDEF} GE1/0/232768210x8000,36f6-c0aa-0200{ACDEF} GE1/0/332768310x8000,36f6-c0aa-0200{AC} b.执行displaycurrent-configurationinterface命令查看本端处于Unselected 状态的成员端口的操作key（包括该端口的速率、双工模式等）与参考端口是否相同，如果不同，则将其配置相同。 以如下显示为例，处于Unselected状态的成员端口GigabitEthernet1/0/3与参考端口GigabitEthernet1/0/1的操作key不同，导致该成员端口无法选中，需要修改该端口速率配置。 <Sysname>displaycurrent-configurationinterfacegigabitethernet1/0/1 # interfaceGigabitEthernet1/0/1portlink-modebridgecomboenablefiber portlink-aggregationgroup11 #return <Sysname>displaycurrent-configurationinterfacegigabitethernet1/0/3 # interfaceGigabitEthernet1/0/3portlink-modebridgecomboenablefiberspeed100 portlink-aggregationgroup11 #return如果本端成员端口的操作key与参考端口相同，则执行步骤(5)。 (5)本端聚合接口是否为动态聚合。如果是动态聚合，则执行步骤(6)；如果是静态聚合，否则进行步骤(8)。(6)LACP报文收发是否正确。 执行debugginglink-aggregationlacppacket命令确认LACP报文收发是否正确。执行命该令后，查看成员端口send信息中Actor信息和receive信息中Partner信息。如果sys-mac、key和port-index字段的显示不一致，则LACP协议报文收发不正常，请排除收发光纤错接问题；如果sys-mac、key和port-index字段的显示一致，则LACP协议报文收发正常，请执行步骤(7)。打开聚合组成员端口GigabitEthernet1/0/1的LACP报文调试信息开关，查看该端口收发LACP协议报文的情况。 <Sysname>debugginglink-aggregationlacppacketallinterfacegigabitethernet1/0/1*Nov215:51:21:152021SysnameLAGG/7/Packet:PACKET.GigabitEthernet1/0/1.send.size=110,subtype=1,version=1 Actor:type=1,len=20,sys-pri=0x8000,sys-mac=00e0-fc02-0300,key=0x1,pri=0x8000,port-index=0x2,state=0xc5 Partner:type=2,len=20,sys-pri=0x0,sys-mac=0000-0000-0000,key=0x0,pri=0x0,port-index=0x0,state=0x32 Collector:type=3,len=16,col-max-delay=0x0Terminator:type=0,len=0 *Nov215:55:21:152021SysnameLAGG/7/Packet:PACKET.GigabitEthernet1/0/1.receive.size=110,subtype=1,version=1 Actor:type=1,len=20,sys-pri=0x8000,sys-mac=00e0-fc00-0000,key=0x1,pri=0x8000,port-index=0x6,state=0xd Partner:type=2,len=20,sys-pri=0x8000,sys-mac=00e0-fc02-0300,key=0x1,pri=0x8000,port-index=0x2,state=0xc5 Collector:type=3,len=16,col-max-delay=0x0 Terminator:type=0,len=0 (7)本端成员端口的对端端口的操作key和属性类配置与参考端口的对端端口是否相同。 在本端Unselected端口的对端设备上执行displaycurrent-configuration interface命令查看对端Unselected端口的属操作key和属性类配置与参考端口的对端端口是否相同，如果不同，则将其配置相同。 如果本端成员端口的对端端口的操作key和属性类配置与参考端口的对端端口相同，则执行步骤(8)。 (8)聚合成员端口数量是否达到阈值。 聚合成员端口数超过上限。 可在聚合接口视图下通过link-aggregationselected-portmaximum命令配置聚合组中的最大选中端口数。通过displaylink-aggregationverbose命令查看聚 合组中成员端口数是否超过上限，如果超过上限，则多出来的端口为Unselected状态， Selected端口按照端口编号从小到大排序。请在成员端口视图下使用undoport link-aggregationgroup命令将Selected端口中不适用的端口从聚合组中删除，以 使必须使用的端口能够选中。 聚合成员端口数低于下限。 可在聚合接口视图下执行link-aggregationselected-portminimum命令配置聚合组中的最小选中端口数。通过displaylink-aggregationverbose命令查看聚 合组中成员端口是否低于下限，如果低于下限，则所有成员端口为Unselected状态。请执行link-aggregationselected-portminimum命令修改最小选中端口数值或者为 聚合组添加成员端口，使其满足最小选中要求。 如果聚合成员端口数量未达到聚合组的阈值，则执行步骤(9)。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 8.3生成树故障处理 8.3.1设备连接成环时业务中断 ",Suggestion not provided
当两台设备通过链路聚合连接时，通过displaycountersrate命令查看聚合成员端口出方向流量速率，某些成员端口速率特别小或者根本没有。 ,本类故障的常见原因主要为聚合负载分担方式配置错误。 3.故障分析 本类故障的诊断思路为确认聚合接口转发的报文的特征，并查看聚合负载分担类型是否和报文特性匹配。本类故障的诊断流程如图54所示。 图54聚合接口流量负载分担不均的故障诊断流程图 4.处理步骤 (1)用户业务流量是否正常。 如果用户业务流量正常，则等待一段时间，再执行displaycountersrate命令查看聚 合成员端口出方向流量速率，确认聚合成员端口流量是否恢复负载分担： 如果已恢复负载分担，则无需处理。 如果未恢复负载分担，则执行步骤(2)。如果用户业务流量不正常，则执行步骤(2)。 (2)查看聚合负载分担类型与报文特征是否匹配。 通过执行displaylink-aggregationload-sharingmode命令查看聚合负载分担类 型，如果与报文特征不匹配，则通过以下命令调整聚合负载分担类型（部分设备不支持在聚合接口视图下执行link-aggregationload-sharingmode命令）： 在系统视图下执行link-aggregationglobalload-sharingmode命令调整全局 在聚合接口视图下(的负载分担类型。)执行link-aggregationload-sharingmode命令调整聚合接口的负载分担类型。针对不同业务流量，不同产品缺省的负载分担类型不同，具体请参见各产品“二层技术—以太网交换配置指导”中的“以太网链路聚合”。 如果聚合负载分担类型与报文特征匹配，则执行步骤(3)。 (3)检查是否部署跨板/跨框/跨成员设备聚合。 对于框式设备：在IRF环境下，如果部署跨板/跨框聚合，则在系统视图下使用undo link-aggregationload-sharingmodelocal-first命令关闭本地优先转发功能。 如果关闭本地优先转发功能，则可能影响IRF系统稳定，请根据实际情况进行操作。 如果未部署跨板/跨框聚合或不支持undolink-aggregationload-sharingmodelocal-first命令，则执行步骤(4)。 对于盒式设备：在IRF环境下，如果部署跨成员设备聚合，则在系统视图下使用undo link-aggregationload-sharingmodelocal-first命令关闭本地优先转发功能。 如果关闭本地优先转发功能，则可能影响IRF系统稳定，请根据实际情况进行操作。 如果未部署跨成员设备聚合或不支持undolink-aggregationload-sharingmodelocal-first命令，则执行步骤(4)。 需要注意，跨板/跨框/跨成员设备流量不能过大，否则可能影响IRF系统稳定。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 8.2.3聚合成员端口无法选中 ,Suggestion not provided
"登录到交换机上以后，试图通过OAP方式登录到无线控制器业务板上进行查询或者配置，却发现无法登录成功，提示“TheOAPconnectionisbusy,pleasetryagainlater!”。 <Sysname>oapconnectslot1 TheOAPconnectionisbusy,pleasetryagainlater! ",(1)确认当前是否有其他人在使用OAP连接。 (2)登录到无线控制器业务板，通过displayusers命令收集当前访问无线控制器业务板的用户信息： <Sysname>displayusers IdxLineIdleTimePidType 0CON000:00:00Aug1110:06:511249 +1VTY000:00:00Aug1110:09:241273TEL Followingaremoredetails. VTY0: Username:adminLocation:180.10.1.1 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. 通过该命令可以看到当前登录到无线控制器业务板的用户（此信息说明当前有两个用户，其中“+”开头的用户为自己）可以多次执行上面的命令，如果Idle时间始终为00:00:00，则很大可能是该用户使用了OAP链接。 上面给出了Console用户的显示信息，如果通过Telnet登录发现con0在线，而且Idle时间始终为00:00:00，则很有可能说明Console用户已经离开，但是使用了OAP连接，所以需要将该用户踢掉，以恢复OAP连接。 (3)在无线控制器业务板的用户视图下执行freeuser-interface命令踢掉怀疑使用OAP连接的用户，其中下面的参数VTY和0分别为displayusers中的Line信息： <Sysname>freeuser-interfacevty0 Areyousuretofreeuser-interfacevty0?[Y/N]:y[OK] (4)如果踢掉用户成功，再次进行OAP登录，应该可以连接成功，否则可以踢掉所有的用户进行测试。 (5)如果踢掉所有的用户也没有效果，只有重新启动设备或者联系厂商的维护人员确认。 4.2使用本地转发时FITAP注册成功后一会儿连接断开 ,(1)确认当前是否有其他人在使用OAP连接。 (2)登录到无线控制器业务板，通过displayusers命令收集当前访问无线控制器业务板的用户信息： <Sysname>displayusers IdxLineIdleTimePidType 0CON000:00:00Aug1110:06:511249 +1VTY000:00:00Aug1110:09:241273TEL Followingaremoredetails. VTY0: Username:adminLocation:180.10.1.1 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. 通过该命令可以看到当前登录到无线控制器业务板的用户（此信息说明当前有两个用户，其中“+”开头的用户为自己）可以多次执行上面的命令，如果Idle时间始终为00:00:00，则很大可能是该用户使用了OAP链接。 上面给出了Console用户的显示信息，如果通过Telnet登录发现con0在线，而且Idle时间始终为00:00:00，则很有可能说明Console用户已经离开，但是使用了OAP连接，所以需要将该用户踢掉，以恢复OAP连接。 (3)在无线控制器业务板的用户视图下执行freeuser-interface命令踢掉怀疑使用OAP连接的用户，其中下面的参数VTY和0分别为displayusers中的Line信息： <Sysname>freeuser-interfacevty0 Areyousuretofreeuser-interfacevty0?[Y/N]:y[OK] (4)如果踢掉用户成功，再次进行OAP登录，应该可以连接成功，否则可以踢掉所有的用户进行测试。 (5)如果踢掉所有的用户也没有效果，只有重新启动设备或者联系厂商的维护人员确认。 4.2使用本地转发时FITAP注册成功后一会儿连接断开 
"登录到交换机上以后，提示“TheOAPconnectionisbusy,pleasetryagainlater!”",(1)确认当前是否有其他人在使用OAP连接。 (2)登录到无线控制器业务板，通过displayusers命令收集当前访问无线控制器业务板的用户信息： <Sysname>displayusers IdxLineIdleTimePidType 0CON000:00:00Aug1110:06:511249 +1VTY000:00:00Aug1110:09:241273TEL Followingaremoredetails. VTY0: Username:adminLocation:180.10.1.1 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. 通过该命令可以看到当前登录到无线控制器业务板的用户（此信息说明当前有两个用户，其中“+”开头的用户为自己）可以多次执行上面的命令，如果Idle时间始终为00:00:00，则很大可能是该用户使用了OAP链接。 上面给出了Console用户的显示信息，如果通过Telnet登录发现con0在线，而且Idle时间始终为00:00:00，则很有可能说明Console用户已经离开，但是使用了OAP连接，所以需要将该用户踢掉，以恢复OAP连接。 (3)在无线控制器业务板的用户视图下执行freeuser-interface命令踢掉怀疑使用OAP连接的用户，其中下面的参数VTY和0分别为displayusers中的Line信息： <Sysname>freeuser-interfacevty0 Areyousuretofreeuser-interfacevty0?[Y/N]:y[OK] (4)如果踢掉用户成功，再次进行OAP登录，应该可以连接成功，否则可以踢掉所有的用户进行测试。 (5)如果踢掉所有的用户也没有效果，只有重新启动设备或者联系厂商的维护人员确认。 4.2使用本地转发时FITAP注册成功后一会儿连接断开 ,(1)确认当前是否有其他人在使用OAP连接。 (2)登录到无线控制器业务板，通过displayusers命令收集当前访问无线控制器业务板的用户信息： <Sysname>displayusers IdxLineIdleTimePidType 0CON000:00:00Aug1110:06:511249 +1VTY000:00:00Aug1110:09:241273TEL Followingaremoredetails. VTY0: Username:adminLocation:180.10.1.1 +:Currentoperationuser. F:Currentoperationuserworksinasyncmode. 通过该命令可以看到当前登录到无线控制器业务板的用户（此信息说明当前有两个用户，其中“+”开头的用户为自己）可以多次执行上面的命令，如果Idle时间始终为00:00:00，则很大可能是该用户使用了OAP链接。 上面给出了Console用户的显示信息，如果通过Telnet登录发现con0在线，而且Idle时间始终为00:00:00，则很有可能说明Console用户已经离开，但是使用了OAP连接，所以需要将该用户踢掉，以恢复OAP连接。 (3)在无线控制器业务板的用户视图下执行freeuser-interface命令踢掉怀疑使用OAP连接的用户，其中下面的参数VTY和0分别为displayusers中的Line信息： <Sysname>freeuser-interfacevty0 Areyousuretofreeuser-interfacevty0?[Y/N]:y[OK] (4)如果踢掉用户成功，再次进行OAP登录，应该可以连接成功，否则可以踢掉所有的用户进行测试。 (5)如果踢掉所有的用户也没有效果，只有重新启动设备或者联系厂商的维护人员确认。 4.2使用本地转发时FITAP注册成功后一会儿连接断开 
点对点类隧道（包括GRE、IPv4和IPv6隧道）配置完成后，Tunnel接口状态为up，且本端隧道接口IP地址可以Ping通对端隧道接口IP地址。但隧道接口工作状态不稳定，包括： •	隧道接口震荡，反复的up/down。 •	隧道报文丢包率高，传输速率低。 本章节以GREoverIPv4隧道为例进行介绍。 ,本类故障的常见原因主要包括： •	到达隧道目的地址的路由震荡，导致隧道也发生震荡。 •	设备上配置了隧道A的源目的地址和隧道B的源目的地址相同，导致其中只有一条隧道可以up。 •	GRE隧道接口下使能了保活探测报文功能，但设备无法正常收发GREkeepalive报文，导致设备将隧道置为down。 •	设备资源不足，隧道下发硬件处理失败，导致隧道在物理层down。 •	隧道口下的配置不合理，导致隧道报文丢包。 3.	故障分析 本类故障的诊断流程如图46所示。 图46隧道接口不稳定故障诊断流程图 ,"通过debuggingtunnelevent命令打开隧道事件调试开关，如果持续出现路由刷新或删 除消息，说明路由出现震荡，此时隧道也会震荡。示例如下： <Sysname>debuggingtunnelevent <Sysname>%Jun1612:49:55:4972022SysnameBGP/5/BGP_STATE_CHANGED:-MDC=1;BGP.: 4.4.4.4statehaschangedfromESTABLISHEDtoIDLEforTCP_Connection_Failedeventreceived. //BGP邻居的IP地址为4.4.4.4，收到TCP连接失败事件，BGP会话状态从Established转换为Idle %Jun1612:49:55:4972022SysnameBGP/5/BGP_STATE_CHANGED_REASON:-MDC=1;BGP.:4.4.4.4statehaschangedfromESTABLISHEDtoIDLE.(Reason:TCPconnectionfailed(Noroutetohost)) //BGP邻居的IP地址为4.4.4.4，BGP会话状态从Established转换为Idle，原因是TCP连接失败（没有到达主机的路由） 如果存在路由震荡，则需要根据路由刷新或删除消息进一步排查设备路由震荡原因。例如，本例中BGP会话无法稳定进入Established状态，可以参考BGP故障处理手册进行定位。 如果不存在路由震荡，请继续执行步骤(2)排查故障。(2)检查是否存在同源同目的隧道。 分别在两端设备的任意视图下执行displayinterfacetunnel命令，查看是否存在隧道 A的源目的地址和隧道B的源目的地址相同的情况。 <Sysname>displayinterfaceTunnelTunnel0 Currentstate:UP Lineprotocolstate:UP Description:Tunnel0Interface Bandwidth:64kbps Maximumtransmissionunit:1464 Internetprotocolprocessing:Disabled Outputqueue-Urgentqueuing:Size/Length/Discards0/100/0 Outputqueue-Protocolqueuing:Size/Length/Discards0/500/0 Outputqueue-FIFOqueuing:Size/Length/Discards0/75/0 Lastclearingofcounters:15:20:18Mon06/13/2022 Tunnelsource1.1.1.1,destination2.2.2.2略… 如果存在同源同目的隧道，只允许其中一个up，可以通过undointerfacetunnel命令删除不需要的隧道；如果不存在同源同目的隧道，则执行步骤(3)继续排查故障。 (3)检查是否配置GRE保活探测报文功能，是否可以正常收发GREkeepalive报文。（仅部分机型支持G图下执行displaycurrentinterface(REkeepalive，如不支持请忽略本步骤）。在任意视)tunnel命令查看隧道接口的keepalive配置。 <Sysname>displaycurrentinterfacetunnel # interfaceTunnel2modegreipaddress10.1.1.2255.255.255.0source12.1.1.4destination12.1.1.2keepalive33 # 在本端设备上通过debugginggrepacket命令打开GRE报文调试开关，查看是否可以正常收发keepalive报文。 <Sysname>debugginggrepacket *Jun1612:46:50:3502022SysnameGRE/7/packet:-MDC=1; Tunnel2packet:Beforeencapsulation, 12.1.1.2->12.1.1.4(length=24) *Jun1612:46:50:3502022SysnameGRE/7/packet:-MDC=1; Tunnel2packet:Afterencapsulation, 12.1.1.4->12.1.1.2(length=48) *Jun1612:46:50:3512022SysnameGRE/7/packet:-MDC=1; Tunnel2packet:Beforede-encapsulationaccordingtofast-forwardingtable, 12.1.1.2->12.1.1.4(length=24) *Jun1612:46:50:3512022SysnameGRE/7/packet:-MDC=1;Tunnel2:Receivedakeepalivepacket. //Tunnel2收到keepalive报文 在对端设备上同样打开GRE报文调试开关，如果对端显示发出了keepalive报文，本端却未收到，则GRE报文可能未通过本端的校验和检查。无法收到keepalive报文会导致隧道接口down，可以尝试通过undokeepalive命令关闭keepalive功能来解决该问题。 如果能够正常收到keepalive报文，则执行步骤(4)继续排查故障。(4)检查隧道报文的hoplimit/TTL和隧道报文DF标志配置是否合理。 在任意视图下执行displaycurrentinterfacetunnel命令查看hoplimit/TTL和隧道报文DF标志的配置： # interfaceTunnel2modegreipaddress10.1.1.2255.255.255.0source12.1.1.4destination12.1.1.2keepalive33tunnelttl1 tunneldfbitenable # hoplimit/TTL配置和DF（Don’tFragment，不分片）标志的配置可能导致隧道报文被丢弃：a.hoplimit/TTL配置过小会导致隧道报文在中间设备上因为TTL超时而被丢弃。解决方法为在隧道接口视图下执行tunnelttl命令，依照实际组网配置合理的TTL值； b.设置封装后的隧道报文的DF标志后，中间设备可能会因为报文长度超出接口MTU值而丢弃报文。解决方法为配置转发路径上各个接口的MTU大于隧道报文长度。在无法保证转发路径上各个接口的MTU大于隧道报文长度时，请关闭隧道报文不分片功能。执行以上操作后仍无法排除故障，则执行步骤(5)继续排查故障。 (5)查看是否隧道下发硬件处理失败。打开隧道事件调试信息开关，查看是否有隧道报文或事件下内核/驱动失败，调试信息的示例如下： <Sysname>debuggingtunnelall *Jun1612:51:25:8322022SysnameTUNNEL/7/event:-MDC=1; Tunnel2notifiesdriver:Operation=4. TunnelIfIndex=524,EvilinkIfIndex=0 VRFIndex=0,DstVRFIndex=0 TunnelMode=IPv4GRE,TransPro=1 TunnelSrc=12.1.1.4 TunnelDst=12.1.1.2 TTL=255,ToS=0,DFBit=0 MTU=1476,IPv6Mtu=1476 DrvContext[0]=0xffffffffffffffff,DrvContext[1]=0xffffffffffffffff VNHandle=0x20000040,ADJIndex=0xfaf3889c //隧道接口Tunnel2通知驱动执行Operation4 *Jun1612:51:25:8322022SysnameTUNNEL/7/event:-MDC=1;Processingresultofoperation4forTunnel2:failed. //隧道接口Tunnel2下发的Operation4处理失败 %Jun1612:51:25:8322022SysnameIFNET/3/PHY_UPDOWN:-MDC=1;PhysicalstateontheinterfaceTunnel2changedtodown. %Jun1612:51:25:8322022SysnameIFNET/5/LINK_UPDOWN:-MDC=1;LineprotocolstateontheinterfaceTunnel2changedtodown. //隧道Tunnel2接口down *Jun1612:51:27:3502022SysnameTUNNEL/7/event:-MDC=1; Tunnel2can'tcomeupbecausethereisnotenoughhardwareresource //由于硬件资源不足，隧道Tunnel2不能up 当设备打印的如下的event或error信息时，表示硬件是故障导致隧道工作不稳定，此时请联系技术支持。 表4硬件相关的debug信息描述表 字段	描述 隧道Tunnelnum不能up的原因为reason，reason的 Tunnelnumcan'tcomeupbecausereason.	取值为thereisnotenoughhardwareresource：硬 件资源不足 向DBM（Databaseinmemory，内存数据库）保存 Failedtosave6RDprefixtoDBM.	6RD隧道的IPv6前缀失败 FailedtosaveIPv4prefix/suffixfor6RDtunneltoDBM.	向DBM保存6RD隧道的IPv4前缀/后缀失败 Failedtosave6RDBRaddresstoDBM.	向DBM保存6RD隧道的BR地址失败 Failedtosend6RDprefixtokernel.	向内核发送隧道的6RD前缀配置消息失败 kernel.FailedtosendIPv4prefix/suffixfor6RDtunnelto向内核发送隧道的6RDIPv4配置消息失败 Failedtosend6RDBRaddresstokernel.	向内核发送隧道的6RDBR地址配置消息失败 (6)如果故障仍未排除，请收集如下信息，并联系技术支持人员。 	上述步骤的执行结果。 	设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 8	二层技术-以太网交换类故障处理 8.1M-LAG故障处理 8.1.1peer-link接口无法UP "
点对点类隧道（包括GRE、IPv4和IPv6隧道）配置完成后，Tunnel接口状态为up，且本端隧道接口IP地址可以Ping通对端隧道接口IP地址。但隧道接口工作状态不稳定，包括： •隧道接口震荡，反复的up/down。 •隧道报文丢包率高，传输速率低。 本章节以GREoverIPv4隧道为例进行介绍。 ,"本类故障的常见原因主要包括： •到达隧道目的地址的路由震荡，导致隧道也发生震荡。 •设备上配置了隧道A的源目的地址和隧道B的源目的地址相同，导致其中只有一条隧道可以up。 •GRE隧道接口下使能了保活探测报文功能，但设备无法正常收发GREkeepalive报文，导致设备将隧道置为down。 •设备资源不足，隧道下发硬件处理失败，导致隧道在物理层down。 •隧道口下的配置不合理，导致隧道报文丢包。 3.故障分析 本类故障的诊断流程如图46所示。 图46隧道接口不稳定故障诊断流程图 4.处理步骤(1)检查路由是否发生震荡。 通过debuggingtunnelevent命令打开隧道事件调试开关，如果持续出现路由刷新或删 除消息，说明路由出现震荡，此时隧道也会震荡。示例如下： <Sysname>debuggingtunnelevent <Sysname>%Jun1612:49:55:4972022SysnameBGP/5/BGP_STATE_CHANGED:-MDC=1;BGP.: 4.4.4.4statehaschangedfromESTABLISHEDtoIDLEforTCP_Connection_Failedeventreceived. //BGP邻居的IP地址为4.4.4.4，收到TCP连接失败事件，BGP会话状态从Established转换为Idle %Jun1612:49:55:4972022SysnameBGP/5/BGP_STATE_CHANGED_REASON:-MDC=1;BGP.:4.4.4.4statehaschangedfromESTABLISHEDtoIDLE.(Reason:TCPconnectionfailed(Noroutetohost)) //BGP邻居的IP地址为4.4.4.4，BGP会话状态从Established转换为Idle，原因是TCP连接失败（没有到达主机的路由） 如果存在路由震荡，则需要根据路由刷新或删除消息进一步排查设备路由震荡原因。例如，本例中BGP会话无法稳定进入Established状态，可以参考BGP故障处理手册进行定位。 如果不存在路由震荡，请继续执行步骤(2)排查故障。(2)检查是否存在同源同目的隧道。 分别在两端设备的任意视图下执行displayinterfacetunnel命令，查看是否存在隧道 A的源目的地址和隧道B的源目的地址相同的情况。 <Sysname>displayinterfaceTunnelTunnel0 Currentstate:UP Lineprotocolstate:UP Description:Tunnel0Interface Bandwidth:64kbps Maximumtransmissionunit:1464 Internetprotocolprocessing:Disabled Outputqueue-Urgentqueuing:Size/Length/Discards0/100/0 Outputqueue-Protocolqueuing:Size/Length/Discards0/500/0 Outputqueue-FIFOqueuing:Size/Length/Discards0/75/0 Lastclearingofcounters:15:20:18Mon06/13/2022 Tunnelsource1.1.1.1,destination2.2.2.2略… 如果存在同源同目的隧道，只允许其中一个up，可以通过undointerfacetunnel命令删除不需要的隧道；如果不存在同源同目的隧道，则执行步骤(3)继续排查故障。 (3)检查是否配置GRE保活探测报文功能，是否可以正常收发GREkeepalive报文。（仅部分机型支持G图下执行displaycurrentinterface(REkeepalive，如不支持请忽略本步骤）。在任意视)tunnel命令查看隧道接口的keepalive配置。 <Sysname>displaycurrentinterfacetunnel # interfaceTunnel2modegreipaddress10.1.1.2255.255.255.0source12.1.1.4destination12.1.1.2keepalive33 # 在本端设备上通过debugginggrepacket命令打开GRE报文调试开关，查看是否可以正常收发keepalive报文。 <Sysname>debugginggrepacket *Jun1612:46:50:3502022SysnameGRE/7/packet:-MDC=1; Tunnel2packet:Beforeencapsulation, 12.1.1.2->12.1.1.4(length=24) *Jun1612:46:50:3502022SysnameGRE/7/packet:-MDC=1; Tunnel2packet:Afterencapsulation, 12.1.1.4->12.1.1.2(length=48) *Jun1612:46:50:3512022SysnameGRE/7/packet:-MDC=1; Tunnel2packet:Beforede-encapsulationaccordingtofast-forwardingtable, 12.1.1.2->12.1.1.4(length=24) *Jun1612:46:50:3512022SysnameGRE/7/packet:-MDC=1;Tunnel2:Receivedakeepalivepacket. //Tunnel2收到keepalive报文 在对端设备上同样打开GRE报文调试开关，如果对端显示发出了keepalive报文，本端却未收到，则GRE报文可能未通过本端的校验和检查。无法收到keepalive报文会导致隧道接口down，可以尝试通过undokeepalive命令关闭keepalive功能来解决该问题。 如果能够正常收到keepalive报文，则执行步骤(4)继续排查故障。(4)检查隧道报文的hoplimit/TTL和隧道报文DF标志配置是否合理。 在任意视图下执行displaycurrentinterfacetunnel命令查看hoplimit/TTL和隧道报文DF标志的配置： # interfaceTunnel2modegreipaddress10.1.1.2255.255.255.0source12.1.1.4destination12.1.1.2keepalive33tunnelttl1 tunneldfbitenable # hoplimit/TTL配置和DF（Don’tFragment，不分片）标志的配置可能导致隧道报文被丢弃：a.hoplimit/TTL配置过小会导致隧道报文在中间设备上因为TTL超时而被丢弃。解决方法为在隧道接口视图下执行tunnelttl命令，依照实际组网配置合理的TTL值； b.设置封装后的隧道报文的DF标志后，中间设备可能会因为报文长度超出接口MTU值而丢弃报文。解决方法为配置转发路径上各个接口的MTU大于隧道报文长度。在无法保证转发路径上各个接口的MTU大于隧道报文长度时，请关闭隧道报文不分片功能。执行以上操作后仍无法排除故障，则执行步骤(5)继续排查故障。 (5)查看是否隧道下发硬件处理失败。打开隧道事件调试信息开关，查看是否有隧道报文或事件下内核/驱动失败，调试信息的示例如下： <Sysname>debuggingtunnelall *Jun1612:51:25:8322022SysnameTUNNEL/7/event:-MDC=1; Tunnel2notifiesdriver:Operation=4. TunnelIfIndex=524,EvilinkIfIndex=0 VRFIndex=0,DstVRFIndex=0 TunnelMode=IPv4GRE,TransPro=1 TunnelSrc=12.1.1.4 TunnelDst=12.1.1.2 TTL=255,ToS=0,DFBit=0 MTU=1476,IPv6Mtu=1476 DrvContext[0]=0xffffffffffffffff,DrvContext[1]=0xffffffffffffffff VNHandle=0x20000040,ADJIndex=0xfaf3889c //隧道接口Tunnel2通知驱动执行Operation4 *Jun1612:51:25:8322022SysnameTUNNEL/7/event:-MDC=1;Processingresultofoperation4forTunnel2:failed. //隧道接口Tunnel2下发的Operation4处理失败 %Jun1612:51:25:8322022SysnameIFNET/3/PHY_UPDOWN:-MDC=1;PhysicalstateontheinterfaceTunnel2changedtodown. %Jun1612:51:25:8322022SysnameIFNET/5/LINK_UPDOWN:-MDC=1;LineprotocolstateontheinterfaceTunnel2changedtodown. //隧道Tunnel2接口down *Jun1612:51:27:3502022SysnameTUNNEL/7/event:-MDC=1; Tunnel2can'tcomeupbecausethereisnotenoughhardwareresource //由于硬件资源不足，隧道Tunnel2不能up 当设备打印的如下的event或error信息时，表示硬件是故障导致隧道工作不稳定，此时请联系技术支持。 表4硬件相关的debug信息描述表 字段描述 隧道Tunnelnum不能up的原因为reason，reason的 Tunnelnumcan'tcomeupbecausereason.取值为thereisnotenoughhardwareresource：硬 件资源不足 向DBM（Databaseinmemory，内存数据库）保存 Failedtosave6RDprefixtoDBM.6RD隧道的IPv6前缀失败 FailedtosaveIPv4prefix/suffixfor6RDtunneltoDBM.向DBM保存6RD隧道的IPv4前缀/后缀失败 Failedtosave6RDBRaddresstoDBM.向DBM保存6RD隧道的BR地址失败 Failedtosend6RDprefixtokernel.向内核发送隧道的6RD前缀配置消息失败 kernel.FailedtosendIPv4prefix/suffixfor6RDtunnelto向内核发送隧道的6RDIPv4配置消息失败 Failedtosend6RDBRaddresstokernel.向内核发送隧道的6RDBR地址配置消息失败 (6)如果故障仍未排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 8二层技术-以太网交换类故障处理 8.1M-LAG故障处理 8.1.1peer-link接口无法UP ",Suggestion not provided
点对点类隧道（包括GRE、IPv4和IPv6隧道）配置完成后，本端Tunnel接口IP地址无法Ping通对端Tunnel接口IP地址。 本章以GREoverIPv4隧道为例进行说明。 ,"本类故障的常见原因主要包括： •配置错误：比如两端隧道模式不一致、未配置源地址或者是目的地址、两端源和目的不满足互为源、目的的关系等。 •物理链路不通：Tunnel的源和目的地址之间不存在路由，导致Tunnel接口不能UP，或者 Tunnel依赖的物理链路路由不通，导致Tunnel口虽然能UP但是中间设备丢包。 3.故障分析 本类故障的诊断流程如图126所示。 图126无法Ping通对端Tunnel接口IP地址故障诊断流程图 4.处理步骤 (1)检查隧道两端接口配置的完整性。 在两端设备分别执行displaycurrentinterfacetunnel命令，查看隧道接口配置，请确保隧道接口的源地址、目的地址和隧道接口IP地址均已配置。 <Sysname>displaycurrentinterfacetunnel # interfaceTunnel1modegreipaddress10.1.1.1255.255.255.0source1.1.1.1destination1.1.1.2 # 如果隧道接口的配置不完整，请参考如下示例补充缺失的配置。 <Sysname>system-view [Sysname]interfacetunnel1modegre [Sysname-Tunnel1]ipaddress10.1.1.1255.255.255.0 [Sysname-Tunnel1]source1.1.1.1[Sysname-Tunnel1]destination1.1.1.2 (2)检查隧道两端封装模式是否一致。 在两端设备上分别执行displaycurrentinterfacetunnel命令，查看隧道接口的封装模式。 <Sysname>displaycurrentinterfacetunnel # interfaceTunnel1modegreipaddress10.1.1.1255.255.255.0source1.1.1.1destination1.1.1.2 # 如果两端封装模式不一致，则需要先通过undointerfacetunnel命令删除模式配置错误的隧道，再通过interfacetunnel命令重新配置隧道接口。隧道删除后，隧道口下的配置也同时被删除，还需要重新配置源地址、目的地址和接口IP地址。(3)检查两端隧道源、目的地址是否匹配。 在两端设备分别执行displaycurrentinterfacetunnel命令，查看隧道接口配置， 请确保本端隧道的源地址等于对端隧道的目的地址，本端隧道的目的地址等于对端隧道的源地址，且源地址必须是本机地址。 本端设备： <Sysname>displaycurrentinterfacetunnel # interfaceTunnel1modegreipaddress10.1.1.1255.255.255.0source1.1.1.1destination1.1.1.2 # 对端设备： <Sysname>displaycurrentinterfacetunnel # interfaceTunnel1modegreipaddress10.1.1.2255.255.255.0source1.1.1.2destination1.1.1.1 # 如果两端隧道源、目的地址配置有误，则在隧道接口视图下执行source命令或destination命令重新配置源、目的地址。(4)检查两端隧道接口状态是否已经UP通过displayinterfacetunnel可以查看隧道接口状态，如果经过步骤(1)和步骤(2)的检查之后，隧道口状态依旧为Down，则可以参考故障处理手册中的Tunnel接口工作不稳定中的内容继续定位。 # <Sysname>displayinterfacetunnel1Tunnel1 Currentstate:UP Lineprotocolstate:UP Description:Tunnel1Interface Bandwidth:64kbps Maximumtransmissionunit:1476 Internetaddress:10.1.2.1/24(primary) Tunnelsource2002::1:1(Vlan-interface10),destination2001::2:1 TunnelTOS0xC8,TunnelTTL255 Tunnelprotocol/transportGRE/IPv6 … # (5)检查隧道的源、目的地址间是否路由可达检查隧道的源、目的IP地址之间是否存在路由。通过displaycurrentinterfacetunnel检查两端隧道接口IP是否在同一网段，如果在同一网段，默认会生成网段路由，不存在物理链路不通的问题；如果不在同一网段，则通过displayfib命令检查隧道源、目的IP地址之间是否路由可达，如果不存在路由，则需要配置相应的静态或者动态路由，使隧道的源、目的IP地址间路由可达。如果仍无法解决故障，则继续执行步骤(6)。 # <Sysname>displayfib Routedestinationcount:4 Directly-connectedhostcount:0 Flag: U:UseableG:GatewayH:HostB:BlackholeD:DynamicS:Static R:RelayF:FRR Destination/MaskNexthopFlagOutInterface/TokenLabel 0.0.0.0/32127.0.0.1UHInLoop0Null1.1.1.2/24192.168.126.1USGFM-GE0/0/0Null127.0.0.0/8127.0.0.1UInLoop0Null127.0.0.0/32127.0.0.1UHInLoop0Null# (6)如果故障仍未排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 下表中Debug命令输出的调试信息。 表17Debug命令列表 命令描述 debuggingtunnel开启Tunnel模块的调试信息开关debugginggre开启GRE的调试信息开关 debuggingippacket[aclacl-number]开启IP报文调试信息开关debuggingipv6packet[aclacl-number]开启IPv6报文调试信息开关 debuggingiperror开启IP转发错误调试信息开关 debuggingipinfo[aclacl-number]开启IP转发调试信息开关debuggingipv6info[aclacl-number]开启IPv6转发调试信息开关 5.告警与日志 相关告警无 相关日志 无 18用户接入与认证故障处理 18.1802.1X故障处理 18.1.1802.1X用户认证失败 ",Suggestion not provided
电口连接线缆后无法正常UP。 ,•接口不支持拆分或合并功能。 •未正确配置拆分或合并命令。 •拆分或合并后，未保持配置重启设备或单板。 •设备或单板硬件故障。 3.故障分析 本类故障的诊断流程如图21所示。 图21故障诊断流程图 4.处理步骤 (1)确认接口是否支持拆分、合并功能。 接口拆分、合并功能的支持情况与设备实际情况有关，需要查看配置命令手册或规格，确认该接口是否支持拆分或合并。若不支持，则更换支持拆分、合并功能的接口。 (2)查看是否正确配置拆分或合并命令在接口下，通过displaythis命令查看是否已配置拆分或合并命令。若没有配置，请正确配置拆分或合并命令。 (3)是否有重启单板或设备。 (4)部分产品需own命令，再执行undoshutdown执行命令，查看端(要保存配置并重启单板或设备后，命令才能生效。shutd)口是否能恢复正常。 (5)如果故障仍然未能排除，可能是设备或单板硬件故障，请收集信息，并联系技术支持人员。 5.告警与日志相关告警无 相关日志 无 3.6.5电口无法UP 本类故障的常见原因主要包括： •端口配置问题。 •网线有问题。 •本端或者对端端口有问题。 3.故障分析 本类故障的诊断流程如图22所示：图22故障诊断流程图 4.处理步骤 (1)查看网线两端对接设备网口配置（端口速率，双工，协商模式等）是否一致。执行displayinterfacebrief命令，查看两端端口的速率、双工配置是否匹配。若不匹配，请通过speed命令和duplex命令配置端口的速率和双工模式。需要注意的是：对于不支持半双工模式的交换机（例如S5850-54QS），当设备本端（速率双工为auto/auto模式）和对端（例如100M/FULL）协商后需要工作在halfduplex，端口也不会linkup。 <Sysname>displayinterfacebrief Briefinformationoninterfacesinroutemode: Link:ADM-administrativelydown;Stby-standby Protocol:(s)–spoofing InterfaceLinkProtocolPrimaryIPDescriptionGE1/0/1DOWNDOWN-- Loop0UPUP(s)2.2.2.9 NULL0UPUP(s)-- Vlan1UPUP-- Vlan999UPUP192.168.1.42 Briefinformationoninterfacesinbridgemode: Link:ADM-administrativelydown;Stby-standbySpeed:(a)-auto Duplex:(a)/A-auto;H-half;F-fullType:A-access;T-trunk;H-hybrid InterfaceLinkSpeedDuplexTypePVIDDescription GE1/0/2DOWNautoAA1aaaaaaa GE1/0/3UP1G(a)F(a)A1aaaaaaa (2)通过displayinterface命令查看端口状态Currentstate是否为AdministrativelyDOWN状态，如果是，请使用undoshutdown命令激活相应的以太网端口。 <Sysname>displayinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1 Currentstate:AdministrativelyDOWN Lineprotocolstate:DOWN Description:GigabitEthernet1/0/1Interface Bandwidth:1000000kbps Maximumtransmissionunit:1500 Allowjumboframestopass Broadcastmax-ratio:100%Multicastmax-ratio:100%Unicastmax-ratio:100% Internetprotocolprocessing:Disabled... (3)更换一根确认为好的网线，检查故障是否排除。 (4)分别更换本端设备端口以及对端设备端口，检查故障是否排除。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 3.6.6端口频繁UP/DOWN ,Suggestion not provided
电源模块状态指示灯异常或者电源运行中上报Fault。 ,本类故障的常见原因主要包括： •电源模块型号和主机不匹配。 •电源模块安装不到位。 •电源线缆没有插牢。 •电源模块温度过高。 •电源模块故障。 3.故障分析 本类故障的诊断流程如图7所示。 图7故障诊断流程图 4.处理步骤 (1)检查电源模块的型号是否和主机型号匹配。 (2)检查设备连接的供电系统：确认供电系统正常供电，电压正常。 (3)通过电源模块上的指示灯初步判断电源模块是否存在输出短路、输出过流、输出过压、输入欠 压、温度过高等问题。不同主机电源指示灯状态有所差异，具体请参见相应主机的硬件手册。 (4)检查电源模块状态。 使用displaypower命令显示电源模块状态，查看是否存在Fault、Error或Absent状态的 电源模块。 <Sysname>displaypower Slot1: PowerIDStateModeCurrent(A)Voltage(V)Power(W) 1NormalDC----0 2FaultAC----0 (5)如果电源模块状态为Absent，请按如下子步骤进行定位处理。 a.请将该电源模块拆卸后重新安装，重新安装前请检查电源连接器是否完好。 b.重新安装后，该电源模块的状态未恢复为Normal，则请将该电源模块与正常的电源模块更换槽位再做一次交叉验证。 c.如果该电源模块仍然显示为Absent，则请更换新的电源模块。 d.更换新的电源模块后，此故障仍然存在，请执行步骤7。 (6)如果电源模块状态为Fault或Error，请按如下子步骤进行定位处理。 a.检查电源线是否脱落或者是否正确连接。 b.如果电源线连接正常，交叉验证下电源线是否故障。 c.如果电源线正常，可能是电源模块本身温度过高导致。请查看电源模块积灰情况，如果灰尘较多，请清理灰尘，并将电源模块拆卸后重新安装。 d.重新安装后，电源模块状态未恢复为Normal，请将该电源模块与正常的电源模块更换槽位做一次交叉验证。 e.如果该电源模块仍然显示为Fault状态，请更换电源模块。 f.更换新电源模块后，此故障仍然存在，请执行步骤7。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 •DEV/2/POWER_FAILED •DEV/3/POWER_ABSENT 3.3风扇类故障 3.3.1风扇模块状态异常 ,Suggestion not provided
端口安全采用MAC地址和PSK的认证方式，并采用本地认证，正确输入PSK密钥后，Client无法关联上线,Cause not provided,Suggestion not provided
端口安全采用MAC地址和PSK的认证方式，并采用本地认证，正确输入PSK密钥后，Client无法关联上线。2.处理步骤 (1)需要确认配置的local-user用户名是否和user-name-format配置的一致。如果不一致，需要使用mac-authenticationuser-name-format命令修改MAC地址认证用户的帐 号格式。 (2)如果MAC地址中有字母的，在配置本地用户的时候有可能写成大写。此时需要使用 mac-authenticationuser-name-format命令将用户的MAC地址大写字母改为小写 字母，同时将密码改为和用户名一致，如下所示。 [Sysname-luser-00-14-6c-72-29-5c]displaythis # local-user00-14-6c-72-29-5cpasswordsimple00-14-6c-72-29-5cauthorization-attributelevel3service-typelan-access # 4.17未开启自动AP配置功能造成AP无法注册 ,Cause not provided,Suggestion not provided
端口安全配置802.1X采用RADIUS认证，用户关联不成功 ,(1)确认设备和RADIUS服务器之间可以互通。 (2)检查无线服务模板下配置的WLAN用户接入认证模式是否为dot1x。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)如果采用CHAP或PAP认证，需要检查AC上配置的是否携带域名与服务器上的配置是否保 (5)通过使用(持一致。)debuggingradiuspacket命令，查看RADIUS服务器和AC报文交互情况。 (6)检查AC上配置的port-mode和服务器上配置的证书认证类型是否一致。 (7)查看服务器端配置是否和设备匹配。 (8)查看客户端的配置是否正确。 4.12802.1X和ACS配合认证时，Client关联成功并下线后，再关联时无法关联成功 ,(1)确认设备和RADIUS服务器之间可以互通。 (2)检查无线服务模板下配置的WLAN用户接入认证模式是否为dot1x。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)如果采用CHAP或PAP认证，需要检查AC上配置的是否携带域名与服务器上的配置是否保 (5)通过使用(持一致。)debuggingradiuspacket命令，查看RADIUS服务器和AC报文交互情况。 (6)检查AC上配置的port-mode和服务器上配置的证书认证类型是否一致。 (7)查看服务器端配置是否和设备匹配。 (8)查看客户端的配置是否正确。 4.12802.1X和ACS配合认证时，Client关联成功并下线后，再关联时无法关联成功 
端口安全配置802.1X采用RADIUS认证，用户关联不成功。 ,(1)确认设备和RADIUS服务器之间可以互通。 (2)检查无线服务模板下配置的WLAN用户接入认证模式是否为dot1x。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)如果采用CHAP或PAP认证，需要检查AC上配置的是否携带域名与服务器上的配置是否保 (5)通过使用(持一致。)debuggingradiuspacket命令，查看RADIUS服务器和AC报文交互情况。 (6)检查AC上配置的port-mode和服务器上配置的证书认证类型是否一致。 (7)查看服务器端配置是否和设备匹配。 (8)查看客户端的配置是否正确。 4.12802.1X和ACS配合认证时，Client关联成功并下线后，再关联时无法关联成功 ,(1)确认设备和RADIUS服务器之间可以互通。 (2)检查无线服务模板下配置的WLAN用户接入认证模式是否为dot1x。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)如果采用CHAP或PAP认证，需要检查AC上配置的是否携带域名与服务器上的配置是否保 (5)通过使用(持一致。)debuggingradiuspacket命令，查看RADIUS服务器和AC报文交互情况。 (6)检查AC上配置的port-mode和服务器上配置的证书认证类型是否一致。 (7)查看服务器端配置是否和设备匹配。 (8)查看客户端的配置是否正确。 4.12802.1X和ACS配合认证时，Client关联成功并下线后，再关联时无法关联成功 
端口安全配置802.1X采用本地认证，用户关联不成功,(1)使用debuggingport-security命令检查是否因为没有配置全局端口安全导致没有进行 端口安全认证功能。 (2)确认是否是设备上配置的port-mode不正确，设备上没有PKI证书或者PKI证书过期。 (3)查看客户端的配置是否正确。 4.15使用RADIUS服务器进行MAC地址认证和PSK认证时，用户上不了线 ,(1)使用debuggingport-security命令检查是否因为没有配置全局端口安全导致没有进行 端口安全认证功能。 (2)确认是否是设备上配置的port-mode不正确，设备上没有PKI证书或者PKI证书过期。 (3)查看客户端的配置是否正确。 4.15使用RADIUS服务器进行MAC地址认证和PSK认证时，用户上不了线 
端口安全配置802.1X采用本地认证，用户关联不成功。 ,(1)使用debuggingport-security命令检查是否因为没有配置全局端口安全导致没有进行 端口安全认证功能。 (2)确认是否是设备上配置的port-mode不正确，设备上没有PKI证书或者PKI证书过期。 (3)查看客户端的配置是否正确。 4.15使用RADIUS服务器进行MAC地址认证和PSK认证时，用户上不了线 ,(1)使用debuggingport-security命令检查是否因为没有配置全局端口安全导致没有进行 端口安全认证功能。 (2)确认是否是设备上配置的port-mode不正确，设备上没有PKI证书或者PKI证书过期。 (3)查看客户端的配置是否正确。 4.15使用RADIUS服务器进行MAC地址认证和PSK认证时，用户上不了线 
端口安全配置MAC地址认证和PSK认证并采用RADIUS服务器，正确输入PSK密钥后用户关联不成功,(1)确认设备和RADIUS服务器之间互通。 (2)检查是否配置了全局开启端口安全。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)用户名是否携带域名要和服务器上配置的用户名一致。 (5)查看RADIUS服务器端配置是否和设备匹配。 4.16采用本地MAC地址认证时，用户上不了线 ,(1)确认设备和RADIUS服务器之间互通。 (2)检查是否配置了全局开启端口安全。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)用户名是否携带域名要和服务器上配置的用户名一致。 (5)查看RADIUS服务器端配置是否和设备匹配。 4.16采用本地MAC地址认证时，用户上不了线 
端口安全配置MAC地址认证和PSK认证并采用RADIUS服务器，正确输入PSK密钥后用户关联不成功。 ,(1)确认设备和RADIUS服务器之间互通。 (2)检查是否配置了全局开启端口安全。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)用户名是否携带域名要和服务器上配置的用户名一致。 (5)查看RADIUS服务器端配置是否和设备匹配。 4.16采用本地MAC地址认证时，用户上不了线 ,(1)确认设备和RADIUS服务器之间互通。 (2)检查是否配置了全局开启端口安全。 (3)检查AC上的nas-ip地址与服务器端配置是否一致，key配置是否一致。 (4)用户名是否携带域名要和服务器上配置的用户名一致。 (5)查看RADIUS服务器端配置是否和设备匹配。 4.16采用本地MAC地址认证时，用户上不了线 
端口状态为UP，不接收报文或出现丢包。 使用displayinterface命令查看本端入方向的接收报文统计增长数量小于对端出方向发送报文统计增长数量。 ,•端口出现CRC错误。 •端口上的配置影响报文的接收。 •设备或单板硬件故障。 3.故障分析 本类故障的诊断流程如图19所示。 图19故障诊断流程图 4.处理步骤 (1)查看端口是否出现CRC错误。 按“端口出现CRC错误”章节排查。 (2)检查端口配置是否影响报文接收。 •可通splayinterfacebrief通过命令，查看端口(过以下步骤检查端口配置是否影响报文的接收：di)配置是否有异常。其中包括两端的端口双工模式、端口类型以及VLAN等配置。若有异常，请更改端口属性的配置查看该故障端口 是否能恢复正常。如果不能，请先执行shutdown命令后，再执行undoshutdown命令， •STP对于二层口，如果配置了功(再次查看端口是否能恢复正常。)能，通过displaystpbrief命令，查看端口是否为 discarding状态。如果端口被STP设置为discarding状态，请根据STP的相关配置进一步排查。建议将连接终端设备的端口配置为边缘端口或关闭该端口的STP功能。 •如果该端口加入了聚合组，通过displaylink-aggregationsummary命令查看该端口是否为Selected选中状态。当该端口Status为Unselected状态时，该端口无法收发数据报文。请定位端口成为Unselected状态的原因，如聚合组内成员端口的属性类配置与参考端口不一致，进一步排查解决。 •如果配置了ACL过滤，请根据ACL的相关配置进一步排查。 •如果接口配置了PFC功能和流量控制功能，请关闭PFC功能和流量控制功能查看该故障端口是否能恢复正常。 •如果接口上配置了广播/组播/未知单播风暴抑制功能，当接口上的广播/组播/未知单播流量超过用户设置的抑制阈值时，系统会丢弃超出流量限制的报文，查看接口是否配置了了广播/组 播/未知单播风暴抑制功能，如果配置了，请关闭接口的风暴抑制功能查看该故障端口是否能 (3)执行shutd(恢复正常。)own命令，再执行undoshutdown命令，查看端口是否能恢复正常。 (4)如果故障仍然未能排除，可能是设备或单板硬件故障，请收集信息，并联系技术支持人员。 (5)告警与日志相关告警无 相关日志无 3.6.3端口不发送报文 ,Suggestion not provided
堆叠过程中发生了主设备或者备设备异常重启，导致堆叠分裂。 ,"本类故障的常见原因主要包括：•从设备自动重启来完成软件版本的升级。 •IRF合并，导致从设备重启。 •设备软件或者硬件故障，导致设备异常重启，来尝试修复故障。 3.故障分析 本类故障的诊断流程如图41所示。图41IRF成员设备异常重启故障诊断流程图 4.处理步骤 (1)检查重启的设备是否为从设备。 如果是从设备，请执行步骤(2)。 如果不是从设备，是主设备，请执行步骤(4)。 (2)检查从设备是否因为自动加载启动文件，升级导致的重启。 如果从设备是因为自动加载启动文件，升级导致的重启，则该重启为正常重启，无需处理。 如果从设备不是因为自动加载启动文件，升级导致的重启，请继续执行步骤(3)。您可通过以下方式确认从设备的重启原因：IRF要求所有成员设备上运行的软件版本必须一致。当IRF开启了启动文件的自动加载功能，且有新设备加入IRF时，如果新设备的软件版本和 主设备的软件版本不一致，则新设备会自动从主设备下载启动文件，然后使用新的启动文件重启并以从设备角色加入IRF。在Probe视图下，执行displaysysteminternalirfmsg 命令，如果显示信息中有“Versionisdifferent,andthesenderCPUMACisxxxx-xxxx-xxxx (chassisxxslotxx).”类似信息，表示CPUMAC为xxxx-xxxx-xxxx的从设备是因为自动加载启动文件，升级导致的重启。 (3)检查是否因为IRF合并导致的从设备重启。 如果从设备重启原因为IRF合并，请追查IRF分裂、合并的原因，并排除安全隐患，以免再次因为同样的原因导致IRF分裂、合并。 如果从设备重启原因不是IRF合并，请继续执行步骤(4)。 elreboot(IRF合并：)命令查看设备的重启原因。如果 Reason字段取值为0x7，则表示从设备重启原因为IRF合并，Slot表示触发重启事件的Slot的编号，TargetSlot表示实际发生重启的Slot的编号。 <Sysname>displaykernelreboot1 ---------------------Rebootrecord1--------------------- Recordedat:2021-12-0600:10:05.440616 Occurredat:2021-12-0600:10:05.440616 Reason:0x7 Thread:STM_Main(TID:232)Context:threadcontext Slot:1TargetSlot:2Cpu:0 VCPUID:2 Kernelmoduleinfo:modulename(system)moduleaddress(0xffffffffc0074000)modulename(addon)moduleaddress(0xffffffffc0008000) 在IRF的Probe视图下执行displaysysteminternalirfmsg|includereboot命令，如果可以看到主设备发送了重启报文，则表示从设备重启原因为IRF合并。 19>Sendrebootpkt,src_addr5e40-08d9-0104(chassis1slot1),at2022/1/515:42:48:386 (4)检查是否有软件和硬件故障导致成员设备异常重启。通过displayversion命令，可以查看成员设备/单板上次重启的原因，根据重启原因，以及表3所示的建议操作进行处理。 <Sysname>displayversion … RebootCause:ColdReboot RebootCause字段的取值重启原因说明建议操作 ACL表项太多等原因会导致内存占用 MemoryexhaustReboot内存消耗，低于门限值率高，确认内存占用率高的原因，解决内存占用率高故障 请收集日志、诊断日志，联系技术支持 PdtReboot产品驱动要求的重启人员处理 请收集日志、诊断日志，联系技术支持 SelfReboot业务板本板复位人员处理 StandbyCannotUpdateRebo备用主控板不能升级为主用主请收集日志、诊断日志，联系技术支持 ot控板，重启人员处理 系统软件升级等原因会导致主备倒换， StandbySwitchReboot主备倒换重启原主用主控板确认系统主备倒换的原因，避免再次发生非预期的主备倒换 UserReboot通过命令行、网管或等方式主动重启设备Web页面正常，无需处理 原因可能有多种，例如单板虚插请收集日志、诊断日志，联系技术支持WarmReboot针脚接触不良导致单板重启等人员处理CPU、内存、软件或其它硬件故display命根据 WatchDogReboot障，导致看门狗监测到系统异令显示的故障修复信息定位故障原因，hardware-failure-detection 常，重启设备消除安全隐患 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 假设slot16为主用主控板，以备用主控板slot17重启为例，请收集以下命令的显示信息。 −请在任意视图下执行以下命令：displayversiondisplaydevice displaydiagnostic-informationdisplaykerneldeadloop20verboseslot16displaykernelexception10verboseslot16displaykernelreboot20verboseslot16 −请在Probe视图下执行以下命令来收集信息：locallogbufferslot17display locallogbufferslot17displayfrom-highmemorydisplayrebootlast-timeslot17displaysysteminternalversiondisplaydiag-msgstart-msgslot17 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警 无 相关日志 •DEV/1/AUTO_SWITCH_FAULT_REBOOT •DEV/5/BOARD_REBOOT •DEV/1/BOARD_RUNNING_FAULT_REBOOT •DEV/5/CHASSIS_REBOOT •DEV/5/SUBCARD_REBOOT •DEV/5/SYSTEM_REBOOT •STM/4/STM_MERGE 6.1.3IRF分裂后BFDMAD无法生效 ",Suggestion not provided
对于使用外置PoE电源进行PoE供电的款型，外置PoE电源异常断电，影响PoE功能的正常使用。 ,外部供电异常。 3.故障分析 本类故障的诊断流程如图30所示。 图30故障诊断流程图 4.处理步骤 (1)不需重启设备时，等待30秒后给外置PoE重新上电，查看PoE功能是否恢复。 (2)需要重启设备时，按如下方式处理： 如果由于外部原因（例如外置PoE电源和设备均断电）或误操作等原因导致在外置PoE电源断电时，需重启设备（包括设备重新上电和通过reboot命令重启），请按如下步骤恢复PoE功能： a.给外置PoE电源上电； b.给设备重新上电启动或通过reboot命令重启； c.设备启动完全后，如果PoE功能仍然无法正常工作，请删除设备上PoE的相关配置，然后在设备上重新完成PoE功能的配置。 (3)收集信息并寻求技术支持 如果上述操作完成后PoE功能仍无法恢复正常，请收集设备运行信息，并联系H3C的技术支持工程师。 5.告警与日志相关告警 无相关日志无 4转发类故障处理 4.1转发类故障处理 4.1.1二层流量转发丢包 ,Suggestion not provided
多台设备通过物理链路连接成环时，业务流量中断,"本类故障的常见原因包括： •设备接口的物理状态为DOWN。 •设备的生成树功能处于关闭状态。 3.故障分析 本类故障的诊断流程如图4-5所示。图4-5设备连接成环时业务中断的故障诊断流程图 4.处理步骤 (1)检查承载业务流量的接口状态是否为UP。 a.检查接口的物理状态是否为UP。 执行displayinterfacebrief命令，通过“Link”字段查看网络中的接口物理状态是否为UP，例如： <Sysname>displayinterfacebrief Briefinformationoninterfacesinroutemode: Link:ADM-administrativelydown;Stby-standbyProtocol:(s)-spoofing InterfaceLinkProtocolPrimaryIPDescription Asy1/0/1UP-- E-Ch1/0/1:0DOWNDOWN--InLoop0UPUP(s)--NULL0UPUP(s)-- Vlan1UPUP192.168.100.2 Briefinformationoninterfacesinbridgemode: Link:ADM-administrativelydown;Stby-standbySpeed:(a)-auto Duplex:(a)/A-auto;H-half;F-fullType:A-access;T-trunk;H-hybrid InterfaceLinkSpeedDuplexTypePVIDDescription GE1/0/1UP1G(a)F(a)A1GE1/0/2DOWNautoAA1 WLAN-Radio1/0/1UP--------WLAN-Radio1/0/2UP-------- −如果网络中接口的状态为UP，请执行步骤b。 −如果网络中接口的状态为ADM，请在接口视图下执行undoshutdown命令开启该接口。如果接口的状态仍为DOWN，请进行接口链路以及相关配置的排查；如果此时接口的状态为UP，但是故障仍未解决，请执行步骤b。 −如果网络中接口的状态为DOWN，请进行接口链路以及相关配置的排查。接口状态恢复UP后，如果故障仍未解决，请执行步骤b。 b.检查接口的数据链路层协议状态是否为UP。接口的数据链路层协议为DOWN的接口无法 执行displayinterfa(参与生成树拓扑的计算。)ce命令，通过“Lineprotocolstate”字段查看网络中的接口数据链路层协议状态是否为UP，例如： <Sysname>displayinterfacegigabitethernet1/0/2 GigabitEthernet1/0/2Currentstate:UP Lineprotocolstate:DOWN(LAGG)... DOWN(protocols)表示接口的数据链路层被一个或者多个协议模块关闭。例如，DOWN(LAGG)表示聚合接口中没有选中的成员端口而关闭接口的数据链路层。如果接口的数据链路层被协议模块关闭，请检查并修改协议模块的配置，使得接口的数据链路层协议状态恢复为UP。如果接口的数据链路层协议状态恢复为UP后，故障仍未解决，请执行步骤（2）。 (2)检查设备的生成树功能是否开启。 a.检查设备上全局生成树功能是否开启。执行displaystp命令： −如果出现如下显示信息，则表示全局的生成树协议未开启： <Sysname>displaystp Protocolstatus:Disabled ProtocolStd.:IEEE802.1s Version:3 Bridge-Prio.:32768 MACaddress:2eae-3769-0200 Maxage(s):20Forwarddelay(s):15 Hellotime(s):2 Maxhops:20 TCSnooping:Disabled <Sysname>displaystp STPisnotconfigured.请在系统视图下执行stpglobalenable命令开启全局的生成树功能。 −如果出现生成树的状态和统计信息（如下所示），则说明全局的生成树功能已经开启，请继续执行步骤b。 <Sysname>displaystp -------[CISTGlobalInfo][ModeMSTP]-------BridgeID:32768.2eae-3769-0200 Bridgetimes:Hello2sMaxAge20sFwdDelay15sMaxHops20 RootID/ERPC:32768.2eae-3769-0200,0 RegRootID/IRPC:32768.2eae-3769-0200,0 RootPortID:0.0 BPDU-Protection:Disabled BridgeConfig- Digest-Snooping:Disabled TCorTCNreceived:0 TimesincelastTC:0days2h:49m:11s b.（仅生成树模式为PVST时适用，非PVST模式请继续执行步骤c）检查VLAN的生成树 在系统视图下，(功能是否开启。)执行displaythis命令，查看是否存在undostpvlanenable命令的配置，例如： [Sysname]displaythis...# undostpvlan2enablestpmodepvststpglobalenable# ... 如果存在上述配置且网络中需要开启对应VLAN的生成树功能，请在系统视图下执行stpvlanenable命令，开启VLAN的生成树功能。 c.检查接口的生成树功能是否开启。 执行displaystp命令，查看是否存在生成树功能未开启的接口，例如： <Sysname>displaystp... ----[Port1(GigabitEthernet1/0/1)][DISABLED]---- Portprotocol:Disabled...请在需要参与生成树计算的接口视图下执行stpenable命令，开启接口的生成树功能。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 •无相关日志 •无 4.4.2接入生成树网络的用户终端设备发生掉线 ",Suggestion not provided
多台设备通过物理链路连接成环时，业务流量中断。 ,"本类故障的常见原因包括： •设备接口的物理状态为DOWN。 •设备的生成树功能处于关闭状态。 3.故障分析 本类故障的诊断流程如图4-5所示。图4-5设备连接成环时业务中断的故障诊断流程图 4.处理步骤 (1)检查承载业务流量的接口状态是否为UP。 a.检查接口的物理状态是否为UP。 执行displayinterfacebrief命令，通过“Link”字段查看网络中的接口物理状态是否为UP，例如： <Sysname>displayinterfacebrief Briefinformationoninterfacesinroutemode: Link:ADM-administrativelydown;Stby-standbyProtocol:(s)-spoofing InterfaceLinkProtocolPrimaryIPDescription Asy1/0/1UP-- E-Ch1/0/1:0DOWNDOWN--InLoop0UPUP(s)--NULL0UPUP(s)-- Vlan1UPUP192.168.100.2 Briefinformationoninterfacesinbridgemode: Link:ADM-administrativelydown;Stby-standbySpeed:(a)-auto Duplex:(a)/A-auto;H-half;F-fullType:A-access;T-trunk;H-hybrid InterfaceLinkSpeedDuplexTypePVIDDescription GE1/0/1UP1G(a)F(a)A1GE1/0/2DOWNautoAA1 WLAN-Radio1/0/1UP--------WLAN-Radio1/0/2UP-------- −如果网络中接口的状态为UP，请执行步骤b。 −如果网络中接口的状态为ADM，请在接口视图下执行undoshutdown命令开启该接口。如果接口的状态仍为DOWN，请进行接口链路以及相关配置的排查；如果此时接口的状态为UP，但是故障仍未解决，请执行步骤b。 −如果网络中接口的状态为DOWN，请进行接口链路以及相关配置的排查。接口状态恢复UP后，如果故障仍未解决，请执行步骤b。 b.检查接口的数据链路层协议状态是否为UP。接口的数据链路层协议为DOWN的接口无法 执行displayinterfa(参与生成树拓扑的计算。)ce命令，通过“Lineprotocolstate”字段查看网络中的接口数据链路层协议状态是否为UP，例如： <Sysname>displayinterfacegigabitethernet1/0/2 GigabitEthernet1/0/2Currentstate:UP Lineprotocolstate:DOWN(LAGG)... DOWN(protocols)表示接口的数据链路层被一个或者多个协议模块关闭。例如，DOWN(LAGG)表示聚合接口中没有选中的成员端口而关闭接口的数据链路层。如果接口的数据链路层被协议模块关闭，请检查并修改协议模块的配置，使得接口的数据链路层协议状态恢复为UP。如果接口的数据链路层协议状态恢复为UP后，故障仍未解决，请执行步骤（2）。 (2)检查设备的生成树功能是否开启。 a.检查设备上全局生成树功能是否开启。执行displaystp命令： −如果出现如下显示信息，则表示全局的生成树协议未开启： <Sysname>displaystp Protocolstatus:Disabled ProtocolStd.:IEEE802.1s Version:3 Bridge-Prio.:32768 MACaddress:2eae-3769-0200 Maxage(s):20Forwarddelay(s):15 Hellotime(s):2 Maxhops:20 TCSnooping:Disabled <Sysname>displaystp STPisnotconfigured.请在系统视图下执行stpglobalenable命令开启全局的生成树功能。 −如果出现生成树的状态和统计信息（如下所示），则说明全局的生成树功能已经开启，请继续执行步骤b。 <Sysname>displaystp -------[CISTGlobalInfo][ModeMSTP]-------BridgeID:32768.2eae-3769-0200 Bridgetimes:Hello2sMaxAge20sFwdDelay15sMaxHops20 RootID/ERPC:32768.2eae-3769-0200,0 RegRootID/IRPC:32768.2eae-3769-0200,0 RootPortID:0.0 BPDU-Protection:Disabled BridgeConfig- Digest-Snooping:Disabled TCorTCNreceived:0 TimesincelastTC:0days2h:49m:11s b.（仅生成树模式为PVST时适用，非PVST模式请继续执行步骤c）检查VLAN的生成树 在系统视图下，(功能是否开启。)执行displaythis命令，查看是否存在undostpvlanenable命令的配置，例如： [Sysname]displaythis...# undostpvlan2enablestpmodepvststpglobalenable# ... 如果存在上述配置且网络中需要开启对应VLAN的生成树功能，请在系统视图下执行stpvlanenable命令，开启VLAN的生成树功能。 c.检查接口的生成树功能是否开启。 执行displaystp命令，查看是否存在生成树功能未开启的接口，例如： <Sysname>displaystp... ----[Port1(GigabitEthernet1/0/1)][DISABLED]---- Portprotocol:Disabled...请在需要参与生成树计算的接口视图下执行stpenable命令，开启接口的生成树功能。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 •无相关日志 •无 4.4.2接入生成树网络的用户终端设备发生掉线 ",Suggestion not provided
多台设备无法组建IRF，或者新设备无法加入现有的IRF。 ,"本类故障的常见原因主要包括： •IRF成员设备数量超出了产品支持的规格，导致新设备无法加入现有的IRF。 •配置不符合IRF要求，导致无法组建IRF，或者新设备无法加入现有的IRF。 •IRF物理端口、线缆和物理拓扑不符合IRF要求，导致IRF链路无法达到up状态。 3.故障分析 本类故障的诊断流程如图40所示。 图40IRF组建失败故障诊断流程图 4.处理步骤 本文仅列出组建IRF的常规要求，以供参考。组建IRF的完整要求请参见产品配套的《IRF配置指导》。 (1)检查IRF成员数量是否已达到系统支持的最大值。 请使用displayirf命令查看当前IRF中的成员设备数量。如果IRF成员数量已经达到系统支持的最大值，则不允许再加入成员设备。 同一IRF域内，不同型号的产品支持的IRF成员最大数量不同，请以设备的实际情况为准。 (2)检查各成员设备使用的软件版本是否一致。 使用displayversion命令查看每台设备当前运行的软件版本，只有使用相同软件版本的设备才能组成IRF。 IRF系统启动文件自动加载功能（缺省为开启状态）可以自动将成员设备的软件版本与IRF中主设备进行同步，但是在成员设备与主设备的软件版本差异过大时，自动升级可能无法成功执行。此时，需要分别升级每台成员设备，使得所有成员设备的软件版本一致，之后再组建IRF。如果成员设备使用双主控，请同时升级两块主控板，保证所有成员设备的所有主控板上运行的软件版本相同。 (3)检查IRF的配置是否满足相关要求。 a.确保设备运行在IRF模式。 部分产品出厂即为IRF模式，且不支持模式切换；部分产品出厂为独立运行模式，支持模式切换。如果设备当前支持displayirflink或者displayirftopology命令， 则说明设备运行在IRF模式。否则，设备运行在独立运行模式，需要先在系统视图执行chassisconvertmodeirf命令将设备切换到IRF模式。 <Sysname>displayirf? >Redirectittoafile >>Redirectittoafileinappendmode configurationIRFconfigurationthatwillbevalidafterrebootlinkDisplaylinkstatustopologyTopologyinformation |Matchingoutput <cr> 不支持模式切换的设备，请忽略此步骤。 b.确保设备的成员编号在IRF中唯一。 请使用displayirf命令查看IRF中各成员设备的成员编号。IRF中各成员设备必须使用不同的编号，编号相同的设备不能建立或加入IRF。设备缺省成员编号为1，在独立运行模式下可通过irfmember命令修改，在IRF模式下可通过irfmemberrenumber命令修改（不支持模式切换的产品，可通过irfmemberrenumber命令修改成员编号）。 修改后需要保存配置并重启该设备，新编号才能生效。 c.确保各成员设备的出厂桥MAC地址不同 具有相同出厂桥MAC的成员设备之间不能组成IRF。通常情况下，设备出厂会携带全网唯 一的桥MAC地址。如果IRF组建失败，且输出了日志信息“FailedtostackbecauseofthesamebridgeMACaddresses.”，则表明两台设备的出厂桥MAC相同，可在其中一台设备上执行irfmac-address命令修改桥MAC。（不支持irfmac-address命令的设备，请忽略此步骤） d.确保同一IRF系统中所有成员设备的IRF域编号一致。IRF域编号不影响IRF的组建和合并，但是会影响MAD检测。为了使MAD功能正常工作，请确保同一IRF系统中所有成员设备的IRF域编号一致。IRF域编号缺省值为0。在单台设备上执行displayirf命令，可通过显示信息中的DomainID字段查看IRF域编号。 如果设备的IRF域编号和其它设备不同，可在该设备上执行irfdomain命令修改。 (4)检查IRF端口的状态，使其变成UP状态。 IRF端口是一种专用于IRF连接的逻辑接口，需要与物理端口绑定后才能生效。请通过displayirftopology命令显示信息的Link字段来确认IRF端口的状态。 <Sysname>displayirftopology TopologyInfo ------------------------------------------------------------------------- IRF-Port1IRF-Port2 MemberIDLinkneighborLinkneighborBelongTo 2DIS---UP15e40-08d9-0104 1UP2DIS---5e40-08d9-0104 如果Link字段取值为UP，则表示IRF端口连接正常，无需处理。 如果Link字段取值为DIS，则表示该IRF端口还没有和任何IRF物理端口绑定。请根据组网需要在IRF端口视图下使用portgroupinterface命令进行绑定。 如果Link字段取值为DOWN，请使用displayirflink命令进一步检查IRF物理端口的状态是否为UP。 −如果IRF物理端口的状态为UP，但IRF端口的状态为DOWN，原因可能是IRF端口的配置未激活。请在系统视图下执行irf-port-configurationactive命令激活IRF端口。 −如果IRF物理端口的状态不是UP，请参照步骤(5)定位IRF物理端口的问题。 如果Link字段取值为TIMEOUT，表明IRFHello报文超时，IRF链路通信存在问题。可参照以下步骤先定位IRF报文超时问题。 −确认是否因为对端IRF端口状态异常，导致IRF报文无法互通：登录IRF链路的对端设备，在对端设备上执行displayirftopology和displayirflink，根据显 −确认是否存在网络环路，导(示的状态信息进行定位。)致IRF报文丢包：使用displaycountersrateinboundinterface命令查看IRF物理端口的报文速率统计信息，确认IRF链路上是否存在报文风暴。如果存在报文风暴，请检查是否存在物理环路以及VLAN和STP配置是否正确等，先解决报文风暴问题。 −使用displaydevice命令检查网板状态是否正常。如果不正常，请先定位网板问题。 如果Link字段取值为ISOLATE，表明该成员设备处于隔离状态。执行displaylogbuffer|include“STMstackabilitycheck”，并根据显示结果处理： −如果显示信息中包含“STMstackabilitycheck:Productseriesisinconsistency”字样，则说明成员设备的型号不符合IRF要求，请参考步骤(7)处理。 −如果显示信息中包含“STMstackabilitycheck:Productxxxisinconsistency”字样， xxx取值可能为systemworkingmode等，则说明当前系统参数配置不符合IRF要求，请参考步骤(8)处理。 (5)检查IRF物理端口的状态，使其变成UP状态。请通过displayirflink命令查看IRF物理端口的状态。如果显示信息中： Interface字段取值为disable，表示该IRF端口还没有和IRF物理端口绑定。 Interface字段为物理接口的名称，请继续检查Status字段。Status字段的取值及含义如下： −UP：链路up，无需处理 −DOWN：链路down，请检查IRF物理端口的光模块/光纤或者电缆是否工作正常。请使用符合产品要求的物理接口作为IRF物理端口，使用符合产品要求的线缆来连接IRF物理端口，并执行步骤(6)。 −ADM：表示该接口通过shutdown命令被关闭，即管理状态为关闭。您需要执行undoshutdown命令将其开启。 −ABSENT：接口不存在。请插入单板或接口模块扩展卡。 (6)检查IRF物理连线是否符合要求。 可通过以下步骤来定位IRF物理连接问题： a.在每台成员设备上通过displayirfconfiguration命令查看IRF端口与IRF物理 端口的绑定关系。检查绑定的物理接口和实际连接的物理接口是否一致，如果不一致，请重新配置绑定关系或重新进行物理连接。 b.检查IRF物理端口的连接状况，是否满足相邻设备的连接要求。连接两台相邻的成员设备时，一台设备上IRF-Port1绑定的IRF物理端口只能和邻居成员设备IRF-Port2绑定的IRF物理端口相连。且当两台成员设备组建IRF时，只能使用链型拓扑，不允许使用环形拓扑。 (7)检查成员设备的硬件是否符合IRF的要求。请使用符合产品要求的硬件组建IRF，例如设备型号、主控板、接口板、IRF物理接口的类型必须符合要求。可以通过如下方式查看当前设备的型号、主控板型号等，以判断设备硬件是否符合IRF要求。例如：S10500X-G系列交换机仅支持同一型号的交换机之间建立IRF且IRF中所有成员设备的主控板型号必须相同。 #使用displayversion命令查看设备型号。 <Sysname>displayversion H3CComwareSoftware,Version7.1.070,ESS7752P01 Copyright(c)2004-2022NewH3CTechnologiesCo.,Ltd.Allrightsreserved. H3CS10506X-Guptimeis0weeks,0days,18hours,11minutes Lastrebootreason:USERreboot … #使用displaydevice命令查看主控板的型号。 <Sysname>displaydevice SlotTypeStateSubslotSoftVerPatchVer 1/0LSEM1SUPA0Master0S10500XG-7752P01None1/1NONEAbsent0NONENone 1/2NONEAbsent0NONENone 1/3LSEM1GT48TSSD0Normal0S10500XG-7752P01None1/4NONEAbsent0NONENone 1/5NONEAbsent0NONENone 1/6NONEAbsent0NONENone 1/7NONEAbsent0NONENone1/8LSEM1SF06D0Normal0S10500XG-7752P01None1/9NONEAbsent0NONENone 1/10NONEAbsent0NONENone 1/11NONEAbsent0NONENone… (8)检查系统参数配置是否满足IRF的要求。 通常组成IRF的设备上要求某些系统参数或软件特性配置相同，例如： 在组成IRF的所有设备上，系统工作模式的配置（通过system-working-mode命令配 IRF在组成的所有设备上，硬件资源模式(置）必须相同，否则这些设备将无法组成)的配置(IRF。)（通过hardware-resourceswitch-mode命令配置）必须相同，否则这些设备将无法组成IRF。 请确保两个IRF上都配置或都取消IRF增强功能，否则，它们不能合并为一个IRF。 同时配置MDC和IRFMAD检测功能的情况下，请将IRF物理端口和MAD检测VLAN都配置在缺省MDC中，并请先为MDC分配物理接口再配置MAD功能。 在IRF分裂后，以及再次合并前，请确保各成员设备上MDC的相关配置以及IRF的相关undomdc命令删除使用M(配置和分裂前的保持一致。)DC时，建议先使用displayirflink命令查看该MDC中是否有IRF物理端口，如果该MDC中有IRF物理端口，请先取消IRF物理端口与IRF端口的绑定关系并保存配置后再删除MDC。 在组成IRF的所有设备上，以下路由相关配置必须相同，否则这些设备将无法组成IRF。−最大等价路由条数（通过max-ecmp-num命令配置）。 −等价路由模式（通过ecmpmode命令配置）。 −前缀大于64位的IPv6路由功能（通过hardware-resourcerouting-modeipv6-128命令配置）。 在组成IRF的所有设备上，ACL硬件模式的相关配置都必须相同，否则这些设备将无法组成IRF。 在组成IRF的所有设备上，VXLAN硬件资源模式的配置（通过hardware-resourcevxlan命令配置）必须相同，否则这些设备将无法组成IRF。以上仅例举典型产品的情况，不同产品的具体要求不同，请以设备的实际情况为准，具体可参见产品配套的配置指导。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：HH3C-STACK-MIB •hh3cStackPhysicalIntfLinkDown(1.3.6.1.4.1.25506.2.91.6.0.8)•hh3cStackPhysicalIntfRxTimeout(1.3.6.1.4.1.25506.2.91.6.0.9)相关日志 •STM/3/STM_LINK_DOWN •STM/2/STM_LINK_TIMEOUT •STM/6/STM_LINK_UP •STM/4/STM_SAMEMAC •STM/3/STM_SOMER_CHECK 6.1.2IRF成员设备异常重启 ",Suggestion not provided
二层组播业务不通主要表现在二层组播转发表项无法生成，导致组播流量无法正常转发。 ,本类故障的常见原因主要包括： •设备没有收到二层组播协议报文。 •IGMP协议报文格式不正确。 •二层组播转发表项未生成。 3.故障分析 本类故障的诊断思路如下： (1)检查是否生成二层组播转发表项。 (2)检查是否正常收到组播协议报文。 (3)检查IGMP协议报文格式是否正确。 (4)检查IGMP报文版本是否跟设备上配置的一致。 (5)检查是否开启三层组播功能。本类故障的诊断流程如图89所示。图89二层组播业务不通的故障诊断流程图 4.处理步骤 (1)检查是否生成正确的二层组播转发表项。 执行displayl2-multicastipforwarding命令查看二层组播表项是否生成。 如果存在，请直接联系技术人员。 如果不存在，请执行步骤(2)。 (2)检查设备是否正常收到IGMP成员关系报告报文。 执行debuggingigmp-snoopingpacket命令，打开IGMPSnooping报文调试信息开 关。如果设备上打印如下调试信息，表示可以正常收到成员关系报告报文。 *Sep1511:47:41:4552011SysnameMCS/7/PACKET:-MDC=1;ReceiveIGMPv2reportpacketfromportGE1/0/1onVLAN2.(G162625) 如果没有，检查下游设备和终端设备是否正常。 如果有，请执行步骤(3)。 (3)检查IGMP协议报文交互过程是否正常，报文格式是否符合协议规范。 IGMP协议交互不正常时，通常会出现设备上转发表项无法生成的现象，导致组播数据流无法正常转发，造成组播业务中断。 在设备上配置镜像，并联系技术支持，在专业人士的指导下使用抓包工具（例如Wireshark）对镜像的IGMP协议报文进行分析。 如果不正常，请将IGMP协议报文修改为符合协议规范的报文。 如果正常，请执行步骤(4)。 (4)检查收到的IGMP报文的版本是否与设备配置的IGMPSnooping版本一致。 执行displayigmp-snooping命令查看显示信息中的Version字段确认设备使用的IGMP Snooping版本，检查是否与收到的IGMP报文的版本一致。 如果不一致，可以用如下两种方法处理： −修改上下游设备的IGMP版本，保证上下游设备的IGMP版本与本设备上配置的IGMP Snooping版本一致。 −在本设备IGMP-Snooping视图下执行version命令或者在VLAN视图下执行igmp-snoopingversion命令，修改IGMPSnooping版本，保证本设备的IGMP Snooping版本与上下游设备的IGMP版本一致。 如果一致，请执行步骤(5)。 (5)检查是否开启三层组播功能。 在开启了二层组播功能的VLAN所对应的VLAN接口上，若同时开启三层组播功能，会导致二层组播转发表项无法下发硬件，请关闭三层组播功能。 如果开启了三层组播功能，请删除三层组播配置。 如果未开启三层组播功能，请执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 无 12MPLS类故障处理 12.1LDP故障处理 12.1.1LDP会话无法Up ,Suggestion not provided
风扇模块状态指示灯异常或者风扇框运行中上报Fault。 ,本类故障的常见原因主要包括： •风扇未插紧。 •机箱出风口、入风口被异物堵塞。 •风扇硬件故障。 •风扇的实际风道方向与设备期望的风道方向不一致（仅部分机型涉及）。 3.故障分析 本类故障的诊断流程如图8所示。 图8故障诊断流程图 4.处理步骤 (1)查看风扇模块指示灯状态是否正常，不同主机风扇指示灯状态有所差异，具体请参见相应主机的硬件手册。如果所有指示灯都为灭，请确认电源模块是否正常工作，或整机开关接线是否开路，具体请参见3.2.1电源模块状态异常。 (2)查看风扇框状态。 使用displayfan命令查看风扇框状态（不同产品的显示信息不同，请以产品的实际情况 为准）。 <Sysname>displayfan Slot1: Fan1: State:Normal AirflowDirection:Port-to-power PreferAirflowDirection:Port-to-power (3)检查风扇框是否安装牢固。 对于部分机型，如果风扇框工作状态显示为FanDirectionFault，表示设备期望的风道方向与风扇框的实际风道方向不一致，此时可通过fanprefer-direction命令配置期望的风道 方向，使其和风扇框的实际风道方向一致，或者可以更换相同风道方向的风扇框。 如果风扇框工作状态显示为Absent，表示风扇框不在位或者没有安装牢固。如果风扇框在位，请将该风扇框拆卸后重新安装，重新安装前请检查风扇连接器是否完好，然后查看风扇框状态是否显示为Normal状态。如果仍然显示为Absent状态，请更换风扇框。如果更换新风扇框后仍然显示为Absent状态，请执行步骤5。 (4)检查设备的工作环境信息。 如果风扇框工作状态显示为Fault，表示该风扇框异常，无法提供抽风散热功能。请使用下述步骤进一步定位。 a.使用displayenvironment命令查看系统温度是否持续升高。如果系统温度持续升高，建议用手在设备出风口触摸进一步判断出风口是否有出风。如果温度持续升高，且出风口无风，表示风扇框异常。 b.检查机箱出风口、入风口是否被异物堵塞。如果有异物，请将其清理。 c.查看各个风扇的转速是否正常。使用Probe视图下的debugsysmfanfan-id get-speed命令查看风扇转速（不同设备对此命令的支持情况存在差异，请以设备实际情况为准）。如果speed字段信息显示风扇转速小于500/rpm，表示风扇异常。 d.如果确定风扇异常，请将风扇框拆卸后重新安装，重新安装前请检查风扇连接器是否完好，然后使用displayfan命令查看是否恢复为Normal状态。 e.如果仍然不能恢复为Normal状态，请更换该风扇框。如果现场没有风扇框，不能立即更换，请关闭设备以免温度过高导致电路烧坏；如果有降温措施保证系统工作在50摄氏度以下，也可以继续使用设备。 f.如果更换新的风扇框仍然不能恢复为Normal状态，请执行步骤5。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 •DEV/2/FAN_FAILED •DEV/3/FAN_ABSENT 3.4接口模块扩展卡故障 3.4.1接口模块扩展卡状态异常 ,Suggestion not provided
管理员采用HWTACACS认证登录设备失败。 ,"本类故障的常见原因主要包括： •用户线下的认证方式配置错误。 •VTY用户线下支持的协议类型不正确。 •ISP域下配置的认证、授权、计费方案错误。 •与HWTACACS服务器交互失败。 •HWTACACS服务器未下发用户角色权限。 3.故障分析 本类故障的诊断流程如图4-39所示。 图4-39HWTACACS认证登录失败的故障诊断流程图 4.处理步骤 Web、NETCONFoverSOAP、FTP类登录故障无需关心用户线（类）下的配置，其它排障步骤相同。 (1)检查用户线下的配置。 执行linevtyfirst-number[last-number]命令进入指定的VTY用户线视图，并通过displaythis命令查看如下配置是否准确： authentication-mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。 (2)检查用户线类下的配置。 用户线视图下的配置优先于用户线类视图下的配置。若用户线视图下未配置，则需要继续检查 lineclassvty执行(用户线类视图下的配置。)命令进入VTY用户线类视图，并通过displaythis命令查看如 -mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。 如果用户线和用户线类下的配置均不准确，请按照需要，在指定的用户线或用户线类下设置认证方案为scheme，并设置用户登录支持的协议类型。 (3)检查ISP域下的认证、授权、计费方案配置是否准确。执行displaydomain命令，查看显示信息： 如果用户的登录用户名中携带了域名（假设为test），则查看该域下的“Loginauthenticationscheme:”字段取值是否为“HWTACACS=xx”。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“HWTACACS=xx”。 <Sysname>displaydomaintest Domain:test State:Active Loginauthenticationscheme:HWTACACS=hwt1 Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:Online Accountingquotaoutaction:Offline Servicetype:HSI Sessiontime:ExcludeidletimeNAS-ID:N/A DHCPv6-follow-IPv6CPtimeout:60seconds Authorizationattributes: Idlecut:Disabled Sessiontimeout:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 如果用户的登录用户名中未携带域名，则在系统视图下执行displaythis命令查看是否存在domaindefaultenableisp-name配置。（下例中缺省域名为system）。 # domaindefaultenablesystem # −如果存在该配置，则执行displaydomain命令查看isp-name域下的“Loginauthenticationscheme:”字段取值是否为“HWTACACS=xx”。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“HWTACACS=xx”。 −如果不存在该配置，则执行displaydomain命令查看system域下的“Loginauthenticationscheme:”字段取值是否为“HWTACACS=xx”。如果system域下无 “Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“HWTACACS=xx”。 授权、计费配置确认方式与认证类似，不再赘述。如果以上配置不准确，请在相关ISP域下配置Login用户采用HWTACACS认证/授权/计费方案（下例中认证/授权/计费均采用HWTACACS方案hwt1）。 <Sysname>system-view[Sysname]domaintest [Sysname-isp-test]authenticationloginhwtacacs-schemehwt1 [Sysname-isp-test]authorizationloginhwtacacs-schemehwt1 [Sysname-isp-test]accountingloginhwtacacs-schemehwt1 (4)通过HWTACACS的调试信息辅助排查如下故障。 执行debugginghwtacacssend-packet和debugginghwtacacs receive-packet命令打开HWTACACS报文发送/接收调试信息，如果系统打印应答报文调试信息中包含“status:STATUS_FAIL”，则表示用户的认证请求被服务器拒绝。因此，需要继续查看HWTACACS服务器认证日志中描述的失败原因，并根据具体的失败原因继 执行deb(续定位。)ugginghwtacacserror命令打开HWTACACS错误调试信息开关，如果系统打印错误调试信息“Failedtogetavailableserver.”，则通常表示设备与服务器的共享密钥不匹配，可以尝试在HWTACACS方案下设置与服务器匹配的共享密钥。 执行debugginghwtacacsevent命令打开HWTACACS事件调试信息开关，如果系统打印事件调试信息“Connectiontimedout.”，则表示设备与服务器之间不可达，可以尝试排查设备和服务器中间链路不通的问题。 (5)检查HWTACACS服务器是否下发了正确的用户角色权限。执行debugginghwtacacsall命令打开所有HWTACACS调试信息开关后，如果发现客户端登录时直接断开连接，且没有异常的HWTACACS事件调试信息以及HWTACACS错误调试信息输出，则有可能是HWTACACS服务器未给用户下发用户角色权限导致。此时，可以查看HWTACACS的接收报文调试信息是否包含“priv-lvl=xx”或“roles=xx”字段。 如果不包含，则表示HWTACACS服务器未给用户下发用户角色权限，则可以选用如下方 −在设备侧，(法之一解决：)可以通过执行roledefault-roleenablerolename命令使能缺省 用户角色授权功能，使得用户在没有被服务器授权任何角色的情况下，具有一个缺省的用户角色。 <Sysname>system-view [Sysname]roledefault-roleenable −联系HWTACACS服务器管理员，为用户下发合适的用户角色。HWTACACS服务器上 的授权角色配置必须满足格式：roles=""name1name2namen""，其中name1、name2、namen为要授权下发给用户的用户角色，可为多个，并使用空格分隔。 如果包含，但指定的用户角色在设备上不存在，则需要联系RADIUS服务器管理员修改用户角色设置或者在设备上通过user-rolerole-name命令创建对应的用户角色。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 hwtacacsall命令），收集设备的调试信息。 5.告警与日志 相关告警 模块名：HH3C-UI-MAN-MIB •hh3cLogInAuthenFailure(1.3.6.1.4.1.25506.2.2.1.1.3.0.3)模块名：HH3C-SSH-MIB •hh3cSSHUserAuthFailure(1.3.6.1.4.1.25506.2.22.1.3.0.1) 相关日志 •LOGIN/5/LOGIN_AUTHENTICATION_FAILED •LOGIN/5/LOGIN_FAILED •SSHS/6/SSHS_AUTH_FAIL 4.13.16LDAP认证登录失败 ",Suggestion not provided
管理员采用LDAP认证登录设备失败。 ,"本类故障的常见原因主要包括： •用户线下的认证方式配置错误。 •VTY用户线下支持的协议类型不正确。 •ISP域下配置的认证、授权、计费方案错误。 •与LDAP服务器交互失败。 3.故障分析 本类故障的诊断流程如图4-40所示。 图4-40LDAP认证登录失败的故障诊断流程图 4.处理步骤 Web、NETCONFoverSOAP、FTP类登录故障无需关心用户线（类）下的配置，其它排障步骤相同。 (1)检查用户线下的配置。 执行linevtyfirst-number[last-number]命令进入指定的VTY用户线视图，并通过displaythis命令查看如下配置是否准确： authentication-mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。 (2)检查用户线类下的配置。 用户线视图下的配置优先于用户线类视图下的配置。若用户线视图下未配置，则需要继续检查 lineclassvty执行(用户线类视图下的配置。)命令进入VTY用户线类视图，并通过displaythis命令查看如 -mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。如果用户线和用户线类下的配置均不准确，请按照需要，在指定的用户线或用户线类下设置认证方案为scheme，并设置用户登录支持的协议类型。 (3)检查ISP域下的认证、授权、计费方案配置是否准确。执行displaydomain命令，查看显示信息： 如果用户的登录用户名中携带了域名（假设为test），则查看该域下的“Loginauthenticationscheme:”字段取值是否为“LDAP=xx”。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“LDAP=xx”。 <Sysname>displaydomaintest Domain:test State:Active Loginauthenticationscheme:LDAP=ldp Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:OnlineAccountingquotaoutaction:Offline Servicetype:HSI Sessiontime:Excludeidletime NAS-ID:N/A DHCPv6-follow-IPv6CPtimeout:60seconds Authorizationattributes: Idlecut:Disabled Sessiontimeout:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 如果用户的登录用户名中未携带域名，则在系统视图下执行displaythis命令查看是否存在domaindefaultenableisp-name配置（下例中缺省域名为system）。 # domaindefaultenablesystem # −如果存在该配置，则执行displaydomain命令查看isp-name域下的“Loginauthenticationscheme:”字段取值是否为“LDAP=xx。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“LDAP=xx”。 −如果不存在该配置，则执行displaydomain命令查看system域下的“Loginauthenticationscheme:”字段取值是否为“LDAP=xx”。如果system域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“LDAP=xx”。 如果以上配置不准确，请在相关ISP域下配置Login用户采用LDAP认证方案。LDAP服务器一般只作为认证服务器，授权和计费通常配置为其它方式，比如local、RADIUS或HWTACACS（下例中，认证采用LDAP方案ccc、授权和计费为local）。 <Sysname>system-view[Sysname]domaintest [Sysname-isp-test]authenticationloginldap-schemeccc [Sysname-isp-test]authorizationloginlocal [Sysname-isp-test]accountingloginlocal (4)通过LDAP的调试信息辅助排查如下故障。 执行debuggingldaperror命令打开LDAP错误调试信息开关，可根据系统打印的如下调试信息定位问题： “Failedtoperformbindingoperationasadministrator.“表示LDAP服务器视图下配置的管理员用户DN不存在或管理员密码不正确。针对此问题，可以进入LDAP服务器视图，执行login-dn和login-password命令修改管理员用户DN和密码配置（下例中管理员权限的用户DN为cn=administrator,cn=users,dc=ld、管理员密码为admin!123456）。 <Sysname>system-view [Sysname]ldapserverldap1 [Sysname-ldap-server-ldap1]login-dncn=administrator,cn=users,dc=ld [Sysname-ldap-server-ldap1]login-passwordsimpleadmin!123456 “Failedtogetbindresult.errno=115”表示对端未开启LDAP服务或LDAP服务器异常。针对此问题，可以联系LDAP服务器管理员解决。 “Bindoperationfailed.”表示设备与LDAP服务器之间不可达，可以尝试排查设备和服务器中间链路不通的问题。 “Failedtoperformbindingoperationasuser.”表示LDAP用户密码错误。 “FailedtobinduserusernamefortheresultofsearchingDNisNULL.”表示LDAP用户不存在。针对此问题，可以联系LDAP服务器管理员解决。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 all命令），收集设备的调试信息。 5.告警与日志 相关告警 模块名：HH3C-UI-MAN-MIB •hh3cLogInAuthenFailure(1.3.6.1.4.1.25506.2.2.1.1.3.0.3)模块名：HH3C-SSH-MIB •hh3cSSHUserAuthFailure(1.3.6.1.4.1.25506.2.22.1.3.0.1) 相关日志 •LOGIN/5/LOGIN_AUTHENTICATION_FAILED •LOGIN/5/LOGIN_FAILED •SSHS/6/SSHS_AUTH_FAIL 4.13.17RADIUS认证服务器下发的动态VLAN不生效 ",Suggestion not provided
管理员采用RADIUS认证登录设备失败。 ,"本类故障的常见原因主要包括： •用户线下的认证方式配置错误。 •VTY用户线下支持的协议类型不正确。 •ISP域下配置的认证、授权、计费方案错误。 •与RADIUS服务器交互失败。 •RADIUS服务器下发的Login-Service属性值不正确。 •RADIUS服务器未下发用户角色权限。 3.故障分析 本类故障的诊断流程如图4-38所示。 图4-38RADIUS认证登录失败的故障诊断流程图 4.处理步骤 Web、NETCONFoverSOAP、FTP类登录故障无需关心用户线（类）下的配置，其它排障步骤相同。 (1)检查用户线下的配置。 执行linevtyfirst-number[last-number]命令进入指定的VTY用户线视图，并通过displaythis命令查看如下配置是否准确： authentication-mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。 (2)检查用户线类下的配置。 用户线视图下的配置优先于用户线类视图下的配置。若用户线视图下未配置，则需要继续检查 lineclassvty执行(用户线类视图下的配置。)命令进入VTY用户线类视图，并通过displaythis命令查看如 -mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。如果用户线和用户线类下的配置均不准确，请按照需要，在指定的用户线或用户线类下设置认证方案为scheme，并设置用户登录支持的协议类型。 (3)检查ISP域下的认证、授权、计费方案配置是否准确。执行displaydomain命令，查看显示信息： 如果用户的登录用户名中携带了域名（假设为test），则查看该域下的“Loginauthenticationscheme:”字段取值是否为“RADIUS=xx”。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“RADIUS=xx”。 <Sysname>displaydomaintest Domain:test State:Active Loginauthenticationscheme:RADIUS=rds Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:Online Accountingquotaoutaction:Offline Servicetype:HSI Sessiontime:ExcludeidletimeNAS-ID:N/A DHCPv6-follow-IPv6CPtimeout:60seconds Authorizationattributes: Idlecut:Disabled Sessiontimeout:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 如果用户的登录用户名中未携带域名，则在系统视图下执行displaythis命令查看是否存在domaindefaultenableisp-name配置（下例中缺省域名为system）。 # domaindefaultenablesystem # −如果存在该配置，则执行displaydomain命令查看isp-name域下的“Loginauthenticationscheme:”字段取值是否为“RADIUS=xx”。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“RADIUS=xx”。 −如果不存在该配置，则执行displaydomain命令查看system域下的“Loginauthenticationscheme:”字段取值是否为“RADIUS=xx”。如果system域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“RADIUS=xx”。 授权、计费配置确认方式与认证类似，不再赘述。如果以上配置不准确，请在相关ISP域下配置Login用户采用RADIUS认证/授权/计费方案（下例中认证/授权/计费均采用RADIUS方案rd1）。 <Sysname>system-view[Sysname]domaintest [Sysname-isp-test]authenticationloginradius-schemerd1 [Sysname-isp-test]authorizationloginradius-schemerd1 [Sysname-isp-test]accountingloginradius-schemerd1 (4)通过RADIUS的调试信息辅助排查如下故障。 执行debuggingradiuspacket命令打开RADIUS报文调试信息开关，如果系统打印 Authenticationreject类的报文调试信息，则表示用户的认证请求被服务器拒绝。因此，需要继续查看RADIUS服务器上记录的认证日志，并通过日志中描述的失败原因联系服务器 执行debuggingradiu(管理员进行相应的处理。)serror命令打开RADIUS错误调试信息开关，如果系统打印错误调试信息“Invalidpacketauthenticator.”，则表示设备与服务器的共享密钥不匹配， 可以尝试在RAngradiusevent命令打开RADIUS执行事件调(DIUS方案下设置与服务器匹配的共享密钥。debuggi)试信息开关，如果系统打印事件调试信息“Responsetimedout.”，则表示设备与服务器之间不可达，可以尝试排查设备和服务器中间链路不通的问题。 (5)检查RADIUS服务器下发的Login-Service属性值是否为设备支持的业务类型。执行debuggingradiuspacket命令打开RADIUS的报文调试信息开关后，查看RADIUS服务器下发的Login-Service属性情况，并采用“4.13.12用户接入类型与RADIUS服务器下发的Login-Service属性值不匹配”介绍的方法解决故障。 (6)检查RADIUS服务器是否下发了正确的用户角色权限。 执行debuggingradiusall命令打开所有RADIUS调试信息开关后，如果用户输入用户名和密码后连接直接断开，且没有异常的RADIUS事件调试信息以及RADIUS错误调试信息输出，则有可能是RADIUS服务器未给用户下发用户角色或下发的用户角色错误导致。此时，可以查看RADIUS报文调试信息中是否包含“shell:roles=""xx""”或“Exec-Privilege=xx”字段。 如果不包含，则表示RADIUS服务器未给用户下发用户角色权限，则可以选用如下方法之 −在设备(一解决：)侧，可以通过执行roledefault-roleenablerolename命令使能缺省 用户角色授权功能，使得用户在没有被服务器授权任何角色的情况下，具有一个缺省的用户角色。 <Sysname>system-view [Sysname]roledefault-roleenable −联系RADIUS服务器管理员，为用户下发合适的用户角色。 如果包含，但指定的用户角色在设备上不存在，则需要联系RADIUS服务器管理员修改用户角色设置或者在设备上通过user-rolerole-name命令创建对应的用户角色。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 iusall命令），收集设备的调试信息。5.告警与日志 相关告警 模块名：HH3C-UI-MAN-MIB •hh3cLogInAuthenFailure(1.3.6.1.4.1.25506.2.2.1.1.3.0.3)模块名：HH3C-SSH-MIB •hh3cSSHUserAuthFailure(1.3.6.1.4.1.25506.2.22.1.3.0.1) 相关日志 •LOGIN/5/LOGIN_AUTHENTICATION_FAILED •LOGIN/5/LOGIN_FAILED •SSHS/6/SSHS_AUTH_FAIL 4.13.15HWTACACS认证登录失败 ",Suggestion not provided
管理员采用本地认证登录设备失败。 ,本类故障的常见原因主要包括： •用户线下的认证方式配置错误。 •VTY用户线下支持的协议类型不正确。 •ISP域下配置的认证、授权、计费方案错误。 •本地用户不存在、用户密码错误，或服务类型错误。 •本地用户接入数量达到上限。 •登录设备的用户数量到达上限。 •全局密码管理功能开启的情况下，设备本地的lauth.dat文件异常。 3.故障分析 本类故障的诊断流程如图4-37所示。 图4-37本地认证登录失败的故障诊断流程图 4.处理步骤 Web、NETCONFoverSOAP、FTP类登录故障无需关心用户线（类）下的配置，其它排障步骤相同。 (1)检查用户线下的配置。 执行linevtyfirst-number[last-number]命令进入指定的VTY用户线视图，并通过displaythis命令查看如下配置是否准确： authentication-mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。 (2)检查用户线类下的配置。 用户线视图下的配置优先于用户线类视图下的配置。若用户线视图下未配置，则需要继续检查 lineclassvty执行(用户线类视图下的配置。)命令进入VTY用户线类视图，并通过displaythis命令查看如 -mode是否配置为scheme。 对于Telnet登录：protocolinbound是否配置为telnet或为缺省情况。 对于SSH登录：protocolinbound是否配置为ssh或为缺省情况。如果用户线和用户线类下的配置均不准确，请按照需要在指定的用户线或用户线类下设置认证方案为scheme，并设置用户登录支持的协议类型。 (3)检查ISP域下的认证、授权、计费方案配置是否准确。执行displaydomain命令，查看显示信息： 如果用户的登录用户名中携带了域名（假设为test），则查看该域下的“Loginauthenticationscheme:”字段取值是否为Local。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为Local。 <Sysname>displaydomaintest Domain:test State:Active Loginauthenticationscheme:Local Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local Accountingstartfailureaction:Online Accountingupdatefailureaction:OnlineAccountingquotaoutaction:Offline Servicetype:HSI Sessiontime:Excludeidletime NAS-ID:N/A DHCPv6-follow-IPv6CPtimeout:60seconds Authorizationattributes: Idlecut:Disabled Sessiontimeout:Disabled IGMPaccesslimit:4 MLDaccesslimit:4 如果用户的登录用户名中未携带域名，则在系统视图下执行displaythis命令查看是否存在domaindefaultenableisp-name配置。（下例中缺省域名为system）。 # domaindefaultenablesystem # −如果存在该配置，则执行displaydomain命令查看isp-name域下的“Login authenticationscheme:”字段取值是否为“Local”。如果该域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“Local”。 −如果不存在该配置，则执行displaydomain命令查看system域下的“Loginauthenticationscheme:”字段取值是否为“Local”。如果system域下无“Loginauthenticationscheme:”字段，再查看“Defaultauthenticationscheme:”字段取值是否为“Local”。 授权、计费配置确认方式与认证类似，不再赘述。如果以上配置不准确，请在相关ISP下配置Login用户的认证/授权/计费方案均为Local。 (4)检查用户名和密码是否正确。 执行displaylocal-user命令查看是否存在对应的本地用户配置。 如果本地用户存在，则执行local-userusernameclassmanage命令进入本地用户视图，然后通过displaythis命令查看该视图下是否配置了密码，以及service-type配置是否为所需的服务类型。 −若需要用户密码，则尝试重置一次密码（下例中为123456TESTplat&!）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]passwordsimple123456TESTplat&! −若服务类型错误，则配置与登录方式匹配的服务类型（下例中为SSH）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]service-typessh 如果本地用户不存在，则执行local-userusernameclassmanage命令创建一个设备管理类本地用户（下例中用户名为test），并按需配置密码和服务类型。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test] (5)检查使用该本地用户名接入的用户数是否达到上限。 在本地用户视图下执行displaythis命令查看是否存在access-limit配置。 如果access-limit配置存在，则执行displaylocal-userusernameclassmanage命令查看“Currentaccessnumber:”字段取值是否达到配置的上限值。如果达到上限值，则根据需要采取以下措施之一： −在该本地用户视图下执行access-limit命令扩大用户数上限（下例中为20）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]access-limit20 −在用户视图下执行free命令强制其它在线用户下线（下例中为强制释放VTY1上建立的所有连接）。 <Sysname>freelinevty1 Areyousuretofreelinevty1?[Y/N]:y [OK] 如果access-limit配置不存在，或者用户数未达到上限值，则继续定位。 (6)检查指定登录类型的在线用户数是否到达上限。 a.在系统视图下执行displaythis命令查看是否存在aaasession-limit的配置，若 无此配置，则说明采用了缺省值32。 # aaasession-limitftp33domaindefaultenablesystem # b.执行displayusers查看当前用户线的用户登录情况，确认是否已到用户数上限。 c.如果在线用户数到达上限，则根据需要采取以下措施之一：−在系统视图下执行aaasession-limit命令扩大用户数上限。 −在用户视图下执行free命令强制其它在线用户下线。 (7)检查本地lauth.dat文件是否正常。开启全局密码管理功能后，设备会自动生成lauth.dat文件记录本地用户的认证、登录信息。如果手工删除或修改该文件，会造成本地认证异常。因此，请首先执行displaypassword-control命令查看设备上是否开启了全局密码管理功能。 如果该文件不存在、大小为0或者很小（若小于20B，则大概率发生了异常），请优先联系技术支持人员协助处理，若当前配置需求紧迫，可尝试重新开启全局密码管理功能来解决此问题。 <Sysname>dir Directoryofflash:(EXT4) 0drw--Aug16202111:45:37core 1drw--Aug16202111:45:42diagfile 2drw--Aug16202111:45:57dlp 3-rw-713Aug16202111:49:41ifindex.dat 4-rw-12Sep01202102:40:01lauth.dat ... <Sysname>system-view [Sysname]undopassword-controlenable [Sysname]password-controlenable 若未开启，则忽略此步骤。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 local-serverall命令），收集设备的调试信息。 5.告警与日志 相关告警 模块名：HH3C-UI-MAN-MIB •hh3cLogInAuthenFailure(1.3.6.1.4.1.25506.2.2.1.1.3.0.3)模块名：HH3C-SSH-MIB •hh3cSSHUserAuthFailure(1.3.6.1.4.1.25506.2.22.1.3.0.1) 相关日志 •LOGIN/5/LOGIN_FAILED •SSHS/6/SSHS_AUTH_FAIL 4.13.14RADIUS认证登录失败 ,Suggestion not provided
"管理员采用本地认证方式登录设备失败。如果设备上同时打开了Local-Server的事件调试信息开关（通过执行debugginglocal-serverevent命令），系统会打印如下形式的调试信息： *Aug1810:36:58:5142021SysnameLOCALSER/7/EVENT:-MDC=1;Authenticationfailed,userpasswordiswrong. 或者 *Aug1810:37:24:9622021SysnameLOCALSER/7/EVENT:-MDC=1;Authenticationfailed,user""t4""doesn'texist. ",本类故障的常见原因主要包括：•用户输入的密码错误。 •本地用户名不存在。 3.故障分析 本类故障的诊断流程如图4-29所示。图4-29本地用户名或密码错误的故障诊断流程图 4.处理步骤 (1)检查本地用户名是否存在。 执行displaylocal-user命令查看是否存在与登录用户名相同的设备管理类本地用户。 如果不存在该本地用户，则需要使用local-user命令创建设备管理类本地用户（下例中用户名为test），并通知该用户再次尝试登录设备。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test] 如果存在该本地用户，请执行步骤（2）。 (2)确认本地用户密码是否正确。如果用户登录时系统提示密码错误，则进入对应的本地用户视图后，执行password命令重置密码（下例中为123456TESTplat&!），并通知该用户再次尝试登录设备。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]passwordsimple123456TESTplat&! (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息、调试信息。 5.告警与日志 相关告警无 相关日志无 4.13.6本地用户的服务类型不匹配 ,Suggestion not provided
"管理员采用本地认证方式登录设备失败。如果设备上同时打开了Local-Server的事件调试信息开关（通过执行debugginglocal-serverevent命令），系统会打印如下形式的调试信息：： *Aug717:18:07:0982021SysnameLOCALSER/7/EVENT:-MDC=1;Authenticationfailed,unexpecteduserservicetype64(expected=3072). ",本类故障的主要原因为，用户的接入类型与设备上配置的本地用户服务类型不匹配，即用户的接入类型不在配置的服务类型范围之内。 3.故障分析 本类故障的诊断流程如图4-30所示。 图4-30本地用户服务类型不匹配的故障诊断流程图 4.处理步骤 (1)检查用户接入类型是否在本地用户配置的服务类型范围之内。 a.执行displaylocal-user命令查看本地用户的配置信息，用户服务类型由“Service type:”字段标识。 <Sysname>displaylocal-useruser-nametestclassmanageTotal1localusersmatched. Devicemanagementusertest: State:ActiveServicetype:TelnetUsergroup:system Bindattributes: Authorizationattributes: Workdirectory:flash: Userrolelist: ... b.在该用户的本地用户视图下，通过执行service-typetype命令修改用户的服务类型为 实际使用的接入类型（下例中为SSH）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]service-typessh (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息、调试信息。 5.告警与日志 相关告警无 相关日志 无 4.13.7登录失败固定次数后，被禁止在指定的时间内再次登录 ,Suggestion not provided
管理员采用本地认证方式登录设备时，系统判断密码强度不符合要求，提示用户修改当前的登录密码。 ,本类故障的常见原因主要包括： •本地用户视图下配置的PasswordControl密码检查强度高。 •本地用户组视图下配置的PasswordControl密码检查强度高。 •系统视图下配置的PasswordControl密码检查强度高。3.故障分析 本类故障的诊断流程如图4-41所示。 图4-41管理员登录时要求修改密码故障诊断流程图 4.处理步骤 (1)判断是否降低当前密码检查强度。 开启全局密码管理功能后，通过Telnet、SSH、HTTP、HTTPS方式登录的设备管理类用户，输入登录密码时，系统会根据当前设定的Passwordcontrol密码组合检测策略、密码最小长度限制以及密码复杂度检查策略检查对用户的登录密码进行检查，若不符合以上密码检查策略要求，则视为弱密码。系统缺省的密码检查策略请查看“安全配置指导”中的“Password Control”。 缺省情况下，用户使用弱密码登录设备时，系统会打印弱密码提示信息。如果当前的密码检查强度高于实际登录控制需求，请在确定修改范围（指定的本地用户、指定的用户组、所有本地用户）之后，按照如下步骤降低相应视图下的密码检查强度。 (2)降低本地用户的PasswordControl密码检查强度。 执行local-user命令，进入本地用户视图： 通过password-controlcomposition命令配置密码组合策略（下例中密码元素的最 少组合类word-controllength通过命令配置密码最小长(型为4种，至少要包含每种元素的个数为5个）。pass)度（下例中密码最小长度为16 通过pass(个字符）。)word-controlcomplexity命令配置密码复杂度检查策略（下例中为检查密码中是否包含用户名）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]password-controlcompositiontype-number4type-length5 [Sysname-luser-manage-test]password-controllength16 [Sysname-luser-manage-test]password-controlcomplexityuser-namecheck (3)降低用户组的PasswordControl密码检查强度。执行user-group命令，进入本地用户视图： 通过password-controlcomposition命令配置密码组合策略。 通过password-controllength命令配置密码最小长度。 通过password-controlcomplexity命令配置密码复杂度检查策略。 (4)降低所有本地用户的PasswordControl密码检查强度。 -controlcomposition命令配置密码组合策略。 通过password-controllength命令配置密码最小长度。 通过password-controlcomplexity命令配置密码复杂度检查策略。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、诊断信息、提示信息。 5.告警与日志 相关告警无 相关日志无 4.14.2创建本地用户或配置用户密码失败 ,Suggestion not provided
管理员采用本地认证方式登录设备时，因账户闲置超时无法成功登录，系统打印提示信息“Failedtologinbecausetheidletimerexpired.”。 ,本类故障的常见原因主要包括： •设备的内存使用率达到指定门限。 •设备的本地文件系统存储空间不足。 •设备本地的lauth.dat文件异常。 3.故障分析 本类故障的诊断流程如图4-42所示。图4-42创建本地用户或配置密码失败故障诊断流程图 4.处理步骤 (1)检查设备剩余空闲内存值是否进入指定的内存门限。 如果是修改本地用户密码失败，则无需关注内存门限问题，直接进入步骤（2）。 执行displaymemory-threshold命令查看显示内存告警门限相关信息，通过“Currentfree-memorystate:”字段查看当前内存使用状态。系统内存进入一级（Minor）、二级（Severe）、三级（Critical）告警门限状态期间，不允许创建本地用户。 <Sysname>displaymemory-thresholdMemoryusagethreshold:100% Free-memorythresholds: Minor:96M Severe:64M Critical:48M Normal:128M Currentfree-memorystate:Normal(secure) ... 可在任意视图下通过执行monitorprocess命令查看进程统计信息，输入“m”后按照显示的内存排序定位占用内存资源过多的进程，按需进行内存清理。等待内存门限解除后，再次尝试创建本地用户。 (2)检查设备的本地文件系统存储空间是否不足。 如果设备上输出如下任意一类日志信息，则表示文件系统异常导致此问题： PWDCTL/3/PWDCTL_FAILED_TO_OPENFILE:Failedtocreateoropenthepasswordfile. PWDCTL/3/PWDCTL_FAILED_TO_WRITEPWD:Failedtowritethepasswordrecordstofile. PWDCTL/3/PWDCTL_NOENOUGHSPACE:Notenoughfreespaceonthestoragemediawherethefileislocated. 请在用户视图下执行dir命令查看本地存储介质（例如flash）的剩余容量信息，如果剩余空间不足，则需要删除无用的文件。 (3)检查本地lauth.dat文件是否正常。 开启全局密码管理功能后，设备会自动生成lauth.dat文件记录本地用户的认证、登录信息。如果手工删除或修改该文件，会造成本地认证异常。请在用户视图下执行dir命令查看本地存储介质中（例如flash）的lauth.dat文件存在情况。 <Sysname>dir Directoryofflash:(EXT4) 0drw--Aug16202111:45:37core 1drw--Aug16202111:45:42diagfile 2drw--Aug16202111:45:57dlp 3-rw-713Aug16202111:49:41ifindex.dat 4-rw-12Sep01202102:40:01lauth.dat... 如果该文件不存在、大小为0或者很小（若小于20B，则大概率发生了异常），请优先联系技术支持人员协助处理，若当前配置需求紧迫，可尝试重新开启全局密码管理功能来解决此问题。 <Sysname>system-view [Sysname]undopassword-controlenable [Sysname]password-controlenable 以上问题解决后，请尝试重新创建本地用户或配置用户密码。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、诊断信息、提示信息。 5.告警与日志 相关告警无 相关日志 •PWDCTL/3/PWDCTL_FAILED_TO_WRITEPWD •PWDCTL/3/PWDCTL_FAILED_TO_OPENFILE •PWDCTL/3/PWDCTL_NOENOUGHSPACE 4.14.3管理员因闲置超时无法登录 本类故障的主要原因为，用户自从最后一次成功登录之后，在配置的闲置时间内再未成功登录过，那么该闲置时间到达之后此用户账号立即失效，系统不再允许使用该账号的用户登录。 3.故障分析 本类故障的诊断流程如图4-43所示。 图4-43管理员因闲置超时无法登录故障诊断流程图 4.处理步骤 (1)确认是否有其它管理员或其它途径可以登录设备。 如果有其它管理员或其它途径（例如Console口）可以登录设备，则表示仅该用户被禁止登录，因此可以由其它管理员登录后删除该本地用户后重新创建此用户，或修改用户账号的闲置时间（通过password-controlloginidle-time命令）。若将闲置时间修改 为0，则会立即关闭闲置超时检查。 如果无其它管理员或其它途径可以登录设备，则执行步骤（2）。 (2)确认设备是否开启了SNMP功能。 尝试是否可以通过NMS（NetworkManagementSystem，网络管理系统）登录设备： 若开启了SNMP功能，则可以使用MIB修改系统时间，将系统时间修改为闲置超时之前的 某个时间点，再使用此管理员帐号登录设备。修改系统时间对应的MIB节点为 HH3C-SYS-MAN-MIB中的hh3cSysLocalClock(1.3.6.1.4.1.25506.2.3.1.1.1)。 管理员再次成功登录后，需要第一时间将系统时间恢复，并关闭用户账号闲置超时检查。 若未开启SNMP功能，则无法使用MIB。可尝试重启设备，并按提示进入BootWare扩展段菜单后，选择跳过console口认证或者跳过配置文件选项来进入系统。建议在技术支持人员指导下执行此步骤。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、诊断信息、提示信息。 5.告警与日志相关告警无 相关日志无 4.15SSH故障处理 4.15.1SSH客户端登录设备失败 ,Suggestion not provided
管理员登录设备后无法创建或修改本地用户，系统打印提示信息“Insufficientrighttoperformtheoperation.”,本类故障的主要原因为，给用户授权的用户角色权限过小。 3.故障分析 本类故障的诊断流程如图4-25所示。 图4-25登录后无法执行部分命令行的故障诊断流程图 4.处理步骤 (1)检查用户角色否为自定义用户角色。 请以超级管理员身份（即具有network-admin或者level-15用户角色）登录设备，执行displayline命令查看登录用户线的认证方式，并根据不同的认证方式，采取不同的处理步骤： <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation0CON0115200-N-1/0 +81VTY0-N-1/0 +82VTY1-P-1/0 +83VTY2-A-1/0 ... 对于none和password认证方式（Auth字段：N、P），检查对应用户线视图下的用户角色是否为自定义用户角色。如果不是自定义用户角色，则通过user-rolerole-name命令设置权限更高的系统预定义角色。 对于scheme认证方式（Auth字段：A），首先查看登录用户认证域下配置的认证方法： −如果采用了Local认证方法，则通过displaylocal-user命令查看用户角色是否为自定义用户角色。如果不是自定义用户角色，则通过authorization-attributeuser-rolerole-name命令设置权限更高的系统预定义角色（下例为network-admin）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]authorization-attributeuser-rolenetwork-admin −如果采用了远程认证方法，则联系远程认证服务器管理员，为用户授权权限更高的系统预定义角色。 (2)检查不允许执行的命令行是否在自定义用户角色允许的权限范围内。 a.执行命令displayrolenamerole-name，查看用户的自定义角色拥有的命令行权限规则。 b.如果用户所执行的命令行不在所属用户角色拥有的命令行权限范围之内，则为其更换权限较高的系统域定义用户角色，或者通过命令rule为用户的自定义角色增加对应的命令行权限规则。需要注意的是，自定义用户角色即使配置了较高的权限规则，仍然有部分无法支持的命令行，这些命令行的明细请查看“基础配置指导”中的“RBAC”手册。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.13.2登录设备后无法创建或修改本地用户 本类故障的主要原因为，给用户授权的用户角色权限不具备修改目标本地用户配置的权限。 3.故障分析 本类故障的诊断流程如图4-26所示。 图4-26登录后无法创建或修改本地用户的故障诊断流程图 4.处理步骤 (1)检查登录用户的角色是否为预定义的超级管理员角色，即为network-admin、level-15之一。只有上述预定义用户角色才拥有创建本地用户的权限，其它用户角色只有进入自身本地用户视图的权限。如果登录用户不拥有如上预定义用户角色，则为其授权其中之一。如果重新授权后，故障仍未排除，请继续定位。 此步骤仅适用于无权限创建本地用户，若无权限修改本地用户，请执行步骤（2）。 (2)比较登录用户和目标用户的权限范围。 执行命令displayrolenamerole-name，分别查看登录用户和目标用户的角色权限， 并比较两者的权限大小。如果操作者权限较小，则为其更换拥有更高权限的用户角色。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.13.3管理员未被授权用户角色 ,Suggestion not provided
管理员登录设备后无法创建或修改本地用户，系统打印提示信息“Insufficientrighttoperformtheoperation.”。 ,本类故障的主要原因为，给用户授权的用户角色权限过小。 3.故障分析 本类故障的诊断流程如图4-25所示。 图4-25登录后无法执行部分命令行的故障诊断流程图 4.处理步骤 (1)检查用户角色否为自定义用户角色。 请以超级管理员身份（即具有network-admin或者level-15用户角色）登录设备，执行displayline命令查看登录用户线的认证方式，并根据不同的认证方式，采取不同的处理步骤： <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation0CON0115200-N-1/0 +81VTY0-N-1/0 +82VTY1-P-1/0 +83VTY2-A-1/0 ... 对于none和password认证方式（Auth字段：N、P），检查对应用户线视图下的用户角色是否为自定义用户角色。如果不是自定义用户角色，则通过user-rolerole-name命令设置权限更高的系统预定义角色。 对于scheme认证方式（Auth字段：A），首先查看登录用户认证域下配置的认证方法： −如果采用了Local认证方法，则通过displaylocal-user命令查看用户角色是否为自定义用户角色。如果不是自定义用户角色，则通过authorization-attributeuser-rolerole-name命令设置权限更高的系统预定义角色（下例为network-admin）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]authorization-attributeuser-rolenetwork-admin −如果采用了远程认证方法，则联系远程认证服务器管理员，为用户授权权限更高的系统预定义角色。 (2)检查不允许执行的命令行是否在自定义用户角色允许的权限范围内。 a.执行命令displayrolenamerole-name，查看用户的自定义角色拥有的命令行权限规则。 b.如果用户所执行的命令行不在所属用户角色拥有的命令行权限范围之内，则为其更换权限较高的系统域定义用户角色，或者通过命令rule为用户的自定义角色增加对应的命令行权限规则。需要注意的是，自定义用户角色即使配置了较高的权限规则，仍然有部分无法支持的命令行，这些命令行的明细请查看“基础配置指导”中的“RBAC”手册。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.13.2登录设备后无法创建或修改本地用户 本类故障的主要原因为，给用户授权的用户角色权限不具备修改目标本地用户配置的权限。 3.故障分析 本类故障的诊断流程如图4-26所示。 图4-26登录后无法创建或修改本地用户的故障诊断流程图 4.处理步骤 (1)检查登录用户的角色是否为预定义的超级管理员角色，即为network-admin、level-15之一。只有上述预定义用户角色才拥有创建本地用户的权限，其它用户角色只有进入自身本地用户视图的权限。如果登录用户不拥有如上预定义用户角色，则为其授权其中之一。如果重新授权后，故障仍未排除，请继续定位。 此步骤仅适用于无权限创建本地用户，若无权限修改本地用户，请执行步骤（2）。 (2)比较登录用户和目标用户的权限范围。 执行命令displayrolenamerole-name，分别查看登录用户和目标用户的角色权限， 并比较两者的权限大小。如果操作者权限较小，则为其更换拥有更高权限的用户角色。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.13.3管理员未被授权用户角色 ,Suggestion not provided
管理员登录设备失败，系统打印如下形式的日志信息： SysnameLOGIN/5/LOGIN_INVALID_USERNAME_PWD:-MDC=1;Invalidusernameorpasswordfromxx.xx.xx.xx. ,本类故障的主要原因为，用户输入的用户名中含有非法字符。 3.故障分析 本类故障的诊断流程如图4-28所示。 图4-28登录用户名含有非法字符的故障诊断流程图 4.处理步骤 (1)检查用户输入的用户名是否含有非法字符。 用户登录设备时，系统会检查用户输入的纯用户名以及域名的有效性，如果纯用户名中包含了非法字符“\”、“|”、“/”、“:”、“*”、“?”、“<”、“>”和“@”，域名中包含 “@”，则不允许登录。此时，建议用户再次尝试登录，并输入正确的用户名。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 •LOGIN_INVALID_USERNAME_PWD 4.13.5本地用户名或密码错误 ,Suggestion not provided
管理员登录设备失败后，控制台无响应一定的时间，期间用户无法执行任何操作。 ,本类故障的主要原因主要为，设备上配置了Login延时认证功能。开启本功能后，用户登录失败后，系统将会延迟一定的时长之后再允许用户进行认证。 3.故障分析 本类故障的诊断流程如图4-32所示。 图4-32登录失败后等待重认证的故障诊断流程图 4.处理步骤(1)检查是否开启了Login延时认证功能。 如果当前配置中存在attack-defenseloginreauthentication-delay命令，则可 on-delay命令关闭延时认证功能。 <Sysname>system-view [Sysname]undoattack-defenseloginreauthentication-delay 通过执行attack-defenseloginreauthentication-delayseconds命令减小用户登录失败后重新进行认证的等待时长（下例中为10秒）。 <Sysname>system-view [Sysname]attack-defenseloginreauthentication-delay10 执行以上操作可能会减弱设备防范Login用户字典序攻击的力度，请慎重执行。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.13.9使用相同用户名接入设备的用户数达到上限 ,Suggestion not provided
管理员登录设备失败指定的次数后，在一定时间内被禁止再次登录设备。 ,本类故障的常见原因主要包括： •设备上开启了Login用户攻击防范功能。开启该功能后，会导致Login用户登录失败指定的次数后，若用户的IP地址被加入黑名单，则设备将会丢弃来自该IP地址的报文，使得该用户不能在指定的阻断时长内进行登录操作。 •用户采用本地认证方式登录设备，且设备上开启了PasswordControl功能。用户登录认证失败后，系统会将该用户加入密码管理的黑名单，并根据配置的处理措施对其之后的登录行为进行相应的限制。当用户登录失败次数超过指定值后，系统禁止该用户登录，经过一段时间后，再允许该用户重新登录。 3.故障分析 本类故障的诊断流程如图4-31所示。 图4-31指定时间内被阻断登录的故障诊断流程图 4.处理步骤 (1)等待一定时间后，尝试重新登录。 如果因为偶尔密码输入有误导致的禁止登录，属于正常现象，建议等待一定的时间后再次尝试重新登录。如果再次使用正确的用户名和密码登录设备遇到同样的问题，请更换其它可登录设备的管理员账号继续下面的处理步骤。 (2)确认用户被阻断后能否发起登录连接。 如果该用户被阻断后，仍然可以向设备发起登录连接，但无法认证成功，则在任意视图下执行displaypassword-controlblacklist命令查看该用户是否被加入了黑名单。 如果该用户在黑名单中，且显示信息中的Lockflag为lock，则表示用户被锁定了。 <Sysname>displaypassword-controlblacklist Per-userblacklistlimit:100. Blacklistitemsmatched:1. UsernameIPaddressLoginfailuresLockflagtest3.3.3.34lock −在系统视图下执行undopassword-con(对于加入黑名单的用户，有两种处理方式：)trolenable命令关闭全局密码管理功能。 <Sysname>system-view [Sysname]undopassword-controlenable −在用户视图下执行resetpassword-controlblacklist命令清除密码管理黑名单中的用户（下例中为用户test）。 <Sysname>resetpassword-controlblacklistuser-nametest 如果该用户被阻断后，根本无法向设备发起登录连接，则执行步骤（4）。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.13.8登录失败后需要等待一定时长再进行重认证 ,Suggestion not provided
管理员无法成功登录设备，设备也没有提供三次登录尝试机会。例如，使用Telnet登录时，用户输入用户名和密码后，设备登录界面上既未打印提示信息“AAAauthenticationfailed”，也未再次提示用户输入用户名和密码。 ,"本类故障的主要原因为，没有为用户授权用户角色。 3.故障分析 本类故障的诊断流程如图4-27所示。图4-27管理员未被授权用户角色的故障诊断流程图 4.处理步骤 (1)检查是否为用户授权了用户角色。 请以超级管理员身份（即具有network-admin或者level-15用户角色）登录设备，执行displayline命令查看登录用户线的认证方式，并根据不同的认证方式，采取不同的处理步骤： <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation 0CON0115200-N-1/0 +81VTY0-N-1/0 +82VTY1-P-1/0+83VTY2-A-1/0 ... 对于none和password认证方式（Auth字段：N、P），检查对应用户线视图下是否存在用户角色配置。如果不存在，则通过user-rolerole-name命令设置用户角色（下例中为abc）。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]user-roleabc 对于scheme认证方式（Auth字段：A），首先查看登录用户认证域下配置的认证方法： −如果采用了Local认证方法，则执行displaylocal-user命令查看该用户的授权用户角色情况，如果显示信息中的“Userrolelist：”字段为空，则表示该用户没有被授权任何用户角色。 <Sysname>displaylocal-useruser-nametestclassmanageTotal1localusersmatched. Devicemanagementusertest: State:ActiveServicetype:TelnetUsergroup:system Bindattributes: Authorizationattributes: Workdirectory:flash: Userrolelist: ... 此时，需要进入该本地用户视图，执行authorization-attributeuser-role命令为用户授权角色（下例中为abc）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]authorization-attributeuser-roleabc −如果采用了远程认证方法，则联系远程认证服务器管理员确认是否为该用户授权了用户角色，若无，请为该用户添加用户角色属性。以FreeRADIUS服务器为例，如果需要在users文件中添加用户角色network-admin，则需要编辑的脚本如下： userCleartext-Password:=""123456"" H3C-User-Roles=""shell:roles=\""network-admin\"""" 其它RADIUS服务器上的用户角色添加方式请以实际情况为准。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.13.4登录用户名含有非法字符 ",Suggestion not provided
开启IP组播路由功能后，同一PIM域内三层组播流量不通。 ,本类故障的常见原因主要包括： •需要转发组播数据的接口未使能PIM。 •接口的PIM协议没有生效。 •PIM邻居未建立成功。 •连接用户网段的接口未使能IGMP。 •在PIM-SM或双向PIM网络中，没有配置RP或RP信息不正确。 •不存在到达RP或组播源的RPF路由。 •转发组播数据的接口上配置了组播边界。 •在PIM-SM或双向PIM网络中，配置了错误的组播源过滤策略。 •组播表项未生成。 3.故障分析 支持双向PIM的设备本类故障的诊断流程如图83所示，不支持双向PIM的设备本类故障的诊断流程如图84所示。 图83PIM域内三层组播流量不通的故障诊断流程图（支持双向PIM的设备） 图84PIM域内三层组播流量不通的故障诊断流程图（不支持双向PIM的设备） 4.处理步骤 (1)检查需要转发组播数据的接口是否使能PIM。在需要转发组播数据的接口视图下执行displaythis命令，检查是否存在pimsm或pimdm的配置。 如果不存在，表明接口下PIM功能未开启。 −请在接口视图下通过pimsm或pimdm命令开启PIM功能。 −若是双向PIM网络，在接口视图下配置了通过pimsm命令开启PIM功能后，还需在PIM视图下通过bidir-pimenable命令开启双向PIM功能。不支持双向PIM的设 备，请忽略本步骤。 如果存在，请执行步骤(2)。 (2)检查接口的PIM功能是否生效。 在设备上执行displaypiminterface命令，通过查看显示信息中是否存在该接口对应 faceinterface-type interface-number命令查看显示信息中的“Currentstate”字段，确认接口的物理状态是否为Up。如果为Down，请排查处理接口物理Down的问题。 如果生效，请执行步骤(3)。 (3)检查PIM邻居是否建立成功。 在设备上执行displaypimneighbor命令，根据是否存在相应的PIM邻居信息，判断 PIM邻居是否建立成功。 a.如果未建立成功，请参见“PIM邻居Down”进行定位，确保PIM邻居建立成功。 b.如果建立成功，请执行步骤(4)。 (4)检查连接用户网段的接口上IGMP功能是否生效。 在设备上执行displayigmpinterface命令，根据是否存在显示信息确认接口IGMP功 能是否生效。 如果没有生效，请检查接口下是否通过igmpenable命令开启了IGMP功能，确保IGMP功能已开启。 如果已生效，根据不同的网络类型执行如下操作： −若为PIM-SM或双向PIM网络，请执行步骤(5)。 −若为PIM-DM网络，请执行步骤(7)。 (5)对于PIM-SM或双向PIM网络，检查RP信息是否正确。 在设备上执行displaypimrp-info命令，查看设备是否生成了为某组播组服务的RP信息表项，并检查PIM-SM或双向PIM域中其它所有设备上，为此组播组服务的RP信息是否配置一致。 如果不一致，且PIM-SM/双向PIM网络中使用静态RP，请在PIM-SM/双向PIM域的所有设备上的PIM视图下执行static-rp命令，将为某组播组服务的RP地址配置为相同的地址；如果PIM-SM/双向PIM网络中使用动态RP，请执行步骤(6)。 如果一致，请执行步骤(6)。 (6)检查是否存在到达RP的RPF路由。 在设备上执行displaymulticastrpf-info命令，查看是否存在到达RP的RPF路由。 如果不存在，检查单播路由配置。请在当前设备和RP上分别执行ping命令，检查是否能够互相ping通。如果ping不通，请修改单播路由配置，直到ping通为止。 如果存在，通过执行displaymulticastrpf-info命令，查看显示信息中的 Referencedroutetype字段，确认RPF为组播静态路由还是单播路由。 −如果RPF路由为组播静态路由，请执行displaymulticastrouting-table static命令查看组播静态路由配置是否合理。 −如果RPF路由为单播路由，请执行displayiprouting-table命令查看单播路 由是否与RPF路由一致。 如果到达RP的RPF路由存在且配置合理，请执行步骤(8)。 (7)检查是否存在到达组播源的RPF路由。 在设备上执行displaymulticastrpf-info命令，查看是否存在到达组播源的RPF路 由。 如果不存在，检查单播路由配置。请在当前设备和组播源上分别执行ping命令，检查是否能够互相ping通。如果ping不通，请修改单播路由配置，直到Ping通为止。 如果存在，通过执行displaymulticastrpf-info命令，查看显示信息中的 Referencedroutetype字段，确认RPF为组播静态路由还是单播路由。 −如果Referencedroutetype字段显示为“multicaststatic”，表示RPF路由为组播静态路由，请执行displaymulticastrouting-tablestatic命令查看组播静态 路由配置是否合理。 −如果Referencedroutetype字段显示为“igp”、“egp”、“unicast(direct)”或“unicast”，表示RPF路由为单播路由，请执行displayiprouting-table命令查看单播路 由是否与RPF路由一致。 如果到达组播源的RPF路由存在且配置合理，请执行步骤(8)。 (8)检查RPF接口和RPF邻居接口上是否配置组播转发边界。 在设备上执行displaymulticastboundary命令，查看接口上是否配置了组播转发边 配置，建议在接口上执行undomulticastboundary命令删除对应配置或重新进行网络规划，确保RPF接口和RPF邻居接口没有配置组播边界。 如果未配置，请执行步骤(9)。 (9)检查是否配置组播数据过滤器。 在PIM视图下执行displaythis命令，查看是否配置组播数据过滤器（通过PIM视图下的source-policy命令配置）。 如果已配置，继续确认接收到的组播数据是否在过滤器指定的允许范围之内。如果不在，建议根据实际组网需要执行undosource-policy命令删除该配置或重新配置ACL规 则，确保用户需要的组播数据正常转发。 如果未配置，请执行步骤(10)。 (10)检查组播表项是否生成。 在设备上分别查看组播表项是否生成： 如果存在相应的表项，流量仍然不通，请收集相关表项信息，并执行步骤(11)。 如果不存在，请执行步骤(11)。 able命令，检查PIM协议路由表项是否生成。 在设备上执行displayigmpgroup命令，检查IGMP协议是否有对应的组播组。 在设备上执行displaymulticastrouting-table命令，检查组播路由表是否生成。 在设备上执行displaymulticastforwarding-table命令，检查组播转发表是否 生成。 (11)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 11.2.3PIM-SM网络中SPT无法正常转发数据 ,Suggestion not provided
客户端无法通过Web登录AC，提示无法显示网页，但是从客户端可以Ping通AC，也可以Telnet登录到AC,(1)关闭Windows防火墙，Windows系统自带的防火墙开启后偶尔会造成此现象。 (2)Telnet登录到AC，检查AC配置，将HTTP和HTTPS功能开启。 5.7无法修改自动AP方式生成的AP服务模板 ,(1)关闭Windows防火墙，Windows系统自带的防火墙开启后偶尔会造成此现象。 (2)Telnet登录到AC，检查AC配置，将HTTP和HTTPS功能开启。 5.7无法修改自动AP方式生成的AP服务模板 
客户端无法通过Web登录AC，提示无法显示网页，但是从客户端可以Ping通AC，也可以Telnet登录到AC。 ,(1)关闭Windows防火墙，Windows系统自带的防火墙开启后偶尔会造成此现象。 (2)Telnet登录到AC，检查AC配置，将HTTP和HTTPS功能开启。 5.7无法修改自动AP方式生成的AP服务模板 ,(1)关闭Windows防火墙，Windows系统自带的防火墙开启后偶尔会造成此现象。 (2)Telnet登录到AC，检查AC配置，将HTTP和HTTPS功能开启。 5.7无法修改自动AP方式生成的AP服务模板 
客户端无法通过Web登录CPE，提示无法显示网页,Suggestion not provided,Suggestion not provided
客户端无法通过Web登录CPE，提示无法显示网页，但是从客户端可以Ping通CPE，也可以Telnet登录到CPE。 2.故障处理步骤 (1)关闭Windows防火墙，Windows系统自带的防火墙开启后偶尔会造成此现象。 (2)Telnet登录到CPE，检查CPE配置，将HTTP服务开启。 (3)如果故障仍然未能排除，请联系技术支持人员。 4.2软件升级故障处理 4.2.1设备启动失败 ,Suggestion not provided,Suggestion not provided
连续使用命令displaycpu-usage查看CPU的占用率。如果CPU占用率持续在70％以上，说 明有某个任务长时间占用CPU，需要确认CPU高的具体原因。 <Sysname>displaycpu-usage Slot1CPU0CPUusage: 70%inlast5seconds 70%inlast1minute 70%inlast5minutes ,"本类故障的常见原因主要包括： •路由振荡 •报文攻击 •链路环路 3.故障分析 本类故障的诊断流程如图5所示： 图5CPU占用率高故障诊断流程图 4.处理步骤 (1)检查是否发生路由振荡路由表中条目频繁变化，可能导致CPU占用率过高。当发生路由震荡时，请收集信息并联系H3C技术人员寻求技术支持。首次查看路由表： [Sysname]displayiprouting-table Destinations:9Routes:9 Destination/MaskProtoPreCostNextHopInterface 0.0.0.0/32Direct00127.0.0.1InLoop0 10.1.1.0/24OSPF150111.2.1.1Vlan100127.0.0.0/8Direct00127.0.0.1InLoop0 127.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.1/32Direct00127.0.0.1InLoop0 127.255.255.255/32Direct00127.0.0.1InLoop0 224.0.0.0/4Direct000.0.0.0NULL0 224.0.0.0/24Direct000.0.0.0NULL0 255.255.255.255/32Direct00127.0.0.1InLoop0再次查看路由表： [Sysname]displayiprouting-table Destinations:8Routes:8 Destination/MaskProtoPreCostNextHopInterface 0.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.0/8Direct00127.0.0.1InLoop0 127.0.0.0/32Direct00127.0.0.1InLoop0 127.0.0.1/32Direct00127.0.0.1InLoop0 127.255.255.255/32Direct00127.0.0.1InLoop0 224.0.0.0/4Direct000.0.0.0NULL0 224.0.0.0/24Direct000.0.0.0NULL0 255.255.255.255/32Direct00127.0.0.1InLoop0 (2)检查是否受到报文攻击部分机型Probe视图下支持debugrxtxsoftcarshow命令，可以查看软件收包是否堵塞丢包。 <Sysname>system-view [Sysname]probe [Sysname-probe]debugrxtxsoftcarshowslot1 IDTypeRcvPpsRcv_AllDisPkt_AllPpsDynSwiHashACLmax 0ROOT000300SOnSMAC0 1ISIS000200DOnSMAC8 2ESIS000100SOnSMAC8 3CLNP000100SOnSMAC8 4VRRP0001024SOnSMAC8 5UNKNOWN_IPV4MC000100SOnSMAC8 6UNKNOWN_IPV6MC000100SOnSMAC8 7IPV4_MC_RIP000150DOnSMAC8 8IPV4_BC_RIP000150DOnSMAC8 9MCAST_NTP000100SOnSMAC8 10BCAST_NTP000100SOnSMAC8 如果某类报文的统计计数在不断增长，说明有攻击存在，可通过抓包确认攻击源。在设备端口抓包，使用报文捕获工具（如Sniffer、Wireshark、WinNetCap等）分析报文特征，确认攻击源。然后针对攻击源配置报文防攻击。关于报文防攻击的详细介绍和配置，请参见“安全配置指导”中的“攻击检测与防范”。 (3)检查是否存在链路环路链路存在环路时，可能出现广播风暴和网络振荡，大量的协议报文上送CPU处理可能导致 CPU占用率升高，设备很多端口的流量会变得很大，端口使用率达到90%以上： <Sysname>displayinterfacegigabitethernet3/0/1 GigabitEthernet3/0/1Currentstate:UP Lineprotocolstate:UP Description:GigabitEthernet3/0/1Interface Bandwidth:1000000kbps Maximumtransmissionunit:1500 Internetaddress:2.1.1.2/24(primary) IPpacketframetype:EthernetII,hardwareaddress:0000-fc00-9276 IPv6packetframetype:EthernetII,hardwareaddress:0000-fc00-9276 Loopbackisnotset Mediatypeistwistedpair,porthardwaretypeis1000_BASE_TPortpriority:0 1000Mbps-speedmode,full-duplexmode Linkspeedtypeisautonegotiation,linkduplextypeisautonegotiation Flow-controlisnotenabled Maximumframelength:9216 Lastclearingofcounters:Never Peakinputrate:8bytes/sec,at2016-03-1909:20:48 Peakoutputrate:1bytes/sec,at2016-03-1909:16:16 Last300secondinput:26560packets/sec123241940bytes/sec99% Last300secondoutput:0packets/sec0bytes/sec0% …… 如链路出现环路： 排查链路连接、端口配置是否正确。 对于二层口，是否使能STP协议，配置是否正确。 对于二层口，邻接设备STP状态是否正常。 如以上配置均正确，可能为STP协议计算错误或协议计算正确但端口驱动层没有正常Block阻塞，可以shutdown环路上端口、拔插端口让STP重新计算来快速恢复业务。 (4)确定CPU占用率高的任务如果通过上述步骤无法解决故障，请通过displayprocesscpu命令观察占用CPU最多的任务。 <Sysname>displayprocesscpuslot1 CPUutilizationin5secs:2.4%;1min:2.5%;5mins:2.4% JID5Sec1Min5MinName10.0%0.0%0.0%scmd 20.0%0.0%0.0%[kthreadd] 30.0%0.0%0.0%[migration/0]40.0%0.0%0.0%[ksoftirqd/0] 50.0%0.0%0.0%[watchdog/0] 60.0%0.0%0.0%[migration/1] 70.0%0.0%0.0%[ksoftirqd/1] 80.0%0.0%0.0%[watchdog/1] 90.0%0.0%0.0%[migration/2] 100.0%0.0%0.0%[ksoftirqd/2] 110.0%0.0%0.0%[watchdog/2] …… 各列分别表示某任务平均5sec、1min、5min占用CPU的百分比和任务名。某任务占用率越高，说明相应的任务占用CPU的资源越多。正常情况任务对CPU的占用率一般低于5%，这个命令可以查看明显高出正常占用率的任务。 (5)确认异常任务的调用栈通过Probe视图下的followjobjob-id命令确认异常任务的调用栈，请查询5次以上，发送给技术支持人员分析，以便于分析该任务具体在做什么处理导致CPU占用率持续升高。此处以显示JID145的调用栈为例。 <Sysname>system-view [Sysname]probe [Sysname-probe]followjob145slot1Attachingtoprocess145([dGDB]) Iteration1of5 ------------------------------ Kernelstack: [<ffffffff80355290>]schedule+0x570/0xde0 [<ffffffff80355da8>]schedule_timeout+0x98/0xe0 [<ffffffff802047e4>]ep_poll+0x4b4/0x5e0 [<ffffffffc05587a8>]DRV_Sal_EVENT_Read+0x1f8/0x290[system] [<ffffffffc07351e4>]drv_sysm_gdb_console+0xc4/0x2d0[system] [<ffffffffc1a04114>]thread_boot+0x84/0xa0[system] [<ffffffff8015c420>]kthread+0x130/0x140 [<ffffffff801183d0>]kernel_thread_helper+0x10/0x20 Iteration2of5 ------------------------------ Kernelstack: [<ffffffff80355290>]schedule+0x570/0xde0 [<ffffffff80355da8>]schedule_timeout+0x98/0xe0 [<ffffffff802047e4>]ep_poll+0x4b4/0x5e0 [<ffffffffc05587a8>]DRV_Sal_EVENT_Read+0x1f8/0x290[system] [<ffffffffc07351e4>]drv_sysm_gdb_console+0xc4/0x2d0[system] [<ffffffffc1a04114>]thread_boot+0x84/0xa0[system] [<ffffffff8015c420>]kthread+0x130/0x140 [<ffffffff801183d0>]kernel_thread_helper+0x10/0x20 Iteration3of5 ------------------------------ Kernelstack: [<ffffffff80355290>]schedule+0x570/0xde0 [<ffffffff80355da8>]schedule_timeout+0x98/0xe0 [<ffffffff802047e4>]ep_poll+0x4b4/0x5e0 [<ffffffffc05587a8>]DRV_Sal_EVENT_Read+0x1f8/0x290[system] [<ffffffffc07351e4>]drv_sysm_gdb_console+0xc4/0x2d0[system] [<ffffffffc1a04114>]thread_boot+0x84/0xa0[system] [<ffffffff8015c420>]kthread+0x130/0x140 [<ffffffff801183d0>]kernel_thread_helper+0x10/0x20 Iteration4of5 ------------------------------ Kernelstack: [<ffffffff80355290>]schedule+0x570/0xde0 [<ffffffff80355da8>]schedule_timeout+0x98/0xe0 [<ffffffff802047e4>]ep_poll+0x4b4/0x5e0 [<ffffffffc05587a8>]DRV_Sal_EVENT_Read+0x1f8/0x290[system] [<ffffffffc07351e4>]drv_sysm_gdb_console+0xc4/0x2d0[system] [<ffffffffc1a04114>]thread_boot+0x84/0xa0[system] [<ffffffff8015c420>]kthread+0x130/0x140 [<ffffffff801183d0>]kernel_thread_helper+0x10/0x20 Iteration5of5 ------------------------------ Kernelstack: [<ffffffff80355290>]schedule+0x570/0xde0 [<ffffffff80355da8>]schedule_timeout+0x98/0xe0[<ffffffff802047e4>]ep_poll+0x4b4/0x5e0 [<ffffffffc05587a8>]DRV_Sal_EVENT_Read+0x1f8/0x290[system] [<ffffffffc07351e4>]drv_sysm_gdb_console+0xc4/0x2d0[system] [<ffffffffc1a04114>]thread_boot+0x84/0xa0[system] [<ffffffff8015c420>]kthread+0x130/0x140 [<ffffffff801183d0>]kernel_thread_helper+0x10/0x20 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •CPU_STATE_NORMAL •CPU_MINOR_RECOVERY •CPU_MINOR_THRESHOLD •CPU_SEVERE_RECOVERY •CPU_SEVERE_THRESHOLD 3.1.6USB状态异常 ",Suggestion not provided
配置工具通过SSH登录设备失败。 ,请参见“安全类故障处理/SSH客户端登录设备失败”进行定位。 21.2NTP故障处理 21.2.1NTP时钟未同步故障处理 ,请参见“安全类故障处理/SSH客户端登录设备失败”进行定位。 21.2NTP故障处理 21.2.1NTP时钟未同步故障处理 
配置工具通过SSH登录设备失败。 2.	处理步骤 请参见“安全类故障处理/SSH客户端登录设备失败”进行定位。 21.2NTP故障处理 21.2.1NTP时钟未同步故障处理 ,Suggestion not provided,Suggestion not provided
配置流镜像后，监控设备收不到镜像报文。 ,本类故障的常见原因主要包括： •目的接口与被监控网络间链路存在故障。 •QoS策略未被应用或者报文未匹配QoS策略。 •配置流行为时，指定的流镜像接口错误。 3.故障分析 本类故障的诊断流程如图177所示。 图177配置流镜像后监控设备收不到镜像报文的故障诊断流程图 4.处理步骤 (1)检查镜像源端口能否成功收发报文。 在源设备上执行displayinterfaceinterface-typeinterface-number命令，通 过显示信息中的“Input(total)”、“Output(total)”字段查看端口收发报文的统计值。 如果镜像源端口收发的报文的统计信息为0或者不变化，此时设备与被监控的网络之间可能存在链路故障（比如端口Down等），请排查解决。 如果镜像源端口收发的报文的统计信息不为0且不断变化，请执行步骤(2)。 (2)检查QoS策略是否被正确应用。 排查匹配待镜像报文的QoS策略是否被应用以及应用的QoS策略是否正确。 在源设备上执行displayqospolicyinterface命令检查镜像源端口上是否应用QoS 策略。 如果未应用，请根据实际组网需要，在镜像源端口上应用QoS策略。 如果已应用，继续检查QoS策略配置是否正确。在设备上执行displayqospolicy命令检查QoS策略的配置信息。显示信息中Classifier字段和Behavior字段分别对应配置的流分类和流行为。 −如果引用的错误，则在系统视图下执行qospolicy命令进入对应的QoS策略视图，执行classifierbehavior命令来修改QoS策略引用的流分类和流行为。QoS策 略的具体的定位修改，请参见“MQC方式配置的QoS策略未生效”。 −如果引用正确，请执行步骤(3)。 (3)检查目的端口是否有报文发出。 在目的设备上执行displayinterfaceinterface-typeinterface-number命令， 通过显示信息中的“Output(total)”字段查看端口发送的报文的统计值。 如果目的端口发出的报文的统计信息为0或者不变化。在设备上执行display interfaceinterface-typeinterface-number命令查看显示信息中的“Currentstate”字段，确认接口的物理状态是否为Up。 −如果为Up，请执行步骤。 −如果为Down，请排查处理接口物理Down的问题。 如果目的端口发出的报文的统计信息不为0且不断变化，请执行步骤(5)。 (4)检查在目的端口上应用的QoS策略中，流行为视图下配置的流镜像接口（通过mirror-tointerface命令配置）是否为目的端口。 如果不是，请通过mirror-tointerface命令将流镜像接口重新配置为正确的接口。 如果是，请执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 •QOS_POLICY_APPLYIF_CBFAIL •QOS_POLICY_APPLYIF_FAIL •QOS_POLICY_APPLYGLOBAL_CBFAIL •QOS_POLICY_APPLYGLOBAL_FAIL 21.6.2配置端口镜像后监控设备收不到镜像报文 ,Suggestion not provided
配置组播网络后发现MSDP对等体无法正确建立（S，G）表项。 ,本类故障的常见原因主要包括： •MSDP对等体建立失败。 •SA报文缓存机制未开启。 •没有收到源端对等体发出的SA报文。 •创建SA报文的MSDP对等体没有部署在RP上。 •配置问题（比如，export、import过滤策略、import-source策略配置不正确）。 3.故障分析 本类故障的诊断流程如图81所示。 图81MSDP对等体无法正确建立（S，G）表项的故障诊断流程图 4.处理步骤 (1)检查MSDP对等体状态是否为Established。 在配置了MSDP对等体的设备上执行displaymsdpbrief命令，通过显示信息中的State字段判断MSDP对等体状态是否为Established。 a.如果不是，请检查MSDP对等体接口配置是否正确，以及MSDP对等体之间是否能够Ping通。如果Ping不通，请参见“Ping不通的定位思路”继续定位，确保MSDP对等体之间能够Ping通。 b.如果是，请执行步骤(2)。 (2)检查是否开启SA报文缓存机制。 在MSDP对等体的MSDP视图下执行displaythis命令，查看是否已通过cache-sa-enable命令开启了SA报文缓存机制。 如果未开启，请通过MSDP视图下的cache-sa-enable命令开启。 如果已开启，请执行步骤(3)。 (3)检查是否有源端对等体发出的SA报文到达。 在MSDP对等体上执行displaymsdpsa-cache命令，查看本设备上SA缓存中（S，G）表项的信息。通过查看是否存在相应的表项信息，判断对等体是否收到源端对等体发送的SA报文。 如果未收到，请执行步骤(4)。 如果已收到，请执行步骤(8)。 (4)检查源端MSDP对等体是否配置export过滤策略。 在源端MSDP对等体的MSDP视图下执行displaythis命令，查看设备上是否已通过peerpeer-addresssa-policyexport命令配置export策略，即是否配置对转发给指定MSDP 对等体的SA报文进行过滤。 如果已配置，根据是否通过acl命令配置过滤规则，分为如下两种情况处理： −如果未配置ACL过滤规则，则表示该MSDP对等体不转发SA报文，请执行undopeerpeer-addresssa-policyexport命令删除该配置。 −如果配置了ACL过滤规则，则表示该MSDP对等体只转发符合ACL规则的（S，G）表项的SA报文。请检查需要转发的（S，G）表项的SA报文能否通过已配置的ACL 规则的过滤。如果不能，可以执行undopeerpeer-addresssa-policyexport 命令删除该配置或调整指定的ACL规则。 如果未配置，请执行步骤(5)。 (5)检查接收端MSDP对等体是否配置了import策略。 在接收端MSDP对等体的MSDP视图下执行displaythis命令，查看设备上是否已通过peerpeer-addresssa-policyimport命令配置import策略，即对来自指定MSDP 对等体的SA报文进行过滤。 如果已配置，根据是否通过acl命令配置过滤规则，分为如下两种情况处理： −如果未配置ACL过滤规则，则表示该MSDP对等体不接收任何SA报文，请执行undopeerpeer-addresssa-policyimport命令删除该配置。 −如果配置了ACL过滤规则，则表示该MSDP对等体只接收符合ACL规则的（S，G）表项的SA报文。请检查需要接收的（S，G）表项的SA报文能否通过已配置的ACL规则的过滤。如果不能，可以执行undopeerpeer-addresssa-policyimport 命令删除该配置或调整指定的ACL规则。 如果未配置，请执行步骤(6)。 (6)检查源端MSDP对等体是否为RP。 在源端MSDP对等体上执行displaypimrouting-table命令，通过查看显示信息中（S， G）对应的Flag字段取值是否为2MSDP，判断该MSDP对等体是否为RP。 如果不是，请调整PIM-SM网络中RP的配置或者远端MSDP对等体的配置，确保源端 MSDP对等体为RP。 如果是，请执行步骤(7)。 (7)检查源端MSDP对等体是否配置了import-source策略。 在源端MSDP对等体的MSDP视图下执行displaythis命令，查看设备上是否已通过import-source命令配置了SA报文的创建规则。 如果已配置，根据是否通过acl命令配置过滤规则，分为如下两种情况处理： −如果未配置ACL过滤规则，则表示该MSDP对等体在创建SA报文时，对所有的（S， G）表项不作通告，请执行undoimport-source命令删除该配置。 −如果配置了ACL过滤规则，则表示该MSDP对等体在创建SA报文时，只通告符合ACL规则的（S，G）表项。请检查需要通告的（S，G）表项能否通过已配置的ACL规则的过滤。如果不能，可以执行undoimport-source命令删除该配置或调整指定的 ACL规则。 如果未配置，请执行步骤(8)。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 11.2PIM故障处理 11.2.1PIM邻居Down ,Suggestion not provided
启动过程中，串口无输出或打印乱码 ,本类故障的常见原因包括： •Console线缆损坏 •终端仿真程序的串口设置有误 •BootWare基本段损坏 •Flash硬件故障 3.故障分析 本类故障的诊断流程如图3-3所示。 图3-3设备输入输出异常的故障诊断流程 4.处理步骤 (1)检查Console线缆是否损坏 (2)更换连接计算机的串口和设备Console口的线缆，查看配置终端能否正常显示。 如果问题得到解决，则为Console线缆损坏。 如果问题无法解决，则执行步骤(2)。 (3)检查终端仿真程序的串口配置是否有误 请按如下要求设置终端仿真参数：波特率：9600；数据位：8；停止位：1；奇偶校验：无；流量控制：无。 如果问题得到解决，则为配置终端串口设置有误。 如果问题无法解决，则执行步骤(3)。 (4)如果配置终端不打印任何信息或打印一行乱码，则BootWare基本段损坏，建议更换AP。 (5)检查命令输入输出是否正常 (6)AP完成启动后，验证基本命令的输入输出是否正常。如果AP能够打印输出信息，但是无法输入任何信息，请更换其他AP进行测试。如果问题得到解决，则考虑为Flash硬件故障，建议更换AP。 3.11AP接口通信异常 ,Suggestion not provided
启动过程中，串口无输出或打印乱码；设备完成启动后，无法输入命令。 ,本类故障的常见原因包括： •Console线缆损坏 •终端仿真程序的串口设置有误 •BootWare基本段损坏 •Flash硬件故障 3.故障分析 本类故障的诊断流程如图3-3所示。 图3-3设备输入输出异常的故障诊断流程 4.处理步骤 (1)检查Console线缆是否损坏 (2)更换连接计算机的串口和设备Console口的线缆，查看配置终端能否正常显示。 如果问题得到解决，则为Console线缆损坏。 如果问题无法解决，则执行步骤(2)。 (3)检查终端仿真程序的串口配置是否有误 请按如下要求设置终端仿真参数：波特率：9600；数据位：8；停止位：1；奇偶校验：无；流量控制：无。 如果问题得到解决，则为配置终端串口设置有误。 如果问题无法解决，则执行步骤(3)。 (4)如果配置终端不打印任何信息或打印一行乱码，则BootWare基本段损坏，建议更换AP。 (5)检查命令输入输出是否正常 (6)AP完成启动后，验证基本命令的输入输出是否正常。如果AP能够打印输出信息，但是无法输入任何信息，请更换其他AP进行测试。如果问题得到解决，则考虑为Flash硬件故障，建议更换AP。 3.11AP接口通信异常 ,Suggestion not provided
启动过程中串口无输出或打印乱码,(1)设备的默认串口速率是9600，但可能部分设备设置的串口速率不是9600，需要修改设备串口速率与登录软件的串口速率一致即可。 (2)部分设备会发生内存条接口接触不良或接口磨损情况，这个时候可以尝试拔出来擦拭接口再插入（该方法只适用于允许插拔内存条的设备），确保插入没有问题；如果内存条本身损坏了，开始启动（内存低端损坏）或者启动过程中（内存高端损坏）会打印乱码，可以在进入 Bootware菜单后，按Ctrl+U进入如下菜单，测试内存是否完好（如下的菜单选择<1>即可）。 如果内存损坏了，只能更换内存了。 ===========================<BASIC-ASSISTANTMENU>=========================== |<1>RAMTest| |<0>ExitToMainMenu|============================================================================Enteryourchoice(0-1):1 Warning:TestMemorywilltakealongtime?[Y/N]Y..................... 526385152bytesmemorytestok. Memorytestedsuccess. (3)Bootware菜单的基本段被破坏的情况，请参见6.22.中的Bootware菜单的加载问题。 6.2系统启动不了 ,(1)设备的默认串口速率是9600，但可能部分设备设置的串口速率不是9600，需要修改设备串口速率与登录软件的串口速率一致即可。 (2)部分设备会发生内存条接口接触不良或接口磨损情况，这个时候可以尝试拔出来擦拭接口再插入（该方法只适用于允许插拔内存条的设备），确保插入没有问题；如果内存条本身损坏了，开始启动（内存低端损坏）或者启动过程中（内存高端损坏）会打印乱码，可以在进入 Bootware菜单后，按Ctrl+U进入如下菜单，测试内存是否完好（如下的菜单选择<1>即可）。 如果内存损坏了，只能更换内存了。 ===========================<BASIC-ASSISTANTMENU>=========================== |<1>RAMTest| |<0>ExitToMainMenu|============================================================================Enteryourchoice(0-1):1 Warning:TestMemorywilltakealongtime?[Y/N]Y..................... 526385152bytesmemorytestok. Memorytestedsuccess. (3)Bootware菜单的基本段被破坏的情况，请参见6.22.中的Bootware菜单的加载问题。 6.2系统启动不了 
入端口出现了CRC错包。 ,•端口与电缆连接器物理连接有虚插现象。 •端口异常。 •电缆连接器损坏。 •光模块、光纤有污染或连接不好。 •光功率不足。 •中间链路或设备故障。 •设备或单板硬件故障。 3.故障分析 本类故障的诊断流程如图18所示。 图18故障诊断流程图 4.处理步骤 (1)端口进行内部环回检查。 在端口下配置loopbackinternal命令开启内部环回功能，然后通过displayinterface查看端口CRC错包统计是否增长。如果增长，则可能是设备或单板硬件故障，请联系技术支持人员。如果不增长，则不是端口内部问题。 (2)检查端口与电缆连接器是否有异常。 a.检查端口和电缆连接器的物理连接是否有虚插。若有虚插，请正确连接端口和电缆连接器。 b.检查端口是否异常，比如端口内存在异物，端口的PIN针有弯针，端口的外壳变形等异常。 若有异常，需要更换其他正常端口或光模块。 c.检查电缆连接器是否出现损坏现象。若有损坏现象，请更换电缆。 (3)检查光模块是否有异常。 a.使用光纤将该端口的光模块Tx端和Rx端连接，然后通过displayinterface查看端口CRC错包统计是否增长。如果增长，则可能是光模块的问题。如果不增长，则不是该光b.通过displ(模块问题。)aytransceiveralarm命令查看光模块是否有Rx_Los或Tx_Fault告警 c.信息，若有aytransceiverdiagnosis通过命令查看(告警信息，需要清洁或更换光纤、光模块。displ)光模块的接收功率和发送功率是否 在规定的最大值和最小值的范围内，若有接收或发送的功率超出范围，需要清洁或更换光纤、光模块。 (4)更换正常端口测试是否能恢复正常。 更换其他正常的端口测试，如果端口更换后错包消失，端口更换回来错包又再次出现，则为端口硬件故障，请更换端口并将故障信息发送技术支持人员分析；如更换到其他正常端口仍会出现错包，则中间传输链路故障的可能性较大。 (5)检查中间传输链路是否正常。 使用仪器测试中间链路，链路质量差或者线路光信号衰减过大会导致报文在传输过程中出错。检查互连中间链路设备（光转，转接架，传输等设备）是否正常。若中间传输链路故障，请更 (6)shutdown执行命令，再(换或恢复中间传输链路。)执行undoshutdown命令，查看端口是否能恢复正常。 (7)检查端口是否收到大量流控帧 通过displayinterface命令，查看端口pauses帧计数，如果在不断增长，表明端口发出或者收到了大量的流控帧。检查下端口出入流量是否过大及对端设备的流量处理能力。 (8)如果故障仍然未能排除，可能是设备或单板硬件故障，请收集信息，并联系技术支持人员。 5.告警与日志相关告警无 相关日志无 3.6.2端口不接收报文 ,Suggestion not provided
三层组播业务不通主要表现在组播流量转发失败。 ,本类故障的常见原因主要包括： •单播路由配置错误。 •接口状态不正确。 •PIM路由表项未正确生成。 •组播转发表项未正确生成。 3.故障分析 本类故障的诊断流程如图87所示。 图87三层组播业务不通的故障诊断流程图 4.处理步骤 (1)检查是否存在到组播源的单播路由。 执行displayiprouting-tableip-address命令，查看是否存在到达组播源的路由。 其中，ip-address指定为组播源的地址。 如果不存在，请配置到达组播源的路由。 如果存在，请执行步骤(2)。 (2)检查组播流量入、出接口的状态是否正常。 执行displayinterface命令查看接口物理层状态。 如果接口物理层状态为Down，请解决接口故障问题。 如果接口物理层状态为Up，请执行步骤(3)。 (3)检查是否生成正确的PIM路由表项。 执行displaypimrouting-table命令，查看PIM路由表项是否生成，以及是否有对应 的出接口。 如果没有，请联系技术支持人员。 如果有，请执行步骤(4)。 (4)检查是否生成正确的组播转发表项。 执行displaymulticastforwarding-table命令，查看组播转发表项是否生成，以及 是否有对应的出接口。 如果没有，请收集上述步骤的执行结果和设备的配置文件，并联系技术支持人员。 如果有，也请收集上述步骤的执行结果和设备的配置文件，并联系技术支持人员。 5.告警与日志相关告警无 相关日志无 11.3.2无法正常建立IGMP或MLD表项 ,Suggestion not provided
扫码枪网络随机不通,本类故障的常见原因主要包括： •扫码枪的信号值不满足要求。 •AP空口有干扰。 •加密方式不同导致扫码枪关联存在问题。 •扫码枪工作在省电模式或休眠模式。 •扫码枪版本过低或者网卡较老。 3.故障分析 本类故障的诊断流程如图5-5所示。 图5-5扫码枪网络随机不通的故障诊断流程图 4.处理步骤 (1)检查扫码枪的信号值是否满足要求。无线报文交互是一个双向传输的过程，设备侧感知到的终端信号强度就是AP接收到无线终端回传报文的信号强度。 在AC上通过如下命令查看终端信号强度，mac-address为扫码枪的MAC地址。 <AC>displaywlanclientmac-addressmac-addressverbose|includeRSSIRSSI:30 设备侧我们一般要求终端的信号强度RSSI>30，如果RSSI<25，终端实际发包速率就会明显降低；如果RSSI<20，终端无线基本不可用。扫码枪的作业场景一般为物流仓库，如果扫码枪的信号值较弱，会影响回传报文的质量，建议检查如下： 扫码枪作业的范围是否有明显的阻挡物、衰减物，如实体墙等； 检查扫码枪是否连接到了远端AP； 检查现场AP的点位和部署方式，尽可能的保证终端连接的信号值。 (2)查看AP空口干扰。空口利用率体现了信道的繁忙程度，这个值是实时波动的。无线信号频率越高衰减越大。大多扫码枪的网卡性能较老，并且只能连接2.4G频段。由于2.4G频谱资源有限，相比5G衰减小，又属于工业开放频段，易受干扰，我们尤其要关注2.4G频段的空口利用率情况，尽可能的降低环境的影响。 AC上可以快速查看所有AP当前时刻的空口利用率（每50秒统计一次），以便对整个网络环境有一个基本了解。而AP上可以看到该射频200秒（每10秒钟统计一次）内的空口变化情况，更具有实际意义，强烈建议在AP上查看。 通过AC查看空口利用率： <AC>displaywlanapallradio TotalnumberofAPs:1 …… APnameRIDStateChannelBWUsageTxPowerClients (MHz)(%)(dBm) 7c1e-067a-81401Up52(auto)808180 7c1e-067a-81402Up149(auto)8022200 7c1e-067a-81403Up6(auto)2019201 RID1、2、3分别代表射频1、射频2和射频3，Usage代表空口利用率。 通过AP查看空口利用率，登录AP，进入Probe视图，查看Tx、Rx方向的空口利用率。 [ap]probe [ap-probe]displayar5drv2channelbusy ChannelBusyinformation CtlChannel:08ChannelBand:20M RecordInterval(s):9 Date/Month/Year:23/11/2019 Time(h/m/s):CtlBusy(%)TxBusy(%)RxBusy(%)ExtBusy(%) 0119:11:564030 0219:11:4780500319:11:387040 (3)检查是否因加密方式不同导致的问题。 尝试不加密、RSN+CCMP和WPA+TKIP组合加密方式，观察扫码枪关联是否存在问题。 (4)检查终端工作模式。 a.检查扫码枪是否工作在省电模式或休眠模式。 图5-6检查扫码枪是否工作在省电模式或休眠模式 b.在AC上查看扫码枪的休眠次数是否过多，如果扫码枪的休眠次数过多，则会影响终端的上网体验，尤其是在终端移动（存在漫游）和信号强度较低时。对于休眠次数过多的问题，可以通过在设备侧配置客户端保活来缓解。当无线客户端进入休眠状态后，通过定时监听Beacon帧中的TIM（TafficIndicationMap，数据待传指示信息）来判断AP是否为其缓存了报文，如果AP为其缓存了报文则终止休眠状态，与AP进行数据通信。通过命令optionkeep-activeenable开启缩短客户端休眠时间功能后，AP通过修改Beacon帧中的TIM，缩短了客户端的休眠时间，从而提高了传输效率。但该问题的根本原因与客户端网卡自身休眠的机制有关，所以强烈建议检查扫码枪的工作模式。 查看客户端休眠次数： <AC>displaywlanclientmac-addressmac-addressverbose …… Sleepcount:35737 …… RSSI:22 (5)检查扫码枪的型号和版本。 a.确认扫码枪的型号和版本，如果当前扫码枪的版本过低，建议升级为最新版本和网卡驱动。b.强制11g模式。 部分扫码枪的网卡较老，为了配合它的Wi-Fi模式，可以将射频配置为11g模式进行观察。 [AC]wlanapap1modelmodel-name [AC-wlan-ap-ap1]radio2 [AC-wlan-ap-ap1-radio-2]typedot11g c.禁用5.5速率。 根据问题处理经验，部分摩托罗拉的扫码枪对5.5速率支持不好，导致协商到该速率时出现掉线的情况，可针对现网情况尝试禁用该速率并进行观察。 [AC]wlanapap1modelmodel-name [AC-wlan-ap-ap1]radio2 [AC-wlan-ap-ap1-radio-2]ratedisabled5.5 d.配置长导码。前导码是位于数据包起始处的一组bit位，接收者可以据此同步并准备接收数据。只有射频模式为802.11b、802.11g或802.11gn模式，才支持配置前导码类型。选择短前导码能使网络同步性能更好，我们的设备默认是短前导码，但是有些早期的客户端网卡为长导码，我们可以选择长前导码兼容这些客户端网卡。 #配置前导码类型为长前导码。（Radio视图） [AC]wlanapap1modelmodel-name [AC-wlan-ap-ap1]radio2 [AC-wlan-ap-ap1-radio-2]typedot11g[AC-wlan-ap-ap1-radio-2]preamblelong (6)第三方网卡抓包。 在故障时刻，通过无线抓包网卡进行空口抓包。 a.在故障时刻，记录下故障终端的MAC或IP地址，保留故障现象，避免客户端重新关联导 b.通过命令dis(致故障消失。)playwlanclient|includeX.X.X.X在AC上找到该终端关联的AP。 c.记录AP的工作信道，可通过命令displaywlanapallradio查看。 d.安装无线抓包网卡，打开omnipeek软件，在802.11栏目选择关联AP工作的信道。图5-7选择信道 e.在“Filters”过滤器栏目输入客户端的MAC地址，并选择双向。 图5-8过滤客户端MAC地址 f.点击右上角“StartCapture”开始抓包。 图5-9开始抓包 (7)拨打热线400-810-0504求助。 如果根据上述相关步骤排查还是无法定位扫码枪网络中断问题，请收集故障时的AC诊断、 AP诊断、抓包信息、终端verbose信息、终端型号和组网拓扑情况，拨打400-810-0504热线寻求帮助。 5.13集中转发方式下无线上网卡慢 ,Suggestion not provided
扫码枪网络随机不通。 ,本类故障的常见原因主要包括： •扫码枪的信号值不满足要求。 •AP空口有干扰。 •加密方式不同导致扫码枪关联存在问题。 •扫码枪工作在省电模式或休眠模式。 •扫码枪版本过低或者网卡较老。 3.故障分析 本类故障的诊断流程如图5-5所示。 图5-5扫码枪网络随机不通的故障诊断流程图 4.处理步骤 (1)检查扫码枪的信号值是否满足要求。无线报文交互是一个双向传输的过程，设备侧感知到的终端信号强度就是AP接收到无线终端回传报文的信号强度。 在AC上通过如下命令查看终端信号强度，mac-address为扫码枪的MAC地址。 <AC>displaywlanclientmac-addressmac-addressverbose|includeRSSIRSSI:30 设备侧我们一般要求终端的信号强度RSSI>30，如果RSSI<25，终端实际发包速率就会明显降低；如果RSSI<20，终端无线基本不可用。扫码枪的作业场景一般为物流仓库，如果扫码枪的信号值较弱，会影响回传报文的质量，建议检查如下： 扫码枪作业的范围是否有明显的阻挡物、衰减物，如实体墙等； 检查扫码枪是否连接到了远端AP； 检查现场AP的点位和部署方式，尽可能的保证终端连接的信号值。 (2)查看AP空口干扰。空口利用率体现了信道的繁忙程度，这个值是实时波动的。无线信号频率越高衰减越大。大多扫码枪的网卡性能较老，并且只能连接2.4G频段。由于2.4G频谱资源有限，相比5G衰减小，又属于工业开放频段，易受干扰，我们尤其要关注2.4G频段的空口利用率情况，尽可能的降低环境的影响。 AC上可以快速查看所有AP当前时刻的空口利用率（每50秒统计一次），以便对整个网络环境有一个基本了解。而AP上可以看到该射频200秒（每10秒钟统计一次）内的空口变化情况，更具有实际意义，强烈建议在AP上查看。 通过AC查看空口利用率： <AC>displaywlanapallradio TotalnumberofAPs:1 …… APnameRIDStateChannelBWUsageTxPowerClients (MHz)(%)(dBm) 7c1e-067a-81401Up52(auto)808180 7c1e-067a-81402Up149(auto)8022200 7c1e-067a-81403Up6(auto)2019201 RID1、2、3分别代表射频1、射频2和射频3，Usage代表空口利用率。 通过AP查看空口利用率，登录AP，进入Probe视图，查看Tx、Rx方向的空口利用率。 [ap]probe [ap-probe]displayar5drv2channelbusy ChannelBusyinformation CtlChannel:08ChannelBand:20M RecordInterval(s):9 Date/Month/Year:23/11/2019 Time(h/m/s):CtlBusy(%)TxBusy(%)RxBusy(%)ExtBusy(%) 0119:11:564030 0219:11:4780500319:11:387040 (3)检查是否因加密方式不同导致的问题。 尝试不加密、RSN+CCMP和WPA+TKIP组合加密方式，观察扫码枪关联是否存在问题。 (4)检查终端工作模式。 a.检查扫码枪是否工作在省电模式或休眠模式。 图5-6检查扫码枪是否工作在省电模式或休眠模式 b.在AC上查看扫码枪的休眠次数是否过多，如果扫码枪的休眠次数过多，则会影响终端的上网体验，尤其是在终端移动（存在漫游）和信号强度较低时。对于休眠次数过多的问题，可以通过在设备侧配置客户端保活来缓解。当无线客户端进入休眠状态后，通过定时监听Beacon帧中的TIM（TafficIndicationMap，数据待传指示信息）来判断AP是否为其缓存了报文，如果AP为其缓存了报文则终止休眠状态，与AP进行数据通信。通过命令optionkeep-activeenable开启缩短客户端休眠时间功能后，AP通过修改Beacon帧中的TIM，缩短了客户端的休眠时间，从而提高了传输效率。但该问题的根本原因与客户端网卡自身休眠的机制有关，所以强烈建议检查扫码枪的工作模式。 查看客户端休眠次数： <AC>displaywlanclientmac-addressmac-addressverbose …… Sleepcount:35737 …… RSSI:22 (5)检查扫码枪的型号和版本。 a.确认扫码枪的型号和版本，如果当前扫码枪的版本过低，建议升级为最新版本和网卡驱动。b.强制11g模式。 部分扫码枪的网卡较老，为了配合它的Wi-Fi模式，可以将射频配置为11g模式进行观察。 [AC]wlanapap1modelmodel-name [AC-wlan-ap-ap1]radio2 [AC-wlan-ap-ap1-radio-2]typedot11g c.禁用5.5速率。 根据问题处理经验，部分摩托罗拉的扫码枪对5.5速率支持不好，导致协商到该速率时出现掉线的情况，可针对现网情况尝试禁用该速率并进行观察。 [AC]wlanapap1modelmodel-name [AC-wlan-ap-ap1]radio2 [AC-wlan-ap-ap1-radio-2]ratedisabled5.5 d.配置长导码。前导码是位于数据包起始处的一组bit位，接收者可以据此同步并准备接收数据。只有射频模式为802.11b、802.11g或802.11gn模式，才支持配置前导码类型。选择短前导码能使网络同步性能更好，我们的设备默认是短前导码，但是有些早期的客户端网卡为长导码，我们可以选择长前导码兼容这些客户端网卡。 #配置前导码类型为长前导码。（Radio视图） [AC]wlanapap1modelmodel-name [AC-wlan-ap-ap1]radio2 [AC-wlan-ap-ap1-radio-2]typedot11g[AC-wlan-ap-ap1-radio-2]preamblelong (6)第三方网卡抓包。 在故障时刻，通过无线抓包网卡进行空口抓包。 a.在故障时刻，记录下故障终端的MAC或IP地址，保留故障现象，避免客户端重新关联导 b.通过命令dis(致故障消失。)playwlanclient|includeX.X.X.X在AC上找到该终端关联的AP。 c.记录AP的工作信道，可通过命令displaywlanapallradio查看。 d.安装无线抓包网卡，打开omnipeek软件，在802.11栏目选择关联AP工作的信道。图5-7选择信道 e.在“Filters”过滤器栏目输入客户端的MAC地址，并选择双向。 图5-8过滤客户端MAC地址 f.点击右上角“StartCapture”开始抓包。 图5-9开始抓包 (7)拨打热线400-810-0504求助。 如果根据上述相关步骤排查还是无法定位扫码枪网络中断问题，请收集故障时的AC诊断、 AP诊断、抓包信息、终端verbose信息、终端型号和组网拓扑情况，拨打400-810-0504热线寻求帮助。 5.13集中转发方式下无线上网卡慢 ,Suggestion not provided
上电后，设备无法启动 ,查看Bootware菜单的加载信息，如果没有输出Systemimageisstarting...消息就停住了，则是 Bootware菜单加载问题，如果已经输出了这个消息，则是版本文件有问题。 •针对Bootware被破坏的情况：如果基本段被破坏了，应该是什么都不输出或者输一行乱码，这个时候没有其它办法，返厂烧片才能解决。如果是扩展段破坏了，找到产品对应的Bootware文件，重新升级Bootware即可。 •针对启动文件信息破坏的情况：表现为扩展段找不到启动文件，可以进入扩展段重新设置启动文件，或者下载新的启动文件。 •针对文件系统损坏的情况：也表现为找不到启动文件，并且设置启动文件和下载文件不成功。 那么可以格式化文件系统，再下载启动文件。 •版本文件问题不常出现，如果开启了看门狗，表现为异常重启或直接地反复重启；如果没有开启看门狗，表现为系统阻塞。在排除下载了错误的版本原因后，只能联系研发的支持解决；更推荐的做法，就是更换其它的正常启动版本。 6.3AP未知原因重启 ,查看Bootware菜单的加载信息，如果没有输出Systemimageisstarting...消息就停住了，则是 Bootware菜单加载问题，如果已经输出了这个消息，则是版本文件有问题。 •针对Bootware被破坏的情况：如果基本段被破坏了，应该是什么都不输出或者输一行乱码，这个时候没有其它办法，返厂烧片才能解决。如果是扩展段破坏了，找到产品对应的Bootware文件，重新升级Bootware即可。 •针对启动文件信息破坏的情况：表现为扩展段找不到启动文件，可以进入扩展段重新设置启动文件，或者下载新的启动文件。 •针对文件系统损坏的情况：也表现为找不到启动文件，并且设置启动文件和下载文件不成功。 那么可以格式化文件系统，再下载启动文件。 •版本文件问题不常出现，如果开启了看门狗，表现为异常重启或直接地反复重启；如果没有开启看门狗，表现为系统阻塞。在排除下载了错误的版本原因后，只能联系研发的支持解决；更推荐的做法，就是更换其它的正常启动版本。 6.3AP未知原因重启 
上电后，设备无法启动。 ,查看Bootware菜单的加载信息，如果没有输出Systemimageisstarting...消息就停住了，则是 Bootware菜单加载问题，如果已经输出了这个消息，则是版本文件有问题。 •针对Bootware被破坏的情况：如果基本段被破坏了，应该是什么都不输出或者输一行乱码，这个时候没有其它办法，返厂烧片才能解决。如果是扩展段破坏了，找到产品对应的Bootware文件，重新升级Bootware即可。 •针对启动文件信息破坏的情况：表现为扩展段找不到启动文件，可以进入扩展段重新设置启动文件，或者下载新的启动文件。 •针对文件系统损坏的情况：也表现为找不到启动文件，并且设置启动文件和下载文件不成功。 那么可以格式化文件系统，再下载启动文件。 •版本文件问题不常出现，如果开启了看门狗，表现为异常重启或直接地反复重启；如果没有开启看门狗，表现为系统阻塞。在排除下载了错误的版本原因后，只能联系研发的支持解决；更推荐的做法，就是更换其它的正常启动版本。 6.3AP未知原因重启 ,查看Bootware菜单的加载信息，如果没有输出Systemimageisstarting...消息就停住了，则是 Bootware菜单加载问题，如果已经输出了这个消息，则是版本文件有问题。 •针对Bootware被破坏的情况：如果基本段被破坏了，应该是什么都不输出或者输一行乱码，这个时候没有其它办法，返厂烧片才能解决。如果是扩展段破坏了，找到产品对应的Bootware文件，重新升级Bootware即可。 •针对启动文件信息破坏的情况：表现为扩展段找不到启动文件，可以进入扩展段重新设置启动文件，或者下载新的启动文件。 •针对文件系统损坏的情况：也表现为找不到启动文件，并且设置启动文件和下载文件不成功。 那么可以格式化文件系统，再下载启动文件。 •版本文件问题不常出现，如果开启了看门狗，表现为异常重启或直接地反复重启；如果没有开启看门狗，表现为系统阻塞。在排除下载了错误的版本原因后，只能联系研发的支持解决；更推荐的做法，就是更换其它的正常启动版本。 6.3AP未知原因重启 
设备的CPU控制核占用率高,"本类故障的常见原因主要包括： •协议震荡，通常为STP震荡、路由协议震荡等。 •网络环路。 •设备产生海量日志，设备生成和管理这些日志需要占用大量CPU资源。 3.故障分析 本类故障的诊断流程如图4-4所示。 图4-4CPU占用率高的故障诊断流程图 4.处理步骤 (1)确认设备是否出现协议震荡。协议震荡会导致设备不断地处理协议报文、计算拓扑、更新表项，引起CPU占用率高。在实际应用中，最常见的协议震荡为STP协议震荡和OSPF协议震荡。 对于STP协议震荡，在系统视图执行stpport-log命令打开端口状态变化日志显示开关，如果命令行界面频繁输出以下日志，则说明出现了STP协议震荡。 STP/6/STP_DETECTED_TC:Instance0'sportGigabitEthernet1/0/1detectedatopologychange. STP/6/STP_DISCARDING:Instance0'sportGigabitEthernet1/0/1hasbeensettodiscardingstate. STP/6/STP_NOTIFIED_TC:Instance0'sportGigabitEthernet1/0/1wasnotifiedatopologychange. −如果STP协议震荡，请先排除STP协议震荡问题。 对(−)OSPF协议震荡，执行于displayip(如果STP协议没有震荡，则继续定位。)routing-table命令，查看路由信息。如果路由表项中相同网段的路由条目被频繁反复地创建和删除，则表示路由震荡。 −如果路由震荡，或者路由一直不存在，则先排除链路问题和IGP路由问题。−如果路由没有震荡，则执行步骤（2）。 (2)确认是否存在网络环路。 当以太网接口工作在二层模式并且链路存在环路时，可能出现广播风暴和网络振荡。大量的协议报文上送CPU处理，从而导致CPU占用率升高。当存在网络环路时，设备很多端口的流量会明显变大，且广播和组播报文占比较大。可通过以下步骤来确认设备是否存在网络环路，设备是否存在广播、组播、未知单播报文风暴。a.清除接口的统计信息。 <Sysname>resetcountersinterface b.多次执行displaycountersrateinboundinterface命令查看端口使用率是否 明显增大。 <Sysname>displaycountersrateinboundinterfaceUsage:Bandwidthutilizationinpercentage InterfaceUsage(%)Total(pps)Broadcast(pps)Multicast(pps)GE5/3/00.017---- MGE0/31/00.011----MGE0/32/00.015----VMC1/1/00.0560---- VMC1/2/00.0452---- Overflow:Morethan14digits.--:Notsupported. c.如果端口使用率明显增大，可继续多次执行displaycountersinboundinterface 命令查看接口收到的总报文数、广播和组播报文的数量，分别对应显示信息中Total(pkt)、Broadcast(pkt)、Multicast(pkt)字段的取值。如果广播和组播报文的增长速度快，广播、组播报文在接口收到的总报文数中占比大，则可能出现广播/组播风暴。如果广播和组播报文数量没有明显增加，但是接口收到的总报文数明显增加，则可能出现未知单播报文风暴。 <Sysname>displaycountersinboundinterface InterfaceTotal(pkt)Broadcast(pkt)Multicast(pkt)Err(pkt)GE5/3/0141271110MGE0/31/0274866476960-- MGE0/32/010630346848082--VMC1/1/0111577977274558500 VMC1/2/096538985619640520 Overflow:Morethan14digits(7digitsforcolumn""Err""). --:Notsupported. 如链路出现环路，可进行如下处理： −排查链路连接，避免物理拓扑出现环路。 −使用displaystp命令检查STP协议是否使能，配置是否正确。如果配置错误，请 −使用displ(修改配置。)aystpbrief和displaystpabnormal-port命令检查邻接设备STP状态是否正常。请根据displaystpabnormal-port命令显示信息中的BlockReason字段的取值，定位并解决STP异常问题。如STP配置均正确，可能为STP协议计算错误或协议计算正确但端口驱动层没有正常Block阻塞，可以在发生环路的接口上执行shutdown/undoshutdown命令或者拔插网线让STP重新计算来快速恢复STP功能，消除环路。 −在以太网接口视图下，使用broadcast-suppression命令开启端口广播风暴抑制功能，使用multicast-suppression命令开启端口组播风暴抑制功能，使用unicast-suppression命令开启端口未知单播风暴抑制功能。或者使用flow-control命令配置流量控制功能。 如未出现环，请执行步骤(3）。 (3)确认设备当前是否正在生成海量日志。某些异常情况下，例如，设备受到攻击、运行中发生了错误、端口频繁Up/Down等，设备会不停地产生诊断信息或日志信息。此时系统软件要频繁的读写存储器，会造成CPU占用率升高。 允许日志信息输出到当前终端。 <Sysname>terminalmonitor Thecurrentterminalisenabledtodisplaylogs. 配置该命令后，如果有大量异常日志或者重复日志输出到命令行界面，则说明设备正在生 重复执行dis(成海量日志。)playlogbuffersummary命令，如果日志信息总量有明显的增加，再使用displaylogbufferreverse命令查看日志详情，确认是否有大量异常日志或者某一条信息大量重复出现。 <Sysname>displaylogbuffersummary EMERGALERTCRITERRORWARNNOTIFINFODEBUG 002924121280 0004172820 004211147400 <Sysname>displaylogbufferreverse Logbuffer:Enabled Maxbuffersize:1024 Actualbuffersize:512 Droppedmessages:0 Overwrittenmessages:0 Currentmessages:410 %Jan1508:17:24:2592021SysnameSHELL/6/SHELL_CMD: -Line=vty0-IPAddr=192.168.2.108-User=**;Commandisdisplaylogbuffer %Jan1508:17:19:7432021SysnameSHELL/4/SHELL_CMD_MATCHFAIL: -User=**-IPAddr=192.168.2.108;Commanddisplaylogfileinviewshellfailedtobematched. ... 如果设备正在生成海量日志，可以通过以下方法减少日志的生成： ess命令禁止指定模块日志的输出。 使用info-centerloggingsuppressduplicates命令开启重复日志抑制功能。如果设备未生成海量日志，则执行步骤（4）。 (4)收集CPU占用率相关信息，找到CPU占用率高的业务模块。 a.确定对CPU占用率高的任务。 #在设备上执行displayprocesscpu命令查看一段时间内占用CPU最多的任务。 <Sysname>displayprocesscpu CPUutilizationin5secs:0.5%;1min:0.6%;5mins:0.4% JID5Sec1Min5MinName 10.0%0.0%0.0%scmd ...如果某个进程的CPU占用率高于3%（经验值供参考），则需要针对该进程继续定位。#在设备上执行monitorprocessdumbtty命令实时查看进程在指定CPU上的占用率。 <Sysname>system-view [Sysname]monitorprocessdumbtty 319processes;411threads;2093fdsThreadstates:1running,410sleeping,0stopped,0zombieCPU0:90.10%idle,4.50%user,5.40%kernel,0.00%interrupt,0.00%stealCPU1:99.10%idle,0.00%user,0.90%kernel,0.00%interrupt,0.00%stealCPU2:100.00%idle,0.00%user,0.00%kernel,0.00%interrupt,0.00%stealCPU3:100.00%idle,0.00%user,0.00%kernel,0.00%interrupt,0.00%stealMemory:967Mtotal,381Mavailable,pagesize4KJIDPIDPRIStateFDsMEMHH:MM:SSCPUName856856120S2014956K00:03:281.42%diagd11120S1918764K00:00:160.15%scmd294294120S00K00:02:150.15%[kworker/1:1 … −在monitorprocessdumbtty命令显示信息中找到CPU占用率超过3%（经验值供参考）的进程的JID，再对这些进程执行displayprocessjob命令，收集进程的详细信息，并确认该进程是否运行在控制核上。 如果displayprocessjob命令的显示信息中LAST_CPU字段的取值为控制核的编号（例如0～1），则说明该进程运行在CPU控制核上，则需要进一步定位；如果显示信息中LAST_CPU字段的取值为非控制核的编号，则说明该进程运行在CPU转发核上，无需关注，请执行步骤（5）。下面以pppd进程为例，通过显示信息可以看到，该进程包含多个线程，这些线程都运行在控制核上。 <Sysname>displayprocessnamepppd JobID:515PID:515 ParentJID:1 ParentPID:1 Executablepath:/sbin/pppd Instance:0 Respawn:ON Respawncount:1 Max.spawnsperminute:12 Laststarted:WedNov309:52:002021 Processstate:sleeping Max.core:1 ARGS:--MaxTotalLimit=2000000 --MaxIfLimit=65534--CmdOption=0x01047fbf--bSaveRunDb--pppoechastenflag=1 --pppoechastennum=6--pppoechastenperiod=60--pppoechastenblocktime=300 --pppchastenflag=1--pppchastennum=6--pppchastenperiod=60 --pppchastenblocktime=300--PppoeKChasten--bSoftRateLimit--RateLimitToken=2048 TIDLAST_CPUStackPRIStateHH:MM:SS:MSECName 5150136K115S0:0:0:90pppd 5490136K115S0:0:0:0ppp_misc 5570136K115S0:0:0:10ppp_chasten 6100136K115S0:0:0:0ppp_work0 6111136K115S0:0:0:0ppp_work1 6121136K115S0:0:0:0ppp_work2 6131136K115S0:0:0:0mp_main 6181136K115S0:0:0:110pppoes_main 6191136K115S0:0:0:100pppoes_mesh 6201136K115S0:0:0:120l2tp_mesh6211136K115S0:0:0:20l2tp_main −对于运行在控制核、CPU占用率超过5%的进程，查看进程的Name字段的取值来确定该进程是否为用户态进程。 如果Process的Name取值中包含“[]”，表示它是内核线程，无需执行monitorthreaddumbtty命令；如果Process的Name取值中未包含“[]”，表示它是用户态进程，它可能包含多个线程。对于多线程的用户态进程，还需要对该用户态进程执行monitorthreaddumbtty命令，如果显示信息中某线程LAST_CPU字段的取值为CPU控制核的编号，且CPU字段取值大于5%，则该线程可能为导致CPU控制核占用率高的线程，需要进一步定位。 <Sysname>monitorthreaddumbtty 206processes;342threads;5134fds Threadstates:4running,338sleeping,0stopped,0zombie CPU0:98.06%idle,0.97%user,0.97%kernel,0.00%interrupt,0.00%steal CPU1:97.12%idle,0.96%user,0.96%kernel,0.96%interrupt,0.00%steal CPU2:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%stealCPU3:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal CPU4:0.00%idle,0.00%user,100.00%kernel,0.00%interrupt,0.00%steal Memory:7940Mtotal,5315Mavailable,pagesize4K JIDTIDLAST_CPUPRIStateHH:MM:SSMAXCPUName 3223222115R00:04:21020.15%[kdrvfwdd2]3233233115R00:04:21020.15%[kdrvfwdd3] 3243244115R00:04:21020.15%[kdrvfwdd4] 111120S00:00:02210.19%scmd 3763761120S00:00:0010.19%diagd 220120S00:00:0000.00%[kthreadd] ... b.确认异常任务的调用栈。 在Probe视图下执行followjob命令确认异常任务的调用栈。下面以Sysname上pppd进程（进程编号为515）的操作为例。 <Sysname>system-view [Sysname]probe [Sysname-probe]followjob515 Attachingtoprocess515(pppd) Iteration1of5 ------------------------------ ThreadLWP515:Switches:3205 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x0000000000441745inppp_EpollSched+0x35/0x5c #20x0000000000000004in?? Kernelstack: [<ffffffff811f0573>]ep_poll+0x2f3/0x370 [<ffffffff811f06c0>]SyS_epoll_wait+0xd0/0xe0 [<ffffffff814aed79>]system_call_fastpath+0x16/0x1b[<ffffffffffffffff>]0xffffffffffffffff ThreadLWP549:Switches:20 Userstack: #00x00007fdc2a3aaa8cinepoll_wait+0x14/0x2e #10x00000000004435d4inppp_misc_EpollSched+0x44/0x6c Kernelstack: [<ffffffffffffffff>]0xffffffffffffffff ... c.根据a和b步骤找到任务名称，再根据任务名称找到对应的业务模块，定位并处理业务模块的问题。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 4.4生成树故障处理 4.4.1设备连接成环时业务中断 ",Suggestion not provided
设备的光口工作异常，不能link,重启设备，同时确保光模块的Tx和Rx没有插反。 3.7AP设备信号弱 ,重启设备，同时确保光模块的Tx和Rx没有插反。 3.7AP设备信号弱 
设备对Telnet登录用户采用Password认证或AAA本地认证的情况下，管理员遗忘Telnet账户密码无法登录设备,本类故障的常见原因主要包括： •管理员遗忘了Telnet口的登录密码或输入错误的密码。 •Telnet登录账户已过期。 3.故障分析 本类故障的诊断流程如图4-2所示。 图4-2Telnet登录密码遗忘故障诊断流程图 4.处理步骤 (1)确认是否有其它方式可以登录设备。 如果Telnet登录密码丢失，可以通过其他方式（例如Console口）登录设备后重新进行配置。 a.使用其它方式登录设备，执行displayline命令查看VTY口所在用户线的认证方式。 <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation +0CON09600-P-0/081VTY0-P-0/0... 以上显示信息中，“Auth”字段取值为P表示采用密码认证方式，取值为A表示采用AAA认证方式。 b.根据VTY口的认证方式，采用不同的处理步骤重新设置新的登录密码。−采用密码认证 设置VTY登录用户的认证方式为密码认证，假设登录密码为1234567890!，用户角色为network-admin。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modepassword [Sysname-line-vty0-63]setauthenticationpasswordsimple1234567890! [Sysname-line-vty0-63]user-rolenetwork-admin −采用AAA本地认证 设置VTY登录用户的认证方式为AAA认证，假设登录使用的本地账户名为admin，使用的本地密码为1234567890!，用户角色为network-admin。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modescheme[Sysname-line-vty0-63]quit [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]service-typetelnet[Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin如果忘记原有登录账户名，可参考以上步骤创建新的本地账户。 −采用AAA远程认证该认证方式下，请联系AAA服务器管理员获取登录密码。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 4.1.3Telnet登录失败 ,Suggestion not provided
设备对Telnet登录用户采用Password认证或AAA本地认证的情况下，管理员遗忘Telnet账户密码无法登录设备。 ,本类故障的常见原因主要包括： •管理员遗忘了Telnet口的登录密码或输入错误的密码。 •Telnet登录账户已过期。 3.故障分析 本类故障的诊断流程如图4-2所示。 图4-2Telnet登录密码遗忘故障诊断流程图 4.处理步骤 (1)确认是否有其它方式可以登录设备。 如果Telnet登录密码丢失，可以通过其他方式（例如Console口）登录设备后重新进行配置。 a.使用其它方式登录设备，执行displayline命令查看VTY口所在用户线的认证方式。 <Sysname>displayline IdxTypeTx/RxModemAuthIntLocation +0CON09600-P-0/081VTY0-P-0/0... 以上显示信息中，“Auth”字段取值为P表示采用密码认证方式，取值为A表示采用AAA认证方式。 b.根据VTY口的认证方式，采用不同的处理步骤重新设置新的登录密码。−采用密码认证 设置VTY登录用户的认证方式为密码认证，假设登录密码为1234567890!，用户角色为network-admin。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modepassword [Sysname-line-vty0-63]setauthenticationpasswordsimple1234567890! [Sysname-line-vty0-63]user-rolenetwork-admin −采用AAA本地认证 设置VTY登录用户的认证方式为AAA认证，假设登录使用的本地账户名为admin，使用的本地密码为1234567890!，用户角色为network-admin。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modescheme[Sysname-line-vty0-63]quit [Sysname]local-useradminclassmanage [Sysname-luser-manage-admin]service-typetelnet[Sysname-luser-manage-admin]passwordsimple1234567890! [Sysname-luser-manage-admin]authorization-attributeuser-rolenetwork-admin如果忘记原有登录账户名，可参考以上步骤创建新的本地账户。 −采用AAA远程认证该认证方式下，请联系AAA服务器管理员获取登录密码。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 4.1.3Telnet登录失败 ,Suggestion not provided
设备二层转发丢包，即源端和目的端在同一二层网络的同一VLAN内，通信过程中有丢包。 ,"•端口下有错包 •报文因ACL规则被丢弃 •端口处于block状态 •拥塞丢包 3.故障分析 本类故障的诊断流程如图31所示。 图31二层流量转发丢包故障诊断流程图 4.处理步骤 (1)查看端口下是否有错包使用displayinterface命令查看端口下是否有错包。如果有错包，请前往步骤2，如果没有错包，请前往步骤3进行后续步骤的检查。 <Sysname>displayinterfaceTwenty-FiveGigE1/0/17 Twenty-FiveGigE1/0/17currentstate:UP Lineprotocolstate:UP IPPacketFrameType:PKTFMT_ETHNT_2,HardwareAddress:aa11-2233-4496 …… Last300secondsinput:0packets/sec10bytes/sec0% Last300secondsoutput:0packets/sec10bytes/sec0%Input(total):1438packets,480292bytes 0unicasts,0broadcasts,1438multicasts,0pauses Input(normal):1438packets,-bytes 0unicasts,0broadcasts,1438multicasts,0pauses Input:0inputerrors,0runts,0giants,0throttles 0CRC,0frame,-overruns,0aborts -ignored,-parityerrors Output(total):1440packets,475200bytes 0unicasts,0broadcasts,1440multicasts,0pauses Output(normal):1440packets,-bytes 0unicasts,0broadcasts,1440multicasts,0pauses Output:0outputerrors,-underruns,-bufferfailures 0aborts,0deferred,0collisions,0latecollisions 0lostcarrier,-nocarrier (2)端口下有错包端口下有错包有以下几种可能的故障原因，可使用排除法定位： 端口本身硬件故障：通过将连接端口的线缆连接到配置相同且可正常工作的端口查看是否端口本身硬件故障。如果是端口本身硬件故障，请将线缆连接到可正常工作的端口。 链路上光模块、光纤或以太网双绞线故障：通过更换完好的光模块、光纤或以太网双绞线定位是否光纤或以太网双绞线故障。如果是光模块、光纤或以太网双绞线故障，请更换完好的光模块、光纤或以太网双绞线。 对端配置问题，查看对端速率、双工模式的配置是否和本端一致。如果对端速率和双工模式的配置与本端不一致，请更新配置保证本端和对端速率和双工模式的配置一致。 当通过上述方法无法解决错包问题需要联系技术支持时，请先通过如下方法收集信息，然后前往步骤7。 Probe视图下，使用debugportmapping命令确认面板端口对应的芯片端口。 [Sysname-probe]debugportmappingslot1 [Interface][Unit][Port][Name][Combo?][Active?][IfIndex][MID][Link] =============================================================================== WGE1/0/109xe8nono0x11down WGE1/0/2010xe9nono0x21downWGE1/0/3011xe10nono0x31down WGE1/0/4012xe11nono0x41down WGE1/0/5013xe12nono0x51down WGE1/0/6014xe13nono0x61down WGE1/0/7015xe14nono0x71down WGE1/0/8016xe15nono0x81down WGE1/0/9017xe16nono0x91downWGE1/0/10018xe17nono0xa1downWGE1/0/11019xe18nono0xb1downWGE1/0/12020xe19nono0xc1downWGE1/0/13021xe20nono0xd1downWGE1/0/14022xe21nono0xe1downWGE1/0/15023xe22nono0xf1downWGE1/0/16024xe23nono0x101downWGE1/0/17025xe24nono0x111downWGE1/0/18026xe25nono0x121down WGE1/0/19027xe26nono0x131down WGE1/0/20028xe27nono0x141down ----More---- 查到Twenty-FiveGigE1/0/17对应的芯片端口名字为xe24，然后执行下面命令两次或两次以上，查看是否有接收丢包统计(RDBGC)和发送丢包统计(TDBGC)计数。如果有将相关信息反馈技术支持。 [Sysname-probe]bcmslot1chip0show/c/xe24 RDBGC3.xe24:5+5 RDBGC6.xe24:5+5 R64.xe24:19+19 R127.xe24:163+1631/sR255.xe24:10+10 R511.xe24:6+6 RPKT.xe24:198+1982/s RMCA.xe24:136+1361/s RBCA.xe24:62+62 RPOK.xe24:198+1982/sRBYT.xe24:21,392+21,392315/s [Sysname-probe]bcmslot1chip0show/c/xe24 R64.xe24:20+1 R127.xe24:168+52/s RPKT.xe24:204+62/sRMCA.xe24:141+52/s RBCA.xe24:63+1 RPOK.xe24:204+62/s RBYT.xe24:21,974+582261/s (3)报文因匹配ACL被过滤 a.检查端口、VLAN以及全局下是否配置了ACL或QoS策略，如果配置了ACL或QoS策略，请检查端口进入的报文是否因匹配了ACL或QoS策略的流分类而被丢弃，包括端口下的packet-filter（使用displaypacket-filter查看）、qospolicy（使用displayqospolicy查看），vlanpolicy（使用displayqosvlan-policy查看）以及globalpolicy（使用displayqospolicyglobal查看）。如果报文因匹配了ACL或QoS策略的流分类而被丢弃，请参考ACL或QoS的配置方法通过更新配置使报文不被丢弃。 b.检查是否因匹配一些特性自动创建的的ACL而被过滤，在以太网接口视图下使用displaythis命令查看端口下是否配置了下面特性或使用特性相关的具体命令查看： −端口是否配置ipsourcebinding或ipverifysource，使用displayipsourcebinding或displayipv6sourcebinding可以查看绑定表项信息。如果端口配置了ipsourceguard且通过上述display命令发现没有匹配报文的表项，请根据您使用的绑定表项的生成方法进一步排查。 −查看端口是否配置了Portal认证，如果配置了Portal认证，则没有通过Portal认证的用户，报文会被该端口丢弃。使用displayportalinterface可以显示指定VLAN接口的Portal配置信息。请用户根据实际情况确定是否可以取消Portal认证，在端口所属VLAN 的对应VLAN虚接口下使用undoportalserverserver-name可以取消三层Portal认证。 −使用displaydot1x命令查看端口是否使能了EAD快速部署。如果使能了802.1X的 EAD快速部署功能，那未认证成功的用户访问除FreeIP以外的网段时就会丢包。请定位用户是否是未认证成功用户，且未认证成功用户访问的是否是FreeIP以外的网段来进一步确认丢包原因。 −端口所在VLAN是否配置了MFF，使用displaymac-forced-forwardingvlan命令显示指定VLAN的MFF信息，如果显示信息中没有Gateway信息，请根据MFF运行的模式查看ARPSnooping是否正确配置。 (4)端口被协议设置为block状态 使用displaystpbrief命令查看端口是否被STP设置为discarding状态。如果端口被STP设置为discarding状态，请根据STP的相关配置进一步排查。H3C建议您将连接终端设备的端口配置为边缘端口或关闭该端口的STP功能。 如果端口属于某个聚合组，使用displaylink-aggregationverbose命令查看聚合口的详细信息，当该端口Status为Unselected状态时，该端口无法收发数据报文。请定位端口成为Unselected状态的原因，如聚合组内成员端口的属性类配置与参考端口不一致，进一步排查解决。 查看端口是否被Smartlink阻塞：使用displaysmart-linkgroup命令查看端口状态，当 State为STANDBY或DOWN时端口不能转发数据。如果State为DOWN，请定位端口成 为DOWN状态的原因，如上行链路上的设备配置了MonitorLink功能造成该端口DOWN， 或该端口所在链路连接发生故障或端口被shutdown，进一步排查解决；如果State为 STANDBY，请将该设备SmartLink组的主、从端口互换。 (5)配置相关丢包 在以太网接口视图下使用displaythis命令查看端口是否在报文所属VLAN中。如果端口不在报文所属VLAN中，请将端口加入该VLAN。 使用displaymac-addressblackhole命令查看是否因为匹配了黑洞MAC地址表项被丢包。请根据实际情况确定是否可以取消该黑洞MAC。如果需要删除该黑洞MAC，请使用undomac-addressblackholemac-addressvlanvlan-id命令删除。 使用displayqoslrinterface查看是否有端口限速的配置。如果端口有限速的配置，请查看令牌生成速度和突发流量配置值是否合理，可以通过使用qoslr{inbound| outbound}circommitted-information-rate[cbscommitted-burst-size]命令调整令牌生 成速度和突发流量配置值定位解决。 在以太网接口视图下使用displaythis命令查看端口是否有风暴抑制相关配置，包括广播风暴抑制比（broadcast-suppression），组播风暴抑制比（multicast-suppression），未知单播风暴抑制比（unicast-suppression）。如果端口下配置了风暴抑制比，可以通过将风暴抑制比的数值调大定位解决。 (6)拥塞丢包通过displayqosqueueinterface命令查看端口是否有拥塞丢包。请参考拥塞管理的相关内容定位解决拥塞问题。 (7)寻求技术支持 如果上述检查完成后故障仍无法排除，请联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志 无 4.1.2三层流量转发丢包 ",Suggestion not provided
设备加载软件包后重启时，无法正常启动,本类故障的常见原因为系统的BootWare版本与加载的软件包版本不匹配。 ,(1)在与Console口相连的PC上运行终端仿真程序，启动设备，然后通过登录过程中系统打印的如下信息确认系统的BootWare版本，然后执行第（2）步。 (2)请与H3C技术支持工程师确认系统的BootWare版本是否为最新版本： 如果系统的BootWare版本是最新版本，请执行第（8）步。 如果系统的BootWare版本不是最新版本，请从官网获取最新版本BootWare软件包，然后执行第(3）步。 (3)连接PC与设备的以太网接口，在PC上运行FTP/TFTPServer程序，并指定下载程序的文件路径，然后执行第（4）步。 (4)键入<0>退出到BootWare扩展段主菜单。在BootWare扩展段主菜单中，键入<7>，进入 BootWare操作子菜单，然后执行第（5）步。 ==========================<EXTENDED-BOOTWAREMENU>========================== |<1>BootSystem| |<2>EnterSerialSubMenu| |<3>EnterEthernetSubMenu||<4>FileControl||<5>RestoretoFactoryDefaultConfiguration||<6>SkipCurrentSystemConfiguration||<7>BootWareOperationMenu||<8>SkipAuthenticationforConsoleLogin||<9>StorageDeviceOperation||<0>Reboot| ============================================================================ Ctrl+Z:AccessEXTENDEDASSISTANTMENU Ctrl+C:DisplayCopyright Ctrl+F:FormatFileSystem Enteryourchoice(0-9):7 (5)在BootWare操作子菜单中，键入<4>，选择通过以太网口升级BootWare。然后执行第（6）步。 =========================<BootWareOperationMenu>==========================|Note:theoperatingdeviceisflash||<1>BackupFullBootWare| |<2>RestoreFullBootWare| |<3>UpdateBootWareBySerial| |<4>UpdateBootWareByEthernet| |<0>ExitToMainMenu| ============================================================================Enteryourchoice(0-4):4 (6)键入<4>，设置以太网口参数。然后执行第（7）步。 ===================<BOOTWAREOPERATIONETHERNETSUB-MENU>=================== |<1>UpdateFullBootWare| |<2>UpdateExtendedBootWare||<3>UpdateBasicBootWare||<4>ModifyEthernetParameter||<0>ExitToMainMenu| ============================================================================Enteryourchoice(0-4):4 (7)设置以太网口参数后，键入<1>，上传BootWare软件包。BootWare软件包上传完成后，键入<0>，退出到BootWare操作子菜单。再键入<0>，退出到BootWare扩展段主菜单。在BootWare扩展段主菜单中键入<0>，重新启动设备： 如果设备正常启动，则故障排除。 如果设备没有正常启动，请执行第（8）步。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.告警与日志相关告警 无 相关日志无 4.2.2设备无法正常加载软件包 
设备加载软件包后重启时，无法正常启动。 ,本类故障的常见原因为系统的BootWare版本与加载的软件包版本不匹配。 ,(1)在与Console口相连的PC上运行终端仿真程序，启动设备，然后通过登录过程中系统打印的如下信息确认系统的BootWare版本，然后执行第（2）步。 (2)请与H3C技术支持工程师确认系统的BootWare版本是否为最新版本： 如果系统的BootWare版本是最新版本，请执行第（8）步。 如果系统的BootWare版本不是最新版本，请从官网获取最新版本BootWare软件包，然后执行第(3）步。 (3)连接PC与设备的以太网接口，在PC上运行FTP/TFTPServer程序，并指定下载程序的文件路径，然后执行第（4）步。 (4)键入<0>退出到BootWare扩展段主菜单。在BootWare扩展段主菜单中，键入<7>，进入 BootWare操作子菜单，然后执行第（5）步。 ==========================<EXTENDED-BOOTWAREMENU>========================== |<1>BootSystem| |<2>EnterSerialSubMenu| |<3>EnterEthernetSubMenu||<4>FileControl||<5>RestoretoFactoryDefaultConfiguration||<6>SkipCurrentSystemConfiguration||<7>BootWareOperationMenu||<8>SkipAuthenticationforConsoleLogin||<9>StorageDeviceOperation||<0>Reboot| ============================================================================ Ctrl+Z:AccessEXTENDEDASSISTANTMENU Ctrl+C:DisplayCopyright Ctrl+F:FormatFileSystem Enteryourchoice(0-9):7 (5)在BootWare操作子菜单中，键入<4>，选择通过以太网口升级BootWare。然后执行第（6）步。 =========================<BootWareOperationMenu>==========================|Note:theoperatingdeviceisflash||<1>BackupFullBootWare| |<2>RestoreFullBootWare| |<3>UpdateBootWareBySerial| |<4>UpdateBootWareByEthernet| |<0>ExitToMainMenu| ============================================================================Enteryourchoice(0-4):4 (6)键入<4>，设置以太网口参数。然后执行第（7）步。 ===================<BOOTWAREOPERATIONETHERNETSUB-MENU>=================== |<1>UpdateFullBootWare| |<2>UpdateExtendedBootWare||<3>UpdateBasicBootWare||<4>ModifyEthernetParameter||<0>ExitToMainMenu| ============================================================================Enteryourchoice(0-4):4 (7)设置以太网口参数后，键入<1>，上传BootWare软件包。BootWare软件包上传完成后，键入<0>，退出到BootWare操作子菜单。再键入<0>，退出到BootWare扩展段主菜单。在BootWare扩展段主菜单中键入<0>，重新启动设备： 如果设备正常启动，则故障排除。 如果设备没有正常启动，请执行第（8）步。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.告警与日志相关告警 无 相关日志无 4.2.2设备无法正常加载软件包 
设备三层转发丢包，即发送端IP地址和目的端IP地址不在同一网段内，通信过程中有丢包。 ,"•端口出现故障 •ARP/路由表项不正确 3.故障分析 本类故障的诊断流程如图32所示。图32三层转发丢包故障诊断流程图 4.处理步骤 (1)检查端口是否有故障 根据4.1.1二层流量转发丢包的故障定位处理方法，定位是否是设备端口故障（包括端口硬件故障和端口配置故障）： 如果是端口故障，请按照4.1.1二层流量转发丢包的故障处理思路进行处理。 如果不是端口故障，则执行步骤2。 (2)查看ARP表项是否正确（IPv4） 如果三层转发基于IPv4协议，使用displayarp命令查看设备上是否学习到网关设备的ARP表项、学习到的ARP表项是否正确： 如果设备上未学习到ARP表项或学习到的表项错误，通过打开debuggingarppacket查看设备ARP表项学习情况，来定位ARP问题的原因。对于未学习到ARP表项，可以使用arpstatic命令手工添加静态ARP表项。 使用displaymac-address命令查看对应的MAC地址表项的出接口和ARP表项中的出接口是否一致，如果不一致，使用reset命令清除ARP表项，让设备重新学习表项。 如果设备上ARP表项学习正确，请执行步骤3。 (3)查看ND表项是否正确（IPv6）如果三层转发基于IPv6协议，使用displayipv6neighbors命令查看设备上是否学习 到网关设备的ND表项、学习到的ND表项是否正确： 如果设备上未学习到ND表项或学习到的表项错误，通过打开debuggingipv6icmp查看设备ND表项学习情况，来定位ND问题的原因。同时，检查两端MAC地址是否相同,或者是否配置了组播MAC地址。如果都检查无误，对于未学习到ND表项，可以使用ipv6neighbor命令手工添加静态ND表项。 使用displaymac-address命令查看对应的MAC地址表项的出接口和ND表项中的与 邻居相连接口是否一致，如果不一致，使用resetipv6neighbors命令清除ND表项， 让设备重新学习表项。 如果设备上ND表项学习正确，请执行步骤4。 (4)查看路由表项是否正确 使用displayiprouting-table命令查看设备上学习的路由信息是否正确： 如果设备上学习到的路由信息不正确，请根据您使用的具体的路由协议进行进一步排查。 使用displayfib命令查看对应的FIB表项的出接口和路由表项中的出接口是否一致，如果不一致，使用reset命令清除路由表项，让设备重新学习表项。 如果设备上的路由信息正确，请执行步骤4。 (5)寻求技术支持 如果上述检查完成后故障仍无法排除，请联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志无 4.1.3因协议报文丢包导致的协议震荡 ",Suggestion not provided
设备上电启动时，配置终端无显示或显示乱码。 ,本类故障的常见原因主要包括： •电源工作异常。 •主控板工作异常。 •配置电缆未连接到设备/主控板的配置口。 •配置终端参数设置错误。 •配置电缆故障。 3.故障分析 本类故障的诊断流程如图1所示： 图1故障诊断流程图 4.处理步骤 (1)检查电源工作是否正常。 如果电源模块指示灯状态异常，请参考电源故障处理章节进行处理。 (2)检查主控板工作是否正常。 如果主控板指示灯状态异常，请参考主控板故障处理章节进行处理。 (3)检查配置电缆是否已经连接到设备/主控板的配置口。 (4)检查配置终端COM口连接是否正确，实际选择的串口与终端设置的串口要一致，串口参数设置是否正确。 串口参数如下：波特率为9600，数据位为8，奇偶校验为无，停止位为1，流量控制为无，选择终端仿真为VT100。不同设备配置的串口参数请以设备实际情况为准。 (5)更换配置电缆。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警 无 相关日志无 3.1.2设备异常重启 ,Suggestion not provided
设备升级以后，用户终端能够Ping通设备，也可以远程Telnet登录设备，但是重新通过Web进行登录时，Web界面上会弹出一个错误提示对话框，提示“功能函数执行错误”,这个问题是由于用户没有清除浏览器缓存所致。由于两个不同的软件版本的Web界面可能存在着差异，重新用Web登录以后，浏览器里面缓存的信息与新版本的Web信息不兼容。 3.故障处理步骤 (1)清理浏览器缓存后，重新登录Web。 (2)如果故障仍然未能排除，请联系技术工程师。 4软件类故障处理 4.1登录设备类故障处理 4.1.1Console口密码遗忘 ,Suggestion not provided
设备升级以后，用户终端能够Ping通设备，也可以远程Telnet登录设备，但是重新通过Web进行登录时，Web界面上会弹出一个错误提示对话框，提示“功能函数执行错误”。 ,这个问题是由于用户没有清除浏览器缓存所致。由于两个不同的软件版本的Web界面可能存在着差异，重新用Web登录以后，浏览器里面缓存的信息与新版本的Web信息不兼容。 3.故障处理步骤 (1)清理浏览器缓存后，重新登录Web。 (2)如果故障仍然未能排除，请联系技术工程师。 4软件类故障处理 4.1登录设备类故障处理 4.1.1Console口密码遗忘 ,Suggestion not provided
设备收到对端设备发送到ARP请求报文后，不回应ARP应答报文,"本类故障的常见原因主要包括： •接口收到的ARP请求报文的目的IP不是本机IP。 •端设备发送的ARP请求报文触发了本端的源MAC地址固定的ARP攻击检测功能。 3.故障分析 本类故障的诊断流程如图4-10所示。图4-10不回应ARP请求报文故障诊断流程图 4.处理步骤 (1)查看ARP报文信息，确认ARP报文是否已上送到CPU处理。 a.先通过debuggingarppacket命令打开ARP的报文调试信息开关，再触发对端设备 向本端发送ARP请求报文。 <Sysname>debuggingarppacket <Sysname>*Apr2117:38:05:4892022SysnameARP/7/ARP_RCV:-MDC=1;ReceivedanARPmessage,operation:1,senderMAC:68cb-9c3f-0206,senderIP:1.1.1.2,targetMAC:0000-0000-0000,targetIP:1.1.1.1 如果“targetIP”不是本机IP，请检查对端设备的路由表和转发表。 如果“targetIP”是本机IP，请执行步骤b。 b.通过debuggingarperror命令打开ARP的错误调试信息开关，根据表4-3中的内容 确认设备不回应ARP报文的原因。 表4-3debuggingarperror命令显示信息描述表 字段描述 Packetdiscardedforthenetworkstateofreceivinginterfaceisdown.接收接口网络层状态down，报文被丢弃 PacketdiscardedfortheARPpacketistooshort.ARP报文长度太短，报文被丢弃 PacketdiscardedfortheARPpacketiserror.ARP报文错误，报文被丢弃 Packetdiscardedforthelinkstateoftheportisdown.端口链路层状态down，报文被丢弃 PacketdiscardedforthesenderIPisinvalid.报文源IP地址无效，报文被丢弃 PacketdiscardedforthesenderIPisabroadcastIP.报文源IP地址为广播IP，报文被丢弃 PacketdiscardedforthetargetIPisinvaild.报文请求的IP地址无效，报文被丢弃 PacketdiscardedforthetargetIPisabroadcastIP.报文请求的IP地址为广播IP，报文被丢弃 FailedtogetthesourceMACoftheARPreply.获取应答报文的源MAC失败 PacketdiscardedforthesourceMACisamulticastaddress.源MAC是组播MAC，报文被丢弃 PacketdiscardedforthesourceMACisabroadcastaddress.源MAC是广播MAC，报文被丢弃 PacketdiscardedforthesenderMACaddressisthesameasthereceivinginterface.源MAC和接口MAC相同，报文被丢弃 PacketdiscardedforthenumberofARPentriesreachesthelimit.ARP表项数目达到上限，报文被丢弃 PacketdiscardedforthetypeofreceivinginterfaceisL2VE.报文入端口是L2VE口，报文被丢弃 Packetdiscardedforconflictwithstaticentry.和静态配置冲突，报文被丢弃 Packetdiscardedformemoryalarmnotification.设备内存告警，报文被丢弃 Packetdiscardedforinsufficientresources.设备资源不足，导致ARP报文处理失败，报文被丢弃 (2)查看对端设备的MAC是否被加入攻击表项中。以本端接口GigabitEthernet1/0/1为例，通过displayarpsource-mac命令显示检测到的源MAC地址固定的ARP攻击检测表项。 <Sysname>displayarpsource-macinterfacegigabitethernet1/0/1 Source-MACVLAN/VSInameInterfaceAging-time(sec)23f3-1122-33444094GE1/0/110 如果存在源MAC地址固定的ARP攻击检测表项，且表项的MAC地址是对端设备的MAC地址，请根据业务情况通过arpsource-macthreshold命令配置源MAC地址固定的 ARP报文攻击检测阈值。 如果不存在对端设备MAC地址对应的源MAC地址固定的ARP攻击检测表项，请执行（3）。 (3)通过debuggingarpentry命令打开ARP表项状态调试信息开关，查看ARP表项的状态，收集ARP表项状态相关日志，发送给H3C技术支持工程师。 <Sysname>debuggingarpentry <Sysname>ping-c1192.168.111.188 PING192.168.111.188(192.168.111.188):56databytes,pressCTRL_Ctobreak 56bytesfrom192.168.111.188:icmp_seq=0ttl=128time=1.000ms ---192.168.111.188pingstatistics--- 1packet(s)transmitted,1packet(s)received,0.0%packetlossround-tripmin/avg/max/std-dev=1.000/1.000/1.000/0.000ms *Dec1714:28:34:7622012SysnameARP/7/ARP_ENTRY:-MDC=1;ARPentrystatusch anged:MACaddress:000a-eb83-691e,IPaddress:192.168.111.188,INITIALIZE->NO_AGE 表4-4debuggingARPentry命令显示信息描述表 字段描述 ARPentrystatuschangedARP表项发生变化 MACaddressARP表项的MAC地址 IPaddressARP表项的IP地址 state1->state2从状态state1迁移到状态state2，共有四种状态： •INITIALIZE：未解析状态 •NO_AGE：不老化状态 •AGING：老化处理状态 •AGED：老化待删除状态 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.7NTP故障处理 4.7.1NTP时钟未同步故障处理 ",Suggestion not provided
设备收到对端设备发送到ARP请求报文后，不回应ARP应答报文。 ,"本类故障的常见原因主要包括： •接口收到的ARP请求报文的目的IP不是本机IP。 •端设备发送的ARP请求报文触发了本端的源MAC地址固定的ARP攻击检测功能。 3.故障分析 本类故障的诊断流程如图4-10所示。图4-10不回应ARP请求报文故障诊断流程图 4.处理步骤 (1)查看ARP报文信息，确认ARP报文是否已上送到CPU处理。 a.先通过debuggingarppacket命令打开ARP的报文调试信息开关，再触发对端设备 向本端发送ARP请求报文。 <Sysname>debuggingarppacket <Sysname>*Apr2117:38:05:4892022SysnameARP/7/ARP_RCV:-MDC=1;ReceivedanARPmessage,operation:1,senderMAC:68cb-9c3f-0206,senderIP:1.1.1.2,targetMAC:0000-0000-0000,targetIP:1.1.1.1 如果“targetIP”不是本机IP，请检查对端设备的路由表和转发表。 如果“targetIP”是本机IP，请执行步骤b。 b.通过debuggingarperror命令打开ARP的错误调试信息开关，根据表4-3中的内容 确认设备不回应ARP报文的原因。 表4-3debuggingarperror命令显示信息描述表 字段描述 Packetdiscardedforthenetworkstateofreceivinginterfaceisdown.接收接口网络层状态down，报文被丢弃 PacketdiscardedfortheARPpacketistooshort.ARP报文长度太短，报文被丢弃 PacketdiscardedfortheARPpacketiserror.ARP报文错误，报文被丢弃 Packetdiscardedforthelinkstateoftheportisdown.端口链路层状态down，报文被丢弃 PacketdiscardedforthesenderIPisinvalid.报文源IP地址无效，报文被丢弃 PacketdiscardedforthesenderIPisabroadcastIP.报文源IP地址为广播IP，报文被丢弃 PacketdiscardedforthetargetIPisinvaild.报文请求的IP地址无效，报文被丢弃 PacketdiscardedforthetargetIPisabroadcastIP.报文请求的IP地址为广播IP，报文被丢弃 FailedtogetthesourceMACoftheARPreply.获取应答报文的源MAC失败 PacketdiscardedforthesourceMACisamulticastaddress.源MAC是组播MAC，报文被丢弃 PacketdiscardedforthesourceMACisabroadcastaddress.源MAC是广播MAC，报文被丢弃 PacketdiscardedforthesenderMACaddressisthesameasthereceivinginterface.源MAC和接口MAC相同，报文被丢弃 PacketdiscardedforthenumberofARPentriesreachesthelimit.ARP表项数目达到上限，报文被丢弃 PacketdiscardedforthetypeofreceivinginterfaceisL2VE.报文入端口是L2VE口，报文被丢弃 Packetdiscardedforconflictwithstaticentry.和静态配置冲突，报文被丢弃 Packetdiscardedformemoryalarmnotification.设备内存告警，报文被丢弃 Packetdiscardedforinsufficientresources.设备资源不足，导致ARP报文处理失败，报文被丢弃 (2)查看对端设备的MAC是否被加入攻击表项中。以本端接口GigabitEthernet1/0/1为例，通过displayarpsource-mac命令显示检测到的源MAC地址固定的ARP攻击检测表项。 <Sysname>displayarpsource-macinterfacegigabitethernet1/0/1 Source-MACVLAN/VSInameInterfaceAging-time(sec)23f3-1122-33444094GE1/0/110 如果存在源MAC地址固定的ARP攻击检测表项，且表项的MAC地址是对端设备的MAC地址，请根据业务情况通过arpsource-macthreshold命令配置源MAC地址固定的 ARP报文攻击检测阈值。 如果不存在对端设备MAC地址对应的源MAC地址固定的ARP攻击检测表项，请执行（3）。 (3)通过debuggingarpentry命令打开ARP表项状态调试信息开关，查看ARP表项的状态，收集ARP表项状态相关日志，发送给H3C技术支持工程师。 <Sysname>debuggingarpentry <Sysname>ping-c1192.168.111.188 PING192.168.111.188(192.168.111.188):56databytes,pressCTRL_Ctobreak 56bytesfrom192.168.111.188:icmp_seq=0ttl=128time=1.000ms ---192.168.111.188pingstatistics--- 1packet(s)transmitted,1packet(s)received,0.0%packetlossround-tripmin/avg/max/std-dev=1.000/1.000/1.000/0.000ms *Dec1714:28:34:7622012SysnameARP/7/ARP_ENTRY:-MDC=1;ARPentrystatusch anged:MACaddress:000a-eb83-691e,IPaddress:192.168.111.188,INITIALIZE->NO_AGE 表4-4debuggingARPentry命令显示信息描述表 字段描述 ARPentrystatuschangedARP表项发生变化 MACaddressARP表项的MAC地址 IPaddressARP表项的IP地址 state1->state2从状态state1迁移到状态state2，共有四种状态： •INITIALIZE：未解析状态 •NO_AGE：不老化状态 •AGING：老化处理状态 •AGED：老化待删除状态 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.7NTP故障处理 4.7.1NTP时钟未同步故障处理 ",Suggestion not provided
设备收到对端设备发送到NS报文后，不回应NA报文。 ,"本类故障的常见原因主要包括： •接口收到的NS报文的目的IPv6地址不是本机IPv6地址。 •对端设备触发了源MAC地址固定的ND攻击检测功能。 •对端设备触发了NDDetection功能。 3.故障分析 本类故障的诊断流程如图63所示。 图63不回应NS报文故障诊断流程图 4.处理步骤 (1)查看ARP报文信息，确认ARP报文是否已上送。 a.先通过debuggingipv6packet命令用来打开ND的报文调试信息开关，再使用对端 设备向本端发送NS报文。 <Sysname>debuggingipv6packet *Apr2613:33:34:8972022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Receiving,interface=GigabitEthernet1/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::2,Dst=1::1,prompt:ReceivedanIPv6packet. 如果“Dst”不是本机IPv6地址，请检查对端设备的路由表和转发表。 b().通过debugging(如果“Dst”是本机)ipv6error命(IP，请执行b。)令用来打开ND的错误调试信息开关，根据表10中的 内容确认设备不回应ND报文的原因。 表10debuggingipv6error命令输出信息描述表 (2)以本端接口接口GigabitEthernet1/0/1为例，通过displayipv6ndsource-mac命令显 示检测到的源MAC地址固定的ND攻击检测表项，查看对端设备的MAC是否被加入攻击表项中。 <Sysname>displayipv6ndsource-macinterfacegigabitethernet1/0/1 SourceMACVLANIDInterfaceAgingtime(sec)Packetsdropped 23f3-1122-33444094GE1/0/11084467 如果存在源MAC地址固定的ND攻击检测表项，且表项的MAC地址是对端设备的MAC地址，请根据业务情况通过ipv6ndsource-macthreshold命令配置源MAC地址固定的ND报文攻击检测阈值。 如果不存在对端设备MAC地址对应的源MAC地址固定的ND攻击检测表项，请执行(3)。 (3)通过displayipv6nddetectionstatistics命令显示NDDetection丢弃ND报文的统计信息，查看对端设备是否触发了NDDetection功能。 <Sysname>displayipv6nddetectionstatistics NDpacketsdroppedbyNDdetection:InterfacePacketsdropped GE1/0/178 如果与对端设备相连的接口丢弃的报文不为0，请检查NDDetection相关配置。 如果与对端设备相连的接口丢弃的报文为0，请执行(4)。 (4)通过displaysysteminternalarpstatistics命令显示各单板的ARP统计信息， (5)收集“Errorstatistics”字段中的内容，发送给systeminternalndstatistics(H3C技术支持工程师。以slot1为例，通过display)命令显示各单板的ND统计信息，确认是否有单板发生故障。 [Sysname-probe]displaysysteminternalndstatisticsslot1 Entrystatistics: Valid:1Dummy:0Packet:1OpenFlow:0Longstatic:0Shortstatic:0Tempnode:0Rule:0 Staticstatistics: Short:0Longinterface:0 Longport:0 Processstatistics: Input:7Resolving:11 Errorstatistics: Memory:0Sync:0Packet:0Parameter:0Anchor:0Getaddress:0RefreshFIB:0DeleteFIB:0RealtimeSync:0Tempnode:0 Exceedlimit:0Refreshrule:0Deleterule:0Smoothrulestart:0 Smoothruleend:0RA:0Origin:0FinalRA:0 通过“Input”字段查看单板是否正常的接收ND报文。 收集“Errorstatistics”字段中的内容，发送给H3C技术支持工程师。 (6)请收集如下信息，并联系H3C技术支持工程师。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 9.2.3已有ND表项但无法转发流量 ",Suggestion not provided
设备突发或反复重启,本类故障的常见原因包括三大类：设备掉电重启、人为重启、软件重启。 3.故障分析 不同的重启原因对应不同的排查方法，所以无线接入点重启的排查思路首先是定位重启原因，然后根据重启类型进行具体分析。 •设备掉电重启的主要原因包括：连接线缆异常和供电设备异常。 •人为重启的主要原因包括： 人为通过RESET按钮重启设备。 人为通过命令行、SNMP、Web等管理手段重启设备。 AP长时间未在AC上注册。 •软件重启的主要原因包括内核异常、内存泄漏、看门狗重启和版本自动升级等。 4.处理步骤 •在AC上通过displaywlana(查看AP重启原因的方法一般有两种：)pnameap-nameverbose命令查看AP的详细信息，通过Lastrebootreason显示字段定位AP重启原因。 <Sysname>displaywlanapnameap1verbose APname:ap1 APID:1 APgroupname:default-group State:Run Backuptype:Master Onlinetime:0days1hours25minutes12secondsSystemuptime:0days2hours22minutes12seconds Model:WA6320 Regioncode:CN Regioncodelock:Disable SerialID:219801A28N819CE0002T MACaddress:0AFB-423B-893C IPaddress:192.168.1.50UDPcontrolportnumber:18313 UDPdataportnumber:N/A H/Wversion:Ver.CS/Wversion:E2321Bootversion:1.01 显示信息略…… Sentcontrolpackets:1 Receivedcontrolpackets:1 Echorequests:147 Lostechoresponses:0 Averageechodelay:3 Lastrebootreason:Usersoftreboot Lastrebootreason(APcheck):Theradiophysicalstatuswasdown Lastrebootreason(ACcheck):Theradiophysicalstatuswasdown •Console通过(显示信息略……)方式登录AP，在Probe视图下通过diagboot-infodisplay命令查看设备最近10次的重启时间和原因。 <Sysname>system-view SystemView:returntoUserViewwithCtrl+Z.[Sysname]probe [Sysname-probe]diagboot-infodisplay ****************************************************************************** PowerOnBootTimes:19 WatchdogBootTimes:0 SoftwareBootTimes:262 HardwareBootTimes:1 MotherBoardBootTimes:0 BackupBootTimes:0 SlotOutBootTimes:0 CurrentBootType:Hardware-bootCurrentRunningTime:120(s) RunningTime:83(d)0(h) ***BootHistory(StartupTimeandReason)*** 2022-07-1102:05:19(GMT+0)Hardreboot 2022-07-1102:05:19(GMT+0)Poweron 2022-07-1102:05:19(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:55:14(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:45:09(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:35:04(GMT+0)Poweron 2022-07-1101:35:04(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:24:59(GMT+0)Poweron 2022-07-1101:24:59(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:14:54(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) AP常见的重启原因如表6-1所示。 表6-1AP常见重启原因 字段重启原因排查方式 PoweronAP设备上电重启，即AP掉电后重新上电6.4设备掉电重启 Hardreboot硬重启，即使用RESRT按钮重启AP设备6.5人为重启 Usersoftreboot•通过命令行、SNMP、Web等管理手段重启设备 •AP长时间未在AC上注册 Watchdogreboot看门狗重启6.6软件重启 Unknownreboot未知原因重启 Kernelexceptionsoftreboot内核异常重启 Kerneldeadloopsoftreboot内核死循环重启 Autoupdatesoftreboot版本自动升级 Unknownsoftreboot未知软件原因 Memoryexhausted内存耗尽 Otherunknownsoftreboot其他原因 6.4设备掉电重启 ,Suggestion not provided
设备突发或反复重启，用户无法定位AP重启原因。 ,本类故障的常见原因包括三大类：设备掉电重启、人为重启、软件重启。 3.故障分析 不同的重启原因对应不同的排查方法，所以无线接入点重启的排查思路首先是定位重启原因，然后根据重启类型进行具体分析。 •设备掉电重启的主要原因包括：连接线缆异常和供电设备异常。 •人为重启的主要原因包括： 人为通过RESET按钮重启设备。 人为通过命令行、SNMP、Web等管理手段重启设备。 AP长时间未在AC上注册。 •软件重启的主要原因包括内核异常、内存泄漏、看门狗重启和版本自动升级等。 4.处理步骤 •在AC上通过displaywlana(查看AP重启原因的方法一般有两种：)pnameap-nameverbose命令查看AP的详细信息，通过Lastrebootreason显示字段定位AP重启原因。 <Sysname>displaywlanapnameap1verbose APname:ap1 APID:1 APgroupname:default-group State:Run Backuptype:Master Onlinetime:0days1hours25minutes12secondsSystemuptime:0days2hours22minutes12seconds Model:WA6320 Regioncode:CN Regioncodelock:Disable SerialID:219801A28N819CE0002T MACaddress:0AFB-423B-893C IPaddress:192.168.1.50UDPcontrolportnumber:18313 UDPdataportnumber:N/A H/Wversion:Ver.CS/Wversion:E2321Bootversion:1.01 显示信息略…… Sentcontrolpackets:1 Receivedcontrolpackets:1 Echorequests:147 Lostechoresponses:0 Averageechodelay:3 Lastrebootreason:Usersoftreboot Lastrebootreason(APcheck):Theradiophysicalstatuswasdown Lastrebootreason(ACcheck):Theradiophysicalstatuswasdown •Console通过(显示信息略……)方式登录AP，在Probe视图下通过diagboot-infodisplay命令查看设备最近10次的重启时间和原因。 <Sysname>system-view SystemView:returntoUserViewwithCtrl+Z.[Sysname]probe [Sysname-probe]diagboot-infodisplay ****************************************************************************** PowerOnBootTimes:19 WatchdogBootTimes:0 SoftwareBootTimes:262 HardwareBootTimes:1 MotherBoardBootTimes:0 BackupBootTimes:0 SlotOutBootTimes:0 CurrentBootType:Hardware-bootCurrentRunningTime:120(s) RunningTime:83(d)0(h) ***BootHistory(StartupTimeandReason)*** 2022-07-1102:05:19(GMT+0)Hardreboot 2022-07-1102:05:19(GMT+0)Poweron 2022-07-1102:05:19(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:55:14(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:45:09(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:35:04(GMT+0)Poweron 2022-07-1101:35:04(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:24:59(GMT+0)Poweron 2022-07-1101:24:59(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) 2022-07-1101:14:54(GMT+0)Usersoftreboot(Stayedinidlestateforalongtime) AP常见的重启原因如表6-1所示。 表6-1AP常见重启原因 字段重启原因排查方式 PoweronAP设备上电重启，即AP掉电后重新上电6.4设备掉电重启 Hardreboot硬重启，即使用RESRT按钮重启AP设备6.5人为重启 Usersoftreboot•通过命令行、SNMP、Web等管理手段重启设备 •AP长时间未在AC上注册 Watchdogreboot看门狗重启6.6软件重启 Unknownreboot未知原因重启 Kernelexceptionsoftreboot内核异常重启 Kerneldeadloopsoftreboot内核死循环重启 Autoupdatesoftreboot版本自动升级 Unknownsoftreboot未知软件原因 Memoryexhausted内存耗尽 Otherunknownsoftreboot其他原因 6.4设备掉电重启 ,Suggestion not provided
设备无法学习到ARP表项，导致设备无法正常转发流量 ,"本类故障的常见原因主要包括： •内存不足导致无法学习到ARP表项。 •接口物理层未正常Up。 •接口下配置的IP地址与对端接口不在同一网段。 •ARP报文未上送到CPU。 •CPU繁忙导致ARP报文被丢弃。 3.故障分析 本类故障的诊断流程如图4-9所示。 图4-9无法学习到ARP表项的故障诊断流程图 4.处理步骤 (1)通过displaymemory-threshold命令查看是否由于内存不足导致无法学习到ARP表项。 <Sysname>displaymemory-threshold Memoryusagethreshold:100% Free-memorythresholds: Minor:96M Severe:64M Critical:48M Normal:128M Early-warning:256M Secure:304M Currentfree-memorystate:Normal(secure) 若系统当前内存使用状态（Currentfree-memorystate）为“Normal”或“Normal(secure)”，请继续执行第（2）步。 若系统当前内存使用状态（Currentfree-memorystate）为“Minor”、“Severe”、“Critical”或“Normal(early-warning)”，请检查设备内存的使用情况并排查内存不足问题。 (2)查看网络配置以及接口状态。 依次检查如下配置： a.通过displayinterface命令查看接口是否处于UP状态。如果接口没有处于UP状态， b.displayfib通过ip-add(请排查物理接口故障问题。)ress命令查看FIB表项的信息，ip-address为ARP表项的IP地址。如果不存在对应的FIB表项，则说明可能路由模块发生故障，请检查路由模块配置并排查问题。如果FIB表存在且转发的下一跳地址不是直连下一跳地址，则需检查设 c.displayipinterface通过命(备与转发下一跳地址的连接情况。)令查看接口的IP地址： −本端接口的IP地址是否与对端接口在同一网段。如果两端接口的IP地址不在同一网段，请在接口视图下执行ipaddress命令修改两端的IP地址，使其在同一网段。 −本端接口的IP地址是否与对端接口的IP地址发生冲突。如果两端接口的IP地址发生冲突，请在接口视图下执行ipaddress命令修改两端的IP地址，使冲突消失。 −查看对端接口是否为转发的下一跳所在的接口。 d.通过ping命令检查链路是否存在故障。 (3)检查ARP报文是否正常收发。 a.先通过debuggingarppacket命令打开ARP的报文调试信息开关，再通过ping命 令查看设备是否正常发送和接收ARP报文。 <Sysname>debuggingarppacket <Sysname>ping–c11.1.1.2 Ping1.1.1.2(1.1.1.2):56databytes,pressCTRL+Ctobreak 56bytesfrom1.1.1.2:icmp_seq=0ttl=255time=2.511ms ---Pingstatisticsfor1.1.1.2--- 1packet(s)transmitted,1packet(s)received,0.0%packetlossround-tripmin/avg/max/std-dev=2.511/2.511/2.511/nanms <Sysname>*Apr1817:28:22:8792022SysnameARP/7/ARP_SEND:-MDC=1;SentanARPmessage,operation:1,senderMAC:68cb-978f-0106,senderIP:1.1.1.1,targetMAC: 0000-0000-0000,targetIP:1.1.1.2 以上信息表示设备成功发送一个ARP请求报文，目标IP地址为1.1.1.2，源IP地址为 ",Suggestion not provided
设备无法学习到ND表项，导致设备无法正常转发流量 ,"本类故障的常见原因主要包括： •内存不足导致无法学习到ND表项。 •接口物理层未正常Up。 •接口下配置的IPv6地址与对端接口不在同一网段。 •ND报文未上送到CPU。 •CPU繁忙导致ARP报文被丢弃。 3.故障分析 本类故障的诊断流程如图4-8所示。 图4-8ND表项学习失败的故障诊断流程图 4.处理步骤 (1)通过displaymemory-threshold命令查看是否由于内存不足导致无法学习到ND表项。 <Sysname>displaymemory-threshold Memoryusagethreshold:100% Free-memorythresholds: Minor:96M Severe:64M Critical:48M Normal:128M Early-warning:256M Secure:304M Currentfree-memorystate:Normal(secure) 若系统当前内存使用状态（Currentfree-memorystate）为“Normal”或“Normal(secure)”，请继续执行第（2）步。 若系统当前内存使用状态（Currentfree-memorystate）为“Minor”、“Severe”、“Critical”或“Normal(early-warning)”，请检查设备内存的使用情况并排查内存不足问题。 (2)查看网络配置以及接口状态。 依次检查如下配置： a.通过displayinterface命令查看接口是否处于UP状态。如果接口没有处于UP状态， b.displayipv6fib通过(请排查物理接口故障问题。)ipv6-address命令查看IPv6FIB表项的信息， ipv6-address为ND表项的IPv6地址。如果不存在对应的IPv6FIB表项，则说明可能路由管理模块发生故障，请检查路由模块配置并排查问题。如果IPv6FIB表中存在且转发的下一跳地址不是直连下一跳地址，则需检查设备与转发下一跳地址的连接情况。 c.通过displayipv6interface命令查看接口的的IPv6地址： −本端接口的IPv6地址是否与对端接口在同一网段。如果两端接口的IPv6地址不在同一网段，请在接口视图下执行ipv6address命令修改两端的IPv6地址，使其在同一网段。 −本端接口的IPv6地址是否与对端接口的IPv6地址发生冲突。如果两端接口的IPv6地址发生冲突，请在接口视图下执行ipv6address命令修改两端的IPv6地址，使冲突消失。 −查看对端接口是否为转发的下一跳所在的接口。 d.通过pingipv6命令检查链路是否存在故障。 (3)检查IPv6报文是否正常收发。 a.先通过debuggingipv6packet命令打开IPv6的报文调试信息开关，再通过ping ipv6命令查看设备是否正常发送和接收IPv6报文。 <Sysname>debuggingipv6packet <Sysname>pingipv6-c11::2 Ping6(56databytes)1::1-->1::2,pressCTRL+Ctobreak *Apr2611:37:33:4022022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1;LocalSending,version=6,trafficclass=0, flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::1,Dst=1::2,prompt:OutputanIPv6Packet. *Apr2611:37:33:4022022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Sending,interface=GigabitEthernet1/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::1,Dst=1::2,prompt:SendingthepacketfromlocalinterfaceGigabitEthernet1/0/1. 以上信息表示设备在接口GigabitEthernet1/0/1上成功发送一个IPv6报文。 *Apr2611:37:33:4022022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1;LocalSending,version=6,trafficclass=224, flowlabel=0,payloadlength=32,protocol=58,hoplimit=255,Src=1::1,Dst=ff02::1:ff00:2,prompt:OutputanIPv6Packet. *Apr2611:37:33:4022022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Sending,interface=GigabitEthernet1/0/1,version=6,trafficclass=224,flowlabel=0,payloadlength=32,protocol=58,hoplimit=255,Src=1::1,Dst=ff02::1:ff00:2,prompt:SendingthepacketfromlocalinterfaceGigabitEthernet1/0/1. 56bytesfrom1::2,icmp_seq=0hlim=64time=19.336ms ---Ping6statisticsfor1::2--- 1packet(s)transmitted,1packet(s)received,0.0%packetlossround-tripmin/avg/max/std-dev=19.336/19.336/19.336/0.000ms<Sysname>*Apr2611:37:33:4212022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1;Receiving,interface=GigabitEthernet1/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::2,Dst=1::1,prompt:ReceivedanIPv6packet.以上信息表示设备接收到IPv6报文。 *Apr2611:37:33:4212022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Delivering,interface=GigabitEthernet1/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::2,Dst=1::1,prompt:DeliveringtheIPv6packettotheupperlayer.以上信息表示设备将接收到的IPv6报文上送到CPU处理。 %Apr2611:37:33:4222022SysnamePING/6/PING_STATISTICS:-MDC=1;Ping6statisticsfor1::2:1packet(s)transmitted,1packet(s)received,0.0%packetloss,round-tripmin/avg/max/std-dev=19.336/19.336/19.336/0.000ms. 若设备成功的发送和接收了IPv6报文，请继续执行第步。 若设备没有成功的发送和接收IPv6报文，请执行第4.6.14.(3)b步。 b.通过debuggingipv6error命令用来打开IPv6报文的错误调试信息开关，根据。表4-2中的内容确认设备无法成功发送或接收IPv6报文的原因。 表4-1debuggingipv6error命令输出信息描述表 字段描述 NumberofIPv6fragmentsexceededthethreshold.分片报文的数量超过了限制 NumberofIPv6reassemblyqueuesexceededthethreshold.重组队列的数量超过了限制 InvalidIPv6packet.IPv6报文非法 Failedtoprocessthehop-by-hopextensionheader.处理报文中逐跳扩展头失败 Failedtoprocessthehop-by-hopoption.处理报文中逐跳选项失败 Thepacketwasdiscardedbyservices.业务禁止报文 Thepacketwasadministrativelydiscarded.IPv6报文被管理禁止 (4)确认是否由于CPU繁忙导致ND报文被丢弃。通过view命令查看系统目录/proc/kque下的ND的相关内容，确认ND报文的丢弃情况及丢弃原因。 [Sysname-probe]view/proc/kque|inND 0:dd0e0a00ARP_SEND1024/0/0/0(0x4b515545) 0:dd0e6d00ND_TIMER1024/0/5/0(0x4b515545) 0:dd0e6e00ND_SINGLEEVENT1/0/0/0(0x4b515545) 0:dd0e6f00ND_MACNOTIFYEVENT1/0/0/0(0x4b515545) 0:dcec4000ND_RULE4096/0/0/0(0x4b515545) 0:dcec4200ND_MICROSEGMENT2048/0/0/0(0x4b515545) 0:dcec4300ND_MACNOTIFY2048/0/0/0(0x4b515545) 0:dcec4400ND_MAC_EVENT1/0/0/0(0x4b515545) 0:d2da7800OVERLAY_VNDEL1/0/0/0(0x4b515545) 0:ca5f3800FIB6NDHRQ1/0/0/0(0x4b515545) 0:ca3f7600ND_VSISUP_PKT4096/0/0/0(0x4b515545) 0:ca3f7400NDSNP_PKT4096/0/0/0(0x4b515545) 0:ca3f7700NDRAPG_PKT4096/0/0/0(0x4b515545)0:ca3f7800ND_EVENT8192/0/1/0(0x4b515545) 0:ca3f7900ND_PKT4096/0/1/0(0x4b515545) 查看以上Probe信息中的“ND_PKT”字段，该字段取值表示“depth/cursize/max/drops”： “depth”为队列的容量，为固定值。 “cursize”为当前队列的长度。 “max”为队列的历史最大长度。“drops”为队列中丢弃的ARP报文的个数。当“drops”不为0且“max”的值与“depth”相同时，说明因CPU繁忙导致ND报文被丢弃。如果“drops”为0，请执行第（5）步。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 无 4.6ARP故障处理 4.6.1无法学习到ARP表项 ",Suggestion not provided
设备无法正常加载软件包，导致无法升级,本类故障的常见原因主要为软件包损坏。 ,(1)在用户视图下通过md5sum命令来使用MD5摘要算法计算设备上待加载软件包的摘要值。 <Sysname>md5sumflash:/startup-a2105.ipe MD5digest: f2054bc35cd13bf84038bd10fc7a3efd (2)在官网或H3C技术支持工程师处获得待加载软件包的标签，请自行获取MD5工具（利用搜索引擎或其他渠道），使用MD5工具计算标签的摘要值。 (3)将设备上待加载软件包的摘要值和标签的摘要值比较： 如果两者一致，则说明软件包没有被损坏，请执行第（4）步。 如果两者不一致，则说明软件包被损坏，请联系H3C技术支持工程师获取新的软件包。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.告警与日志相关告警无 相关日志无 4.3硬件资源管理故障处理 4.3.1CPU占用率高 
设备无法正常上电，AP的指示灯未正常亮起,本类故障的常见原因包括： •电源适配器或PoE注入器输出电压或功率未满足要求。 •PoE交换机输出功率未满足要求。 •AP侧硬件故障。 3.故障分析 本类故障的诊断流程如图3-1所示。 图3-1设备上电异常的故障诊断流程图 4.处理步骤 电源适配器或PoE注入器供电方式 (1)供电设备是否满足供电要求 如果AP采用电源适配器或PoE注入器供电方式，需要查看电源适配器或PoE注入器的输出功率（电压和电流）是否满足AP安装手册中的电压要求。 如果未满足，请更换符合要求的电源适配器或PoE注入器。 如果满足，则执行步骤(2)。 (2)定位故障设备 采用交叉测试的方式确认故障出现在供电侧还是AP侧。 更换同型号的电源适配器或PoE注入器进行交叉测试。如果问题得到解决，则为供电侧故障，请更换供电设备。 更换同型号AP进行交叉测试。如果问题得到解决，则为AP侧故障，建议执行步骤(3)。 (3)观察指示灯状态 AP的指示灯状态说明请参考各型号AP的安装指导手册，通过指示灯状态可以协助用户判断当前设备的工作状态。 如果电源指示灯未正常亮起，则多为AP硬件故障，请拨打H3C客户服务热线 400-810-0504寻求帮助。 如果指示灯状态显示异常，需要进一步定位。 PoE供电方式 (1)供电设备是否满足供电要求 如果AP采用PoE供电方式，需要查看： a.AP和PoE交换机的供电模式是否匹配，AP采用PoE、PoE+还是PoE++供电。 b.PoE交换机单端口的输出功率是否满足供电要求；确认PoE交换机上所接AP的总功率是否超过交换机的供电功率规格。 如果未满足，请更换符合要求的供电设备。 如果满足，则执行步骤(2)。 (2)定位故障设备 采用交叉测试的方式确认故障出现在供电侧还是AP侧。 调整PoE交换机的供电端口或更换同型号的PoE交换机。如果问题得到解决，则为供电侧故障，请调整供电端口或更换供电设备。 更换同型号AP进行交叉测试。如果问题得到解决，则为AP侧故障，建议执行步骤(3)。 (3)观察指示灯状态 AP的指示灯状态说明请参考各型号AP的安装指导手册，通过指示灯状态可以协助用户判断当前设备的工作状态。 如果电源指示灯未正常亮起，则多为AP硬件故障，请联系技术支持人员或您购买设备的代理商，更换新的设备。 如果指示灯状态显示异常，需要进一步定位。 3.9AP启动异常 ,Suggestion not provided
设备学习不到IS-IS路由。 ,本类故障的常见原因主要包括： •其它路由协议也发布了相同的路由，并且路由协议优先级比IS-IS协议高。 •引入的外部路由优先级低，没有被优选。 •引入的外部路由类型不同，没有被优选。IS-IS开销值类型不匹配。 •IS-IS邻居没有正常建立。 •两台设备的SystemID配置相同。 •LSP报文认证不匹配。 •设备底层故障或者链路故障，造成LSP报文丢失。 •LSP长度超过了设备可以接收的LSP的最大长度。 3.故障分析 本类故障的诊断流程如图72所示。 图72设备学习不到IS-IS路由的故障诊断流程图 4.处理步骤 (1)检查IS-IS路由表是否正确。 请执行displayisisroute命令，查看IS-IS路由表。 如果IS-IS路由表中存在指定的路由，请执行displayiprouting-tableip-address[mask|mask-length]verbose命令查看IP路由表中是否存在协议优先级比IS-IS高的路由。 −如果存在，请根据网络规划调整配置。 −如果不存在，请执行步骤(7)。 如果IS-IS路由表中不存在指定的路由，请执行步骤(2)。 (2)检查指定的IS-IS路由是否发布。 在发布指定路由的设备上，执行displayisislsdbverboselocal命令，查看本地 产生的LSP报文中是否携带了指定路由。 如果LSP报文中没有携带指定的路由，请检查IS-IS配置是否正确，例如接口是否使能IS-IS。 如果指定的路由是IS-IS引入的外部路由，请执行displayiprouting-table protocolprotocolverbose命令查看该路由的“State”字段，当“State”字段的取值中包含“Inactive”时，说明外部路由处于非激活状态，这种情况下，IS-IS不会将此路由发布出去。请检查外部路由的配置，使该路由的“State”取值包含“Active”和“Adv”。 如果LSP报文中携带了指定的路由，请执行步骤(7)。 (3)检查指定的IS-IS路由的开销类型是否一致。 多台设备通过路由引入的方式发布到达同一目的地的路由，并希望这些外部路由形成等价路由的场景中，需要检查IS-IS引入路由的开销类型是否一致。不同的开销类型的路由开销值不同，具体如下： 如果开销类型为external，那么IS-IS通过LSP发布引入的外部路由时，该路由的开销值为原有开销值＋64。 如果开销类型为internal，那么IS-IS通过LSP发布引入的外部路由时，该路由的开销值为原有开销值。 缺省情况下，我司设备引入的外部路由的开销类型为external。如果其他厂商设备引入外部路由的开销类型与我司缺省情况不同，会导致到达同一目的地的路由开销不同。邻居设备会优选开销最小的路由。对于这种情况，请修改引入外部路由的开销类型，保证各厂商设备引入外部路由的开销类型相同。修改我司设备引入外部路由的开销类型的步骤如下： a.在发布指定路由的设备上，执行displaycurrent-configurationconfigurationisis命令检查IS-IS引入外部路由的配置。 b.通过import-route命令修改引入外部路由的开销类型。 上述情况外的其他情况，请执行步骤(4)。 (4)检查IS-IS的数据库是否同步。 在学习不到IS-IS路由的设备上，执行displayisislsdb命令，查看是否收到发布指定路由的设备的LSP报文。 如果LSDB数据库中不存在指定的LSP报文，请排查是否存在链路故障。如果不存在链路故障，请通过displayisis命令查看“LSPlengthreceive”字段的取值，判断指定的LSP报文长度是否超过了设备可以接收的LSP报文的最大长度。当“LSPlengthreceive”字段的取值超过了设备可以接收的LSP报文的最大长度时，请在生成LSP的设备上通过lsp-lengthoriginate命令将生成LSP报文的最大长度配置为该区域内所有IS-IS接口MTU的最小值。 如果LSDB数据库中存在指定的LSP报文，但SeqNum与发布该LSP的设备上通过 displayisislsdblocalverbose命令显示的SeqNum不一致，并且SeqNum 在不停地增长，则网络中存在其他设备与发布指定路由的设备的SystemID配置相同，请排查并修改网络中设备的SystemID配置。 如果LSDB数据库中存在指定的LSP报文，但SeqNum与发布该LSP的设备上通过 displayisislsdblocalverbose命令显示的SeqNum不一致，并且一直保持不变，可能是LSP报文在传输过程中被丢弃，请排查设备底层和中间链路是否存在故障。 如果LSDB数据库中存在指定的LSP报文，并且SeqNum与发布该LSP的设备上通过 displayisislsdblocalverbose命令显示的SeqNum一致，请执行步骤(7)。 (5)检查IS-IS开销值类型是否匹配。 分别在发布路由的设备和学习不到路由的设备上，执行displayisis命令，查看“Coststyle”的取值，检查两端的IS-IS开销值类型是否匹配。只有开销值类型相同时，才能学到路由。 如果链路两端设备的IS-IS开销值类型不匹配，请在IS-IS视图下执行cost-style命令修改配置。 如果两端设备的IS-IS开销值类型匹配，请执行步骤(7)。 (6)检查IS-IS邻居是否正常建立。 在路径上的每一台设备上执行displayisispeer命令，查看IS-IS邻居是否都正常建立。 如果存在邻居没有正常建立的情况，请参见“IS-IS邻居无法建立”。 如果不存在邻居未能正常建立的情况，请执行步骤(7)。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.2.3IS-IS路由震荡 ,Suggestion not provided
设备已有ARP表项但无法正常转发流量。 ,"本类故障的常见原因主要包括： •学习到的ARP表项参数异常。 •学习到的ARP表项没有成功下发驱动。 3.故障分析 本类故障的诊断流程如图61所示。 图61已有ARP表项但无法转发流量故障诊断流程图 4.处理步骤 (1)检查ARP表项是否成功创建。通过displaysysteminternaladj4entry命令查看 ARP表项信息，以接口GigabitEthernet1/0/1、对端IP地址为1.1.1.2为例。 <Sysname>system-view [Sysname]probe [Sysname-probe]displaysysteminternaladj4entry1.1.1.2interfacegigabitethernet 1/0/1 ADJ4entry: Entryattribute:0x0 Servicetype:Ethernet Linkmediatype:Broadcast Actiontype:Forwarding Entryflag:0x0Forwardtype:0x0 Slot:0 MTU:1500 Driverflag:2 SequenceNo:17 Physicalinterface:GE1/0/1 Logicalinterface:N/A Virtualcircuitinformation:65535 ADJindex:0xdc731e70 Peeraddress:0.0.0.0 Referencecount:0 ReferenceSequence:9 MicroSegmentID:0 Nexthopdriver[0]:0xffffffff Nexthopdriver[1]:0xffffffff Drivercontext[0]:0xffffffffDrivercontext[1]:0xffffffffDrivercontext[2]:0xffffffff Drivercontext[3]:0xffffffff Drivercontext[4]:0xffffffff Drivercontext[5]:0xffffffff Linkheadinformation(IP):68cb9c3f020668cb978f01060800Linkheadinformation(MPLS):68cb9c3f020668cb978f01068847 如果“Actiontype”字段为“Forwarding”，则代表设备正常转发来自1.1.1.2的流量，设备无故障。 如果“Actiontype”字段为“Drop”，则表示没有成功创建ARP表项。 −如果“Driverflag”字段为“4”，代表驱动资源不足，请检查驱动的使用情况。 −如果“Driverflag”字段不为“4”，请继续执行第(2)步。 (2)检查ARP表项是否成功下发到驱动。通过debuggingsysteminternaladj4命令并指定hardware参数打开IPv4邻接表下驱动调试功能。通过resetarp命令清除ARP表项，然后通过ping命令向对端设备发送报文来触发ARP表项的学习，查看ARP表项下发驱动的情况。 <Sysname>system-view [Sysname]probe [Sysname-probe]debuggingsysteminternaladj4hardware [Sysname-probe]ping1.1.1.2 Ping1.1.1.2(1.1.1.2):56databytes,pressCTRL+Ctobreak 56bytesfrom1.1.1.2:icmp_seq=0ttl=255time=2.015ms *Apr2215:57:56:1732022SysnameARP/7/ARP_SEND:-MDC=1;SentanARPmessage,operation:1,senderMAC:68cb-978f-0106,senderIP:1.1.1.1,targetMAC:0000-0000-0000,targetIP:1.1.1.2 *Apr2215:57:56:1732022SysnameARP/7/ARP_RCV:-MDC=1;ReceivedanARPmessage,operation:2,senderMAC:68cb-9c3f-0206,senderIP:1.1.1.2,targetMAC:68cb-978f-0106,targetIP:1.1.1.1 *Apr2215:57:56:1742022SysnameADJ4/7/ADJ4_ENTRY:-MDC=1; -------------ADJ4Entry------------ IPaddress:1.1.1.2Routeinterface:GE1/0/1 Servicetype:Ethernet Actiontype:Forwarding Linkmediatype:Broadcast Physicalinterface:GE1/0/1 Logicalinterface:N/A VSIIndex:4294967295 VPNIndex:0 MicroSegmentID:0 MicSegOrigin:5 VirtualCircuitinformation:0xffff Sequence:1Sequenceforaging:1Slot:0 MTU:1500 *Apr2215:57:56:1742022SysnameADJ4/7/ADJ4_ENTRY:-MDC=1; AddADJentryfinished,Result:0 *Apr2215:57:56:1742022SysnameADJ4/7/ADJ4_HARDWARE:-MDC=1; ====StartADJLINKAdd==== *Apr2215:57:56:1742022SysnameADJ4/7/ADJ4_HARDWARE:-MDC=1; ---------------NewEntry-------------Servicetype:Ethernet Linkmediatype:Broadcast Actiontype:Forwarding EntryAttr:0 IPaddress:1.1.1.2Routeinterface:GE1/0/1 Portinterface:N/ASlot:0 MTU:1500 VLANID:65535 SecondVLANID:65535 Physicalinterface:GE1/0/1 Logicalinterface:N/A VRFindex:0 VSIindex:-1 VSIlinkID:65535 UsrID:-1 MACaddress:68cb-9c3f-0206 Linkheadlength(IP):14 Linkheadlength(MPLS):14 Linkheadinformation(IP):68cb9c3f020668cb978f01060800 Linkheadinformation(MPLS):68cb9c3f020668cb978f01068847 *Apr2215:57:56:1742022SysnameADJ4/7/ADJ4_HARDWARE:-MDC=1; -----------NewEntryDrvContext--------- Nexthopdriver [0]:0xffffffff[1]:0xffffffffDrivercontext [0]:0xffffffff[1]:0xffffffff[2]:0xffffffff[3]:0xffffffff[4]:0xffffffff[5]:0xffffffff TRILLVNdrivercontext [0]:0xffffffffffffffff[1]:0xffffffffffffffff *Apr2215:57:56:1742022SysnameADJ4/7/ADJ4_HARDWARE:-MDC=1; ====EndADJLINKOperate==== Result:0x0,Referenceflag:0x0,Synflag:0x0 56bytesfrom1.1.1.2:icmp_seq=1ttl=255time=1.061ms 56bytesfrom1.1.1.2:icmp_seq=2ttl=255time=0.908ms 56bytesfrom1.1.1.2:icmp_seq=3ttl=255time=0.625ms 56bytesfrom1.1.1.2:icmp_seq=4ttl=255time=0.580ms ---Pingstatisticsfor1.1.1.2--- 5packet(s)transmitted,5packet(s)received,0.0%packetlossround-tripmin/avg/max/std-dev=0.580/1.038/2.015/0.520ms [Sysname-probe]%Apr2215:57:56:9862022SysnamePING/6/PING_STATISTICS:-MDC=1;Pingstatisticsfor1.1.1.2:5packet(s)transmitted,5packet(s)received,0.0%packetloss,round-tripmin/avg/max/std-dev=0.580/1.038/2.015/0.520ms. 如果“Result”字段为“0x0”，则代表ARP表项成功下发到驱动，请继续执行第(3)步。 如果“Result”字段不为“0x0”，则代表ARP表项没有下发到驱动，请在H3C技术支持工程师的指导下检查硬件资源的使用情况。(3)请执行如下命令，并收集显示信息，发送给H3C技术支持工程师。 执行debuggingsysteminternaladj4命令并指定notify参数。 执行debuggingsysteminternalipv4fibprefix命令。 (4)请收集如下信息，并联系H3C技术支持工程师。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 9.2ND故障处理 9.2.1无法学习到ND表项 ",Suggestion not provided
设备已有ND表项但无法正常转发流量。 ,"本类故障的常见原因主要包括：•平台ND表项参数异常。 •平台ND表项没有成功下发驱动。 3.故障分析 本类故障的诊断流程如图64所示。 图64已有ND表项但无法转发流量故障诊断流程图 4.处理步骤 (1)通过displaysysteminternaladj6entry命令查看ND表项是否成功建立。 [Sysname-probe]displaysysteminternaladj6entry1::2interfacegigabitethernet1/0/1ADJ6entry: Entryattribute:0x0 Servicetype:Ethernet Linkmediatype:Broadcast Actiontype:Forwarding Entryflag:0x4Forwardtype:0x0 Slot:0 MTU:1500 Driverflag:2 SequenceNo:17 Physicalinterface:GE1/0/1 Logicalinterface:N/A Virtualcircuitinformation:65535ADJindex:0xdc780c38 Peeraddress::: Referencecount:0 ReferenceSequence:3 MicroSegmentID:0 Nexthopdriver[0]:0xffffffffNexthopdriver[1]:0xffffffffDrivercontext[0]:0xffffffff Drivercontext[1]:0xffffffffDrivercontext[2]:0xffffffff Drivercontext[3]:0xffffffff Drivercontext[4]:0xffffffff Drivercontext[5]:0xffffffff Linkheadinformation(IPv6):68cb9c3f020668cb978f010686dd Linkheadinformation(MPLS):68cb9c3f020668cb978f01068847以接口GigabitEthernet1/0/1，对端IP地址为1.1.1.2为例： 如果“Actiontype”字段为“Forwarding”，则代表设备正常转发来自1.1.1.2的流量，设备无故障。 如果“Actiontype”字段为“Drop”，则代表没有成功建立ND表项。 −如果“Driverflag”字段为“4”，代表驱动资源不足，请检查驱动的使用情况。 −如果“Driverflag”字段不为“4”，请继续执行第(2)步。 (2)通过debuggingsysteminternaladj6命令并指定hardware参数打开IPv4邻接表 下驱动调试功能，然后通过pingipv6命令触发ND表项的学习，查看ND表项是否成功下发到驱动。 [Sysname-probe]debuggingsysteminternaladj6hardware [Sysname-probe]pingipv6-c11::2 Ping6(56databytes)1::1-->1::2,pressCTRL+Ctobreak 56bytesfrom1::2,icmp_seq=0hlim=64time=2.868ms ---Ping6statisticsfor1::2--- 1packet(s)transmitted,1packet(s)received,0.0%packetlossround-tripmin/avg/max/std-dev=2.868/2.868/2.868/0.000ms <Sysname>*Apr2616:06:42:4122022SysnameIP6PMTU/7/IP6PMTU_DBG:-MDC=1;BindingsockettoPMTUsucceeded *Apr2616:06:42:4122022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1;LocalSending,version=6,trafficclass=0, flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::1,Dst=1::2,prompt:OutputanIPv6Packet. *Apr2616:06:42:4122022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Sending,interface=GigabitEthernet0/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::1,Dst=1::2,prompt:SendingthepacketfromlocalinterfaceGigabitEthernet0/0/1. *Apr2616:06:42:4132022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1;LocalSending,version=6,trafficclass=224, flowlabel=0,payloadlength=32,protocol=58,hoplimit=255,Src=1::1,Dst=ff02::1:ff00:2,prompt:OutputanIPv6Packet. *Apr2616:06:42:4132022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Sending,interface=GigabitEthernet0/0/1,version=6,trafficclass=224,flowlabel=0,payloadlength=32,protocol=58,hoplimit=255,Src=1::1,Dst=ff02::1:ff00:2,prompt:SendingthepacketfromlocalinterfaceGigabitEthernet0/0/1. *Apr2616:06:42:4142022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Receiving,interface=GigabitEthernet0/0/1,version=6,trafficclass=224,flowlabel=0,payloadlength=32,protocol=58,hoplimit=255,Src=1::2,Dst=1::1,prompt:ReceivedanIPv6packet. *Apr2616:06:42:4142022SysnameADJ6/7/ADJ6_HARDWARE:-MDC=1; ====StartADJLINKAdd==== *Apr2616:06:42:4142022SysnameADJ6/7/ADJ6_HARDWARE:-MDC=1; --------------NewEntry------------- Servicetype:Ethernet Linkmediatype:Broadcast Actiontype:ForwardingIPv6address:1::2 Routeinterface:GE0/0/1 Portinterface:N/A Slot:0 MTU:1500 VLANid:65535 SecondVLANid:65535 Physicalinterface:GE0/0/1 Logicalinterface:N/A Vrfindex:0 VSIindex:-1 VSIlinkID:65535 UsrID:-1 MACaddress:68cb-9c3f-0206 Linkheadlength(IPv6):14 Linkheadlength(MPLS):14 Linkheadinformation(IPv6):68cb9c3f020668cb978f010686dd Linkheadinformation(MPLS):68cb9c3f020668cb978f01068847 Nexthopdriver [0]:0xffffffff[1]:0xffffffff Drivercontext [0]:0xff *Apr2616:06:42:4142022SysnameADJ6/7/ADJ6_HARDWARE:-MDC=1; ====EndADJLINKOperate==== Result:0x0,Referenceflag:0x0,Synflag:0x0 *Apr2616:06:42:4152022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Receiving,interface=GigabitEthernet0/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64,Src=1::2,Dst=1::1,prompt:ReceivedanIPv6packet. *Apr2616:06:42:4152022SysnameIP6FW/7/IP6FW_PACKET:-MDC=1; Delivering,interface=GigabitEthernet0/0/1,version=6,trafficclass=0,flowlabel=0,payloadlength=64,protocol=58,hoplimit=64, Src=1::2,Dst=1::1,prompt:DeliveringtheIPv6packettotheupperlayer. %Apr2616:06:42:4162022SysnamePING/6/PING_STATISTICS:-MDC=1;Ping6statisticsfor1::2:1packet(s)transmitted,1packet(s)received,0.0%packetloss,round-tripmin/avg/max/std-dev=2.868/2.868/2.868/0.000ms. *Apr2616:06:42:4172022SysnameIP6PMTU/7/IP6PMTU_DBG:-MDC=1;UnbindingPMTUfromsocketsucceeded 如果“Result”字段为“0x0”，则代表ND表项成功下发到驱动，请继续执行第(3)步。 如果“Result”字段不为“0x0”，则代表ND表项没有下发到驱动，请检查硬件资源的使用情况。(3)请执行如下命令，并收集显示信息，发送给H3C技术支持工程师。 执行debuggingsysteminternaladj6命令并指定notify参数。 通过debuggingsysteminternalipv6fibprefix命令。 (4)请收集如下信息，并联系H3C技术支持工程师。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 10三层技术-IP路由类故障处理 10.1BGP故障处理 10.1.1BGP会话无法进入Established状态 ",Suggestion not provided
设备运行后，检查接口状态存在异常,"本类故障的常见原因包括： •端口配置有误 •接口两端配置不一致 •端口流量控制功能开启 •链路质量差 •针对支持光模块的设备，常见原因还包括： •光口收发功率异常 •光电转换器异常 3.故障分析 设备运行后，检查接口的状态是否存在异常，一般可以通过端口自检、光口自检排查出大部分的问题。 4.处理步骤 (1)查看接口Down类型通过displayinterface查看物理端口状态，确认端口是否Down，并查看端口Down类 型。例如，“Currentstate:AdministrativelyDOWN”状态，表示端口视图下配置了shutdown，需要执行undoshutdown命令开启。 <Sysname>displayinterfaceGigabitEthernet1/0/1GigabitEthernet1/0/1Currentstate:AdministrativelyDOWN 常见的Down类型包括： AdministrativelyDOWN：表示该接口已经通过shutdown命令被关闭，即管理状态为关闭。 DOWN：表示该接口的管理状态为开启，但物理状态为关闭，可能因为没有物理连线或者线路故障。 DOWN(Link-Aggregationinterfacedown)：表示该接口所属的聚合接口已经通过shutdown命令被关闭。 mac-addressmovingdown：由于MAC地址迁移抑制导致接口被关闭。 STPDOWN：表示接口由于触发了STPBPDU保护而自动关闭。 (2)检查接口协商链路双工类型通过displayinterfacebrief命令查看接口的概要信息。 自协商（A）状态时，端口的速率双工状态由本端口和对端端口自动协商而定，两端双工速率需匹配一致。 半双工（H）状态时，需要检查接口两端配置是否不一致。 #查看接口的概要信息。 <Sysname>displayinterfacebrief Thebriefinformationofinterface(s)underroutemode: Link:ADM-administrativelydown;Stby-standby Protocol:(s)-spoofing InterfaceLinkProtocolMainIPDescription NULL0UPUP(s)-- Vlan1UPUP192.168.1.254 Vlan2UPUP-- Thebriefinformationofinterface(s)underbridgemode:Link:ADM-administrativelydown;Stby-standbySpeedorDuplex:(a)/A-auto;H-half;F-full Type:A-access;T-trunk;H-hybrid InterfaceLinkSpeedDuplexTypePVIDDescription BAGG1UP2G(a)F(a)T1 GE1/0/1UP1GFT1 GE1/0/2UP1GFT1WLAN-ESS10UP----A2 WLAN-DBSS10:0UP----A2 (3)检查接口流量控制状态 #在以太网接口视图下，通过displaythis命令，查看接口是否开启了流量控制。 <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]displaythis # interfaceGigabitEthernet1/0/1portlink-typetrunk porttrunkpermitvlanall flow-control # 如果该端口不需要开启，建议使用undoflowcontrol关闭该接口的流量控制功能。(4)检查错包增长情况通过多次执行displayinterface查看物理端口状态，确认端口输入、输出方向是否有大量的错误包。为方便查看，可以通过resetcounterinterface命令清空当前端口的报文统计结果再进行观察。 AP端口入方向异常，主要表现如下： 如果端口入包统计不增加，同时上行设备对端出包统计也不增加，建议排查对端设备。 如果端口入包的错误统计频繁增加： −建议测试链路，链路质量差或者线路光衰大会导致报文在传输过程中出错。−通过displayinterface命令，查看两端端口的工作模式是否相同。 −如果是网线，建议检查水晶头、更换网线。 −如果是光纤，更换光模块、更换光纤 AP端口出方向异常，主要表现如下： 如果下行设备对端入包CRC、frame、throttles计数增加，建议测试链路： −如果是网线，建议检查水晶头和网线； −如果是光纤，检查收发光的衰减是否在正常的阈值范围内、线缆中间连接的光电转换器是否异常。 如果下行设备端口入包overruns、ignored计数增加，表明端口输入速率超过接收方处理能力，导致丢包，建议排查对端设备。 #查看AP端口状态。 <Sysname>displayinterfaceGigabitEthernet1/0/1 GigabitEthernet1/0/1Currentstate:UPLineprotocolstate:UPIPpacketframetype:EthernetII,hardwareaddress:a4fa-7679-b6f0Description:GigabitEthernet1/0/1InterfaceBandwidth:1000000kbpsLoopbackisnotset Mediatypeistwistedpair,promiscuousmodenotset 1000Mbps-speedmode,full-duplexmode Linkspeedtypeisautonegotiation,linkduplextypeisautonegotiation …… Input(total):205packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput(normal):196packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput:9inputerrors,0runts,0giants,-throttles8CRC,-frame,0overruns,1aborts-ignored,-parityerrorsOutput(total):162packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput(normal):158packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput:2outputerrors,2underruns,-bufferfailures-aborts,0deferred,0collisions,0latecollisions -lostcarrier,-nocarrier (5)检查端口是否UP/DOWN频繁震荡 (6)如果设备的端口状态频繁UP/DOWN，建议从以下方面排查。 对于以太网电口，如果端口处于自协商状态，则可能是协商不稳定。建议首先尝试设置强 制速率双工，如果通过displaytransceiverdiagnosi(问题无法解决，则排查是否存在中间设备。对于以太网光口，)sinterface命令查看端口的收发光功率，确保接收到的功率应在接收灵敏度与过载功率之间。 收发光功率小于接收灵敏度，则接口不能Up。 收发光功率大于过载功率，可能已经造成光模块损坏。 (7)如果排查以上方面后，问题得不到解决，则一般为硬件问题，请拨打H3C客户服务热线 400-810-0504寻求帮助。 4设备软件配置类故障处理 4.1交换机通过OAP方式登录无线控制器业务板失败 ",Suggestion not provided
设备运行后，检查接口状态存在异常。常见的异常现象包括： •通过displayinterface命令 查看物理端口状态，显示信息Currentstate字段表现为物理Down或Down(类型)。 端口输入、输出方向存在大量的错误包。 •有线接口频繁UP/DOWN。 ,"本类故障的常见原因包括： •端口配置有误 •接口两端配置不一致 •端口流量控制功能开启 •链路质量差 •针对支持光模块的设备，常见原因还包括： •光口收发功率异常 •光电转换器异常 3.故障分析 设备运行后，检查接口的状态是否存在异常，一般可以通过端口自检、光口自检排查出大部分的问题。 4.处理步骤 (1)查看接口Down类型通过displayinterface查看物理端口状态，确认端口是否Down，并查看端口Down类 型。例如，“Currentstate:AdministrativelyDOWN”状态，表示端口视图下配置了shutdown，需要执行undoshutdown命令开启。 <Sysname>displayinterfaceGigabitEthernet1/0/1GigabitEthernet1/0/1Currentstate:AdministrativelyDOWN 常见的Down类型包括： AdministrativelyDOWN：表示该接口已经通过shutdown命令被关闭，即管理状态为关闭。 DOWN：表示该接口的管理状态为开启，但物理状态为关闭，可能因为没有物理连线或者线路故障。 DOWN(Link-Aggregationinterfacedown)：表示该接口所属的聚合接口已经通过shutdown命令被关闭。 mac-addressmovingdown：由于MAC地址迁移抑制导致接口被关闭。 STPDOWN：表示接口由于触发了STPBPDU保护而自动关闭。 (2)检查接口协商链路双工类型通过displayinterfacebrief命令查看接口的概要信息。 自协商（A）状态时，端口的速率双工状态由本端口和对端端口自动协商而定，两端双工速率需匹配一致。 半双工（H）状态时，需要检查接口两端配置是否不一致。 #查看接口的概要信息。 <Sysname>displayinterfacebrief Thebriefinformationofinterface(s)underroutemode: Link:ADM-administrativelydown;Stby-standby Protocol:(s)-spoofing InterfaceLinkProtocolMainIPDescription NULL0UPUP(s)-- Vlan1UPUP192.168.1.254 Vlan2UPUP-- Thebriefinformationofinterface(s)underbridgemode:Link:ADM-administrativelydown;Stby-standbySpeedorDuplex:(a)/A-auto;H-half;F-full Type:A-access;T-trunk;H-hybrid InterfaceLinkSpeedDuplexTypePVIDDescription BAGG1UP2G(a)F(a)T1 GE1/0/1UP1GFT1 GE1/0/2UP1GFT1WLAN-ESS10UP----A2 WLAN-DBSS10:0UP----A2 (3)检查接口流量控制状态 #在以太网接口视图下，通过displaythis命令，查看接口是否开启了流量控制。 <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]displaythis # interfaceGigabitEthernet1/0/1portlink-typetrunk porttrunkpermitvlanall flow-control # 如果该端口不需要开启，建议使用undoflowcontrol关闭该接口的流量控制功能。(4)检查错包增长情况通过多次执行displayinterface查看物理端口状态，确认端口输入、输出方向是否有大量的错误包。为方便查看，可以通过resetcounterinterface命令清空当前端口的报文统计结果再进行观察。 AP端口入方向异常，主要表现如下： 如果端口入包统计不增加，同时上行设备对端出包统计也不增加，建议排查对端设备。 如果端口入包的错误统计频繁增加： −建议测试链路，链路质量差或者线路光衰大会导致报文在传输过程中出错。−通过displayinterface命令，查看两端端口的工作模式是否相同。 −如果是网线，建议检查水晶头、更换网线。 −如果是光纤，更换光模块、更换光纤 AP端口出方向异常，主要表现如下： 如果下行设备对端入包CRC、frame、throttles计数增加，建议测试链路： −如果是网线，建议检查水晶头和网线； −如果是光纤，检查收发光的衰减是否在正常的阈值范围内、线缆中间连接的光电转换器是否异常。 如果下行设备端口入包overruns、ignored计数增加，表明端口输入速率超过接收方处理能力，导致丢包，建议排查对端设备。 #查看AP端口状态。 <Sysname>displayinterfaceGigabitEthernet1/0/1 GigabitEthernet1/0/1Currentstate:UPLineprotocolstate:UPIPpacketframetype:EthernetII,hardwareaddress:a4fa-7679-b6f0Description:GigabitEthernet1/0/1InterfaceBandwidth:1000000kbpsLoopbackisnotset Mediatypeistwistedpair,promiscuousmodenotset 1000Mbps-speedmode,full-duplexmode Linkspeedtypeisautonegotiation,linkduplextypeisautonegotiation …… Input(total):205packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput(normal):196packets,21078bytes106unicasts,37broadcasts,53multicasts,0pausesInput:9inputerrors,0runts,0giants,-throttles8CRC,-frame,0overruns,1aborts-ignored,-parityerrorsOutput(total):162packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput(normal):158packets,10179bytes157unicasts,0broadcasts,1multicasts,0pausesOutput:2outputerrors,2underruns,-bufferfailures-aborts,0deferred,0collisions,0latecollisions -lostcarrier,-nocarrier (5)检查端口是否UP/DOWN频繁震荡 (6)如果设备的端口状态频繁UP/DOWN，建议从以下方面排查。 对于以太网电口，如果端口处于自协商状态，则可能是协商不稳定。建议首先尝试设置强 制速率双工，如果通过displaytransceiverdiagnosi(问题无法解决，则排查是否存在中间设备。对于以太网光口，)sinterface命令查看端口的收发光功率，确保接收到的功率应在接收灵敏度与过载功率之间。 收发光功率小于接收灵敏度，则接口不能Up。 收发光功率大于过载功率，可能已经造成光模块损坏。 (7)如果排查以上方面后，问题得不到解决，则一般为硬件问题，请拨打H3C客户服务热线 400-810-0504寻求帮助。 4设备软件配置类故障处理 4.1交换机通过OAP方式登录无线控制器业务板失败 ",Suggestion not provided
设备在运行中发生异常重启。 ,本类故障的常见原因启动文件故障。 3.故障分析 本类故障的诊断流程如图2所示：图2设备异常重启故障诊断流程图 4.处理步骤 (1)查看设备重启后能否进入命令行状态若设备能够进入命令行状态，请使用displaydiagnostic-information命令收集设备的诊断信息，待收集完成后，将设备信息导出后发给H3C技术人员寻求支持。 执行displaydiagnostic-information命令时，可指定key-info参数仅收集关键诊 断信息，从而减少收集时间。 (2)检查启动文件是否正常 若设备无法进入命令行状态，请通过Console口连接设备后再次重启设备，如果BootWare提示CRC错误或者找不到启动文件，请使用BootWare菜单重新下载启动文件，并设置该文件为当前启动文件（在BootWare加载过程中，BootWare能自动将该文件设置为当前启动文件）。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 3.1.3温度异常告警 ,Suggestion not provided
设备正常上电后，无法正常启动或反复重启,"本类故障的常见原因包括： •无法找到启动文件 •启动文件异常 •内存故障 •BootWare扩展段异常 •硬件初始化设备 •设备自检错误 3.故障分析 对于无Console口的AP，无法查看AP的启动过程信息，请通过尝试恢复出厂配置的方式查看问题是否得到解决。 对于有Console口的AP，可以通过Console口进行本地登录，查看AP是否正常启动。本类故障的诊断流程如图3-2所示。 图3-2含Console口AP启动异常的故障诊断流程图 4.处理步骤无Console口AP 设备可以通过长按RESET按钮5秒以上的方式恢复至出厂配置。如果问题未得到解决，请拨打H3C客户服务热线400-810-0504寻求帮助。有Console口AP (1)AP出现启动异常后，在许可的操作的范围内，建议先尝试进行重启、格式化、重新导入版本操作。 如果故障未能解决，可以参照步骤(2)、步骤(3)定位异常启动原因。 若无法定位问题，请收集相应的现象、日志信息等并拨打H3C客户服务热线400-810-0504寻求帮助。 (2)检查配置终端是否打印启动信息使用电缆连接计算机的串口和设备Console口，设备上电后，正常情况下将在配置终端上显示设备启动信息。 如果配置终端显示AP启动但未打印启动信息，请尝试更换其他AP和网络设备。如果问题得到解决，则多为AP硬件故障，建议更换AP。 Systemisstarting... 如果配置终端显示AP启动信息，建议执行步骤(3)。 (3)检查启动信息是否存在异常 AP上电后，无法正常启动或反复重启，常见为以下几种情况： 无法找到启动文件当配置终端显示如下启动信息是，表明找不到镜像文件，启动失败。建议重新启动设备并重新导入AP的版本文件。 BootWareValidating... PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU... Loadingthemainimagefiles... Theimagedoesnotexist! Loadingthebackupimagefiles... 启动文件异常启动文件异常一般是由启动文件本身异常或Flash故障导致。当配置终端打印如下信息后，请键入“Ctrl+B”进入BootWare主菜单界面。 BootWareValidating... PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU... 在BootWare主菜单下，键入“Ctrl+F”，格式化Flash后重新加载启动文件。如果格式化过程中报错，建议更换AP。 内存故障 Bootware启动时提示内存测试失败信息，具体如下： Systemisstarting... PressCtrl+DtoaccessBASIC-BOOTWAREMENU Valueread:55555564;Valueexpected:55555555 DRAMtestfailedat:87FC0004 DRAMtestfailedat:87fc0004 Fatalerror!Pleasereboottheboard. 建议重新启动设备并键入“Ctrl+D”进入基本BootWare菜单，而后键入“Ctrl+U”，选择“RAMTest”，进行内存测试。如果出现内存测试失败的提示，则为内存故障，建议更换AP。 Systemisstarting... PressCtrl+DtoaccessBASIC-BOOTWAREMENU... =====================<BASIC-BOOTWAREMENU(Ver7.18)>====================== |<1>ModifySerialInterfaceParameter |<2>UpdateExtendedBootWare |<3>UpdateFullBootWare |<4>BootExtendedBootWare |<5>BootBackupExtendedBootWare|<0>Reboot============================================================================Ctrl+U:AccessBASICASSISTANTMENU Enteryourchoice(0-5): ===========================<BASICASSISTANTMENU>===========================|<1>RAMTest|<0>ExitToMainMenu ============================================================================ Enteryourchoice(0-1):1 Warning:TestMemorywilltakealongtime?[Y/N]Y Memorytest...................................................... 475Mbytesmemoryhasbeentested.Memorytestfailed. BootWare扩展段丢失 如果配置终端在显示“PressCtrl+DtoaccessBASIC-BOOTWAREMENU...”的提示后，未打印“PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU...”提示，且键入“Ctrl+B”后，无法进入BootWare主菜单界面，则表示APBootWare扩展段丢失。 Systemisstarting... PressCtrl+DtoaccessBASIC-BOOTWAREMENU... BootingNormalExtendBootWare.. TheExtendBootWareisself-decompressing............................Done! 当配置终端出现“PressCtrl+DtoaccessBASIC-BOOTWAREMENU”时，立即键入“Ctrl+D”，进入基本BootWare菜单，键入<3>，重新引导扩展段启动。 =====================<BASIC-BOOTWAREMENU(Ver0.06)>====================== |<1>ModifySerialInterfaceParameter| |<2>UpdateExtendedBootWare| |<3>UpdateFullBootWare| |<4>BootExtendedBootWare| |<5>BootBackupExtendedBootWare| |<0>Reboot| ============================================================================ Ctrl+U:AccessBASICASSISTANTMENU Ctrl+A:EnterCommandLine Ctrl+C:DisplayCopyright Enteryourchoice(0-5):3 PleaseStartToTransferFile,Press<Ctrl+C>ToExit. Waiting...C 打开终端软件，界面菜单栏选择Xmodem发送数据，完成BootWare版本传输，具体操作过程请参见设备的版本说明书“升级BootWare菜单”章节。 硬件初始化失败 如果AP刚启动即打印“Theprocesswloclitedexitedabnormally.”的异常退出错误信息，则判断为硬件初始化失败，建议更换AP。 设备自检错误如果设备启动时打印“Fatalerror！”，表示设备设备自检错误，判断为AP硬件故障，建议更换AP。 3.10AP设备输入输出异常 ",Suggestion not provided
设备正常上电后，无法正常启动或反复重启。此类情况下，对于单指示灯AP，指示灯长时间处于 “黄色常亮”状态；多于多指示灯AP，电源指示灯长时间处于““黄色常亮”状态”。 ,"本类故障的常见原因包括： •无法找到启动文件 •启动文件异常 •内存故障 •BootWare扩展段异常 •硬件初始化设备 •设备自检错误 3.故障分析 对于无Console口的AP，无法查看AP的启动过程信息，请通过尝试恢复出厂配置的方式查看问题是否得到解决。 对于有Console口的AP，可以通过Console口进行本地登录，查看AP是否正常启动。本类故障的诊断流程如图3-2所示。 图3-2含Console口AP启动异常的故障诊断流程图 4.处理步骤无Console口AP 设备可以通过长按RESET按钮5秒以上的方式恢复至出厂配置。如果问题未得到解决，请拨打H3C客户服务热线400-810-0504寻求帮助。有Console口AP (1)AP出现启动异常后，在许可的操作的范围内，建议先尝试进行重启、格式化、重新导入版本操作。 如果故障未能解决，可以参照步骤(2)、步骤(3)定位异常启动原因。 若无法定位问题，请收集相应的现象、日志信息等并拨打H3C客户服务热线400-810-0504寻求帮助。 (2)检查配置终端是否打印启动信息使用电缆连接计算机的串口和设备Console口，设备上电后，正常情况下将在配置终端上显示设备启动信息。 如果配置终端显示AP启动但未打印启动信息，请尝试更换其他AP和网络设备。如果问题得到解决，则多为AP硬件故障，建议更换AP。 Systemisstarting... 如果配置终端显示AP启动信息，建议执行步骤(3)。 (3)检查启动信息是否存在异常 AP上电后，无法正常启动或反复重启，常见为以下几种情况： 无法找到启动文件当配置终端显示如下启动信息是，表明找不到镜像文件，启动失败。建议重新启动设备并重新导入AP的版本文件。 BootWareValidating... PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU... Loadingthemainimagefiles... Theimagedoesnotexist! Loadingthebackupimagefiles... 启动文件异常启动文件异常一般是由启动文件本身异常或Flash故障导致。当配置终端打印如下信息后，请键入“Ctrl+B”进入BootWare主菜单界面。 BootWareValidating... PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU... 在BootWare主菜单下，键入“Ctrl+F”，格式化Flash后重新加载启动文件。如果格式化过程中报错，建议更换AP。 内存故障 Bootware启动时提示内存测试失败信息，具体如下： Systemisstarting... PressCtrl+DtoaccessBASIC-BOOTWAREMENU Valueread:55555564;Valueexpected:55555555 DRAMtestfailedat:87FC0004 DRAMtestfailedat:87fc0004 Fatalerror!Pleasereboottheboard. 建议重新启动设备并键入“Ctrl+D”进入基本BootWare菜单，而后键入“Ctrl+U”，选择“RAMTest”，进行内存测试。如果出现内存测试失败的提示，则为内存故障，建议更换AP。 Systemisstarting... PressCtrl+DtoaccessBASIC-BOOTWAREMENU... =====================<BASIC-BOOTWAREMENU(Ver7.18)>====================== |<1>ModifySerialInterfaceParameter |<2>UpdateExtendedBootWare |<3>UpdateFullBootWare |<4>BootExtendedBootWare |<5>BootBackupExtendedBootWare|<0>Reboot============================================================================Ctrl+U:AccessBASICASSISTANTMENU Enteryourchoice(0-5): ===========================<BASICASSISTANTMENU>===========================|<1>RAMTest|<0>ExitToMainMenu ============================================================================ Enteryourchoice(0-1):1 Warning:TestMemorywilltakealongtime?[Y/N]Y Memorytest...................................................... 475Mbytesmemoryhasbeentested.Memorytestfailed. BootWare扩展段丢失 如果配置终端在显示“PressCtrl+DtoaccessBASIC-BOOTWAREMENU...”的提示后，未打印“PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU...”提示，且键入“Ctrl+B”后，无法进入BootWare主菜单界面，则表示APBootWare扩展段丢失。 Systemisstarting... PressCtrl+DtoaccessBASIC-BOOTWAREMENU... BootingNormalExtendBootWare.. TheExtendBootWareisself-decompressing............................Done! 当配置终端出现“PressCtrl+DtoaccessBASIC-BOOTWAREMENU”时，立即键入“Ctrl+D”，进入基本BootWare菜单，键入<3>，重新引导扩展段启动。 =====================<BASIC-BOOTWAREMENU(Ver0.06)>====================== |<1>ModifySerialInterfaceParameter| |<2>UpdateExtendedBootWare| |<3>UpdateFullBootWare| |<4>BootExtendedBootWare| |<5>BootBackupExtendedBootWare| |<0>Reboot| ============================================================================ Ctrl+U:AccessBASICASSISTANTMENU Ctrl+A:EnterCommandLine Ctrl+C:DisplayCopyright Enteryourchoice(0-5):3 PleaseStartToTransferFile,Press<Ctrl+C>ToExit. Waiting...C 打开终端软件，界面菜单栏选择Xmodem发送数据，完成BootWare版本传输，具体操作过程请参见设备的版本说明书“升级BootWare菜单”章节。 硬件初始化失败 如果AP刚启动即打印“Theprocesswloclitedexitedabnormally.”的异常退出错误信息，则判断为硬件初始化失败，建议更换AP。 设备自检错误如果设备启动时打印“Fatalerror！”，表示设备设备自检错误，判断为AP硬件故障，建议更换AP。 3.10AP设备输入输出异常 ",Suggestion not provided
"设备转发异常或不断打印Forwardingfault、Boardfault等提示信息，如： %Jun2609:51:53:2072013H3CDIAG/1/ALERT:-MDC=1-Chassis=2-Slot=4;Forwardingfault:chassis2slot6tochassis2slot4 %Jun2609:51:57:6212013H3CDIAG/1/ALERT:-MDC=1;Boardfault:chassis2slot6,pleasecheckit %Jun2609:51:59:2512013H3CDIAG/1/ALERT:-MDC=1-Chassis=2-Slot=6;Forwardingfault:chassis2slot6tochassis2slot6 %Jun2609:52:05:6212013H3CDIAG/1/ALERT:-MDC=1;Boardfault:chassis2slot6,pleasecheckit %Jun2609:52:12:6212013H3CDIAG/1/ALERT:-MDC=1;Boardfault:chassis2slot6,pleasecheckit %Jun2609:52:22:6212013H3CDIAG/1/ALERT:-MDC=1;Boardfault:chassis2slot6,pleasecheckit ",本类故障的常见原因主要包括：•交换网板故障。 •业务板故障。 3.故障分析 本类故障的诊断流程如图17所示：图17故障诊断流程图 4.处理步骤 在系统视图下执行switch-fabricisolate命令逐块隔离交换网板，（确保交换网板数量大于等于2，有冗余备份），观察交换网板隔离后故障是否消失。此处以S12508产品为例说明网板隔离步骤，其中10～18槽位为网板： (1)隔离10槽位网板，隔离后等待一段时间，观察故障是否消失。 (2)执行undoswitch-fabricisolate命令取消10槽位网板隔离，待网板重启Normal后，隔离11槽位网板并观察故障是否消失。 (3)按照上面的方法，依次隔离12～13槽位网板，直到所有网板隔离确认一遍。 (4)如果隔离某块交换网板后故障消失，说明该交换网板故障；如果所有交换网板隔离一遍后故障仍存在，那么应该为业务板故障导致。 (5)建议将业务转移到其它业务板上后更换业务板，更换时注意检查槽位是否吸入异物，如果故障依然存在，请执行步骤7。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 3.6端口故障 3.6.1端口出现CRC错误 ,Suggestion not provided
设备作为NETCONF服务器，用户使用NETCONFoverSOAP客户端登录设备失败。 ,"本类故障的常见原因主要包括： •SOAP客户端与设备之间路由不通，无法建立TCP连接。 •设备未开启NETCONFoverSOAP服务器功能。 •服务器上配置了对客户端的访问控制，但客户端的IP地址不在访问控制的permit规则内。 •本地用户未配置授权HTTP/HTTPS服务。 •本地用户认证方式配置不正确。 •HTTP/HTTPS登录用户数达到允许用户数的上限。 3.故障分析 本类故障的诊断流程如图168所示。 图168SOAP方式登录失败的故障诊断流程图 4.处理步骤(1)检查物理链路是否存在故障。可以通过Telnet登录设备（用户角色名为network-admin），在设备上尝试能否ping通NETCONF客户端的IP地址。如果不能ping通，在设备上执行displayiprouting-table命令或者displayroute-staticrouting-table命令查看去往客户端的路由出接口，再执行displayinterface命令检查该接口状态： <Sysname>displayinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1 Interfaceindex:386 Currentstate:AdministrativelyDOWN Lineprotocolstate:DOWN... a.如果Currentstate显示为AdministrativelyDOWN，则在接口下执行undoshutdown命令打开关闭的接口。如果Currentstate显示为DOWN，则检查接口的物理连线是否正确。 b.如果设备和客户端之间存在其他设备，按上述方法逐跳检查和修复各设备连接的物理接口 (2)通过disp(状态。)laynetconfservice命令检查NETCONFoverSOAP功能是否开启。 <Sysname>displaynetconfservice NETCONFoverSOAPoverHTTP:Disabled(port80) NETCONFoverSOAPoverHTTPS:Disabled(port832) NETCONFoverSSH:Disabled(port830) NETCONFoverTelnet:EnabledNETCONFoverConsole:Enabled... 当NETCONFoverSOAPoverHTTP或NETCONFoverSOAPoverHTTPS字段值为Disabled时，请在系统视图下执行netconfsoaphttpenable、netconfsoaphttpsenable命令开启基于HTTP/HTTPS的NETCONFoverSOAP功能。 (3)检查是否设置了对客户端IP地址的ACL访问控制。 <Sysname>displaycurrent-configuration|beginnetconfnetconfsoaphttpenablenetconfsoaphttpsenablenetconfsoaphttpacl2000 # [Sysname]aclbasic2000 [Sysname-acl-ipv4-basic-2000]displaythis #aclbasic2000 rule5permitsource192.168.4.100rule10permitsource192.168.4.150... 如果存在netconfsoap{http|https}acl命令配置，请按需选择执行以下操作： 确保客户端的IP地址在相关ACL的rule命令允许的IP地址列表中。 通过执行undonetconfsoap{http|https}acl，使NETCONFoverSOAP不再关联ACL。 (4)使用本地认证时，检查客户端对应的本地用户是否可以使用HTTP/HTTPS服务。 进入本地用户视图，执行displaythis命令，确保配置了service-typehttphttps。 <Sysname>system-view [Sysname]local-usertest [Sysname-luser-manage-test]displaythis # local-usertestclassmanageservice-typehttphttps authorization-attributeuser-rolenetwork-operator (5)使用本地认证时，通过displaydomain命令检查用户认证域下的认证、授权、计费配置。 <Sysname>displaydomain Total12domains Domain:system Currentstate:Active Stateconfiguration:Active Defaultauthenticationscheme:Local Defaultauthorizationscheme:Local Defaultaccountingscheme:Local... 例如，用户认证域为system时，如果缺省的Authentication、Authorization、Accounting方案不为Local，请执行以下命令，将login用户的认证、授权、计费方案配置为Local。 <Sysname>system-view [Sysname]domainsystem [Sysname-isp-system]authenticationloginlocal [Sysname-isp-system]authorizationloginlocal [Sysname-isp-system]accountingloginlocal (6)检查登录到设备的用户数是否达到允许用户数的上限。 在设备上使用displaynetconfservice命令查看ActiveSessions字段（当前活跃的NETCONF会话数量），如果该字段值已达到aaasession-limit命令配置的HTTP/HTTPS类型的最大用户连接数ssion-limit{http|https}m(，请选择以下一种方式进行调整：通过aaase)ax-sessions命令，配置更大的 HTTP/HTTPS用户的连接数上限。 使用<kill-session>操作，强制释放已建立的部分SOAP类型的NETCONF会话，使新的用户能够上线。 #查看NETCONF会话信息的命令如下： <Sysname>displaynetconfsessionSessionID:1Sessiontype:SOAPUsername:yy... #<kill-session>操作的XML报文示例如下： <rpcmessage-id=""100""xmlns=""urn:ietf:params:xml:ns:netconf:base:1.0""><kill-session> <session-id>1</session-id> </kill-session> </rpc> (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •NETCONF/6/SOAP_XML_LOGIN 21.1.2SSH方式登录失败 ",Suggestion not provided
设备作为NTP客户端，未能同步NTP服务器端的时钟。在设备上执行displayntp-servicestatus命令，显示信息中Clockstatus字段的取值为unsynchronized，表示NTP时钟未同步,"本类故障的常见原因主要包括：•NTP配置错误。 •NTP时间同步链路不通。 •链路震荡，时延不稳定。 •NTP服务器端时间同步异常。 3.故障分析 本类故障的诊断流程如图4-11所示。 图4-11NTP时钟不同步的故障诊断流程图 4.处理步骤 NTP支持以下几种工作模式： •客户端/服务器模式 •对等体模式 •广播模式 •组播模式 其中客户端/服务器模式、广播模式和组播模式均基于C/S模型。以下处理步骤基于C/S模型，设备作为客户端、NTP时钟未同步的情况进行描述。如果采用对等体模式由本端同步对端的时间，也可使用下述处理步骤，此时本端相当于C/S模型中的客户端。 (1)在设备上执行displayntp-service[ipv6]sessions命令，如果没有显示信息，则表示未开启NTP功能，请参照配置手册先配置NTP功能。如果有显示信息，请按照以下步骤定位： a.查看source字段的取值是否为预期的NTP服务器端的IP地址。如果不是，请执行步骤（5）修改NTP的配置。 b.对于IPv4NTP功能，请查看stra字段的取值，对于IPv6NTP功能，请查看Clockstratum字段的取值，如果取值为16，请登录NTP服务器端并执行ntp-servicerefclock-master命令修改NTP服务器端的NTP层级。时钟层数为16的设备不能对外提供时钟。 c.对于IPv4NTP功能，请查看reach字段的取值，对于IPv6NTP功能，请查看Reachabilities字段的取值，如果取值为0，表示路由不可达，请执行步骤（3）来处理。 IPv4NTP会话显示信息样例： <Sysname>displayntp-servicesessions sourcereferencestrareachpollnowoffsetdelaydisper********************************************************************************[12345]LOCAL(0)LOCL0164-0.00000.00007937.9 [5]1.1.1.1INIT16064-0.00000.00000.0000 Notes:1source(master),2source(peer),3selected,4candidate,5configured.Totalsessions:1 IPv6NTP会话显示信息样例： <Sysname>displayntp-serviceipv6sessions Notes:1source(master),2source(peer),3selected,4candidate,5configured. Source:[12345]3000::32 Reference:127.127.1.0Clockstratum:2 Reachabilities:1Pollinterval:64 Lastreceivetime:6Offset:-0.0 Roundtripdelay:0.0Dispersion:0.0 Totalsessions:1 (2)检查NTP相关配置是否正确。根据组网规划，确认设备使用的NTP工作模式。根据NTP使用的工作模式，在设备上执行 displaycurrent-configuration|includentp-service命令查看NTP相关配 置，来进一步排查当前NTP相关配置是否正确。例如，当采用客户端/服务器模式，并且本端 命令为系统视图下的ntp-service[ipv6]unicast-server。 系统时间的获取方式为NTP，对应的配置命令为系统视图下的clockprotocolntp。 如果需要使用NTP验证功能，还要求在设备和NTP服务器端上均配置的认证密钥必须一致，且本设备上使用的认证密钥对应的秘钥ID在对端设备上是可信的。对应的配置命令为系统视图下的ntp-serviceauthentication-keyid（配置的认证密钥）和ntp-servicereliableauthentication-keyid（配置认证密钥对应的秘钥ID是可信的）。 (3)执行ping命令，检查设备和NTP服务器端之间是否路由可达。 如果可以Ping通，说明设备和NTP服务器端之间路由可达，请执行步骤（4）。 如果无法Ping通，请参见“Ping不通”故障处理方式，先解决网络不通问题。待设备和网管之间可以Ping通后，再执行步骤（4）。 (4)配置debuggingntp-serviceall命令打开NTP调试信息开关，查看调试信息，出现 以下两种情况时，本端不会同步NTP服务器端的时钟： 如果调试信息中出现“Thepacketfromip-addressfailedthevaliditytestsresult”，则表示设备从NTP服务器（IP地址为ip-address）接收到的报文未通过合法性检查，检查结果为result，设备不会同步该NTP服务器的时钟。 NTP报文调试信息中，“rdel:delay”、“rdsp:disper”，如果delay>16000、 disper>16000或delay/2+disper>16000，则表示NTP服务器提供的时钟偏差过大，设备不会同步该NTP服务器的时钟。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 NTP报文交互较慢，使用debuggingntp-serviceall命令开启NTP调试信息开关后，请等待5～10分钟后再收集调试信息。 5.告警与日志相关告警无 相关日志无 4.8Ping和Tracert故障处理 4.8.1Ping不通 ",Suggestion not provided
设备作为NTP客户端，未能同步NTP服务器端的时钟。在设备上执行displayntp-servicestatus命令，显示信息中Clockstatus字段的取值为unsynchronized，表示NTP时钟未同步。 ,"本类故障的常见原因主要包括：•NTP配置错误。 •NTP时间同步链路不通。 •链路震荡，时延不稳定。 •NTP服务器端时间同步异常。 3.故障分析 本类故障的诊断流程如图4-11所示。 图4-11NTP时钟不同步的故障诊断流程图 4.处理步骤 NTP支持以下几种工作模式： •客户端/服务器模式 •对等体模式 •广播模式 •组播模式 其中客户端/服务器模式、广播模式和组播模式均基于C/S模型。以下处理步骤基于C/S模型，设备作为客户端、NTP时钟未同步的情况进行描述。如果采用对等体模式由本端同步对端的时间，也可使用下述处理步骤，此时本端相当于C/S模型中的客户端。 (1)在设备上执行displayntp-service[ipv6]sessions命令，如果没有显示信息，则表示未开启NTP功能，请参照配置手册先配置NTP功能。如果有显示信息，请按照以下步骤定位： a.查看source字段的取值是否为预期的NTP服务器端的IP地址。如果不是，请执行步骤（5）修改NTP的配置。 b.对于IPv4NTP功能，请查看stra字段的取值，对于IPv6NTP功能，请查看Clockstratum字段的取值，如果取值为16，请登录NTP服务器端并执行ntp-servicerefclock-master命令修改NTP服务器端的NTP层级。时钟层数为16的设备不能对外提供时钟。 c.对于IPv4NTP功能，请查看reach字段的取值，对于IPv6NTP功能，请查看Reachabilities字段的取值，如果取值为0，表示路由不可达，请执行步骤（3）来处理。 IPv4NTP会话显示信息样例： <Sysname>displayntp-servicesessions sourcereferencestrareachpollnowoffsetdelaydisper********************************************************************************[12345]LOCAL(0)LOCL0164-0.00000.00007937.9 [5]1.1.1.1INIT16064-0.00000.00000.0000 Notes:1source(master),2source(peer),3selected,4candidate,5configured.Totalsessions:1 IPv6NTP会话显示信息样例： <Sysname>displayntp-serviceipv6sessions Notes:1source(master),2source(peer),3selected,4candidate,5configured. Source:[12345]3000::32 Reference:127.127.1.0Clockstratum:2 Reachabilities:1Pollinterval:64 Lastreceivetime:6Offset:-0.0 Roundtripdelay:0.0Dispersion:0.0 Totalsessions:1 (2)检查NTP相关配置是否正确。根据组网规划，确认设备使用的NTP工作模式。根据NTP使用的工作模式，在设备上执行 displaycurrent-configuration|includentp-service命令查看NTP相关配 置，来进一步排查当前NTP相关配置是否正确。例如，当采用客户端/服务器模式，并且本端 命令为系统视图下的ntp-service[ipv6]unicast-server。 系统时间的获取方式为NTP，对应的配置命令为系统视图下的clockprotocolntp。 如果需要使用NTP验证功能，还要求在设备和NTP服务器端上均配置的认证密钥必须一致，且本设备上使用的认证密钥对应的秘钥ID在对端设备上是可信的。对应的配置命令为系统视图下的ntp-serviceauthentication-keyid（配置的认证密钥）和ntp-servicereliableauthentication-keyid（配置认证密钥对应的秘钥ID是可信的）。 (3)执行ping命令，检查设备和NTP服务器端之间是否路由可达。 如果可以Ping通，说明设备和NTP服务器端之间路由可达，请执行步骤（4）。 如果无法Ping通，请参见“Ping不通”故障处理方式，先解决网络不通问题。待设备和网管之间可以Ping通后，再执行步骤（4）。 (4)配置debuggingntp-serviceall命令打开NTP调试信息开关，查看调试信息，出现 以下两种情况时，本端不会同步NTP服务器端的时钟： 如果调试信息中出现“Thepacketfromip-addressfailedthevaliditytestsresult”，则表示设备从NTP服务器（IP地址为ip-address）接收到的报文未通过合法性检查，检查结果为result，设备不会同步该NTP服务器的时钟。 NTP报文调试信息中，“rdel:delay”、“rdsp:disper”，如果delay>16000、 disper>16000或delay/2+disper>16000，则表示NTP服务器提供的时钟偏差过大，设备不会同步该NTP服务器的时钟。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 NTP报文交互较慢，使用debuggingntp-serviceall命令开启NTP调试信息开关后，请等待5～10分钟后再收集调试信息。 5.告警与日志相关告警无 相关日志无 4.8Ping和Tracert故障处理 4.8.1Ping不通 ",Suggestion not provided
设备作为SSH服务器，用户使用SSH客户端登录设备失败。 ,"本类故障的常见原因主要包括： •SSH客户端与设备之间路由不通，无法建立TCP连接。 •设备未开启SSH服务器功能。 •设备上配置了对SSH客户端的访问控制，且客户端的IP地址不在ACL定义的permit规则范围内。 •客户端指定的服务端口号与服务器端不一致。 •设备上的SSH版本与客户端不兼容。 •设备上未生成本地密钥对。 •服务器主机密钥与设备上缓存的密钥不匹配。 •用户线的认证方式或接入协议配置不正确。 •设备上的本地用户视图下未配置SSH服务。 •SSH用户的服务类型或认证方式配置不正确。 •设备上SSH2协议使用的算法与客户端不匹配。 •设备上VTY用户线资源不足。 •设备上SSH登录用户数达到上限。 3.故障分析 本类故障的诊断流程如图4-44所示。图4-44SSH登录失败故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通设备。使用ping命令检查网络连接情况。 如果Ping不通，请参见“Ping不通的定位思路”继续定位，确保SSH客户端能Ping通服务器端。 如果可以Ping通，请执行步骤（2）。 (2)检查SSH服务器功能是否开启。 当设备上出现如下日志时，表示SSH服务器功能未开启。 SSHS/6/SSHS_SRV_UNAVAILABLE:TheSCPserverisdisabledortheSCPservicetypeisnotsupported. 可以在设备上执行displaysshserverstatus命令，检查Stelnet服务器功能、SFTP服务器功能、NETCONFoverSSH服务器功能和SCP服务器功能是否按需开启。 <Sysname>displaysshserverstatus Stelnetserver:Disable SSHversion:2.0 SSHauthentication-timeout:60second(s) SSHserverkeygeneratinginterval:0hour(s)SSHauthenticationretries:3time(s) SFTPserver:Disable SFTPServerIdle-Timeout:10minute(s) NETCONFserver:DisableSCPserver:Disable 如果未开启，请在设备上执行如下命令，开启相关的SSH服务器功能。 <Sysname>system-view [Sysname]sshserverenable [Sysname]sftpserverenable [Sysname]scpserverenable[Sysname]netconfsshserverenable 如果已开启，请执行步骤（3）。 (3)检查是否设置了对客户端的访问控制。首先检查设备上是否通过sshserveracl命令设置了对客户端的访问控制。 如果已设置，请检查客户端的IP地址是否在ACL的permit规则中。当设备上出现如下日志时，表示客户端的IP地址不在ACL的permit规则中。 SSHS/5/SSH_ACL_DENY:TheSSHconnectionrequestfrom181.1.1.10wasdeniedbyACLrule(ruleID=20). SSHS/5/SSH_ACL_DENY:TheSSHconnectionrequestfrom181.1.1.11wasdeniedbyACLrule(defaultrule). −如果不在，请修改ACL配置，使得客户端的IP地址在ACL的permit规则中。如果对所有SSH客户端都不需要进行访问控制，请删除对客户端的访问控制。 −如果在，请执行步骤（4）。 如果未设置，请执行步骤（4）。 (4)检查客户端指定的服务端口号是否与服务器端一致。 如果服务器端修改了SSH服务端口号，客户端仍然使用缺省端口号登录时，会出现登录失败。 以我司设备作为客户端为例，会出现如下错误提示信息：Failedtoconnecttohost10.1.1.1port100. 如果客户端登录时指定的端口号与服务器端不一致，请在服务器端设备上执行displaycurrent-configuration|includessh命令查看服务器端配置的端口号，将客户端登录时指定的端口修改为与服务器端一致。 如果客户端登录时指定的端口号与服务器端一致，请执行步骤（5）。 (5)检查服务器的SSH版本与客户端版本是否兼容。 当设备上出现如下日志时，表示设备的SSH版本与客户端版本不兼容。 SSHS/6/SSHS_VERSION_MISMATCH:SSHclient192.168.30.117failedtologinbecauseofversionmismatch. 如果使用SSH1版本的客户端登录设备，可以在设备上执行displaysshserverstatus命令查看SSHversion字段确认SSH版本。 如果SSHversion显示为1.99，则表示设备可以兼容SSH1版本的客户端，请执行步骤（6）。 如果SSHversion显示为2.0，请在设备上执行sshservercompatible-ssh1xenable命令设置设备兼容SSH1版本的客户端。 (6)检查服务器上是否生成了本地密钥对。 设备作为SSH服务器时，必须配置本地非对称密钥对。虽然一个客户端只会采用DSA、ECDSA或RSA公钥算法中的一种来认证服务器，但是由于不同客户端支持的公钥算法不同，为了确保客户端能够成功登录服务器，建议在服务器上生成DSA、ECDSA和RSA三种密钥对。在设备上执行displaypublic-keylocalpublic命令查看当前设备上的密钥对信息。 如果DSA、ECDSA和RSA三种密钥对都不存在，请执行public-keylocalcreate命令依次进行配置。 如果已配置，请执行步骤（7）。 (7)检查服务器主机密钥与客户端上缓存的服务器主机密钥对是否一致。如果客户端首次登录服务器设备时选择保存了服务器端主机密钥，当服务器设备更新本地密钥对后，将会导致客户端认证服务端失败。以我司设备作客户端为例，当客户端登录时，出现如下提示信息，则表示服务器主机密钥与客户端上本地缓存的密钥不一致。 Theserver'shostkeydoesnotmatchthelocalcachedkey.Eithertheserveradministratorhaschangedthehostkey,oryouconnectedtoanotherserverpretendingtobethisserver.Pleaseremovethelocalcachedkey,beforeloggingin! 如果不一致，请执行undopublic-keypeer命令，删除客户端保存的旧的服务端主机密钥。 如果一致，请执行步骤（8）。 (8)查看VTY用户线下配置的认证方式及允许接入的协议是否正确。当客户端为Stelnet客户端和NETCONFoverSSH客户端时，需要在VTY用户线视图下，执行displaythis命令查看配置的认证方式是否为scheme、允许接入的协议是否包含SSH。 [Sysname]linevty063 [Sysname-line-vty0-63]displaythis #linevty063 authentication-modescheme user-rolenetwork-adminidle-timeout00 # 如果认证方式或者接入协议配置不正确，请将认证方式修改为scheme、将允许接入的协议修改为包含SSH。 如果均配置正确，请执行步骤（9）。 (9)检查本地用户是否授权了SSH服务。（仅针对本地认证） 在本地用户视图下，执行displaythis命令查看用户可以使用的服务类型是否包含SSH。 [Sysname]local-usertest [Sysname-luser-manage-test]displaythis # local-usertestclassmanageservice-typesshauthorization-attributeuser-rolenetwork-admin authorization-attributeuser-rolenetwork-operator 不包含，请在本地用户视图下通过service-type命令修改配置。 如果包含，请执行步骤（10）。 如果为远程认证方式，请参见“AAA故障处理”进行定位。 (10)检查是否配置了SSH用户并指定正确的服务类型和认证方式。 SSH支持Stelnet、SFTP、NETCONF和SCP四种用户服务类型。 首先，根据服务器采用的认证类型，根据如下规则，查看设备上是否创建正确的SSH用户。 如果服务器采用了publickey认证，则必须在设备上创建相应的SSH用户，以及同名的本地用户（用于下发授权属性：工作目录、用户角色）。 如果服务器采用了password认证，则必须在设备上创建相应的本地用户（适用于本地认证），或在远程服务器（如RADIUS服务器，适用于远程认证）上创建相应的SSH用户。 这种情况下，并不需要通过本配置创建相应的SSH用户，如果创建了SSH用户，则必须保证指定了正确的服务类型以及认证方式。 如果服务器采用了keyboard-interactive、password-publickey或any认证，则必须在设备上创建相应的SSH用户，以及在设备上创建同名的本地用户（适用于本地认证）或者在远程认证服务器上创建同名的SSH用户（如RADIUS服务器，适用于远程认证）。 接着，根据检查的结果，进行如下操作： 如果未创建且无需创建，请执行步骤（11）；如果未创建但有需求创建，请通过sshuser命令进行配置。 如果已创建，检查SSH用户的服务类型和认证方式。 −SSH用户指定的服务类型必须与客户端类型（Stelnet客户端、SFTP客户端、SCP客户端和NETCONFoverSSH客户端）相匹配，否则将会因为服务类型不匹配而登录失败。SSH用户服务类型是否正确，通过如下方式来检查： 以SCP客户端为例，如果设备上出现如下日志，表示服务类型不匹配。 SSHS/6/SSHS_SRV_UNAVAILABLE:TheSCPserverisdisabledortheSCPservicetypeisnotsupported. 请在设备系统视图下执行sshuser命令，修改SSH用户的服务类型。 −请在设备上执行displaysshuser-information命令，查看SSH服务器采用的认证方式，根据具体的认证方式检查设备上SSH用户的配置是否正确。 (11)检查设备上SSH2协议使用的算法列表是否与客户端匹配。 通过displayssh2algorithm命令查看当前SSH2协议使用的算法列表，检查客户端支持的算法是否包含在算法列表中。比如，设备上配置了不使用CBC相关的加密算法，但SSH客户端仅支持CBC相关加密算法，将导致该客户端无法登录服务器。 当设备上出现如下日志信息时，表示设备上SSH2协议使用的算法列表是否与客户端不匹配。 SSHS/6/SSHS_ALGORITHM_MISMATCH:SSHclient192.168.30.117failedtologinbecauseofencryptionalgorithmmismatch. 如果客户端使用的算法与设备上的算法不匹配，可通过如下两种方式进行修改： −设备可以通过执行ssh2algorithmcipher、ssh2algorithmkey-exchange、ssh2algorithmmac或ssh2algorithmpublic-key命令修改相关算法列表，增加客户端支持的算法。 −在客户端添加服务端支持的相关算法。 如果客户端使用的算法与设备上的算法能够匹配，请执行步骤（12）。 (12)检查设备上VTY用户数是否达到允许用户数的上限。SSH用户与Telnet用户登录均使用VTY用户线，但是VTY用户线是有限资源。若VTY类型用户线都已被占用，则后续使用Stelnet及NETCONFoverSSH服务的客户端将无法登录，使用SFTP及SCP服务的客户端不占用用户线资源，不受影响，仍可登录。当设备上出现如下日志时，表示设备上VTY用户数已达到允许用户数的上限。 SSHS/6/SSHS_REACH_USER_LIMIT:SSHclient192.168.30.117failedtologin,becausethenumberofusersreachedtheupperlimit.通过displayline命令查看VTY用户线资源是否充足。 如果VTY用户线资源不足，可将空闲且非scheme认证方式的VTY类型用户线认证方式修改为scheme认证方式；若所有VTY类型用户线都已是scheme认证方式且均处于active状态，可执行freelinevty命令强制释放VTY用户线，使得新的SSH用户能够上线。 如果VTY用户线资源充足，请执行步骤（13）。(13)检查登录服务器的SSH用户数是否达到允许用户数的上限。通过displaysshserversession命令查看服务器的会话信息，以及查看通过aaasession-limitssh命令配置的SSH最大用户连接数。 当设备上出现如下日志时，表示登录服务器的SSH用户数已达到允许用户数的上限。 SSHS/6/SSHS_REACH_SESSION_LIMIT:SSHclient192.168.30.117failedtologin.ThenumberofSSHsessionsis10,andexceededthelimit(10). 如果SSH会话数已达到上限，可通过执行aaasession-limitssh命令调大上限；如果配置的最大用户连接数已为可配置的最大值，可执行freessh命令强制释放已建立的部分SSH连接或者执行freelinevty命令强制释放VTY用户线，使得新的SSH用户能够上线。 如果未达上限，请执行步骤（14）。 (14)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：HH3C-SSH-MIB •hh3cSSHVersionNegotiationFailure(1.3.6.1.4.1.25506.2.22.1.3.0.2)相关日志 •SSHS/5/SSH_ACL_DENY •SSHS/6/SSHS_ALGORITHM_MISMATCH •SSHS/6/SSHS_REACH_SESSION_LIMIT •SSHS/6/SSHS_REACH_USER_LIMIT•SSHS/6/SSHS_SRV_UNAVAILABLE •SSHS/6/SSHS_VERSION_MISMATCH 4.15.2设备作为SSH服务器，用户使用password认证方式登录失败 ",Suggestion not provided
设备作为SSH服务器，用户使用公钥认证登录失败。 ,"本类故障的常见原因主要包括： •SSH客户端与设备之间路由不通，无法建立TCP连接。 •服务器端配置的用户公钥不正确。 •设备未开启SSH服务器功能。 •SSH服务器上不存在该SSH登录用户。 •设备上配置了对SSH客户端的访问控制，且客户端的IP地址不在ACL定义的permit规则范围内。 •设备上SSH登录用户数达到上限。 •设备上的SSH版本与客户端不兼容。 •SSH用户的服务类型或认证方式配置不正确。 •设备上未生成本地密钥对。 •SCP/SFTP工作目录不正确。 3.故障分析 本类故障的诊断流程如图1-2所示。 图4-46SSH客户端使用publickey认证方式登录服务器失败（设备作为服务器）故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通设备。使用ping命令查看网络连接情况。 如果Ping不通，请参见“Ping不通的定位思路”继续定位，确保SSH客户端能Ping通服务器端。 如果可以Ping通，请执行步骤（2）。 (2)检查服务器端配置的用户公钥和用户使用的私钥是否匹配。SSH客户端可能支持多种公钥算法，每种公钥算法对应不同的非对称密钥对。只有服务器端保存的用户公钥类型与用户登录时使用的私钥类型一致时，用户认证才会成功。例如，服务器端为某用户指定了DSA类型的公钥，用户也持有与之相匹配的私钥，但是登录时用户使用的私钥类型为RSA，此时用户认证会失败。通过在设备上执行displaypublic-keypeer 命令查看保存在设备上的客户端公钥信息，判断是否与正在登录用户使用的私钥类型一致： 如果不一致，请执行public-keylocalcreate命令在设备上生成相应类型的密钥对。 如果一致，请执行步骤（3）。 (3)检查SSH服务器功能是否开启。 当设备上出现如下日志时，表示SSH服务器功能未开启。 SSHS/6/SSHS_SRV_UNAVAILABLE:TheSCPserverisdisabledortheSCPservicetypeisnotsupported. 可以在设备上执行displaysshserverstatus命令，检查Stelnet服务器功能、SFTP服务器功能、NETCONFoverSSH服务器功能和SCP服务器功能是否按需开启。 <Sysname>displaysshserverstatus Stelnetserver:Disable SSHversion:2.0 SSHauthentication-timeout:60second(s) SSHserverkeygeneratinginterval:0hour(s)SSHauthenticationretries:3time(s) SFTPserver:Disable SFTPServerIdle-Timeout:10minute(s) NETCONFserver:DisableSCPserver:Disable 如果未开启，请在设备上执行如下命令，开启相关的SSH服务器功能。 <Sysname>system-view [Sysname]sshserverenable [Sysname]sftpserverenable [Sysname]scpserverenable[Sysname]netconfsshserverenable 如果已开启，请执行步骤（4）。 (4)检查客户端指定的服务端口号是否与服务器端一致。 如果服务器端修改了SSH服务端口号，客户端仍然使用缺省端口号登录时，会出现登录失败。以我司设备作为客户端为例，会出现如下错误提示信息：Failedtoconnecttohost10.1.1.1port100. 如果客户端登录时指定的端口号与服务器端不一致，请在服务器端设备上执行displaycurrent-configuration|includessh命令查看服务器端配置的端口号，将客户端登录时指定的端口修改为与服务器端一致。 如果客户端登录时指定的端口号与服务器端一致，请执行步骤（5）。 (5)检查是否设置了对客户端的访问控制。 首先检查设备上是否通过sshserveracl命令设置了对客户端的访问控制。 如果已设置，请检查客户端配置是否在ACL的permit规则中，请先在设备上通过sshserveracl-deny-logenable命令开启匹配ACLdeny规则后打印日志信息功能。 当设备上出现如下日志时，表示客户端的IP地址不在ACL的permit规则中。 SSHS/5/SSH_ACL_DENY:TheSSHconnectionrequestfrom181.1.1.10wasdeniedbyACLrule(ruleID=20). SSHS/5/SSH_ACL_DENY:TheSSHconnectionrequestfrom181.1.1.11wasdeniedbyACLrule(defaultrule). −如果不在，请修改ACL配置，使得客户端的IP地址在ACL的permit规则中。如果对所有SSH客户端都不需要进行访问控制，请删除对客户端的访问控制。 −如果在，请执行步骤（6）。 如果未设置，请执行步骤（6）。 (6)检查服务器的SSH版本与客户端版本是否兼容。 当设备上出现如下日志时，表示设备的SSH版本与客户端版本不兼容。 SSHS/6/SSHS_VERSION_MISMATCH:SSHclient192.168.30.117failedtologinbecauseofversionmismatch. 如果使用SSH1版本的客户端登录设备，可以在设备上执行displaysshserverstatus命令查看SSHversion字段确认SSH版本。 如果SSHversion显示为1.99，则表示设备可以兼容SSH1版本的客户端，请执行步骤（7）。 如果SSHversion显示为2.0，请在设备上执行sshservercompatible-ssh1xenable命令设置设备兼容SSH1版本的客户端。(7)查看VTY用户线下配置的认证方式及允许接入的协议是否正确。当客户端为Stelnet客户端和NETCONFoverSSH客户端时，需要在VTY用户线视图下，执行displaythis命令查看配置的认证方式是否为scheme、允许接入的协议是否包含SSH。 [Sysname]linevty063 [Sysname-line-vty0-63]displaythis #linevty063 authentication-modeschemeuser-rolenetwork-adminidle-timeout00 # 如果认证方式或者接入协议配置不正确，请通过authentication-modescheme命令将认证方式修改为scheme、通过protocolinboundssh命令将允许接入的协议修改为包含SSH。 如果均配置正确，请执行步骤（8）。 (8)检查设备上VTY用户数是否达到允许用户数的上限。 SSH用户与Telnet用户登录均使用VTY用户线，但是VTY用户线是有限资源。若VTY类型用户线都已被占用，则后续使用Stelnet及NETCONFoverSSH服务的客户端将无法登录，使用SFTP及SCP服务的客户端不占用用户线资源，不受影响，仍可登录。当设备上出现如下日志时，表示设备上VTY用户数已达到允许用户数的上限。 SSHS/6/SSHS_REACH_USER_LIMIT:SSHclient192.168.30.117failedtologin,becausethenumberofusersreachedtheupperlimit. 通过displayline命令查看VTY用户线资源是否充足。 如果VTY用户线资源不足，可将空闲且非scheme认证方式的VTY类型用户线认证方式修改为scheme认证方式；若所有VTY类型用户线都已是scheme认证方式且均处于active状态，可执行freelinevty命令强制释放VTY用户线，使得新的SSH用户能够上线。 如果VTY用户线资源充足，请执行步骤（9）。 (9)检查登录服务器的SSH用户数是否达到允许用户数的上限。 通过displaysshserversession命令查看服务器的会话信息，以及查看通过aaasession-limitssh命令配置的SSH最大用户连接数。 当设备上出现如下日志时，表示登录服务器的SSH用户数已达到允许用户数的上限。 SSHS/6/SSHS_REACH_SESSION_LIMIT:SSHclient192.168.30.117failedtologin.ThenumberofSSHsessionsis10,andexceededthelimit(10). 如果SSH会话数已达到上限，可通过执行aaasession-limitssh命令调大上限；如果配置的最大用户连接数已为可配置的最大值，可执行freelinevty命令强制释放 VTY用户线，使得新的SSH用户能够上线。 如果未达上限，请执行步骤（10）。 (10)检查服务器上是否生成了本地密钥对。 为了防止“伪服务器欺骗”，客户端验证服务器身份时，首先判断服务器发送的公钥与本地保存的服务器公钥是否一致，确认服务器公钥正确后，再使用该公钥对服务器发送的数字签名进行验证。如果客户端没有保存服务器的公钥或保存的服务器公钥不正确，则服务器身份验证将会失败，从而导致客户端无法登录服务器。因此，客户端登录服务器之前，需要先在服务器端创建密钥对，并将正确的服务器公钥保存在客户端。 虽然一个客户端只会采用DSA、ECDSA或RSA公钥算法中的一种来认证服务器，但是由于不同客户端支持的公钥算法不同，为了确保客户端能够成功登录服务器，建议在服务器上生成 DSA、ECDSA和RSA三种密钥对。 在设备上执行displaypublic-keylocalpublic命令查看当前设备上的密钥对信息。 如果DSA、ECDSA和RSA三种密钥对都不存在，请执行public-keylocalcreate 命令依次进行配置。 如果已配置，请执行步骤（11）。 (11)检查是否配置了SSH用户并指定正确的服务类型和认证方式。 SSH支持Stelnet、SFTP、NETCONF和SCP四种用户服务类型。 首先，根据服务器采用的认证类型，查看设备上是否创建正确的SSH用户。 由于服务器采用了publickey认证，则必须在设备上创建相应的SSH用户，以及同名的本地用户（用于下发授权属性：工作目录、用户角色）。 接着，根据检查的结果，进行如下操作： 如果未创建，请通过sshuser命令进行配置。 如果已创建，检查SSH用户的服务类型和认证方式。 −请在设备上执行displaysshuser-information命令，分别通过“Service-type” 和“Authentication-type”字段查看SSH用户的服务类型及认证方式。其中，服务类型必须与客户端类型（Stelnet客户端、SFTP客户端、SCP客户端或NETCONFoverSSH客户端）相匹配，认证方式必须为publickey。 −请在设备系统视图下执行sshuser命令，将SSH用户的服务类型和认证方式修改正确。。 (12)检查SCP/SFTP工作目录配置是否正确。当SSH用户的服务方式为SCP/SFTP时，需要为该用户设置授权目录。如果所配置的授权目录不存在，SCP/SFTP客户端通过该用户连接SCP/SFTP服务器就会失败。对于publickey ibutework-directorydirectory-name命令修改授权的工作目录。 如果存在，请执行步骤（13）。 (13)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：HH3C-SSH-MIB •hh3cSSHVersionNegotiationFailure(1.3.6.1.4.1.25506.2.22.1.3.0.2)相关日志 •SSHS/5/SSH_ACL_DENY •SSHS/6/SSHS_ALGORITHM_MISMATCH •SSHS/6/SSHS_REACH_SESSION_LIMIT •SSHS/6/SSHS_REACH_USER_LIMIT •SSHS/6/SSHS_SRV_UNAVAILABLE •SSHS/6/SSHS_VERSION_MISMATCH 4.15.4设备作为SSH客户端，用户使用password认证方式登录失败 ",Suggestion not provided
设备作为SSH服务器，用户使用密码认证登录设备失败。 ,"本类故障的常见原因主要包括： •SSH客户端与设备之间路由不通，无法建立TCP连接。 •SSH客户端登录密码不正确。 •设备未开启SSH服务器功能。 •SSH服务器上不存在该SSH登录用户。 •设备上配置了对SSH客户端的访问控制，且客户端的IP地址不在ACL定义的permit规则范围内。 •设备上SSH登录用户数达到上限。 •设备上的SSH版本与客户端不兼容。 •SSH用户的服务类型或认证方式配置不正确。 •设备上未生成本地密钥对。 •SCP/SFTP工作目录不正确。3.故障分析 本类故障的诊断流程如图4-45所示。 图4-45SSH客户端使用password认证方式登录服务器失败（设备作为服务器）故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通设备。使用ping命令查看网络连接情况。 如果Ping不通，请参见“Ping不通的定位思路”继续定位，确保SSH客户端能Ping通服务器端。 如果可以Ping通，请执行步骤（2）。 (2)检查登录密码是否正确。 a.如果服务器采用本地认证，请确认当前用户登录的密码是否与设备上设备管理类本地用户视图下配置的密码一致： −如果不一致，请重新输入正确的密码。若忘记密码，可以进入设备管理类本地用户视图（用户名为当前登录的用户）下，执行password命令重新配置新的密码，确保登录密码与配置的密码一致。 −如果一致，请执行步骤4.15.14.(2)。 b.如果服务器采用远程认证，请确认当前用户登录的密码是否与认证服务器上配置的一致： −如果不一致，请重新输入正确的密码。若忘记密码，可以在服务器上为登录用户重新设置密码，确保登录密码与认证服务器上配置的一致。 −如果一致，请执行步骤4.15.14.(2)。 (3)检查SSH服务器功能是否开启。 当设备上出现如下日志时，表示SSH服务器功能未开启。 SSHS/6/SSHS_SRV_UNAVAILABLE:TheSCPserverisdisabledortheSCPservicetypeisnotsupported. 可以在设备上执行displaysshserverstatus命令，检查Stelnet服务器功能、SFTP服务器功能、NETCONFoverSSH服务器功能和SCP服务器功能是否按需开启。 <Sysname>displaysshserverstatus Stelnetserver:Disable SSHversion:2.0 SSHauthentication-timeout:60second(s) SSHserverkeygeneratinginterval:0hour(s)SSHauthenticationretries:3time(s) SFTPserver:Disable SFTPServerIdle-Timeout:10minute(s) NETCONFserver:DisableSCPserver:Disable 如果未开启，请在设备上执行如下命令，开启相关的SSH服务器功能。 <Sysname>system-view [Sysname]sshserverenable [Sysname]sftpserverenable [Sysname]scpserverenable[Sysname]netconfsshserverenable 如果已开启，请执行步骤（4）。 (4)检查客户端指定的服务端口号是否与服务器端一致。 如果服务器端修改了SSH服务端口号，客户端仍然使用缺省端口号登录时，会出现登录失败。 以我司设备作为客户端为例，会出现如下错误提示信息：Failedtoconnecttohost10.1.1.1port22. 如果客户端登录时指定的端口号与服务器端不一致，请在服务器端设备上执行displaycurrent-configuration|includessh命令查看服务器端配置的端口号，将客户端登录时指定的端口修改为与服务器端一致。 如果客户端登录时指定的端口号与服务器端一致，请执行步骤（5）。 (5)检查是否设置了对客户端的访问控制。首先检查设备上是否通过sshserveracl命令设置了对客户端的访问控制。 如果已设置，请检查客户端的配置是否在ACL的permit规则中，请先在设备上通过sshserveracl-deny-logenable命令开启匹配ACLdeny规则后打印日志信息功能。 当设备上出现如下日志时，表示客户端的IP地址不在ACL的permit规则中。 SSHS/5/SSH_ACL_DENY:TheSSHconnectionrequestfrom181.1.1.10wasdeniedbyACLrule(ruleID=20). SSHS/5/SSH_ACL_DENY:TheSSHconnectionrequestfrom181.1.1.11wasdeniedbyACLrule(defaultrule). −如果不在，请修改ACL配置，使得客户端的IP地址在ACL的permit规则中。如果对所有SSH客户端都不需要进行访问控制，请删除对客户端的访问控制。 −如果在，请执行步骤4.15.14.(5)。 如果未设置，请执行步骤4.15.14.(5)。 (6)检查服务器的SSH版本与客户端版本是否兼容。 当设备上出现如下日志时，表示设备的SSH版本与客户端版本不兼容。 SSHS/6/SSHS_VERSION_MISMATCH:SSHclient192.168.30.117failedtologinbecauseofversionmismatch. 如果使用SSH1版本的客户端登录设备，可以在设备上执行displaysshserverstatus命令查看SSHversion字段确认SSH版本。 如果SSHversion显示为1.99，则表示设备可以兼容SSH1版本的客户端，请执行步骤 4.15.14.(8)。 如果SSHversion显示为2.0，请在设备上执行sshservercompatible-ssh1xenable命令设置设备兼容SSH1版本的客户端。(7)查看VTY用户线下配置的认证方式及允许接入的协议是否正确。当客户端为Stelnet客户端或NETCONFoverSSH客户端时，需要在VTY用户线视图下，执行displaythis命令查看配置的认证方式是否为scheme、允许接入的协议是否包含SSH。 [Sysname]linevty063 [Sysname-line-vty0-63]displaythis #linevty063 authentication-modeschemeuser-rolenetwork-adminidle-timeout00 # 如果认证方式或者接入协议配置不正确，请通过authentication-modescheme命令将认证方式修改为scheme、通过protocolinboundssh命令将允许接入的协议修改为包含SSH。 如果均配置正确，请执行步骤4.15.14.(12)。 (8)检查设备上VTY用户数是否达到允许用户数的上限。 SSH用户与Telnet用户登录均使用VTY用户线，但是VTY用户线是有限资源。若VTY类型用户线都已被占用，则后续使用Stelnet及NETCONFoverSSH服务的客户端将无法登录，使用SFTP及SCP服务的客户端不占用用户线资源，不受影响，仍可登录。当设备上出现如下日志时，表示设备上VTY用户数已达到允许用户数的上限。 SSHS/6/SSHS_REACH_USER_LIMIT:SSHclient192.168.30.117failedtologin,becausethenumberofusersreachedtheupperlimit. 通过displayline命令查看VTY用户线资源是否充足。 如果VTY用户线资源不足，可将空闲且非scheme认证方式的VTY类型用户线认证方式修改为scheme认证方式；若所有VTY类型用户线都已是scheme认证方式且均处于active状态，可执行freelinevty命令强制释放VTY用户线，使得新的SSH用户能够上线。 如果VTY用户线资源充足，请执行步骤（13）。 (9)检查登录服务器的SSH用户数是否达到允许用户数的上限。 通过displaysshserversession命令查看服务器的会话信息，以及查看通过aaasession-limitssh命令配置的SSH最大用户连接数。 当设备上出现如下日志时，表示登录服务器的SSH用户数已达到允许用户数的上限。 SSHS/6/SSHS_REACH_SESSION_LIMIT:SSHclient192.168.30.117failedtologin.ThenumberofSSHsessionsis10,andexceededthelimit(10). 如果SSH会话数已达到上限，可通过执行aaasession-limitssh命令调大上限；如果配置的最大用户连接数已为可配置的最大值，可执行freelinevty命令强制释放 VTY用户线，使得新的SSH用户能够上线。 如果未达上限，请执行步骤（10）。 (10)检查服务器上是否生成了本地密钥对。 为了防止“伪服务器欺骗”，客户端验证服务器身份时，首先判断服务器发送的公钥与本地保存的服务器公钥是否一致，确认服务器公钥正确后，再使用该公钥对服务器发送的数字签名进行验证。如果客户端没有保存服务器的公钥或保存的服务器公钥不正确，则服务器身份验证将会失败，从而导致客户端无法登录服务器。因此，客户端登录服务器之前，需要先在服务器端创建密钥对，并将正确的服务器公钥保存在客户端。 虽然一个客户端只会采用DSA、ECDSA或RSA公钥算法中的一种来认证服务器，但是由于不同客户端支持的公钥算法不同，为了确保客户端能够成功登录服务器，建议在服务器上生成 DSA、ECDSA和RSA三种密钥对。 在设备上执行displaypublic-keylocalpublic命令查看当前设备上的密钥对信息。 如果DSA、ECDSA和RSA三种密钥对都不存在，请执行public-keylocalcreate 命令依次进行配置，并确保将服务器上生成的公钥保存到客户端。 如果已配置，请执行步骤4.15.14.(10)。 (11)检查是否配置了SSH用户并指定正确的服务类型和认证方式。 SSH支持Stelnet、SFTP、NETCONF和SCP四种用户服务类型。 首先，根据服务器采用的认证类型，查看设备上是否创建正确的SSH用户。 由于服务器采用了password认证，必须在设备上创建相应的本地用户（适用于本地认证），或在远程服务器（如RADIUS服务器，适用于远程认证）上创建相应的SSH用户。对于采用远程认证方式的情况，不需要通过本配置创建相应的SSH用户，如果创建了SSH用户，则必须保证指定了正确的服务类型以及认证方式。接着，根据检查的结果，进行如下操作： 如果未创建且无需创建，请执行步骤（12）；如果未创建且需要创建，请通过sshuser命令进行配置。 如果已创建，检查SSH用户的服务类型和认证方式。 −请在设备上执行displaysshuser-information命令，分别通过“Service-type” 和“Authentication-type”字段查看SSH用户的服务类型及认证方式。其中，服务类型必须与客户端类型（Stelnet客户端、SFTP客户端、SCP客户端或NETCONFoverSSH客户端）相匹配，认证方式必须为password。 −请在设备系统视图下执行sshuser命令，将SSH用户的服务类型和认证方式修改正确。 (12)检查SCP/SFTP工作目录配置是否正确。 当SSH用户的服务方式为SCP/SFTP时，需要为用户设置授权目录。如果所配置的授权目录不存在，SCP/SFTP客户端通过该用户连接SCP/SFTP服务器就会失败。对于password认 ributework-directorydirectory-name命令修改授权的工作目录。 如果存在，请执行步骤（13）。 (13)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：HH3C-SSH-MIB •hh3cSSHVersionNegotiationFailure(1.3.6.1.4.1.25506.2.22.1.3.0.2)相关日志 •SSHS/5/SSH_ACL_DENY •SSHS/6/SSHS_ALGORITHM_MISMATCH •SSHS/6/SSHS_REACH_SESSION_LIMIT •SSHS/6/SSHS_REACH_USER_LIMIT •SSHS/6/SSHS_SRV_UNAVAILABLE •SSHS/6/SSHS_VERSION_MISMATCH 4.15.3设备作为SSH服务器，用户使用publickey认证方式登录失败 ",Suggestion not provided
设备作为SSH客户端，用户使用password认证方式登录SSH服务器失败。 ,"本类故障的常见原因主要包括： •SSH客户端与服务器端之间路由不通，无法建立TCP连接。 •SSH客户端登录密码不正确。 •服务器上未生成本地密钥对。 •服务器主机密钥与SSH客户端上缓存的密钥不匹配。 •客户端的SSH版本与服务器端不兼容。 3.故障分析 本类故障的诊断流程如图4-47所示。 图4-47设备作为客户端采用password认证方式登录SSH服务器失败故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通服务器端。使用ping命令查看网络连接情况。 如果Ping不通，请参见“Ping不通的定位思路”继续定位，确保SSH客户端能Ping通服务器端。 如果可以Ping通，请执行步骤（2）。 (2)检查登录密码是否正确。 a.如果服务器采用本地认证，请确认当前用户登录的密码是否与设备上设备管理类本地用户视图下配置的密码一致： −如果不一致，请重新输入正确的密码。若忘记密码，可以在服务器上进入设备管理类本地用户视图（用户名为当前登录的用户）下，执行password命令重新配置新的密码，确保登录密码与配置的密码一致（此处以我司设备作为SSH服务器为例）。 −如果一致，请执行步骤（3）。 b.如果服务器采用远程认证，请确认当前用户登录的密码是否与认证服务器上配置的一致： −如果不一致，请重新输入正确的密码。若忘记密码，可以在服务器上为登录用户重新设置密码，确保登录密码与认证服务器上配置的一致。 −如果一致，请执行步骤（3）。 (3)检查服务器上是否生成了本地密钥对。 为了防止“伪服务器欺骗”，客户端验证服务器身份时，首先判断服务器发送的公钥与本地保存的服务器公钥是否一致，确认服务器公钥正确后，再使用该公钥对服务器发送的数字签名进行验证。如果客户端没有保存服务器的公钥或保存的服务器公钥不正确，则服务器身份验证将会失败，从而导致客户端无法登录服务器。因此，客户端登录服务器之前，需要先在服务器端创建密钥对，并将正确的服务器公钥保存在客户端。 虽然一个客户端只会采用DSA、ECDSA或RSA公钥算法中的一种来认证服务器，但是由于不同客户端支持的公钥算法不同，为了确保客户端能够成功登录服务器，建议在服务器上生成 DSA、ECDSA和RSA三种密钥对。 以我司设备作为SSH服务器为例，在服务器上执行displaypublic-keylocalpublic 钥对都不存在，请执行public-keylocalcreate 命令依次进行配置，并确保将服务器上生成的公钥保存到客户端。 如果已配置，请执行步骤（4）。 (4)检查服务器的SSH版本与客户端版本是否兼容。 以我司设备作为SSH服务器为例，当服务器上出现如下日志时，表示服务器的SSH版本与客户端版本不兼容。 SSHS/6/SSHS_VERSION_MISMATCH:SSHclient192.168.30.117failedtologinbecauseofversionmismatch. 如果使用SSH1版本的客户端登录设备，可以在服务器上执行displaysshserverstatus命令查看SSHversion字段确认SSH版本。 如果SSHversion显示为1.99，则表示服务器上可以兼容SSH1版本的客户端，请执行步 如果SSH(骤（7）。)version显示为2.0，请在服务器上执行sshservercompatible-ssh1xenable命令设置设备兼容SSH1版本的客户端。 (5)检查服务器主机密钥与客户端上缓存的服务器主机密钥对是否一致。 如果客户端首次登录服务器设备时选择保存了服务器端主机密钥，当服务器设备更新本地密钥对后，将会导致客户端认证服务端失败。 以我司设备作为SSH服务器为例，当设备作为客户端登录时，若出现如下提示信息，则表示服务器主机密钥与客户端上本地缓存的密钥不一致。 Theserver'shostkeydoesnotmatchthelocalcachedkey.Eithertheserveradministratorhaschangedthehostkey,oryouconnectedtoanotherserverpretendingtobethisserver. Pleaseremovethelocalcachedkey,beforeloggingin! 如果不一致，请在客户端上执行undopublic-keypeer命令，删除客户端保存的旧的服务端主机密钥。 如果一致，请执行步骤（6）。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.15.5设备作为SSH客户端，用户使用publickey认证方式登录失败 ",Suggestion not provided
设备作为SSH客户端，用户使用publickey认证方式登录SSH服务器失败。 ,"本类故障的常见原因主要包括： •SSH客户端与服务器端之间路由不通，无法建立TCP连接。 •服务器上未生成本地密钥对。 •服务器端配置的用户公钥不正确。 •服务器主机密钥与SSH客户端上缓存的密钥不匹配。 •客户端的SSH版本与服务器端不兼容。 3.故障分析 本类故障的诊断流程如图4-48所示。 图4-48设备作为客户端使用publickey认证方式登录SSH服务器失败故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通服务器端。使用ping命令查看网络连接情况。 如果Ping不通，请参见“Ping不通的定位思路”继续定位，确保SSH客户端能Ping通服务器端。 如果可以Ping通，请执行步骤（2）。 (2)检查服务器端配置的用户公钥和用户使用的私钥是否匹配。 SSH客户端可能支持多种公钥算法，每种公钥算法对应不同的非对称密钥对。只有服务器端保存的用户公钥类型与用户登录时使用的私钥类型一致时，用户认证才会成功。例如，服务器端为某用户指定了DSA类型的公钥，用户也持有与之相匹配的私钥，但是登录时用户使用的 SSH以我司设备作为服务器为例，通过在(私钥类型为RSA，此时用户认证会失败。)服务器上执行displaypublic-keypeer命令查看保存在设备上的客户端公钥信息，判断是否与正在登录用户使用的私钥类型一致： 如果不一致，请执行public-keylocalcreate命令在服务器上生成相应类型的密钥对。 如果一致，请执行步骤（3）。 (3)检查服务器上是否生成了本地密钥对。为了防止“伪服务器欺骗”，客户端验证服务器身份时，首先判断服务器发送的公钥与本地保存的服务器公钥是否一致，确认服务器公钥正确后，再使用该公钥对服务器发送的数字签名进行验证。如果客户端没有保存服务器的公钥或保存的服务器公钥不正确，则服务器身份验证将会失败，从而导致客户端无法登录服务器。因此，客户端登录服务器之前，需要先在服务器端创建密钥对，并将正确的服务器公钥保存在客户端。 虽然一个客户端只会采用DSA、ECDSA或RSA公钥算法中的一种来认证服务器，但是由于不同客户端支持的公钥算法不同，为了确保客户端能够成功登录服务器，建议在服务器上生成 DSA、ECDSA和RSA三种密钥对。 以我司设备作为SSH服务器为例，在服务器上执行displaypublic-keylocalpublic 钥对都不存在，请执行public-keylocalcreate 命令依次进行配置。 如果已配置，请执行步骤（4）。 (4)检查服务器的SSH版本与客户端版本是否兼容。 当服务器上出现如下日志时，表示服务器的SSH版本与客户端版本不兼容。 SSHS/6/SSHS_VERSION_MISMATCH:SSHclient192.168.30.117failedtologinbecauseofversionmismatch. 以我司设备作为SSH服务器为例，如果使用SSH1版本的客户端登录设备，可以在服务器上执行displaysshserverstatus命令查看SSHversion字段确认SSH版本。 如果SSHversion显示为1.99，则表示服务器上可以兼容SSH1版本的客户端，请执行步 如果SSH(骤（5）。)version显示为2.0，请在服务器上执行sshservercompatible-ssh1xenable命令设置设备兼容SSH1版本的客户端。 (5)检查服务器主机密钥与客户端上缓存的服务器主机密钥对是否一致。 如果客户端首次登录服务器设备时选择保存了服务器端主机密钥，当服务器设备更新本地密钥对后，将会导致客户端认证服务端失败。 以我司设备作为SSH服务器为例，当设备作为客户端登录时，若出现如下提示信息，则表示服务器主机密钥与客户端上本地缓存的密钥不一致。 Theserver'shostkeydoesnotmatchthelocalcachedkey.Eithertheserveradministratorhaschangedthehostkey,oryouconnectedtoanotherserverpretendingtobethisserver. Pleaseremovethelocalcachedkey,beforeloggingin! 如果不一致，请在客户端上执行undopublic-keypeer命令，删除客户端保存的旧的服务端主机密钥。 如果一致，请执行步骤（6）。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 无 4.16QoS故障处理 4.16.1流量不匹配分类的定位思路 ",Suggestion not provided
设备作为Telnet服务器时，用户通过Telnet客户端登录设备失败,本类故障的常见原因主要包括： •Telnet客户端和设备间网络不畅通。 •Telnet客户端未启用Telnet相关功能。 •设备未开启Telnet服务。 •VTY用户线下未配置支持Telnet协议。 •登录用户名、密码不正确。 •登录设备的用户数达到了上限。 •设备上配置了对Telnet用户的访问控制，Telnet客户端不在所引用ACL的规则中permit的用户范围之内。 •认证方式配置不正确。 •当Telnet客户端和Telnet服务器均为我司设备时，用户未从Telnet客户端上指定的发送Telnet报文的源地址或源接口登录Telnet服务器。 3.故障分析 本类故障的诊断流程如图4-3所示。 图4-3Telnet登录失败的故障诊断流程图 4.处理步骤 (1)检查客户端能否Ping通设备。 用户在Telnet客户端上执行ping命令查看Telnet客户端和设备之间网络连接情况。如果不能Ping通设备的IP地址，表示Telnet客户端和设备无法建立Telnet连接，则Telnet客户端登录将失败。无法Ping通设备，也可能是终端设备禁Ping导致。请参见“Ping和Tracert故障处理手册”继续定位，确保Telnet客户端与设备之间的网络畅通。 (2)检查客户端上是否启用Telnet相关功能。通常，在PC机上新建Telnet连接前，需要在PC上的“打开或关闭Windows功能”中启用“Telnet客户端”功能。移动端等其他类型的设备作为Telnet客户端时，开启Telnet相关功能的详细介绍和使用方法请参见该设备的使用指导。 (3)检查设备侧是否开启Telnet服务。缺省情况下，Telnet服务处于关闭状态。如果系统视图下执行displaythis命令后，没有显示telnetserverenable的配置信息，表示Telnet服务处于关闭状态。请先执行telnetserverenable命令开启Telnet服务，确保设备允许客户端通过Telnet登录。 (4)检查客户端登录设备的用户名和密码是否正确。当用户向设备发起Telnet连接，在Telnet客户端按照提示输入登录设备的用户名和密码后，若系统提示认证失败，则建议重新输入用户名和密码，再次尝试登录设备。如果依旧登录失败， 可以查看LOGIN/5/LOGIN_INVALID_USERNAME_PWD日志，若日志中显示类似如下内容时表示用户输入无效的用户名或密码： LOGIN/5/LOGIN_INVALID_USERNAME_PWD:Invalidusernameorpasswordfromvty0. 如果忘记正确的登录用户名或密码，请修改认证方式为不认证，或重置密码，并通知用户再次 户线类视图下执行authentication-modenone命令，设置用户登 录设备时的认证方式为不认证，用户不需要输入用户名和密码，就可以使用该用户线登录设备，但这种方式存在安全隐患，请谨慎配置。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modenone 如果登录用户的认证方式为密码认证，在用户线视图或用户线类视图下执行setauthenticationpassword命令来重新设置认证密码。 <Sysname>system-view [Sysname]linevty063 [Sysname-line-vty0-63]authentication-modepassword [Sysname-line-vty0-63]setauthenticationpasswordsimplehello12345&！ 如果登录用户的认证方式为AAA认证，请参见“AAA&PasswordControl故障处理手册”重置密码。(5)检查登录设备的用户数是否达到了上限。从Console口登录到设备，在任意视图下执行displayusers命令查看当前的Telnet用户数。缺省情况下，同时在线的Telnet用户数上限为32个。可以查看TELNETD/6/TELNETD_REACH_SESSION_LIMIT日志，若日志中显示类似如下内容，表示Telnet登录用户达到上限： TELNETD/6/TELNETD_REACH_SESSION_LIMIT:Telnetclient1.1.1.1failedtologin.ThecurrentnumberofTelnetsessionsis10.Themaximumnumberallowedis(10). 如果登录设备的用户数已经达到了上限，可以先断开其他空闲Telnet用户的连接，或者执行aaasession-limittelnet命令增加允许同时在线的最大用户连接数，然后再向设备发起Telnet连接。(6)查看设备上是否引用了ACL对Telnet用户的访问进行控制。 在系统视图下执行displaythis命令，如果显示telnetserveracl、telnetserveripv6acl相关配置信息，表示引用了ACL对访问设备的Telnet的用户进行控制。 确认所引用的ACL规则中允许了Telnet客户端的IP地址、端口号、协议号等。可以查看TELNETD_ACL_DENY日志，若日志中显示类似如下内容，表示TelnetACL规则限制登录IP地址： TELNETD/5/TELNETD_ACL_DENY:TheTelnetConnection1.2.3.4(vpn1)requestwasdeniedaccordingtoACLrules. 执行undotelnetserveracl或undotelnetserveripv6acl命令来取消 ACL对Telnet用户的访问限制。(7)检查设备上认证方式配置是否正确。在任意视图下执行displayline命令查看用户线下用户登录设备时的认证方式，其中“Auth”字段表示使用该用户线登录的用户的认证方式，取值为“A”表示使用AAA认证方式，取值为“N”表示无需认证，取值为“P”表示使用当前用户线的密码进行认证。 如果使用命令authentication-modepassword配置了VTY用户线下的登录认证方 如果使用命令authentication-modesche(式为密码认证，还需要确保设置了认证密码。)me设置认证方式为AAA，则必须确保已经创建了AAA认证用户。 (8)当Telnet客户端和Telnet服务器均为我司设备时，检查Telnet客户端上是否配置了发送Telnet 在系统视图下执行displ(报文的源地址或源接口。)aythis命令，如果显示中包含telnetclientsource的相关配置信息，表示Telnet客户端上指定了发送Telnet报文的源IPv4地址和源接口，请确保用户从Telnet客户端上指定的源IPv4地址或源接口登录Telnet服务器。若登录失败，请选择以 ource命令重新配置发送Telnet报文的源IPv4地址或源接口。 执行undotelnetclientsource命令来恢复缺省情况，即不指定发送Telnet报文的源IPv4地址和源接口，使用报文路由出接口的主IPv4地址作为Telnet报文的源地址。需要注意的是， 在用户视图下执行telnet命令也可以指定Telnet报文的源接口或源IPv4地址，若同时使用telnetclientsource命令和telnet命令指定源IPv4地址或源接口，则以telnet命令指定的源IP地址或源接口为准。 在IPv6组网环境下，可以通过用户视图下的telnetipv6命令来指定Telnet报文的源接口或源IPv6地址。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.1.4客户端可以Ping通CPE，也能Telnet到CPE，但是无法通过Web登录成功 ,Suggestion not provided
设置AP分片门限为256，Client关联到AP上后，从AP上ping客户端，指定选项–s500，抓包确认，发现ping包并未分片,WMM协议规定，开启WMM功能后不支持报文分片，所以需要使用wmmdisable命令将WMM功能关掉后再测试报文分片功能。 5.5无线网卡提示Windows无法配置无线连接，而WirelessZeroConfigure服务已经启动 ,WMM协议规定，开启WMM功能后不支持报文分片，所以需要使用wmmdisable命令将WMM功能关掉后再测试报文分片功能。 5.5无线网卡提示Windows无法配置无线连接，而WirelessZeroConfigure服务已经启动 
使用两台或多台AP建立Mesh连接，虽然Mesh可以建立成功，但经常up/down,•两台AP建立Mesh连接后，可能一台AP启动了STP，另外一个没有启动STP协议，引起 Mesh不稳定，所以当只有两台AP建立Mesh连接时，可以不在AP上启动STP协议，或者在两台AP上都启动STP协议。 •多台AP建立Mesh连接后，可能没有启动STP，造成环路，此时需要在每台AP上都启动 STP协议，避免造成环路。 4.8两台FITAP无法建立Mesh连接或经过MAP的ping操作失败 ,•两台AP建立Mesh连接后，可能一台AP启动了STP，另外一个没有启动STP协议，引起 Mesh不稳定，所以当只有两台AP建立Mesh连接时，可以不在AP上启动STP协议，或者在两台AP上都启动STP协议。 •多台AP建立Mesh连接后，可能没有启动STP，造成环路，此时需要在每台AP上都启动 STP协议，避免造成环路。 4.8两台FITAP无法建立Mesh连接或经过MAP的ping操作失败 
使用同一登录方式接入设备的用户达到一定数量后，后续该类用户登录设备失败。 如果设备上同时打开了相关接入模块的事件调试信息开关，系统会打印如下形式的调试信息： %Aug1810:57:52:5962021SysnameTELNETD/6/TELNETD_REACH_SESSION_LIMIT:-MDC=1;Telnetclient1.1.1.1failedtologin.ThecurrentnumberofTelnetsessionsis5.Themaximumnumberallowedis(5). ,本类故障的主要常见原因为，设备上设置了采用指定登录方式登录设备并同时在线的用户数。 3.故障分析 本类故障的诊断流程如图4-34所示： 图4-34使用相同登录方式接入用户数达到上限后的故障诊断流程图 4.处理步骤 (1)检查是否设置了采用指定登录方式登录设备并同时在线的用户数。 如果当前配置中存在aaasession-limit命令，则可以根据需要在系统视图下通过aaasession-limit{ftp|http|https|ssh|telnet}max-sessions命令改变使用当前登录方式接入设备的最大用户数（下例中为32）。 <Sysname>system-view [Sysname]aaasession-limittelnet32 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.13.11RADIUS服务器无响应 ,Suggestion not provided
"使用同一用户名接入设备的本地认证用户达到一定数量后，后续使用该用户名登录设备失败。 如果设备上同时打开了Local-Server的事件调试信息开关（通过执行debugginglocal-server event命令），系统会打印如下形式的调试信息： *Aug1810:52:56:6642021SysnameLOCALSER/7/EVENT:-MDC=1; Authenticationfailed,themaximumnumberofconcurrentloginsalreadyreachedforthelocaluser. ",本类故障的主要原因为，设备上设置了使用当前本地用户名接入设备的最大用户数。 3.故障分析 本类故障的诊断流程如图137所示。图137使用相同用户名的上线用户数达上限后的故障诊断流程图 4.处理步骤 (1)检查是否设置了使用当前本地用户名接入设备的最大用户数。 执行displaylocal-user命令，查看该用户名的本地用户配置信息。如果其中的“Accesslimit:”字段取值为Enabled，则表示设置了使用当前本地用户名接入设备的最大用户数（下例中为2）。 <Sysname>displaylocal-useruser-nametestclassmanageTotal1localusersmatched. Devicemanagementusertest: Servicetype:SSH/Telnet Accesslimit:EnabledMaxaccessnumber:2Servicetype:Telnet Usergroup:system Bindattributes: Authorizationattributes: Workdirectory:flash: Userrolelist:test ... 可以根据需要在本地用户视图下取消或者改变使用当前本地用户名接入设备的最大用户数。 通过执行undoaccess-limit命令取消使用当前本地用户名接入的用户数限制。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]undoaccess-limit 通过执行access-limitmax-user-number命令增加最大用户数（下例中为10）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]access-limit10 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 18.2.10相同接入类型的在线用户数达到上限 ,Suggestion not provided
"使用同一用户名接入设备的本地认证用户达到一定数量后，后续使用该用户名登录设备失败。 如果设备上同时打开了Local-Server的事件调试信息开关（通过执行debugginglocal-serverevent命令），系统会打印如下形式的调试信息： *Aug1810:52:56:6642021SysnameLOCALSER/7/EVENT:-MDC=1; Authenticationfailed,themaximumnumberofconcurrentloginsalreadyreachedforthelocaluser. ",本类故障的主要原因为，设备上设置了使用当前本地用户名接入设备的最大用户数。 3.故障分析 本类故障的诊断流程如图4-33所示。图4-33使用相同用户名的上线用户数达上限后的故障诊断流程图 4.处理步骤 (1)检查是否设置了使用当前本地用户名接入设备的最大用户数。 执行displaylocal-user命令，查看该用户名的本地用户配置信息。如果其中的“Accesslimit:”字段取值为Enabled，则表示设置了使用当前本地用户名接入设备的最大用户数（下例中为2）。 <Sysname>displaylocal-useruser-nametestclassmanageTotal1localusersmatched. Devicemanagementusertest: Servicetype:SSH/Telnet Accesslimit:EnabledMaxaccessnumber:2 Servicetype:TelnetUsergroup:system Bindattributes: Authorizationattributes: Workdirectory:flash: Userrolelist:test ... 可以根据需要在本地用户视图下取消或者改变使用当前本地用户名接入设备的最大用户数。 通过执行undoaccess-limit命令取消使用当前本地用户名接入的用户数限制。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]undoaccess-limit 通过执行access-limitmax-user-number命令增加最大用户数（下例中为10）。 <Sysname>system-view [Sysname]local-usertestclassmanage [Sysname-luser-manage-test]access-limit10 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 4.13.10相同接入类型的在线用户数达到上限 ,Suggestion not provided
通过displaylogbuffer命令查看系统日志时，发现存在上报非H3C合法光模块的相关信息。相关日志信息显示如下： ThistransceiverisNOTsoldbyH3C.H3CthereforeshallNOTguaranteethenormalfunctionofthedeviceorassumethemaintenanceresponsibilitythereof! ,•设备当前版本不支持该光模块。 •光口有异物或光模块金手指被污染、损坏。 •光模块与接口速率不匹配。 •光口故障。 •光模块或线缆故障。 •光模块与光纤类型不匹配。 3.故障分析本类故障的诊断流程如3.6.13.图18所示。 图25故障诊断流程图 4.处理步骤 (1)检查设备当前版本是否支持该光模块。 可通过产品安装手册或软件版本说明书查看当前软件版本是否支持该光模块。如果有新版本支持该光模块，也可以升级软件版本。 (2)检查光模块与端口/两端端口的速率、双工模式是否匹配。 执行displayinterface命令，查看端口与光模块/两端端口的速率、双工配置是否匹配。 若不匹配，请通过speed命令和duplex命令配置端口的速率和双工模式。 (3)检查是否满足了端口的特殊配置要求。 部分交换机存在一些特殊的配置，满足这些配置后，相应端口才能UP。例如： 对于25G、100G和400G端口，部分交换机的端口下提供portfecmode{auto|none|rs-fec}命令行，用于控制FEC的模式，以使不同型号设备之间能够对接。链路两端使用的FEC模式必须一致。 对于25G端口，部分交换机的端口下提供porttraining{disable|enable}命令行，用于控制链路补偿功能的开关状态，以使不同型号设备之间能够对接。链路两端的链路补偿功能开启状态必须一致。 部分交换机会将端口分组，同一组中的端口速率配置需要保持一致。当用户需要修改某个端口的速率时，该配置会在同一组中的所有端口上生效。当用户使用default命令恢复当前端口的缺省配置时，端口工作速率会重置为缺省值，且该配置会在同一组中的所有端口上生效。 有关各个产品的具体配置限制，请参见“二层技术—以太网交换配置指导”或“接口管理配置指导”中的“以太网接口”。 (4)检查光接口是否故障。 在本设备上的相同速率的光口上用匹配的线缆（适用于短距离连接）直接互连，查看该端口是否能UP。如果能UP，则说明对端端口异常；如果不能UP，则说明本端端口异常。可通过更换本端与对端端口来检查故障是否解决。 (5)检查光模块/线缆是否异常。 可通过如下步骤检查光模块/线缆是否异常： a.可通过displaytransceiveralarminterface命令，查看当前端口上的光模块的 故障告警信息，若显示为“None”，则表示没有故障；若显示有告警信息，可通过查看 光模块/线缆告警信息来确认是光模块问题还是光纤或者对端问题。比如出现RXsignalloss和TXfault错误，可以查看光口、光模块是否存在异物，或者光模块金手指严重氧化。 b.可通过displaytransceiverinterface命令，检查两端的光模块类型、波长、传 c.可通过displaytrans(输距离等参数是否一致。)ceiverdiagnosisinterface命令，检查光模块的数字诊 断参数的当前测量值是否在正常范围内。参数异常常见问题及解决办法如下： −当光纤与光模块接触不良时，可通过将光线与光模块插牢解决。 −当光纤质量不好或损坏，可通过更换光纤解决。 −当传输路径增加了中间光衰设备，可根据实际使用，调整光衰设备解决。 −当光模块适配传输距离与实际使用距离相差较大，更换为与实际传输距离适配的光模块解决。 d.对怀疑故障的光模块进行交叉验证，如更换端口、与正常的光模块互换，确认是光模块本身故障还是相邻设备或中间链路故障。 (6)检查光模块类型与光纤是匹配。 可通过《H3C光模块手册》，查看光模块类型与光纤类型是否匹配。若不匹配，可通过更换光纤解决。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •OPTMOD/3/CFG_ERR •OPTMOD/5/CHKSUM_ERR •OPTMOD/5/IO_ERR •OPTMOD/4/FIBER_SFPMODULE_INVALID •OPTMOD/4/FIBER_SFPMODULE_NOWINVALID •OPTMOD/5/MOD_ALM_ON •OPTMOD/5/RX_ALM_ON •OPTMOD/5/RX_POW_HIGH •OPTMOD/5/RX_POW_LOW 3.7.2光模块上报非H3C合法光模块故障处理 光模块为第三方光模块或伪造的H3C光模块。 3.故障分析 本类故障的诊断流程如图26所示。 图26故障诊断流程图 4.处理步骤 (1)检查光模块是否为H3C光模块。 a.根据光模块上的标签判断是否为H3C认证光模块。 b.通过命令displaytransceiverinterface，查看VendorName是否是H3C。如果 显示的是H3C，则可能是没有电子标签的H3C光模块，也可能不是H3C光模块，需要进一步确认。如果显示的是其它信息，则一定不是H3C光模块，可通过更换为H3C光模块来检查故障是否排除。 [Sysname]displaytransceiverinterfacetwenty-fivegige1/0/1 Twenty-FiveGigE1/0/1transceiverinformation: TransceiverType:40G_BASE_LR4_QSFP_PLUS ConnectorType:LC Wavelength(nm):1301 TransferDistance(km):10(SMF)DigitalDiagnosticMonitoring:YES VendorName:H3C OrderingName:QSFP-40G-LR4-WDM1300 (2)与H3C的技术支持工程师确认是否是H3C光模块。 通过Probe视图下的命令displayhardwareinternaltransceiverregisterinterface和displaytransceiverinformationinterface收集光模块信息。然 后向H3C技术支持工程师反馈光模块上的条码，确认光模块的渠道来源，明确是否是H3C光模块。如果确认不是H3C光模块，可通过更换为H3C光模块来检查故障是否排除。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的日志信息、告警信息。 5.告警与日志相关告警 无 相关日志 OPTMOD/4/PHONY_MODULE 3.7.3光模块不支持数字诊断 ,Suggestion not provided
通过displaytransceiverdiagnosisinterface命令查看光模块诊断信息时，系统提示 光模块不支持数字诊断。显示如下： <Sysname>displaytransceiverdiagnosisinterfaceTwenty-FiveGigE1/0/1Thetransceiverdoesnotsupportthisfunction. ,•光模块为非H3C光模块。 •光模块不支持数字诊断。 •光模块故障。 •设备/光口故障。 3.故障分析本类故障的诊断流程如3.6.23.图19所示。 图27故障诊断流程图 4.处理步骤 (1)判断是否为H3C光模块，具体步骤见3.7.2光模块上报非H3C合法光模块故障处理。 (2)通过displaytransceiverinterface命令，查看DigitalDiagnosticMonitoring字段是否是YES，如果是YES，表明支持数字诊断，反之亦然。 (3)使用相同型号光模块插在本设备其他正常端口或者其他正常运行且支持该光模块的设备上，检查是否仍然提示不支持数字诊断。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的告警信息。 5.告警与日志相关告警无 相关日志无 3.7.4光模块序列号丢失 ,Suggestion not provided
通过displaytransceiverdiagnosisinterface命令查询OLT端口的光模块诊断信息，发现接收光功率（RXpower）超出阈值（参见以下命令行的Alarmthresholds字段）。 <HP>distransceiverdiagnosisinterfaceolt3/0/8 Olt3/0/8transceiverdiagnosticinformation: Currentdiagnosticparameters: Temp.(°C)Voltage(V)Bias(mA)RXpower(dBm)TXpower(dBm) 383.275.61-40.004.53 Alarmthresholds: Temp.(°C)Voltage(V)Bias(mA)RXpower(dBm)TXpower(dBm) High853.60100.00-4.008.00 Low-133.000.00-32.101.00 ,•ONU未注册。 •ONU端口未使用过光模块诊断命令。 ,(1)检查该光模块对应的OLT端口是否已经存在up的ONU端口，如果没有ONU端口up，则OLT接收光功率超出阈值为正常现象。等ONU注册成功后，接收光功率会变为正常。 (2)当有OLT下有ONU端口up，而OLT端口的接收光功率仍然超出阈值时，可以先通过 displaytransceiverdiagnosisinterface命令查询该OLT下任意up的ONU端口的诊断信息，然后再次查询OLT端口的光模块诊断信息，此时OLT端口的光功率应该可以正常显示（因为OLT光模块的接收光功率显示需要依赖ONU端口的光模块诊断命令来触发）。 (3)如果故障仍未排除，请收集设备运行信息并联系H3C的技术支持工程师。 4.告警与日志 相关告警无 相关日志无 3.6.10ONU端口不up 
同一台PoE交换机连接的部分AP会自动重新启动（和AC的连接断开）,PoE交换机有各自的供电规格及预留空间，所以当对外供电总量超过可以供电量时，交换机会自动断开低优先级的接口，从而造成下挂的AP设备重启。,可以通过交换机上的Log信息确认： #Apr611:26:44:3682019YXY-WLAN-04DRV_DEM/5/POEWARNING:-1-Powerbudgetexceeded #Apr611:26:44:4182019YXY-WLAN-04DRV_DEM/5/POEWARNING:-1-PoefunctionofEthernet1/0/6isdisabled. 第一个表示总的功率超过预算，无法再给新的端口供电，第二个表示断掉了一个接口的PoE供电。 解决方案是增加PoE交换机或者使用PoE模块对AP进行单独供电。 3.2AP使用电源适配器供电，系统控制平台无打印信息，同时电源指示灯未亮 
图117集中式VXLANIP网关示意图 ,"本类故障的常见原因主要包括： •VXLAN隧道状态为Down。 •VXLAN隧道的源IP或目的IP配置错误。 •VXLANIP网关接口状态为Down。 •设备上不存在ping命令对应的ARP表项。 3.故障分析 本类故障的诊断流程如图118所示。 图118Ping不通集中式VXLANIP网关的故障诊断流程图 4.处理步骤 (1)在连接服务器的VTEP上查看服务器所属的VXLAN网络的VXLAN隧道信息。 a.执行displayl2vpnvsiverbose命令查看服务器所属的VXLAN网络的VXLANID 以及与VXLAN网络关联的VXLAN隧道的名称（TunnelName字段）。 <Sysname>displayl2vpnvsiverbose VSIName:vpna VSIIndex:0 VSIState:Up MTU:1500 Bandwidth:UnlimitedBroadcastRestrain:Unlimited MulticastRestrain:Unlimited UnknownUnicastRestrain:Unlimited MACLearning:EnabledMACTableLimit:-MACLearningrate:-DropUnknown:- Flooding:Enabled Statistics:Disabled VXLANID:10 Tunnels: TunnelNameLinkIDStateTypeFloodproxy Tunnel10x5000001UpManualDisabled Tunnel20x5000002UpManualDisabled ACs: ACLinkIDStateType GE1/0/1srv10000UpManual b.根据VXLAN隧道的名称执行displayinterfacetunnel命令，查看服务器接入的VXLAN网络内VXLAN隧道的状态（Currentstate）、隧道的源IP地址（Tunnelsource）和隧道的目的IP地址（destination）。 <Sysname>displayinterfacetunnel2Tunnel2 Currentstate:UP Lineprotocolstate:UP Description:Tunnel2Interface Bandwidth:64kbps Maximumtransmissionunit:1464 Internetprotocolprocessing:DisabledLastclearingofcounters:Never Tunnelsource2.2.2.2,destination1.1.1.1 Tunnelprotocol/transportUDP_VXLAN/IP Last300secondsinputrate:0bytes/sec,0bits/sec,0packets/sec Last300secondsoutputrate:0bytes/sec,0bits/sec,0packets/sec Input:0packets,0bytes,0drops Output:0packets,0bytes,0drops −若VXLAN隧道为Up状态，请继续执行第(3)步。 −若VXLAN隧道为Down状态，请继续执行第(2)步。(2)在VTEP上查看VXLAN隧道的源IP地址是否为本端的IP地址、目的IP地址是否可达。 执行displayipinterfacebrief命令，查看VXLAN隧道的源IP地址是否为本端的IP地址。若VXLAN隧道的源IP地址不是本端的IP地址，请通过source命令修改VXLAN隧道的源IP地址。 <Sysname>displayipinterfacebrief *down:administrativelydown (s):spoofing(l):loopback InterfacePhysicalProtocolIPaddressVPNinstanceDescriptionLoop1upup(s)2.2.2.2---- MGE0/0/0upup192.168.1.61---- MGE0/0/1downdown------MTunnel0downdown--aaa-- Vlan1*downdown------ 执行displayfib命令，查看FIB表中是否存在到达VXLAN隧道的目的IP地址的表项。若不存在对应的表项，请修改路由配置，确保VXLAN隧道的目的IP地址路由可达。 <Sysname>displayfib Destinationcount:4FIBentrycount:4 Flag: U:UseableG:GatewayH:HostB:BlackholeD:DynamicS:Static R:RelayF:FRR Destination/MaskNexthopFlagOutInterface/TokenLabel 0.0.0.0/32127.0.0.1UHInLoop0Null 2.2.2.2/32127.0.0.1UHInLoop0Null1.1.1.1/32127.0.0.1UHInLoop0Null 127.0.0.0/32127.0.0.1UHInLoop0Null (3)在VXLANIP网关上执行displayinterfacevsi-interfacebrief命令，查看VXLAN IP网关接口信息，包括网关接口编号（Interface）、网关接口状态（LinkProtocol）和网关IP地址（PrimaryIP）。 <Sysname>displayinterfaceVsi-interfacebrief Briefinformationoninterfacesinroutemode: Link:ADM-administrativelydown;Stby-standbyProtocol:(s)-spoofing InterfaceLinkProtocolPrimaryIPDescription Vsi1DOWNDOWN192.168.1.1 若VXLANIP网关接口为Down状态，请查看VSI虚接口下是否配置了shutdown命令或 −若VSI虚接口下配置了shutdown命(绑定VSI虚接口的VSI是否为Up状态。)令，请执行undoshutdown命令。−若绑定VSI虚接口的VSI为Down状态，请执行displayl2vpnvsi命令，查看VSI下AC的状态。若AC的状态为Down，则检查AC配置是否正确和AC所在的接口是否Up。如果AC配置不正确或AC所在的接口为Down状态，请修改AC配置或排查接口故障。 若VXLANIP网关接口为Up状态，请执行displayarp命令查看是否学习到了网关IP对应的ARP信息。 <Sysname>displayarp Type:S-StaticD-DynamicO-OpenflowR-RuleM-MultiportI-Invalid IPaddressMACaddressVLAN/VSIInterface/LinkIDAgingType 10.1.1.10001-0001-00010Tunnel217D 10.1.1.110001-0001-00010Tunnel220D 20.1.1.10002-0002-00021Tunnel317D20.1.1.120002-0002-00021Tunnel320D −若存在网关IP对应的ARP信息，请继续执行第(4)步。。 −若不存在网关IP对应的ARP信息，请执行displayarpcount命令查看学习的表项数目是否达到了设备/接口配置的动态ARP表项的最大数目。如果达到动态ARP表项的最大数目，请执行arpmax-learning-num或arpmax-learning-number命令将允许学习的动态ARP表项的最大数目调大。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无相关日志无 15EVPN类故障处理 15.1EVPNVXLAN故障处理 15.1.1EVPN分布式网关场景，同一VXLAN内的VTEP之间隧道无法建立 ",Suggestion not provided
图67跨AS域的数据中心互联场景组网图 ,"在Border3或Border4未重启前，RR1的BGP路由表和IP路由表与下表类似： <RR1>displaybgprouting-tableipv4 Totalnumberofroutes:4 BGPlocalrouterIDis9.9.9.9 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-external a-additional-path Origin:i-IGP,e-EGP,?-incomplete NetworkNextHopMEDLocPrfPrefValPath/Ogn *>i0.0.0.0/019.1.1.11000i*i29.1.1.21000i *>e10.110.0.0/163.3.3.30020i*e4.4.4.40020i <RR1>displayiprouting-table Destinations:25Routes:25 Destination/MaskProtoPreCostNextHopInterface 0.0.0.0/0BGP255019.1.1.1GE1/0/1 0.0.0.0/32Direct00127.0.0.1InLoop0 ",Suggestion not provided
"完成MPLSTE隧道创建后，通过displayinterfacetunnel命令查看到MPLSTE隧道的当前状态为DOWN。 <Sysname>displayinterfacetunnel1Tunnel1 Currentstate:DOWN Lineprotocolstate:DOWN Description:Tunnel1Interface Bandwidth:64kbps Maximumtransmissionunit:1496 Internetaddress:7.1.1.1/24(primary) Tunnelsourceunknown,destination4.4.4.9TunnelTTL255 Tunnelprotocol/transportCR_LSP Lastclearingofcounters:Never Last300secondsinputrate:0bytes/sec,0bits/sec,0packets/sec Last300secondsoutputrate:6bytes/sec,48bits/sec,0packets/sec Input:0packets,0bytes,0drops Output:177packets,11428bytes,0drops ",本类故障的常见原因主要包括：•MPLSTE隧道所在的链路Down。 •MPLSTE配置错误。 •MPLSTE隧道的目的地址被静态路由引用。 3.故障分析 本类故障的诊断流程如图105所示。 图105MPLSTE隧道状态为Down的故障诊断流程图 4.处理步骤 (1)查看MPLSTE隧道对应的接口是否为Up状态。 执行displayinterface命令，查看MPLSTE隧道对应的接口否为Up状态。 (2)检查MPLSTE配置。依次检查如下配置： a.OSPF/IS-IS区域和MPLSTE隧道经过的接口下是否配置mplsteenable命令。 b.LSRID、RouterID是否为同一LoopBack接口的地址。 c.若使用RSVP-TE协议建立MPLSTE隧道，则需要检查设备和接口是否配置了rsvp、rsvpenable命令。 d.若隧道接口下配置了mplstebandwidth命令，检查设备出接口是否配置了mplstemax-linkbandwidth以及mplstemax-reservablebandwidth命令。 e.若隧道接口下配置了mplsteaffinity-attribute命令，检查设备出接口是否配置 合理的mplstelink-attribute命令。如果希望某条链路能够被隧道所用，则需要满足如下要求： −对于隧道亲和属性掩码为1的位，亲和属性为1的位中链路属性至少有1位也为1，亲和属性为0的位对应的链路属性位不能为1。 −对于隧道亲和属性掩码为0的位，不对链路属性的相应位进行检查。 f.若使用SegmentRouting协议建立MPLSTE隧道，则需要检查设备IGP区域下是否配置了Segment-Routing相关功能。 g.若使用mplstepath命令指定显式路径来建立MPLSTE隧道，则需要检查显式路径配置是否合理：使用strict方式时，需要逐跳指定入接口的IP地址；使用loose方式时，需要指定经过的设备的节点地址。 (3)查看MPLSTE隧道的目的地址是否被静态引用。 执行displaycurrent-configuration|includedestination命令，查看MPLSTE隧道的目的地址是否被静态引用。如果被静态路由引用，则需要根据用户的实际组网需求修改静态路由或者隧道的目的地址。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 nostic-information命令收集诊断信息。 5.告警与日志相关告警无 相关日志无 12.4.2MPLSTE隧道由UP状态变为Down状态 ,Suggestion not provided
网管（NMS）对设备执行SNMPGet和Set操作，网管侧提示操作超时，导致操作失败,本类故障的常见原因主要包括： •SNMP连接中断，导致网管无法访问设备。 •网络丢包，导致设备没有收到SNMP请求。 •设备存储介质上的存储空间不足，导致设备无法处理SNMP请求。 •设备繁忙，正在处理其它业务，导致无法处理SNMP请求。 •SNMP（作为SNMPagent）进程忙，正在处理其它SNMP请求，导致无法对当前SNMP请求做出应答。 •SNMP进程处理当前SNMP请求时发生异常。 3.故障分析 本类故障的诊断流程如图174所示。 图174SNMP操作超时的故障诊断流程图 4.处理步骤 (1)定位并处理SNMP连接问题。 在网管上查看SNMP连接，如果显示连接超时或者失败，请参照“SNMP连接失败”故障处理章节先定位并处理SNMP连接问题。 (2)检查网络是否存在丢包。 在网管设备上使用ping–ccounthost命令，例如将conut参数设置为100，host参数取值为设备的IP地址，查看ping命令执行结果中的packetloss字段取值，判断网络是否存在丢包。 如果无丢包，请参照步骤（3）继续定位； 如果有丢包，请参见“IP故障处理”中的“Ping不通”先解决网络不通问题。 (3)定位并处理设备存储介质上的存储空间不足问题。 在任意视图下执行displaymemory-threshold命令，如果显示信息中的“Currentfree-memorystate”字段取值中包含Normal字样，表示设备存储介质上的存储空间充足，否则，表示设备存储介质上的存储空间不足，请使用以下方法清理内存。 使用resetrecycle-bin命令清除回收站中的文件。（回收站中的文件也会占用存储 delete使用/unres(介质上的存储空间。）)ervedfile命令一次性彻底删除文件。如果未使用/unreserved 参数，删除的文件会保存在回收站中。 设备支持的存储介质可能为Flash等。 (4)定位并处理设备繁忙问题。 a.在任意视图下多次重复执行displaycpu-usage命令，查看设备CPU利用率是否持续 在较高水平。 b.在任意视图下执行monitorprocess命令，检查是否存在占用较多CPU的进程。如果某个业务进程占用CPU较多，可以根据业务需要以及设备支持情况，通过重启服务来降低 CPU利用率。 (5)定位SNMP进程问题。 在系统视图下执行probe命令，进入Probe视图，然后多次重复执行displaysysteminternalsnmp-agentoperationin-progress命令查看设备正在处理的SNMP操 作的相关信息。 如果显示信息中的RequestID取值一直在变化，则说明SNMP进程一直在处理不同的请求，当前SNMP进程业务较忙。请降低网管对设备的SNMP操作频率。 如果显示信息中的RequestID取值一直不变，则说明SNMP进程一直在处理同一请求， SNMP进程处理该请求时超时。可通过以下方法排除故障： −依次执行undosnmp-agent命令和snmp-agent命令重启SNMP进程，来尝试排 −执行dis(除故障。)playsysteminternalsnmp-agentoperationtimed-out和 displaysysteminternalsnmp-agentpackettimed-out命令确认耗时较 多的SNMP操作以及该操作涉及的MIB节点，减少或不要执行类似操作。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 21.5.3网管无法管理设备 ,Suggestion not provided
网管（NMS）通过SNMP协议无法成功连接设备,"本类故障的常见原因主要包括： •网络异常导致报文不可达。 •配置错误导致认证失败。 •设备受到SNMP报文攻击，进入SNMP静默模式（仅在设备支持SNMP静默模式的情况下）。 •网管被列入了SNMP黑名单（仅在设备支持SNMP黑名单的情况下）。 3.故障分析 本类故障的诊断流程如图173所示。 图173SNMP无法连接的故障诊断流程图 4.处理步骤 (1)执行ping命令，检查设备和网管之间是否路由可达。 如果可以Ping通，说明设备和网管之间路由可达，请执行步骤（2）。 如果无法Ping通，请参见“IP故障处理”中的“Ping不通”先解决网络不通问题。待设备和网管之间可以Ping通后，重新建立SNMP连接。如果重新建立SNMP连接后，SNMP连接仍不能成功建立，请执行步骤（2）。 (2)检查SNMP配置是否正确。 a.执行displaysnmp-agentsys-infoversion命令，查看设备当前使用的SNMP版本号。设备和网管使用的SNMP版本号必须相同。如果不同，需使用snmp-agentsys-infoversion命令修改配置。 b.如果当前使用的是SNMPv1或SNMPv2c版本，则执行displaysnmp-agent community命令查看设备上配置的团体信息（包括团体名和使用的ACL等信息）。设备和网管使用的团体名必须相同，且设备上配置的ACL必须允许网管访问设备。否则，需使用snmp-agentcommunity和acl命令修改配置。 c.如果当前使用的是SNMPv3版本，则执行displaysnmp-agentusm-user命令查看SNMPv3用户信息（包括用户名和使用的ACL等信息），并执行displaysnmp-agentgroup命令查看SNMP组信息（包括认证/加密模式和使用的ACL等信息）。设备和网管 使用的用户名必须相同，认证/加密参数必须一致，且设备上配置的ACL必须允许网管访问设备。否则，需使用snmp-agentgroup、snmp-agentusm-userv3和acl命令修改配置。 (3)检查设备是否进入SNMP静默状态。如果1个统计周期内（时长为1分钟）设备收到的SNMP认证失败报文的个数大于等于100，则设备认为受到了SNMP攻击，SNMP模块会进入静默状态（设备会打印日志SNMPagentisnowsilent），设备将在4～5分钟内不再响应收到的任何SNMP报文。可使用以下方式来解决静默状态下无法建立SNMP连接的问题：请等待SNMP静默状态解除后，重新建立SNMP连接。 如果设备支持关闭SNMP静默功能，可以暂时关闭SNMP静默功能，重新建立SNMP连接。连接建立后，再开启SNMP静默功能。 (4)检查网管是否被列入SNMP黑名单。 设备上开启SNMP黑名单功能后，如果网管和设备建立SNMP连接失败，则设备会将网管加入SNMP黑名单，第一次、第二次、第三次、第四次连接连续建立失败，网管会依次被锁定8秒、16秒、32秒和5分钟，黑名单中的网管在锁定期内不允许和设备建立SNMP连接。可使用以下方式来解决网管被锁定状态下无法建立SNMP连接的问题：请等待网管被解锁后，重新建立SNMP连接。 暂时关闭SNMP黑名单功能，重新建立SNMP连接。连接建立后，再开启SNMP黑名单功能。 当设备上输出以下任意一种类似的日志时，表示网管被锁定了： •SNMP_IPLOCK:ThesourceIPwaslockedfor8secondsbecauseofthefailureofloginthroughSNMP.(SourceIP=192.168.1.0,VPN=0). •SNMP_IPLOCKSTAT:Inthelast5minutes,2IPaddresseswerelocked.(IPList=(IP=192.168.73.43),(IP=192.168.73.44)). 当设备上输出以下任意一种类似的日志时，表示网管被解锁了： •SNMP_IPUNLOCK:ThesourceIPwasunlocked(SourceIP=192.168.1.0,VPN=0). •SNMP_IPUNLOCKSTAT:Inthelast5minutes,2IPaddresseswereunlocked.(IPList=(IP=192.168.73.43),(IP=192.168.73.44)). (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：SNMPv2-MIB •authenticationFailure(1.3.6.1.6.3.1.1.5.5) 相关日志 •SNMP/3/SNMP_ACL_RESTRICTION •SNMP/4/SNMP_AUTHENTICATION_FAILURE •SNMP/4/SNMP_IPLOCK（仅部分机型支持该类型日志） •SNMP/4/SNMP_IPLOCKSTAT（仅部分机型支持该类型日志） •SNMP/4/SNMP_SILENT（仅部分机型支持该类型日志） •SNMP/5/SNMP_IPUNLOCK（仅部分机型支持该类型日志） •SNMP/5/SNMP_IPUNLOCKSTAT（仅部分机型支持该类型日志） 21.5.2SNMP操作超时 ",Suggestion not provided
网管对设备执行SNMPSet或Get等操作，设备无响应或者提示操作失败,"本类故障的常见原因主要包括： •网管通过SNMP协议无法成功连接设备。 •网管使用的SNMP版本和MIB节点不匹配。 •网管没有访问设备的权限。 •设备上的SNMP进程忙，无法对当前SNMP请求做出应答。 3.故障分析 本类故障的诊断流程如图175所示。 图175网管无法管理设备的故障诊断流程图 4.处理步骤 (1)检查网管是否可以通过SNMP协议连接设备。 如果网管通过SNMP协议无法成功连接设备，请参照SNMP连接失败故障处理流程进行处理。 (2)检查网管当前使用的SNMP协议版本是否支持访问该MIB节点。 例如snmpUsmMIB只支持通过SNMPv3协议访问；Integer32、Unsigned32和Counter64 数据类型仅SNMPv2c和SNMPv3版本支持。如果网管使用SNMPv1版本和设备相连，网管将无法访问Integer32、Unsigned32和Counter64数据类型的MIB节点。MIB节点的数据类型可通过MIB文件中节点的SYNTAX字段查看。 hh3cDhcpServer2BadNumOBJECT-TYPE SYNTAXCounter64 MAX-ACCESSread-only STATUScurrent DESCRIPTION ""Thetotalnumberofthebadpacketsreceived."" ::={hh3cDhcpServer2StatGroup1} 如果因为版本原因导致网管无法访问MIB节点，请将网管切换到SNMPv2c或SNMPv3版本后，与设备重新建立连接，再执行Get和Set操作。 (3)检查MIB节点是否支持当前的访问操作。请根据MIB节点支持的操作类型来访问设备。MIB节点支持的操作类型可通过MIB文件中节点的MAX-ACCESS字段查看。 hh3cDhcpServer2BadNumOBJECT-TYPE SYNTAXCounter64 MAX-ACCESSread-only STATUScurrent DESCRIPTION ""Thetotalnumberofthebadpacketsreceived."" ::={hh3cDhcpServer2StatGroup1} (4)检查网管的访问权限。如果访问权限不够，请在设备上修改对应配置，给网管授权。SNMP支持的访问控制方式包括： VACM（View-basedAccessControlModel，基于视图的访问控制模型）：将团体名/用户 名与指定的MIB视图进行绑定，可以限制NMS能够访问哪些MIB对象，以及对MIB对象不同的操作权限。通过displaycurrent-configuration|includeview命令可查看MIB视图相关配置，通过displaysnmp-agentmib-view命令可查看MIB视图的详细信息。如果配置错误，请修改MIB的相关配置。设备支持三种MIB视图： −Read-view：网管只能读取该视图中节点的值。 −Write-view：网管可读和写该视图中节点的值。 −Notify-view：当该视图中包含的Trap节点到达触发条件，网管会收到对应的Trap/Inform报文。 RBAC（RoleBasedAccessControl，基于角色的访问控制）：我司设备通过RBAC进行用户访问权限控制。RBAC的基本思想就是给用户指定角色，这些角色中定义了允许用户操作哪些系统功能以及资源对象。创建SNMPv3用户名时，可以绑定对应的用户角色，通过用户角色下制定的规则，来限制NMS能够访问哪些MIB对象，以及对MIB对象不同的操作权限。如果RBAC权限配置错误，可以通过rolename命令进入用户角色视图修改用户角色的规则。 −拥有network-admin、mdc-admin或level-15用户角色的SNMP团体/用户，可以对所有的MIB对象进行读写操作； −拥有network-operator或mdc-operator用户角色的SNMP团体/用户，可以对所有的 MIB对象进行读操作； −拥有自定义用户角色的SNMP团体/用户，可以对角色规则中指定的MIB对象进行操作。 为了安全起见，只有具有network-admin、mdc-admin或者level-15用户角色的用户登录设备后才能配置SNMP团体、用户或组。请确保登录用户具有network-admin、mdc-admin或者level-15用户角色，以免配置失败。 (5)检查SNMP进程是否繁忙。 网管对设备执行SNMPSet或Get等操作，设备无响应或者提示操作失败，还可能因为SNMP 进程忙，无法对当前SNMP请求做出应答，请参照SNMP操作超时故障处理流程进行处理。 (6)其它建议 建议网管通过业务接口访问设备，因为业务接口的报文处理能力优于网管口，以便SNMP报文能尽快得到处理。 当有多个NMS同时访问设备，且设备反应缓慢时，建议降低访问频率来减轻设备分担，例如将访问频率设置成大于等于5分钟。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警 模块名：SNMPv2-MIB •authenticationFailure(1.3.6.1.6.3.1.1.5.5) 相关日志 •SNMP/3/SNMP_ACL_RESTRICTION •SNMP/4/SNMP_AUTHENTICATION_FAILURE •SNMP/4/SNMP_IPLOCK（仅部分机型支持本日志） •SNMP/4/SNMP_IPLOCKSTAT（仅部分机型支持本日志） •SNMP/4/SNMP_SILENT（仅部分机型支持本日志） •SNMP/5/SNMP_IPUNLOCK（仅部分机型支持本日志） •SNMP/5/SNMP_IPUNLOCKSTAT（仅部分机型支持本日志） 21.5.4网管无法收到设备发送的Trap ",Suggestion not provided
网管无法接收RMON告警信息,"本类故障的常见原因主要包括： •无对应的路由或者ARP表项。 •中间设备未开启ICMP超时报文发送功能。 •目的端未开启ICMP目的不可达报文发送功能。 3.故障分析 本类故障的诊断思路如下： (1)检查中间设备是否开启了ICMP超时报文发送功能。 (2)检查目的端是否开启了ICMP目的不可达报文发送功能。 (3)检查是否存在达到目的端的ARP以及FIB表项。 本类故障的诊断流程如图171所示。 图171Tracert不通故障诊断流程图 4.处理步骤 (1)检查中间设备是否开启了ICMP超时报文发送功能。#查看报文从源端到目的端所经过的路径（假设源端到目的端只有两跳，目的端的IP地址为 1.1.2.2）。 <Sysname>tracert1.1.2.2 tracerouteto1.1.2.2(1.1.2.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak1*** 21.1.2.2(1.1.2.2)[AS100]580ms470ms80ms 出现以上显示信息时，请登录中间设备，在中间设备上执行ipttl-expiresenable命令开启ICMP超时报文发送功能。如果故障排除，则说明中间设备未开启ICMP超时报文发送功能导致Tracert不通；如果故障未排除，请继续执行下面的步骤。 (2)检查目的端是否开启了ICMP目的不可达报文发送功能。 #查看报文从源端到目的端所经过的路径（假设源端到目的端只有两跳，目的端的IP地址为 1.1.2.2）。 <Sysname>tracert1.1.2.2 tracerouteto1.1.2.2(1.1.2.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak 11.1.1.2(1.1.1.2)[AS99]560ms430ms50ms 2*** 出现以上显示信息时，请在目的端执行ipunreachablesenable命令开启ICMP目的不可达报文发送功能。如果故障排除，则说明目的端未开启ICMP目的不可达报文发送功能；如果故障未排除，请继续执行下面的步骤。 (3)在问题节点上检查是否存在对应的FIB表项和ARP表项。在未回应ICMP差错报文的设备（tracert命令执行结果中显示为“***”的设备）上执行displayfib命令，检查是否存在到目的地址的路由。 如果路由不存在，请检查OSPF、IS-IS、BGP等路由协议配置是否有误。 如果路由存在并且报文所经链路是以太链路，请执行displayarp命令查看Tracert的下一跳地址对应的ARP表项是否存在。如果不存在，请检查ARP配置是否有误。 (4)检查Tracert发起端是否收到ICMP差错报文。发起Tracert后，在Tracert发起端上多次执行displayicmpstatistics命令查看发起端是否收到ICMP差错报文，显示信息示例如下： <Sysname>displayicmpstatistics Input:badformats0badchecksum0echo0destinationunreachable9sourcequench0redirects0echoreplies7parameterproblem0timestamp0informationrequests0maskrequests0maskreplies0timeexceeded3invalidtype0routeradvert0routersolicit0broadcast/multicastechorequestsignored0broadcast/multicasttimestamprequestsignored0 其它显示信息略…… 观察以上ICMP报文的统计信息的变化，判断Input区段内的timeexceeded和destinationunreachable值的增量是否与Tracert报文发送个数相等，如果不等则表明发起端未收到 ICMP差错报文。 (5)根据收发包统计，确认丢包位置和丢包原因。 在Tracert报文途径的设备上： a.配置QoS策略，使用ACL源地址和目的地址过滤Tracert报文，然后在Tracert报文途径 b.通过displayqospolicyinterfa(接口的入方向和出方向应用QoS策略。)ce命令查看应用QoS策略的接口上QoS策略匹 配成功的报文个数。如果报文个数有增长，则说明设备收到了Tracert报文；如果报文个数无增长，则说明设备没有收到Tracert报文，此时，可以使用debuggingippacket命令打开IP报文调试信息开关，进一步排查设备没有收到Tracert报文的原因并解决问题。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 21.4RMON故障处理 21.4.1网管无法接收RMON告警信息 本类故障的常见原因主要包括： •设备与网管之间路由不可达。 •SNMP告警功能配置错误。 •RMON统计表未创建。 •RMON事件表未创建。 •RMON告警表未创建。 •告警变量配置错误。 3.故障分析 本类故障的诊断流程如图图172所示。 图172网管无法接收RMON告警的故障诊断流程图 4.处理步骤 (1)执行ping命令，检查设备和网管之间是否路由可达。 如果可以Ping通，说明设备和网管之间路由可达，请执行步骤（2）。 如果无法Ping通，请参见“IP故障处理”中的“Ping不通”先解决网络不通问题。待设备和网管之间可以Ping通后，再执行步骤（2）。 (2)检查SNMP告警功能配置是否正确。 RMON是SNMP功能的扩展，它基于SNMP告警通道发送RMON告警信息。所以，要想收到RMON告警信息，需要先在设备上配置SNMP告警功能，并确保网管可以正常接收SNMP告警信息。 如果在网管侧能收到以下任一SNMP告警信息，请执行步骤（3）；如果网管侧未能收到以下告警信息，请参见“网络管理和监控类故障处理”中的“网管无法收到设备发送的Trap”先定位解决问题。 SNMP周期保活告警信息（如果产品不支持SNMP周期保活告警信息功能，请忽略此步骤）。 在设备上开启SNMP功能后，缺省情况下，设备会以60秒为周期生成形如“Notificationhh3cPeriodicalTrap(1.3.6.1.4.1.25506.2.38.1.6.3.0.1).”的保活告警信息。 SNMP周期保活告警信息发送参数可通过snmp-agenttrapperiodical-interval命令配置。 Login、Logout告警信息。您可以通过Telnet登录或者退出登录设备，触发设备自动生成对应的Login、Logout告警信息，来验证网管能否正常收到设备生成的告警信息。 Login告警信息形如： Notificationhh3cLogIn(1.3.6.1.4.1.25506.2.2.1.1.3.0.1)withhh3cTerminalUserName(1.3.6.1.4.1.25506.2.2.1.1.2.1.0)=;hh3cTerminalSource(1.3.6. ",Suggestion not provided
网管无法收到设备发送的Trap报文,"本类故障的常见原因主要包括： •设备和网管之间路由不可达，或者SNMP功能异常，导致无法建立SNMP连接。 •设备侧和网管侧配置错误，导致网管无法收到设备发送的告警。 •设备侧业务模块没有产生告警。 •告警报文丢失，导致网管未收到设备发送的告警。 •SNMPTrap报文过大，超过SNMP模块对Trap报文大小的限制。 3.故障分析 本类故障的诊断流程如图176所示。 图176网管无法收到设备发送的Trap的故障诊断流程图 4.处理步骤 (1)在系统视图下通过snmp-agenttraplog命令开启SNMP告警日志功能。当设备向网管发 (2)送告警时，会同时在设备buffer|includeSNMP_NOTIFY通过(上生成一条日志来记录该Trap。displaylog)命令可以查看设备上是否生成Trap以及生成的Trap详情。 如果有显示信息，说明设备有Trap生成。请执行步骤(3)。 如果没有显示信息，说明SNMP模块未向外发送Trap。请执行步骤(4)。 (3)如果设备生成了Trap，但网管未收到Trap，请参照以下步骤定位。 a.检查设备是否可以和网管建立SNMP连接。如果连接建立失败，请参见SNMP连接失败 b.故障处isplaycurrent-configuration|(理流程解决SNMP连接建立失败问题。通过d)includesnmp命令查看snmp-agenttarget-hosttrap命令配置是否正确。如果不正确，请修改配置，保证指定的IP地址（VPN参数）和端口号与网管用来接收Trap报文的IP地址（网管所属VPN）和端口号一致，以及设备和网管使用的SNMP协议、安全字一致。 −如果使用SNMPv1或SNMPv2c版本，则安全字为团体名，请在设备上使用snmp-agentcommunity命令创建SNMP团体。 −如果使用SNMPv3版本，则安全字为用户名，且设备和网管使用的认证和加密级别必须相同。您需要在设备上使用snmp-agentgroup和snmp-agentusm-userv3命 令创建SNMPv3用户，创建用户时配置的认证和加密模式、认证密码和加密密码（如果用到）必须和网管侧一致，且创建用户时配置的认证和加密级别必须比snmp-agenttarget-hosttrap命令中指定的认证和加密级别高。安全级别分为：不认证不加密、认证不加密和认证加密，安全级别依次升高。 −团体名和用户名可访问的MIBview必须包含对应的MIB告警节点，否则，会因为权限 c.执debuggingudppacket命令打开UDP行(问题导致备不会将Trap报文发送给网管。)报文的调试信息开关，查看设备发送的Trap报文是否过大。如果业务模块封装的数据较多，可能会导致Trap报文大于设备能发送的 SNMP报文的最大长度，这样的Trap报文会被丢弃。此时可结合网络的MTU值以及是否支持分片情况，通过snmp-agentpacketmax-size命令修改设备能发送的SNMP报 文的最大长度。 *Dec2722:35:41:2032021SysnameSOCKET/7/UDP:-MDC=1; UDPOutput: UDPPacket:vrf=0,src=192.168.56.121/30912,dst=192.168.56.1/162len=79,checksum=0xd98fd.检查网络中是否存在防火墙过滤Trap报文。 −如果防火墙对报文的源IP进行了过滤，可使用snmp-(如果网络中设置了防火墙，可采用以下措施来解决问题：)agenttrapsource命令修改 Trap报文的源IP地址。 −修改防火墙的规则，放行Trap报文。 e.检查网络是否不稳定，存在丢包。 如果网络中存在丢包，可采用以下措施来解决问题： −检查网络，解决网络丢包问题。 −配置使用Inform报文发送告警信息。Inform有确认机制，比Trap更可靠。Inform仅 SNMPv2c和SNMPv3支持。 (4)SNMP模块未向外发送Trap，请参照以下步骤定位。 a.通过displaysnmp-agenttrap-list查看业务模块的告警功能是否开启。如未开启，可通过snmp-agenttrapenable命令开启。 b.检查是否达到告警条件。例如接口状态告警会在接口状态发生变化时产生，CPU和内存告警会在CPU、内存的利用率超过阈值时产生等。 −如未达到告警条件，未产生Trap，属正常现象，无需处理。 −如果达到告警条件，设备未向外发送Trap，请执行步骤(c)。 c.使用displaysnmp-agenttrapqueue命令查看Trap缓冲区是否被占满。如果 Messagenumber大于Queuesize，表示Trap缓冲区可能被占满，新生成的Trap报文可能被丢弃。此时，可在系统视图下使用snmp-agenttrapqueue-size和snmp-agenttraplife命令来调整Trap缓冲区性能参数。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 •SNMP/6/SNMP_NOTIFY •SNMP/3/SNMP_INFORM_LOST 21.6镜像故障处理 21.6.1配置流镜像后监控设备收不到镜像报文 ",Suggestion not provided
网络中主机的发送报文，通过LSP隧道转发不通,本类故障的常见原因主要包括： •路由不存在。 •LSP不存在。 •路由未迭代到LSP隧道上。 •LSP隧道的转发状态非ACTIVE。 •BFD会话状态为Down。 •CPU利用率过高。 3.故障分析 本类故障的诊断流程如图109所示。 图109报文通过LSP隧道转发不通的故障诊断流程图 4.处理步骤(1)检查IGP路由是否存在。 执行displayiprouting-table命令，查看是否存在到达目的节点的Loopback接口地址的网段路由： <Sysname>displayiprouting-table1.1.1.1 Summarycount:1Destination/MaskProtoPreCostNextHopInterface ,Suggestion not provided
无法修改自动AP方式生成的AP服务模板,系统固有实现，不支持修改自动AP方式下的AP服务模板。用户需要通过wlanauto-appersistent命令将自动AP固化为手工AP后才能修改AP服务模板。 5.8AP通过版本预下载方式升级版本失败 ,系统固有实现，不支持修改自动AP方式下的AP服务模板。用户需要通过wlanauto-appersistent命令将自动AP固化为手工AP后才能修改AP服务模板。 5.8AP通过版本预下载方式升级版本失败 
无线客户端可以弹出Portal认证页面，但是输入用户名和密码，提示认证失败,(1)首先确保用户名和密码正确。 (2)如果用户名和密码无误，检查AC上的RADIUS和认证域相关配置： a.检查AC是否能和RADIUS服务器互相访问； b.检查AC配置的RADIUS认证、授权、计费服务器的IP地址、密钥是否正确； c.检查认证域是否配置正确； d.检查nas-ip地址是否和RADIUS服务器配置的接入设备IP地址相同。 (3)确保AC上的配置无误后，进一步检查RADIUS服务器配置： a.检查RADIUS服务器上配置的接入设备是否添加了该AC的IP地址以及密钥是否正确；b.检查RADIUS服务器上配置的接入服务配置中认证类型是否正确，有无下发不存在的 UserProfile、ACL等（AC上必须配置相应的UserProfile和ACL）； c.Portal认证不支持下发规则中匹配了源的ACL以及rule中带log参数的ACL。 4.6AP最多只能与两台AP建立Mesh连接，无法与第三台AP建立Mesh连接 ,(1)首先确保用户名和密码正确。 (2)如果用户名和密码无误，检查AC上的RADIUS和认证域相关配置： a.检查AC是否能和RADIUS服务器互相访问； b.检查AC配置的RADIUS认证、授权、计费服务器的IP地址、密钥是否正确； c.检查认证域是否配置正确； d.检查nas-ip地址是否和RADIUS服务器配置的接入设备IP地址相同。 (3)确保AC上的配置无误后，进一步检查RADIUS服务器配置： a.检查RADIUS服务器上配置的接入设备是否添加了该AC的IP地址以及密钥是否正确；b.检查RADIUS服务器上配置的接入服务配置中认证类型是否正确，有无下发不存在的 UserProfile、ACL等（AC上必须配置相应的UserProfile和ACL）； c.Portal认证不支持下发规则中匹配了源的ACL以及rule中带log参数的ACL。 4.6AP最多只能与两台AP建立Mesh连接，无法与第三台AP建立Mesh连接 
无线客户端上线后，无法触发Portal认证或者客户端无法弹出Portal认证页面,(1)首先检查客户端的设置。 检查客户端是否分配到正确的VLANIP地址，检查所在VLAN是否是需要进行Portal认证的VLAN，如果有误请检查DHCP服务器相关配置是否正确。 如果客户端分配到的地址是正确的，检查客户端的网关IP地址是否是AC上启用Portal认证的接口IP地址。 检查是否还有别的网卡在使用，导致路由有问题，可在DOS下修改客户端的路由配置。 (2)检查AC上Portal相关配置是否正确。 无线服务模板下Portal配置：选择正确的PortalWeb服务器和认证方式； 全局下Portal配置：配置正确的Portal认证服务器IP地址和PortalWeb服务器URL，配置正确的免认证规则，放行免认证流量。 (3)确保以上无误后，仍无法弹出页面，进一步检查Portal认证服务器的配置。 检查Portal认证服务器上配置的设备IP地址、密钥是否和AC上配置相同； 检查Portal认证服务器上配置的IP地址组范围，必须是Portal认证VLAN的IP地址范围。 4.5Portal认证失败 ,(1)首先检查客户端的设置。 检查客户端是否分配到正确的VLANIP地址，检查所在VLAN是否是需要进行Portal认证的VLAN，如果有误请检查DHCP服务器相关配置是否正确。 如果客户端分配到的地址是正确的，检查客户端的网关IP地址是否是AC上启用Portal认证的接口IP地址。 检查是否还有别的网卡在使用，导致路由有问题，可在DOS下修改客户端的路由配置。 (2)检查AC上Portal相关配置是否正确。 无线服务模板下Portal配置：选择正确的PortalWeb服务器和认证方式； 全局下Portal配置：配置正确的Portal认证服务器IP地址和PortalWeb服务器URL，配置正确的免认证规则，放行免认证流量。 (3)确保以上无误后，仍无法弹出页面，进一步检查Portal认证服务器的配置。 检查Portal认证服务器上配置的设备IP地址、密钥是否和AC上配置相同； 检查Portal认证服务器上配置的IP地址组范围，必须是Portal认证VLAN的IP地址范围。 4.5Portal认证失败 
无线网络测速慢,"本类故障的常见原因主要包括： •安卓终端不支持通过有状态方式自动获取IPv6地址。 •网络中设备的接口和VLAN配置不正确，导致二层网络不通，终端获取不到IPv6地址。 •设备侧有状态地址配置错误，导致终端获取不到IPv6地址。 •无线终端与设备间的DHCPv6报文交互流程出现问题，导致终端获取不到IPv6地址。 3.故障分析 本类故障的诊断流程如图5-30所示。 图5-30通过有状态方式自动获取IPv6地址失败故障排查流程图 4.处理步骤 (1)查看终端类型安卓终端只支持通过无状态方式获取IPv6地址，不支持通过有状态方式获取IPv6地址。 如果无线终端是安卓系统，请配置无状态方式获取IPv6地址，配置步骤请参见5.164.(3)。 如果无线终端不是安卓系统，请继续执行步骤(2)。 (2)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-31所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-31集中转发组网VLAN配置 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-32所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-32本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(3)。 (3)检查网络中设备的接口配置物理接口配置错误可能导致VLAN放通失败，正确的接口配置如下。 集中转发：如图5-31所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发：如图5-32所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(4)。 (4)检查设备侧有状态地址配置设备侧有状态地址配置不正确会导致无线终端无法通过有状态方式获取IPv6地址。通常以网关交换机作为路由通告发布的设备，则正确的配置如下： ComwareV7/V9设备： <Switch>system-view [Switch]IPv6dhcppoolipv6 [Switch-dhcp6-pool-ipv6]network2001::/64 [Switch-dhcp6-pool-ipv6]gateway-list2001::1 [Switch-dhcp6-pool-ipv6]dns-list2001::2 [Switch-dhcp6-pool-ipv6]quit [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]ipv6ipv6ndraprefix2001::/642592000604800 no-autoconfig//指定前缀erface2]ipv6ndautoconfigot(不用于无状态地址配置，可选[Switch-Vlan-int)her-flag//设置NDRA报文中的o位 [Switch-Vlan-interface2]ipv6ndautoconfigmanaged-address-flag//设置NDRA报 [Switch-Vl(文中的M位)an-interface2]ipv6dhcpserverallow-hintrapid-commit//可选 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 [Switch-Vlan-interface2]ipv6dhcpselectserver [Switch-Vlan-interface2]ipv6dhcpserverapplypoolipv6//将配置好的地址池在接口 Comw(上调用)areV5设备： <Switch>system-view [Switch]ipv6//V5设备需要全局使能IPv6功能，V7设备默认已使能，不需要配置此命令 [Switch]ipv6dhcpserverenable//V5设备需使能DHCPv6服务器功能，V7设备不需要配置 [Switch]IPv6dhcppoolipv6 [Switch-dhcp6-pool-ipv6]network2001::/64 [Switch-dhcp6-pool-ipv6]gateway-list2001::1 [Switch-dhcp6-pool-ipv6]dns-list2001::2 [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]ipv6ipv6ndraprefix2001::/642592000604800no-autoconfig//指定前缀不用于无状态地址配置，可选 [Switch-Vlan-interface2]ipv6ndautoconfigother-flag//设置NDRA报文中的o位，必[Sw(配)itch-Vlan-interface2]ipv6ndautoconfigmanaged-address-flag//设置NDRA报文 [Switch-(中的M位)Vlan-interface2]ipv6dhcpserverallow-hintrapid-commit//可选[Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 [Switch-Vlan-interface2]ipv6dhcpserverapplypoolipv6//将配置好的地址池在接口 在设备的(上调用)任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 如果设备侧有状态地址配置不正确，请参照举例修改配置。 如果设备侧有状态地址配置正确，请继续执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的DHCPv6报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 完整的DHCPv6报文交互过程如下图。图5-33完整的DHCPv6报文交互过程 可以在抓包软件（以Wireshark为例）中通过“DHCPv6”关键字进行过滤，下面是一个完整的DHCPv6报文交互过程的抓包示意。 Solicit报文：DHCPv6客户端使用Solicit报文来确定DHCP服务器的位置。图5-34Solicit报文抓包 Advertise报文：DHCPv6服务器发送Advertise报文进行回应，宣告自己能够提供DHCPv6服务，并携带DNS信息。 图5-35Advertise报文抓包 Request报文：DHCPv6客户端向DHCPv6服务器请求IPv6DNS配置信息。图5-36Request报文抓包 Reply报文：DHCPv6服务器发送携带了配置信息(包含DNS信息)的Reply消息来回应从DHCPv6客户端收到的Solicit、Request等报文。图5-37Reply报文抓包 在AC上执行debuggingipv6dhcpserverevent/all命令，并收集调试信息，通 过报文转发接口收发的DHCPv6报文记录来判断AC与终端间DHCPv6报文交互是否完整。下面是设备debug到的一个正常的DHCPv6交互过程： *Nov1409:59:14:4872019ACDHCPS6/7/EVENT:ReceivedSolicitfrom FE80::1C1C:1E22:907A:9654. *Nov1409:59:14:4872019ACDHCPS6/7/PACKET: FromFE80::1C1C:1E22:907A:9654port546,interfaceVlan-interface82 Messagetype:Solicit(1) TransactionID:0x00484796 *Nov1409:59:14:4882019ACDHCPS6/7/EVENT:SendAdvertiseto FE80::1C1C:1E22:907A:9654. *Nov1409:59:14:4882019ACDHCPS6/7/PACKET: ToFE80::1C1C:1E22:907A:9654port8706,interfaceVlan-interface82 Messagetype:Advertise(2) TransactionID:0x00484796 *Nov1409:59:15:4662019ACDHCPS6/7/EVENT:ReceivedRequestfrom FE80::1C1C:1E22:907A:9654. *Nov1409:59:15:4662019ACDHCPS6/7/PACKET: FromFE80::1C1C:1E22:907A:9654port546,interfaceVlan-interface82 Messagetype:Request(3) TransactionID:0x000ddf2e *Nov1409:59:15:4662019ACDHCPS6/7/EVENT:SendReplytoFE80::1C1C:1E22:907A:9654. *Nov1409:59:15:4662019ACDHCPS6/7/PACKET: ToFE80::1C1C:1E22:907A:9654port8706,interfaceVlan-interface82 Messagetype:Reply(7) TransactionID:0x000ddf2e 上述步骤的执行结果 设备的配置文件、日志信息、告警信息。 5.18无线测速慢 本类故障的常见原因主要包括：•有线链路吞吐量较低。 •无线网络部署不合适。 •链路连通性和时延状态异常。 •非最佳无线配置。 •终端能力影响。 •无线周边环境影响。 3.故障分析 本类故障的诊断流程如图5-38所示。 图5-38无线测速慢的故障诊断流程图 4.处理步骤 (1)确认有线链路吞吐量。 无线网络其实只是有线网络的延伸，因此在测试无线网速之前必须要先明确有线网络的Ping包、延迟、抖动以及业务使用是否正常。只有在有线链路完全正常的前提之下，测试无线网速才是有意义的。 可以使用测速软件测试有线链路的速率，比如：360测速或者其他类似工具。 (2)了解无线网络部署架构。无线网络有很多的解决方案和产品，因此在测试无线速率之前先要明确自己当前网络环境的产品形态和部署方式。无线网络部署架构大致分类为： AC+FITAP架构 FATAP架构 开启NAT功能的AC+FITAP架构 AC+FITAP架构下，按照报文的转发模式可以大致分类为： 集中转发 本地转发了解自己的产品形态和部署方式对于后续的步骤至关重要。 对于AC+FITAP架构下的转发模式，需要在AC上查看无线服务模板的配置，查看方式如下： #在AC上查看服务模板是否为本地转发 [AC]wlanservice-template1[AC-wlan-st-1]displaythis # wlanservice-template1ssidXXX clientforwarding-locationap//location为AP表示为本地转发service-templateenable #return 根据维护经验来看，本地转发模式下的无线吞吐及速率往往会优于集中转发模式，因此如果是集中转发且在线人数数量很多的场景，可以考虑是否能够采用本地转发的部署方案。 (3)检查无线终端长Ping是否正常。通过无线终端长Ping来判断一段时间内终端与Internet之间的链路连通性和时延状态。 #常用方式ping114.114.114.114。C:\AA>ping114.114.114.114-t正在Ping114.114.114.114具有32字节的数据: 来自114.114.114.114的回复:字节=32时间=10msTTL=253来自114.114.114.114的回复:字节=32时间=11msTTL=253来自114.114.114.114的回复:字节=32时间=11msTTL=253来自114.114.114.114的回复:字节=32时间=12msTTL=253 …… 正常的延迟和较低的丢包率是体验良好的前提，如果存在丢包和延迟严重的情况，需要对此问题进行重点排查。(4)无线配置优化调整。通过Ping操作进行连通性和时延判断之后，如果能定位到是无线链路造成的问题那就需要按照实际情况进行无线配置优化。根据维护经验，大部分的办公使用场景都需要做特定的优化配置，请参考《H3C无线产品部署与维护操作指导》进行优化，核心目的是降低无线的空口利用率和提升稳定的终端协商速度。 #在AP上查看Radio的ChannelBusy数值，2.4GHz射频无业务吞吐情况下一般要求20%以下，5.8GHz射频无业务吞吐情况下一般要求10%以下，并且RX和TX的相加值和CTL的差值不能超过10，否则可能存在非WLAN干扰。显示信息如下： [AP-probe]displayar5drv1channelbusy ChannelBusyinformation CtlChannel:36 BandWidth:1 RecordInterval(s):9 CurrentTime:23:55:45 Time(h/m/s):CtlBusy(%)TxBusy(%)RxBusy(%) 0123:55:4326025 0223:55:3429029 0323:55:25310310423:55:1630029 针对具备FPGA硬件转发模块的AC还可以开启硬件快转功能，加速在集中转发环境下报文的处理效率： #开启AC硬件快转，加速报文处理效率。 [AC]wlanfast-forwardingenable (5)确认终端能力。 进行无线优化操作之后，如果还存在无线网络速率慢的情况，这个时候需要检查下终端自身的支持能力。不同终端在无线空口的协商能力各不相同，清晰的认知终端的协商能力有助于判断这个终端在无线网络下的速率极限和多用户并发下的资源抢占能力。 常规而言，大部分笔记本都是2×2无线网卡，如果支持11ac射频模式，那么最高协商速率为866.7Mbps，无线的实现原理是时隙半双工模型，最终的极限吞吐能力在600Mbps左右。但是考虑综合使用和干扰并存的前提下，大部分终端可能表现为350～400Mbps。 同时还需要考虑传输工具的发包效率，使用专用的IxChariot软件可以测出较高的吞吐能力，但是普通的FTP工具或者测速软件在除去开销之外最终应该会形成200～300Mbps的表现。 另外受限于出口网络带宽和家用宽带是否有上行速率的限速因素，理论速率与实际吞吐结果还会存在一定的差异。 如果是1×1的终端，大部分的手机或者智能终端设备效果也会减半。 对于这方面的数据可以参考产品配置指导部分关于MCS速率的表格，例如：表5-4VHT-MCS对应速率表（80MHz，2NSS） VHT-MCS索引空间流数量调制方式速率(Mb/s) 800nsGI400nsGI 02BPSK58.565.0 12QPSK117.0130.0 22QPSK175.5195.0 3216-QAM234.0260.0 4216-QAM351.0390.0 5264-QAM468.0520.0 6264-QAM526.5585.0 7264-QAM585.0650.0 82256-QAM702.0780.0 92256-QAM780.0866.7 (6)检查无线周边环境。 在日常无线环境中，一个AP下往往可能有多个终端同时接入，形成一种并发趋势。由于无线资源是共享且有限的，因此在业务重载和轻载的状况下，同样的终端和AP设备表项出的吞吐也不尽相同，在有条件的情况下尽量维持业务轻载部署。 若无法平衡终端使用密度和AP部署数量，那么只能对于每个用户的无线业务进行限速控制，将速率控制在可控范围内，保证不会抢占过多的空口资源。 此外还可以考虑降低5GHz射频的频宽，默认11ac环境下是80MHz，可选信道不多，终端数量密集环境下可以调整到40MHz或者20MHz，增加可选非重叠信道，单个信道的最大协商速率也会降低。 (7)拨打热线400-810-0504求助。 根据上述相关步骤优化、调整之后，如果依旧存在无线网络测速慢的问题，请收集故障时的诊断信息，拨打400-810-0504热线寻求帮助。 6设备常见启动问题 6.1启动过程中串口无输出或打印乱码 ",Suggestion not provided
系统出现温度告警，打印温度过高等告警信息，例如： %Jun2610:13:46:2332013H3CDRVPLAT/4/DrvDebug:Temperatureoftheboardistoohigh! ,本类故障的常见原因主要包括： •机房通风不畅或空调制冷故障等造成环境温度过高。 •设备风扇故障或出入风口被异物堵塞。 •设备防尘网积灰过多。 •温度告警门限设置过低。 •软件获取温度数据失败，错误告警。 3.故障分析 本类故障的诊断流程如图3所示： 图3温度异常故障诊断流程图 4.处理步骤 (1)检查环境温度是否过高 如果温度过高，请增加空调或者采取其他散热措施降低环境温度。 (2)检查设备温度是否过高执行displayenvironment命令查看设备当前温度值。若显示为255，则表示软件获取温度数据失败。可多次执行displayenvironment命令至温度数据正常显示后，判断设备温度是否过高。 若是设备温度过高（设备温度超过一般级高温告警门限），确认设备风扇是否正常并检查出入风口是否被异物堵塞。 使用displayfan命令查看风扇框是否运行正常。若不正常，请参见风扇模块故障章节排除风扇故障。 (3)检查防尘网是否洁净如果风扇正常，则检查防尘网是否洁净。清理防尘网后，看温度是否能恢复正常。 (4)重新设置温度告警门限使用temperature-limit命令重新设置温度告警门限值。通过displayenvironment 命令可以查看温度告警门限是否设置成功。请注意，本步骤需要在研发人员的指导下进行操作，避免告警门限值设置的不合理。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •TEMP_HIGH •TEMP_LOW •TEMP_NORMAL •TEMPERATURE_ALARM •TEMPERATURE_LOW •TEMPERATURE_NORMAL •TEMPERATURE_POWEROFF •TEMPERATURE_SHUTDOWN •TEMPERATURE_WARNING 3.1.4内存异常告警 ,Suggestion not provided
系统打印内存异常告警信息，例如： DIAG/1/MEM_EXCEED_THRESHOLD:Memoryminorthresholdhasbeenexceeded. ,•设备正在执行一些文件类操作。 •设备出现内存泄露。 3.故障分析 本类故障的诊断流程如图4所示： 图4内存占用率高故障诊断流程图 4.处理步骤 (1)确定各内存块使用情况 通过Probe视图下的displaysysteminternalkernelmemorypool命令查看各块内存使用情况，找出使用率不正常和不断增加的内存模块。 <Sysname>system-view [Sysname]probe [Sysname-probe]displaysysteminternalkernelmemorypoolslot1 ActiveNumberSizeAlignSlabPg/SlabASlabsNSlabsName 91269248648321289289kmalloc-64 105112163280285456kmalloc-16328 14142097096015121414kmalloc-2097096 147225204881581215kmalloc-2048 710872321928322226226kmalloc-192 2222524232011282222kmalloc-524232 1288134412882116464kmalloc-128 0067108808011638400kmalloc-67108808 63065140968789393kmalloc-4096 687013101601326870kmalloc-131016 17182048886413132kmalloc-8 111677716001409611kmalloc-16777160 2152048015811sgpool-64 0040042100inotify_event_cache 32533016328828165165kmalloc_dma-16328 0072030100LFIB_IlmEntryCache001080028800LFIB_IlmEntryCache 001464021800MFW_FsCache 120136020111L2VFIB_Ac_cache 00240025200CCF_JOBDESC 0088026100NS4_Aggre_TosSrcPre 00128021100IPFS_CacheHash_cachep----More---- 请重点查看Number列和Size列的统计结果。如果发现某块内存在不停增加，那么表示该块内存在被不断使用。需要注意的是： 有些内存块使用率的增加是正常的，例如设备正在上传大文件或配置启动文件，也可能造成内存告警，此时可观察内存能否快速恢复。 Number*Size是某个模块使用的内存大小。判断内存使用率是否正常可能需要持续观察内存增长速度和内存使用的多少，进行综合分析判断。 有些内存的泄漏过程比较缓慢，所以需要比较长的时间（甚至是几周的时间）来对比观察。 (2)收集信息并寻求技术支持 通过上述步骤只是确定了问题的范围，但还需继续收集信息以确定具体的故障。由于后续信息收集要求较高，不建议用户操作，请与H3C的技术支持工程师联系。 需要注意的是，请不要重启设备，否则会将故障信息破坏，给故障定位带来困难。 5.告警与日志相关告警无 相关日志 •MEM_ALERT •MEM_EXCEED_THRESHOLD •MEM_BELOW_THRESHOLD 3.1.5CPU占用率高 ,Suggestion not provided
系统上电启动后，发现AP与其他设备对接时网口无法建立连接,(1)请确认网线是否插错，如果插到Console口就不会建立连接； (2)请确认网线长度是否超过了规格要求（如100米），如果网线长度超过了规格要求也可能会出现不能建立连接现象； (3)请检查一下网线的线序是否有误，如果既不是直连也不是交叉网线的线序也不能建立连接。 3.5采用PoE-MH通过网口给AP供电时，发现AP不能上电 ,(1)请确认网线是否插错，如果插到Console口就不会建立连接； (2)请确认网线长度是否超过了规格要求（如100米），如果网线长度超过了规格要求也可能会出现不能建立连接现象； (3)请检查一下网线的线序是否有误，如果既不是直连也不是交叉网线的线序也不能建立连接。 3.5采用PoE-MH通过网口给AP供电时，发现AP不能上电 
系统上电启动后，发现CPE与其他设备对接时网口无法建立连接,Cause not provided,Suggestion not provided
系统上电启动后，发现CPE与其他设备对接时网口无法建立连接。 2.故障处理步骤 (1)请确认网线是否插错，如果插到Console口则不会建立连接。 (2)请确认设备端口是否被手工shutdown，如果端口被手工shutdown，则无法建立连接。 (3)请确认网线长度是否超过了规格要求（如100米），如果网线长度超过了规格要求也可能会出现不能建立连接现象。 (4)请检查一下网线的线序是否有误，如果既不是直连也不是交叉网线的线序也不能建立连接。 (5)如果故障仍然未能排除，请联系技术工程师。 3Web类故障处理 3.1.1通过Web登录时，提示“用户数超限！” ,Cause not provided,Suggestion not provided
协议震荡一般都是协议报文交互时不通导致的。 ,•二三层转发丢包 •软件收包发生丢包 3.故障分析 本类故障的诊断流程如图33所示。图33因协议报文丢包导致的协议震荡故障诊断流程图 4.处理步骤 (1)查看二层转发是否丢包根据4.1.1二层流量转发丢包一节的故障定位处理方法，定位是否是设备端口故障（包括端口硬件故障和端口配置故障）： 如果是端口故障，请按照4.1.1二层流量转发丢包节的故障处理思路进行处理。 如果不是端口故障，则执行步骤2。 (2)查看三层转发是否丢包根据4.1.2三层流量转发丢包一节的故障定位处理方法，定位是否为三层故障（包括ARP表项错误和路由表项错误）： 如果是三层故障，请按照4.1.2三层流量转发丢包一节的故障处理思路进行处理。 如果不是三层故障，则执行步骤3。 (3)查看软件收包是否丢包部分机型Probe视图下支持debugrxtxsoftcarshow命令，可以查看软件收包是否丢包。 <Sysname>system-view [Sysname]probe [Sysname-probe]debugrxtxsoftcarshowslot1 IDTypeRcvPpsRcv_AllDisPkt_AllPpsDynSwiHashACLmax 0ROOT000300SOnSMAC0 1ISIS000200DOnSMAC8 2ESIS000100SOnSMAC8 3CLNP000100SOnSMAC8 4VRRP0001024SOnSMAC8 5UNKNOWN_IPV4MC000100SOnSMAC8 6UNKNOWN_IPV6MC000100SOnSMAC8 7IPV4_MC_RIP000150DOnSMAC8 8IPV4_BC_RIP000150DOnSMAC8 9MCAST_NTP000100SOnSMAC8 10BCAST_NTP000100SOnSMAC8 DisPkt_All为丢包计数，Rcv_All为收包总数，RcvPps为接收速率。如果发现有丢包发生，请收集信息，然后前往步骤4。 (4)寻求技术支持如果上述检查完成后故障仍无法排除，请联系H3C的技术支持工程师。 5.告警与日志 相关告警无 相关日志无 4.1.4报文不能进行ECMP转发 ,Suggestion not provided
业务板无法启动。 ,本类故障的常见原因主要包括： •设备当前的工作模式不支持该业务板。 •网板工作异常。 •供电异常。 •软件版本不支持该业务板。 •业务板未安装到位。 •业务板硬件故障。 •机框槽位硬件故障。 3.故障分析 本类故障的诊断流程如图15所示： 图15 4.处理步骤 (1)使用displaysystem-working-mode命令检查设备当前的工作模式，部分交换机处于不同工作模式下时支持的业务板有所不同，例如对于S12500G-AFS系列交换机： 标准模式所有单板均可启动； 高级模式下仅SE系列接口板可以启动；专家模式下仅SF系列接口板可以启动。 有关启动限制和设备工作模式的详细介绍，请参见各系列交换机配置指导手册中的“设备管理”。 (2)检查网板工作是否正常。 确保网板在位且状态为Normal，如果状态异常，请先排除网板故障。 (3)检查业务板是否上电。 查看业务板RUN指示灯状态，如果指示灯不亮，说明业务板可能没有上电，请按如下子步骤进行定位处理。如果上电正常，请执行步骤(4)。 a.查看电源模块指示灯，判断电源模块工作是否正常，如果指示灯异常，请参考“电源模块状态异常”章节进行定位处理。 b.计算整机功耗情况，查看电源剩余功率是否足够，如果功率不足，请增加电源模块。 (4)检查软件版本是否支持该业务板。 在任意视图下执行displayversion，查询设备的软件版本，然后确认当前软件版本是否支持该业务板。如果不支持，请升级到支持此业务板的正确版本。版本升级前请务必确认新版本兼容其它单板。 (5)拔插业务板。 拉出业务板，检查连接器是否完好，将其重新插入，保证业务板安装到位。 (6)将业务板安装到其它槽位测试能否启动。 如果更换到其它槽位也无法启动，则可能是业务板故障，请更换新的业务板进行测试。 如果更换到其它槽位可以正常启动，请将其它可以正常启动的业务板安装到原故障槽位，如果不能启动，则可能是机箱该槽位故障。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 3.5.6业务板在使用中发生重启，无法正常启动 ,Suggestion not provided
业务板运行过程中发生重启，重启后无法正常启动。 ,本类故障的常见原因主要包括： •设备切换了工作模式。 •供电异常。 •主控板上的启动文件异常。 •业务板硬件故障。 •机框槽位硬件故障。 3.故障分析 本类故障的诊断流程如图16所示： 图16 4.处理步骤 (1)使用displaysystem-working-mode命令检查设备当前的工作模式，部分交换机处于不同工作模式下时支持的业务板有所不同，例如对于S12500G-AFS系列交换机： 标准模式所有单板均可启动； 高级模式下仅SE系列接口板可以启动；专家模式下仅SF系列接口板可以启动。 有关启动限制和设备工作模式的详细介绍，请参见各系列交换机配置指导手册中的“设备管理”。 (2)检查电源模块工作是否正常。 查看电源模块指示灯是否正常，电源功率是否满足单板正常运行要求。如果有电源模块工作异常，请参考“电源模块故障处理”章节进行定位处理。 (3)检查主控板上的启动文件是否正常。 在任意视图下执行displayboot-loader命令，查看单板使用的下次启动软件包。在用户视图下执行dir命令，查看启动软件包是否存在，如果不存在或者损坏，请重新获取启动软件包或者设置其它软件包作为该单板的下次启动软件包。 <Sysname>displayboot-loader Softwareimagesonslot16: Currentsoftwareimages: flash:/S12500-X-CMW710-BOOT-D1031.binflash:/S12500-X-CMW710-SYSTEM-D1031.bin Mainstartupsoftwareimages: flash:/S12500-X-CMW710-BOOT-D1031.binflash:/S12500-X-CMW710-SYSTEM-D1031.bin Backupstartupsoftwareimages: None <Sysname>dirDirectoryofflash: 0drw--Sep26201316:18:06core 1drw--Jun30201311:32:34diagfile 2-rw-7122Dec23201310:02:46ifindex.dat 3drw--Dec11201319:00:37license 4drw--Aug30201311:51:15logfile 5-rw-20529152Dec22201314:28:40S12500-X-cmw710-boot-d1031.bin 6-rw-178325504Dec22201314:39:02S12500-X-cmw710-system-d1031.bin 7drw--Jun30201311:32:34seclog 8-rw-17175Dec23201310:02:48startup.cfg9-rw-276535Dec23201310:02:48startup.mdb10drw--Nov12201311:11:54versionInfo 503808KBtotal(125896KBfree) (4)在业务板不能启动的槽位插入能够正常工作的业务板能否正常启动。如果确认业务板加载的启动文件正常，在条件允许的情况下，在无法正常启动的业务板槽位插入其它能够正常工作的业务板做测试。如果插入的其它能够正常工作的业务板能启动，则排除主控板和背板故障，请执行步骤(5)。 如果插入的其它能够正常工作的业务板也不能启动，请更换主控板。 (5)检查是否有加载记录。在任意视图下执行displaylogbuffer命令，检查设备的logbuffer中是否有对应槽位单板的加载记录。 <Sysname>displaylogbuffer %May313:27:17:0862013H3CDEVM/4/BOARD_LOADING:BoardisloadingfileonChassis1Slot7. %May313:27:17:6472013H3CDEVM/5/LOAD_FINISHED:BoardhasfinishedloadingfileonChassis1Slot7.如果logbuffer中有对应槽位单板的加载记录，请将业务板更换到其他槽位看能否正常启动。 如果logbuffer中没有对应槽位单板的加载记录，请执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •DEV/4/BOARD_LOADING •DEV/5/LOAD_FINISHED 3.5.7硬件转发故障 ,Suggestion not provided
因为服务器无响应导致使用RADIUS认证服务器认证/授权/计费失败。如果设备上同时打开了RADIUS的事件调试信息开关（通过执行debuggingradiusevent命令），系统会打印如下形式的调试信息： *Aug817:49:06:1432021SysnameRADIUS/7/EVENT:-MDC=1;Reachedthemaximumretries ,本类故障的常见原因主要包括： •RADIUS服务器上配置的共享密钥与接入设备上配置的共享密钥不一致。 •RADIUS服务器上没有添加接入设备的IP地址或者添加的IP地址不正确。 •RADIUS服务器与接入设备之间的网络存在问题，例如中间网络存在防火墙时，防火墙阻止了RADIUS服务器提供AAA服务的端口号（缺省认证端口号：1812，缺省计费端口号：1813）。 3.故障分析 本类故障的诊断流程如图4-35所示。 图4-35RADIUS服务器无响应的故障诊断流程图 4.处理步骤 (1)检查RADIUS服务器上配置的共享密钥与接入设备上配置的是否一致。 如果共享密钥配置不一致，则： −在接入设备上，需要在RADIUS方案视图下执行keyauthentication、keyaccounting命令分别重新配置认证、计费共享密钥（下例中认证密钥为123、计费密钥为456）。 <Sysname>system-view [Sysname]radiusschemeradius1 [Sysname-radius-radius1]keyauthenticationsimple123 [Sysname-radius-radius1]keyaccountingsimple456 −在RADIUS服务器上，重新配置与接入设备交互RADIUS报文的共享密钥，保证与接入设备上配置的一致。 如果共享密钥配置一致，则执行步骤（2）。 (2)检查RADIUS服务器上是否添加了接入设备的IP地址或者添加的IP地址是否正确。 RADIUS服务器上添加的设备IP地址必须是接入设备发送RADIUS报文的源IP地址。接入设备发送RADIUS报文使用的源IP地址可以通过相关命令设置。接入设备按照以下顺序选择发送RADIUS报文使用的源IP地址： a.RADIUS方案视图下配置的NAS-IP地址（通过nas-ip命令）。 b.系统视图下的配置的源NAS-IP地址（通过radiusnas-ip命令）。 c.发送RADIUS报文的出接口的IP地址。 (3)检查设备和服务器之间的网络是否存在问题。 首先使用ping等手段排除设备与服务器之间的网络可达性，然后排查该网络中是否存在防火墙等设备。通常，如果网络中存在防火墙设备且不允许目的UDP端口号为RADIUS服务器端口号的报文通过（缺省的RADIUS认证端口号为1812，缺省的RADIUS计费端口号为1813）， RADIUS报文将被丢弃。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息、调试信息。 5.告警与日志相关告警无 相关日志无 4.13.12用户接入类型与RADIUS服务器下发的Login-Service属性值不匹配 ,Suggestion not provided
用户访问任意非PortalWeb服务器网页，或者直接访问PortalWeb服务器，无法推出Portal登录页面,"本类故障的常见原因主要包括： •主机、服务器和设备之间的路由不通。 •浏览器开启了HTTP代理功能。 •用户输入的网址内携带了非标准的TCP端口号。 •中间网络或DNS服务器出现问题。 •设备上的HTTPS重定向功能不能正常使用。 •用户访问的HTTPS协议的网站开启了HSTS（HTTPStrictTransportSecurity，HTTP严格传输安全协议）功能。 •Portal服务器无法识别转义后的URL特殊字符。 •Portal服务器配置错误。 3.故障分析 本类故障的诊断流程如图4-14所示： 图4-14Portal认证页面无法弹出的故障诊断流程图 4.处理步骤 (1)确认终端和Portal服务器上的路由配置是否正确。 在终端上关闭防火墙功能后，执行Ping操作检查Portal服务器是否可达，如果Ping不通，首先需要确认终端和Portal服务器上的路由配置是否正确，同时需要注意： Portal服务器到终端的回程路由是否配置正确。 终端或者Portal服务器上是否存在有多个网卡。 在有多个网卡的情况下，终端和服务器之间的流量不一定全部经过配置有Portal认证的网络。以Windows终端为例，在cmd窗口上执行routeprint命令查看具体的路由信息，然后确定用户的Web访问流量是从哪个网卡出去。 最后，采取分段Ping的手段定位问题。首先从终端Ping网关（需要先取消认证，否则Ping不通），然后再从网关上Ping服务器。 (2)终端的浏览器上是否开启了HTTP代理功能。 浏览器上开启了HTTP代理功能会导致用户无法访问Portal认证页面。以WindowsIE浏览器为例，请打开IE浏览器，单击“工具”，选择“Internet选项>连接>局域网设置>代理服务器”中，关闭HTTP代理功能。 (3)输入的网址是否使用非标准TCP端口 非标准TCP端口是指非80或非443端口。用户输入的网址中若包含非标准TCP端口，会导致Portal认证页面无法弹出，例如http://10.1.1.1:18008。对于HTTP协议的网址，请使用80；对于HTTPS协议的网址，请使用443。 (4)中间网络或DNS服务器出现问题。 a.确认设备上是否将DNS服务器IP地址配置为允许访问的地址。 b.检查中间网络连通性以及排查DNS服务器故障，在网关上进行流量统计（分别对连接终端下行接口和连接DNS服务器的上行接口）或镜像获取终端访问DNS服务器的报文，确认网关是否已将DNS请求发出，但却未收到回应报文。 (5)HTTPS网站开启了HSTS功能。 HTTPS网站开启了HSTS功能后，要求浏览器必须使用HTTPS访问，而且证书必须要合法。设备对用户浏览器进行HTTPS重定向时，设备会使用自签名证书（设备没有目标网站的证书，只能使用自签名证书）伪装成目标网站和浏览器建立SSL连接，此时浏览器一旦检测到证书不受信任，将会导致HTTPS重定向失败，无法弹出Portal认证页面。这种情况依赖于具体网站配置的HSTS协议的强制要求，无法解决。此时，建议用户更换其他网站进行尝试。 (6)Portal服务器不支持URL特殊字符的编码。 在实际应用中，一些PortalWeb服务器无法识别URL中“$-_.+!*'();,/?:@”中任意字符的组合的转义字符，会导致PortalWeb服务器向客户端提供Web认证页面失败。此时，请在设备上通过portalurl-unescape-chars命令对这些特殊字符不进行转义处理。 #配置重定向给用户的PortalWeb服务器URL中不转义的特殊字符为“;()”。 <Sysname>system-view [Sysname]portalurl-unescape-chars;() (7)Portal服务器配置是否正确。 检查Portal服务器上是否配置了IP地址组，以及是否将设备与IP地址组关联。 检查终端IP地址是否在Portal服务器上配置的IP地址组范围内。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息和告警信息。 服务器上Portal相关配置截图。 设备与服务器之间的抓包文件。 le命令查看用于报文匹配的Portal过滤规则信息。 出现问题时，在设备上通过debuggingportal、debugginghttp-redirectall和debuggingippacket命令收集Debug信息。 5.告警与日志 相关告警无 相关日志无 4.10.2Portal认证失败 ",Suggestion not provided
用户会话超时时间超时。 •用户闲置切断。 •计费更新失败。 •用户流量达到阈值。 •服务器强制用户下线。 •用户在线探测失败下线。 •用户上线的接口down。 2.故障分析 本类故障的诊断流程如图4-20所示。 图4-20Portal认证用户掉线的故障诊断流程图 ,(1)通过portallogout-recordenable命令，开启Portal用户下线信息记录功能。 (2)检查用户会话超时时间是否超时。如果AAA服务器给Portal用户下发了会话时长，即用户单次在线时长。用户在线时长超过会话时长后，设备会触发用户下线。可通过如下三种方法确认是否因会话超时导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Sessiontimeout 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Sessiontimertimedoutandtheuserwillbeloggedoff.用户会话超时触发的下线属于正常下线，用户重新上线即可。 (3)检查是否为用户闲置切断。如果设备或者AAA服务器授权了用户闲置切断时长，用户上线后，设备会周期性检测用户的流量，若某用户在指定的闲置检测时间内产生的流量小于指定的数据流量，则会被强制下线。可通过如下三种方法确认是否因用户闲置切换功能导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:Idletimeout 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Idle-cuttimertimedoutandtheuserwillbeloggedoff.用户闲置切断触发的下线属于正常下线，用户重新上线即可。 (4)检查是否为计费更新失败。远程Portal认证用户上线，设备会定期向AAA服务器发送计费更新报文。当设备与AAA服务器链路不通或者服务器故障时，计费更新报文会发送失败。当达到最大重传次数后，如果计费更新报文还是发送失败并且设备上配置了用户计费更新失败策略（通过accountingupdate-failoffline命令配置），则触发用户下线。可通过如下方法确认是否因计费更新失败导致用户下线： 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58Logoutreason:Accountingupdatefailure 通过displayinterface查看设备上连接AAA服务器的端口是否发生过变化，检查AAA服务器否有异常记录等。或者通过displayradiusscheme命令显示的State字段查看服务器状态是否为Block，如果是，则可能是计费更新失败导致的下线。 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Processedaccounting-updatefailedanduserlogout. 如果确认是计费更新失败导致的用户下线，请检查设备与服务器之间的链路状态，以及设备和AAA服务器的相关计费配置是否发生过更改。 (5)检查是否为用户流量达到阈值。用户上线时，如果AAA服务器下发了流量阈值，当用户的流量超过AAA服务器下发的流量阈值时，设备就会强制用户下线。可通过如下方法确认是否因用户流量达到阈值导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Usertrafficreachedthreshold 用户流量达到阈值触发的下线属于正常下线，用户重新上线即可。 (6)检查是否为AAA服务器主动踢用户下线。设备上开启了RADIUSsessioncontrol功能后，若收到AAA服务器的断开连接请求，则会立马强制对应的用户下线。首先查看设备上是否开启了（通过radiussession-controlenable命令配置）。如果开启了，则可以通过如下方法查看是否因AAA服务器强制用户下线导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:ForcelogoutbyRADIUSserver服务器为何强制用户下线，请联系服务器管理员进行确认。 (7)检查是否为Portal用户在线探测失败导致用户下线。 如果设备上开启了Portal用户在线探测功能（通过portaluser-detect命令配置），设备会定期向用户终端发送探测报文。若在指定探测次数内，设备未收到终端的回应，则强制用户下线。确认设备上是否开启了Portal用户在线探测功能。如果开启了，则可以通过如下方法确认是否因用户在线探测失败导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Userdetectionfailure 如果确认是因Portal用户在线探测导致用户下线，请检查终端和设备之间的链路状态，排查终端没有回应探测报文的原因。 (8)检查Portal用户上线的接口是否down。如果Portal用户上线的接口down了一段时间后，设备会强制从该接口接入的Portal用户全部下线。 可通过如下方法确认是否因接口down导致用户下线： 查看AAA服务器上的用户下线记录。 通过displayinterface命令查看接口的状态是否发生过变化，如果发生变化的时间正好和用户下线的时间接近，则可能是接口down触发的用户下线。 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/ASSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Interfacedown 如果确认是接口down导致的下线，请排查接口down的原因，如网线口松动等。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Portal服务器上Portal相关配置截图。 AAA服务器上记录的用户下线记录。 设备与服务器间的抓包文件。 调试信息。 4.告警与日志 相关告警无 相关日志无 4.11MAC地址认证故障处理 4.11.1MAC地址认证失败 ,(1)通过portallogout-recordenable命令，开启Portal用户下线信息记录功能。 (2)检查用户会话超时时间是否超时。如果AAA服务器给Portal用户下发了会话时长，即用户单次在线时长。用户在线时长超过会话时长后，设备会触发用户下线。可通过如下三种方法确认是否因会话超时导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Sessiontimeout 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Sessiontimertimedoutandtheuserwillbeloggedoff.用户会话超时触发的下线属于正常下线，用户重新上线即可。 (3)检查是否为用户闲置切断。如果设备或者AAA服务器授权了用户闲置切断时长，用户上线后，设备会周期性检测用户的流量，若某用户在指定的闲置检测时间内产生的流量小于指定的数据流量，则会被强制下线。可通过如下三种方法确认是否因用户闲置切换功能导致Portal用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58Userlogouttime:2021-07-2911:05:58 Logoutreason:Idletimeout 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Idle-cuttimertimedoutandtheuserwillbeloggedoff.用户闲置切断触发的下线属于正常下线，用户重新上线即可。 (4)检查是否为计费更新失败。远程Portal认证用户上线，设备会定期向AAA服务器发送计费更新报文。当设备与AAA服务器链路不通或者服务器故障时，计费更新报文会发送失败。当达到最大重传次数后，如果计费更新报文还是发送失败并且设备上配置了用户计费更新失败策略（通过accountingupdate-failoffline命令配置），则触发用户下线。可通过如下方法确认是否因计费更新失败导致用户下线： 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58Logoutreason:Accountingupdatefailure 通过displayinterface查看设备上连接AAA服务器的端口是否发生过变化，检查AAA服务器否有异常记录等。或者通过displayradiusscheme命令显示的State字段查看服务器状态是否为Block，如果是，则可能是计费更新失败导致的下线。 在设备上执行debuggingportalerror命令，打开Portal错误调试信息开关。如果设备上打印如下信息，则可以确认因用户会话超时导致Portal用户下线。 *Jul2817:51:20:7742021SysnamePORTAL/7/ERROR:-MDC=1;Processedaccounting-updatefailedanduserlogout. 如果确认是计费更新失败导致的用户下线，请检查设备与服务器之间的链路状态，以及设备和AAA服务器的相关计费配置是否发生过更改。 (5)检查是否为用户流量达到阈值。用户上线时，如果AAA服务器下发了流量阈值，当用户的流量超过AAA服务器下发的流量阈值时，设备就会强制用户下线。可通过如下方法确认是否因用户流量达到阈值导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Usertrafficreachedthreshold 用户流量达到阈值触发的下线属于正常下线，用户重新上线即可。 (6)检查是否为AAA服务器主动踢用户下线。设备上开启了RADIUSsessioncontrol功能后，若收到AAA服务器的断开连接请求，则会立马强制对应的用户下线。首先查看设备上是否开启了（通过radiussession-controlenable命令配置）。如果开启了，则可以通过如下方法查看是否因AAA服务器强制用户下线导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:ForcelogoutbyRADIUSserver服务器为何强制用户下线，请联系服务器管理员进行确认。 (7)检查是否为Portal用户在线探测失败导致用户下线。 如果设备上开启了Portal用户在线探测功能（通过portaluser-detect命令配置），设备会定期向用户终端发送探测报文。若在指定探测次数内，设备未收到终端的回应，则强制用户下线。确认设备上是否开启了Portal用户在线探测功能。如果开启了，则可以通过如下方法确认是否因用户在线探测失败导致用户下线： ()通过displayportallogout-recor(查看AAA服务器上记录的用户下线记录。)d命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100UserIPaddress:21.0.0.20 AP:N/A SSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Userdetectionfailure 如果确认是因Portal用户在线探测导致用户下线，请检查终端和设备之间的链路状态，排查终端没有回应探测报文的原因。 (8)检查Portal用户上线的接口是否down。如果Portal用户上线的接口down了一段时间后，设备会强制从该接口接入的Portal用户全部下线。 可通过如下方法确认是否因接口down导致用户下线： 查看AAA服务器上的用户下线记录。 通过displayinterface命令查看接口的状态是否发生过变化，如果发生变化的时间正好和用户下线的时间接近，则可能是接口down触发的用户下线。 通过displayportallogout-record命令查询用户下线记录。 <Sysname>displayportallogout-recordall Totallogoutrecords:1 Username:gkt UserMAC:0800-2700-94ad Interface:Vlan-interface100 UserIPaddress:21.0.0.20 AP:N/ASSID:N/A Userlogintime:2021-07-2911:05:58 Userlogouttime:2021-07-2911:05:58 Logoutreason:Interfacedown 如果确认是接口down导致的下线，请排查接口down的原因，如网线口松动等。 (9)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Portal服务器上Portal相关配置截图。 AAA服务器上记录的用户下线记录。 设备与服务器间的抓包文件。 调试信息。 4.告警与日志 相关告警无 相关日志无 4.11MAC地址认证故障处理 4.11.1MAC地址认证失败 
用户通过Web方式登录时提示“用户数超限”，在设备上通过命令displaywebusers检查登录的Web用户数，显示有多个Web用户在线。 ,出现这个问题是由于其他用户登录Web后，退出Web时直接关闭了浏览器，没有点击Web右上角的<退出登录>按钮，造成设备上的用户没有真正退出。 在设备上使用命令freewebusersall强制在线Web用户下线，然后再次登录Web。 2.2设备升级以后，重新登录Web时失败，提示“功能函数错误” ,出现这个问题是由于其他用户登录Web后，退出Web时直接关闭了浏览器，没有点击Web右上角的<退出登录>按钮，造成设备上的用户没有真正退出。 在设备上使用命令freewebusersall强制在线Web用户下线，然后再次登录Web。 2.2设备升级以后，重新登录Web时失败，提示“功能函数错误” 
用户无法登录云AP的本地Web页面,云AP没有上电，导致搜索不到云AP的管理Wi-Fi，无法登录本地Web页面,Suggestion not provided
用户无法通过Web方式登录设备,网络连通性异常,Suggestion not provided
用户下发ACL失败，具体分两种失败情况： •	执行下发命令后设备提示资源不足。 •	执行下发命令后设备无任何错误提示，但ACL不起作用。 ,•	系统硬件资源不足 •	packet-filter或QoS策略配置不正确 3.	故障分析 本类故障的诊断流程如图124所示。 图124ACL下发失败故障诊断流程图 ,"(1)查看下发时是否报硬件资源不足 下发ACL配置时如果界面打印出“Reason:Notenoughhardwareresource”字样，则表明ACL下发失败是由硬件资源不足导致。通过displayqos-aclresource命令可以进一步确认ACL硬件资源使用情况。 [Sysname]displayqos-aclresource Interfaces:XGE2/1/0/1toXGE2/1/0/21,XGE2/1/0/22 XGE2/1/0/23toXGE2/1/0/24 --------------------------------------------------------------------- TypeTotalReservedConfiguredRemainingUsage--------------------------------------------------------------------- VFPACL1024768025675% IFPACL20481792125587%IFPMeter1024896012887%IFPCounter1024896012887%EFPACL10240010240%EFPMeter512005120%EFPCounter512005120% Interfaces:XGE2/1/0/25toXGE2/1/0/48 ---------------------------------------------------------------------TypeTotalReservedConfiguredRemainingUsage---------------------------------------------------------------------VFPACL1024768025675%IFPACL20481536151175%IFPMeter1024768025675%IFPCounter1024768025675%EFPACL10240010240% EFPMeter512005120%EFPCounter512005120% 如果显示信息中Remaining条目为0了，则表示ACL硬件资源已用尽，设备无法再下发ACL。如果下发时没有报“Reason:Notenoughhardwareresource”字样，则根据下发方式进行 步骤选择： 	通过MQC（QoS策略）方式下发，请进行步骤2； 	通过包过滤（packet-filter）方式下发，请进行步骤3。 (2)	检查QoS策略配置是否正确通过下面命令分别检查不同使用情况下QoS策略的配置情况（不同设备对于下述命令支持情 	，displayqospolicyl2vpn-ac 	显示端口上QoS策略配置信息，displayqospolicyinterface； 	显示VLAN上QoS策略配置信息，displayqosvlan-policy； 	显示全局QoS策略配置信息，displayqospolicyglobal； 	显示控制平面上QoS策略配置信息，displayqospolicycontrol-plane 如果QoS策略中缺少流分类和流行为关联的配置，则补充相应配置。否则可通过以下两个命 	user-defined； 	显示配置的流行为信息，displaytrafficbehavioruser-defined；如果没有正确配置，则进行正确配置，否则进行步骤4。 (3)	检查packet-filter配置是否正确可以通过displaypacket-filter命令检查packet-filter配置是否正确，如果不正确，则进行正确配置，否则进行步骤4。 (4)	检查ACL配置是否正确可以通过displayacl命令检查ACL是否配置正确，包括各条规则的内容、规则的匹配顺序等。确认规则的内容与报文是否匹配，是否因匹配顺序的原因导致报文没有被匹配上。如果不正确，则进行正确配置，否则进行步骤5。 例1： ACLnumber3100 rule0permitipsource2.2.2.20.0.255.255rule1denyipdestination3.3.3.30.0.255.255 如果有报文目的IP是3.3.3.3，源IP地址是2.2.2.2，则只能匹配rule0，不能匹配rule1，如果期望达到rule1的效果，则此ACL未生效。 例2： ACLnumber3100 rule0permitipsource2.2.2.20.0.255.255ACLnumber3009 rule0permitipsource2.2.2.20.0.0.255 当流量的源IP地址为2.2.2.2时，就会同时符合ACLnumber3100与ACLnumber3009的匹配要求，即发生重叠匹配现象。 ACL的规则匹配顺序请参考“ACL和QoS配置指导”中的“ACL”。 (5)寻求技术支持如果上述检查完成后故障仍无法排除，请联系H3C的技术支持工程师。 5.告警与日志 相关告警无 相关日志无 16.2QoS故障处理 16.2.1拥塞丢包故障的定位思路 "
用户在云平台上添加云AP设备后，云AP不能在云平台上线 ,本类故障的常见原因主要包括： •在云平台添加设备时没有正确输入云AP的SN码，导致云AP添加后不能上线。 •云AP没有连接外网，导致云AP无法在云平台上线。 •云AP在本地Web页面上的云管理配置不正确，导致云AP无法在云平台上线。 •云AP已经在AC上线，因为云AP无法同时在AC与云平台上线，导致在云平台上线失败。 图4-2云AP无法连接至云平台故障排查流程图 ,(1)确认在云平台添加设备时正确输入设备的SN码 添加设备时如果输入SN码错误，会导致设备无法在云平台上线。 如果故障仍不能排除，则执行步骤(2)。 (2)查看云平台是否存在云AP的License 登录云平台账号，在[网络管理/设置/License许可]页面的“License管理”页签中选择“已安装License”查看云平台是否存在云APLicense。 图4-3查看云APLicense 新注册的云平台账户拥有云AP试用License，支持最多128台、每台最多180天的试用，试用结束后云AP将自动下线。 若不存在，请购买并安装正式授权。云APLicense授权码及操作方法请参见《H3C云AP License使用指南》。 若存在，请将License绑定云AP设备。 如果故障仍不能排除，则执行步骤(3)。 (3)云AP是否连接外网 请确保云AP的上行设备正确接入网络，云AP可以从上行设备动态获取到IP地址，且该地址与公网网络可达。 若云APIP地址与公网网络不可达，请参考《H3C云AP连接绿洲平台典型配置举例(V7)》重新配置网络。 若云APIP地址与公网网络可达，则执行步骤(4)。 (4)云AP的云管理配置是否正确 登录本地Web页面，确保云平台服务器域名填写正确，填写错误将导致云AP无法连接云平台。云AP本地Web页面的云平台服务器域名为cloudnet.h3c.com。 图4-4本地Web云管理配置 如果故障仍不能排除，则执行步骤(5)。 (5)云AP的CAPWAP隧道是否断开 云AP同时只能被AC和云平台其中一个管理。云AP已经存在CAPWAP隧道时，无法在云平台上线。 如果云AP当前已经在AC上线，可以在AC的系统视图下通过undowlanap命令删除该云AP，或将云AP与AC间的物理链路断开，以断开AP与AC间的CAPWAP隧道。 如果云AP没有在AC上线，则执行步骤(6)。 (6)如果故障仍不能排除，请收集如下信息，并拨打热线400-810-0504求助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.19WIPS反制故障处理 
用户在云平台上添加云AP设备后，云AP不能在云平台上线。 ,本类故障的常见原因主要包括： •在云平台添加设备时没有正确输入云AP的SN码，导致云AP添加后不能上线。 •云AP没有连接外网，导致云AP无法在云平台上线。 •云AP在本地Web页面上的云管理配置不正确，导致云AP无法在云平台上线。 •云AP已经在AC上线，因为云AP无法同时在AC与云平台上线，导致在云平台上线失败。 图4-2云AP无法连接至云平台故障排查流程图 ,(1)确认在云平台添加设备时正确输入设备的SN码 添加设备时如果输入SN码错误，会导致设备无法在云平台上线。 如果故障仍不能排除，则执行步骤(2)。 (2)查看云平台是否存在云AP的License 登录云平台账号，在[网络管理/设置/License许可]页面的“License管理”页签中选择“已安装License”查看云平台是否存在云APLicense。 图4-3查看云APLicense 新注册的云平台账户拥有云AP试用License，支持最多128台、每台最多180天的试用，试用结束后云AP将自动下线。 若不存在，请购买并安装正式授权。云APLicense授权码及操作方法请参见《H3C云AP License使用指南》。 若存在，请将License绑定云AP设备。 如果故障仍不能排除，则执行步骤(3)。 (3)云AP是否连接外网 请确保云AP的上行设备正确接入网络，云AP可以从上行设备动态获取到IP地址，且该地址与公网网络可达。 若云APIP地址与公网网络不可达，请参考《H3C云AP连接绿洲平台典型配置举例(V7)》重新配置网络。 若云APIP地址与公网网络可达，则执行步骤(4)。 (4)云AP的云管理配置是否正确 登录本地Web页面，确保云平台服务器域名填写正确，填写错误将导致云AP无法连接云平台。云AP本地Web页面的云平台服务器域名为cloudnet.h3c.com。 图4-4本地Web云管理配置 如果故障仍不能排除，则执行步骤(5)。 (5)云AP的CAPWAP隧道是否断开 云AP同时只能被AC和云平台其中一个管理。云AP已经存在CAPWAP隧道时，无法在云平台上线。 如果云AP当前已经在AC上线，可以在AC的系统视图下通过undowlanap命令删除该云AP，或将云AP与AC间的物理链路断开，以断开AP与AC间的CAPWAP隧道。 如果云AP没有在AC上线，则执行步骤(6)。 (6)如果故障仍不能排除，请收集如下信息，并拨打热线400-810-0504求助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 4.19WIPS反制故障处理 
用户终端设备接入生成树网络时，连接终端设备的接口发生闪断，业务长时间丢包，造成终端设备掉线。 ,"本类故障的常见原因为：连接用户终端设备的接口未被配置为边缘端口。 3.故障分析 本类故障的诊断流程如图4-6所示。 图4-6接入生成树网络的用户终端设备发生掉线的故障诊断流程图 4.处理步骤 (1)检查生成树网络中与用户终端设备直连的接口是否为边缘端口。 在与用户终端设备直连的生成树网络设备上执行displaystp命令，查看与用户终端设备 直连的接口是否为边缘端口，例如： <Sysname>displaystp ... ----[Port1(GigabitEthernet1/0/1)][FORWARDING]---- Portprotocol:Enabled Portrole:DesignatedPort PortID:128.2 Portcost(Legacy):Config=auto,Active=20 Desg.bridge/port:32768.2eae-3769-0200,128.2 Portedged:Config=enabled,Active=enabled Point-to-Point:Config=auto,Active=true Transmitlimit:10packets/hello-time Protectiontype:Config=none,Active=none Rapidtransition:True Porttimes:Hello2sMaxAge20sFwdDelay15sMsgAge0s... 如果与用户终端设备直连的接口是边缘端口，请执行步骤（2）。 如果与用户终端设备直连的接口不是边缘端口，请进入该接口视图，并执行stpedged-port命令，将该端口配置为边缘端口。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警•无 相关日志 •STP/6/STP_DETECTED_TC 4.4.3非0实例端口状态为主端口且无法调整 ",Suggestion not provided
由于设备不支持RADIUS服务器下发的Login-Service属性值，导致用户认证失败。 打开设备上RADIUS的报文调试信息开关（通过执行debuggingradiuspacket命令），在如 下形式的调试信息中查看到服务器下发的Login-Service属性类型为设备不支持的类型： *Aug302:33:18:7072021SysnameRADIUS/7/PACKET: Service-Type=Framed-User Idle-Timeout=66666 Session-Timeout=6000 Login-Service=TCP-Clear ,本类故障的主要原因为，用户登录的业务类型与服务器下发的Login-Service属性所指定的业务类型不一致。 Login-Service属性由RADIUS服务器下发给用户，标识认证用户的业务类型。当前设备支持的 Login-Service属性取值如下： •0：Telnet（标准属性） •50：SSH（扩展属性） •51：FTP（扩展属性） •52：Terminal（扩展属性） •53：HTTP（扩展属性） •54：HTTPS（扩展属性） 可以通过命令行设置设备对Login-Service属性的检查方式，控制设备对用户进行业务类型一致性检查的方式。 3.故障分析 本类故障的诊断流程如图4-36所示。图4-36用户接入类型与RADIUS服务器下发的Login-Service属性值不匹配的故障诊断流程图 4.处理步骤 (1)检查RADIUS服务器下发的Login-Service属性与接入类型是否匹配。 在接入设备上执行displayradiusscheme命令，查看RADIUS方案下的“Attribute15check-mode”字段取值： 取值为Loose，表示采用松散检查方式，即使用Login-Service的标准属性值对用户业务类型进行检查。对于SSH、FTP、Terminal用户，在RADIUS服务器下发的Login-Service属性值为0（表示用户业务类型为Telnet）时才，这类用户才能够通过认证。 取值为Strict，表示采用严格检查方式，即使用Login-Service的标准属性值以及扩展属性值对用户业务类型进行检查。对于SSH、FTP、Terminal用户，当RADIUS服务器下发的Login-Service属性值为对应的扩展取值时，这类用户才能够通过认。如果RADIUS服务器下发给用户的Login-Service属性不属于设备支持的Login-Service属性 范围，则可以选用如下方法之一解决： 在RADIUS服务器上，设置服务器不下发Login-Service属性或者修改下发的属性值为接 在接入设备上，进入(入设备支持的取值。)相应的RADIUS方案，通过执行attribute15check-mode命令修改对Login-Service属性的检查方式（下例中为松散检查方式）。 <Sysname>system-view [Sysname]radiusschemeradius1 [Sysname-radius-radius1]attribute15check-modeloose (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、调试信息、告警信息。 5.告警与日志 相关告警 无 相关日志无 4.13.13本地认证登录失败 ,Suggestion not provided
与AC相连的MPPCAPWAP连接正常，MeshProfile也绑定到射频，但MAP却无法与其建立正常Mesh链路,(1)MPP上需要使用portal-serviceenable命令配置MPP停止发送邻居探测请求。 (2)MPP和MAP所在的信道应该相同。 4.9快速漫游失败 ,(1)MPP上需要使用portal-serviceenable命令配置MPP停止发送邻居探测请求。 (2)MPP和MAP所在的信道应该相同。 4.9快速漫游失败 
与AC相连的MPPCAPWAP连接正常，MeshProfile也绑定到射频，但MAP却无法与其建立正常Mesh链路，或经过MAP的ping操作失败,(1)MPP上需要使用portal-serviceenable命令配置MPP停止发送邻居探测请求。 (2)MPP和MAP所在的信道应该相同。 4.9快速漫游失败 ,(1)MPP上需要使用portal-serviceenable命令配置MPP停止发送邻居探测请求。 (2)MPP和MAP所在的信道应该相同。 4.9快速漫游失败 
原有主控板或新加入设备的备用主控板无法启动,"本类故障的常见原因主要包括：•主控板卡硬件故障导致无法上电。 •主控板卡BootWare基本段损坏。 •内存或CPU硬件故障导致BootWare无法运行。 •启动文件丢失、校验失败、与硬件不匹配。 •备用主控板和原主控板的型号不一致。 •备用主控板和原主控板的软件版本不一致。 3.故障分析 原主控板无法启动故障的诊断流程如图11所示。 图11原主控板无法启动故障诊断流程图 新加入设备的备用主控板无法启动故障的诊断流程如图12所示。 图12新加入设备的备用主控板无法启动故障诊断流程图 4.处理步骤 •原主控板无法启动故障的处理步骤如下： (1)查看主控板运行灯（RUN灯）是否点亮 BootWare基本段启动后，会立刻将运行灯置成快闪，所以这是判断系统能否启动的重要标志。 表2主控板运行灯状态及含义 主控板运行灯状态指示灯含义 RUN绿色常灭表示单板故障或单板不在位 绿色4Hz闪烁表示软件加载下载过程中 绿色0.5Hz闪烁表示单板正常工作 分以下几种情况处理： a.情况1：运行灯快闪如果设备上电后运行灯以4Hz频率快闪，说明基本段启动正常，则进行步骤2。 b.情况2：运行灯不亮 若运行灯没有点亮，有两个可能：设备不能上电；BootWare基本段被破坏。 先判断设备是否上电。从主控入风口正面观察，主控板内部是否有绿色闪灯或者常亮灯，也可以经过一段时间后，拔出主控板，检验CPU上的散热片是否有热度。如果没有上电，则检查供电、电源模块，设备硬件故障也可能导致主板不能上电。如果设备上电正常，则应该是BootWare基本段被破坏，需要返回研发处理。 •这里所说的运行灯不亮，是指上电后从来没亮过，如果开始闪了一会儿（超过5秒）后续又灭的，则不算此情况。 •一上电运行灯就常亮或慢闪（1Hz频率）是基本不可能的，若出现则为硬件故障。 •此处指示灯状态仅表示大多数主控板的情况，具体各主控板的指示灯状态请参见其安装手册。 (2)检查Bootware是否运行成功 a.情况1：基本段运行成功查看是否有如下信息，是则说明基本段运行成功，进入步骤3。 Systemisstarting... BootingNormalExtendedBootWare ****************************************************************************** *H3CS9850BOOTROM,Version061*** ****************************************************************************Copyright(c)2004-2020NewH3CTechnologiesCo.,Ltd. CompiledDate:Sep17201814:37:13CPUType:C2538CPUClockSpeed:1200MHz MemoryType:DDR3SDRAM MemorySize:16384MB MemorySpeed:1333MHz FlashSize:8MB CPLDVersion:1.0 PCBVersion:Ver.BBootWareValidating... b.情况2：没有任何输出信息如果上电后打印类似下面信息，则可能是内存条有问题，可检查是否有插紧，或尝试更换内存条。也有可能是内存通道的硬件电路出现问题，请联系H3C技术支持。 readedvalueis75555555,expectedvalueis55555555DRAMtestfailsat:5ff80020 Fatalerror!Pleasereboottheboard. 以上信息是内存自检失败打印的。有时候系统因为异常发生热启动，内存控制器状态还未恢复，会出现自检失败的情况（极小概率），此时一般断电，再开电后就能恢复，和内存损坏的情况有区别。 (3)查看加载启动文件是否正常 a.情况1：启动文件加载、解压成功 显示如下信息，说明启动文件加载、解压成功，进行步骤4。 *******************************************************************************H3CS9850BOOTROM,Version061*******************************************************************************Copyright(c)2004-2018NewH3CTechnologiesCo.,Ltd. CompiledDate:Sep17201814:37:13 CPUType:C2538CPUClockSpeed:2400MHzMemoryType:DDR3SDRAM MemorySize:8192MB MemorySpeed:1333MHz FlashSize:3630MB CPLDVersion:8.0PCBVersion:Ver.0 BootWareValidating... PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU... Loadingthemainimagefiles...Loadingfileflash:/S12500R-CMW910-SYSTEM-D5202P14.bin.................................................................................................. ............................................................................ ............................................................................ ...............................................................................................................Done.Loadingfileflash:/S12500R-CMW910-BOOT-D5202P14.bin.................................................................................................... .................................................................................................................................................................................................................................... ....................................................................................Done.Imagefileflash:/S12500R-CMW910-BOOT-D5202P14.binisself-decompressing................................................................................ ....................................................................... Done.Systemimageisstarting... Cryptographicalgorithmstestspassed. b.情况2：启动文件不存在 显示如下信息，表示启动文件不存在，需要重新下载启动文件。 *******************************************************************************H3CS9850BOOTROM,Version061*******************************************************************************Copyright(c)2004-2018NewH3CTechnologiesCo.,Ltd. CompiledDate:Sep17201814:37:13 CPUType:C2538 CPUClockSpeed:2400MHz MemoryType:DDR3SDRAM MemorySize:8192MB MemorySpeed:1333MHz FlashSize:3630MB CPLDVersion:8.0 PCBVersion:Ver.0 BootWareValidating... Applicationprogramdoesnotexist. PleaseinputBootWarepassword: c.情况3：启动文件CRC错误若显示如下信息，表示获取的启动文件发生校验错，请重新下载文件到flash。 **************************************************************************** ** *H3CS9850BOOTROM,Version061* ** ****************************************************************************Copyright(c)2004-2018NewH3CTechnologiesCo.,Ltd. CompiledDate:Sep17201814:37:13 CPUType:C2538 CPUClockSpeed:2400MHz MemoryType:DDR3SDRAM MemorySize:8192MB MemorySpeed:1333MHz FlashSize:3630MB CPLDVersion:8.0 PCBVersion:Ver.0 BootWareValidating...PressCtrl+BtoaccessEXTENDED-BOOTWAREMENU...Loadingthemainimagefiles... Loadingfileflash:/S12500R-CMW910-SYSTEM-D5202P14.bin.................................................................................................. ............................................................................Somethingwrongwiththefile. (4)检查启动文件启动过程 a.情况1：没有System包，系统启动之后进入boot界面 Loadingthemainimagefiles... Loadingfileflash:/S12500R-CMW910-SYSTEM-D5202P14.bin.........................................................Done. <boot> 这种情况，需要重新下载软件版本 b.情况2：Systemimageisstarting...，一直挂死 c.情况3：Systemimageisstarting...，未进入命令行，反复重启 d.情况4：提示PressENTERtogetstarted，但是无法进入命令行 e.情况5：可以进入命令行，但是一段时间之后自动重启对于b.c.d.e.情况，可能是硬件故障或者软件版本存在问题，请联系H3C技术服务支持。 •新加入设备的备用主控板无法启动故障按如下步骤处理： (5)检查新加入主控板是否和原主控板型号一致同一台设备中的两块主控板型号要求一致。检查两块主控板型号是否一致，如果不一致，更换一块型号一致的主控板插入。 (6)收集诊断信息检查主用主控板运行状态，收集诊断信息，寻求技术支持。 (7)寻求技术支持 如果上述检查完成后故障仍无法排除，请联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志无 3.5.3主控板在使用中发生重启，无法正常启动 ",Suggestion not provided
远端PE发布的私网路由在本端PE上频繁震荡,"本类故障的常见原因主要包括：•检测的PW不存在。 •PW模板配置错误。 •PW故障。 •PW不存在有效的公网转发路径。 3.故障分析 本类故障需要根据pingmplspw命令的回显信息进行分析和定位，具体诊断思路如下：•回显信息为UnknownPW时，表示检测的PW不存在，需要修改配置来解决本类故障。 •回显信息为NosuitablecontrolchannelforthePW时，表示PW的VCCV控制通道类型配置错误，需要通过vccvcc命令修改PW模板中VCCV控制通道类型来解决本类故障。 •回显信息为Pleaseconfigurepseudowirecontrol-wordforcontrolchannel时，表示PW引用的PW模板中未开启控制字功能，需要通过control-wordenable命令在PW模板下开启控制字功能来解决本类故障。（不支持control-wordenable命令的产品请忽略此步骤） •回显信息为Requesttimeout时，先排查本端PW是否Up，再通过tracertmplspw命令来定位故障节点。本类故障的诊断流程如图94所示。 图94PWping不通的故障诊断流程图 4.处理步骤 回显信息为UnknownPW时，本类故障的处理步骤为：修改配置确保检测的PW存在。 回显信息为NosuitablecontrolchannelforthePW时，本类故障的处理步骤为：通过vccvcc命令将PW两端的VCCV控制通道类型配置一致。 回显信息为Pleaseconfigurepseudowirecontrol-wordforcontrolchannel时，本类故障的处理步 骤为：通过control-wordenable命令在PW模板下开启控制字功能。（不支持control-wordenable命令的产品请忽略此步骤）回显信息为Requesttimeout时，本类故障的处理步骤如下：(1)执行displayl2vpnpw命令查看PW是否Up。 <Sysname>displayl2vpnpw Flags:M-main,B-backup,E-ecmp,BY-bypass,H-hublink,S-spokelink N-nosplithorizon,A-administration,ABY-ac-bypassPBY-pw-bypass TotalnumberofPWs:2 2up,0blocked,0down,0defect,0idle,0duplicateXconnect-groupName:ldp PeerPWID/RmtSite/SrvIDIn/OutLabelProtoFlagLinkIDState 192.3.3.35001299/1299LDPM0Up VSIName:aaa PeerPWID/RmtSite/SrvIDIn/OutLabelProtoFlagLinkIDState 2.2.2.921420/1419BGPM9Up 若PW为Down状态，请通过displayl2vpnpwverbose命令查看PW状态变为Down的原因，并根据故障原因进行故障处理。 <Sysname>displayl2vpnpwverbose VSIName:aaa Peer:2.2.2.9RemoteSite:2 SignalingProtocol:BGP LinkID:9PWState:DownInLabel:1420OutLabel:1419 MTU:1500 PWAttributes:Main VCCVCC:- VCCVBFD:- FlowLabel:Send ControlWord:Disabled TunnelGroupID:0x800000960000000 TunnelNHLFEIDs:1038 AdminPW:-E-TreeMode:- E-TreeRole:root RootVLAN:- LeafVLAN:- DownReasons:Controlwordnotmatch 常见的故障原因及处理方法如下： −BFDsessionforPWdown：用来检测PW的BFD会话状态为down，此类故障的处理方式为，通过displaybfdsession命令查看BFD状态为down的原因，检查并修改BFD配置或检查物理链路是否存在链路故障、链路质量问题。 −BGPRDwasdeleted：BGP的RD被删除，此类故障的处理方式为，在交叉连接组自动发现视图下配置route-distinguisherroute-distinguisher命令。 −BGPRDwasempty：未配置BGP的RD，此类故障的处理方式为，在交叉连接组自动发现视图下配置route-distinguisherroute-distinguisher命令。−Controlwordnotmatch：PW两端控制字功能配置不一致，此类故障的处理方式为，将PW两端引用的PW模板下的控制字功能（通过control-wordenable命令开启）配置一致。（不支持control-wordenable命令的产品请忽略此步骤）−Encapsulationnotmatch：PW两端封装类型不一致，此类故障的处理方式为，将PW两端引用的PW模板下的PW数据封装类型（通过pw-type命令配置）配置一致。（不支持pw-type命令的产品请忽略此步骤） −LDPinterfaceparameternotmatch：PW两端接口LDP协商参数不一致，此类故障的处理方式为，将PW两端引用的PW模板下的VCCV控制通道类型（通过vccvcc命令配置）配置一致或将PW两端关联的电路仿真接口下引用的电路仿真类中的配置保持一致。 −Non-existentremoteLDPPW：对端设备已删除LDPPW，此类故障的处理方式为，在对端设备上重新配置PW。 −LocalACDown：本地AC状态为down，此类故障的处理方式为，检查并修改AC接口上的配置或排除AC所在的接口的故障，保障接口为Up状态。 −LocalACwasnon-existent：未配置本地AC，此类故障的处理方式为，配置本地的AC并关联VSI。 −MTUnotmatch：PW两端MTU不一致，此类故障的处理方式为，将PW两端的MTU配置一致或者通过mtu-negotiatedisable命令关闭PWMTU协商功能。（不支持mtu-negotiatedisable命令的产品请忽略此步骤） −RemoteACDown：对端AC状态down，此类故障的处理方式为，检查并修改对端AC接口上的配置或排除AC所在的接口的故障，保障接口为Up状态。 若PW为Up状态，请继续执行第(2)步。 (2)执行displayl2vpnforwardingpwverbose命令，查看PW的转发信息中入标签（In Label）、出标签（OutLabel）和承载PW的隧道对应的NHLFE表项索引值（TunnelNHLFEIDs）是否为有效值。 <Sysname>displayl2vpnforwardingpwverbose Xconnect-groupName:xcg1ConnectionName:c1 LinkID:0 PWType:VLANPWState:Up InLabel:110126OutLabel:130126 MTU:1500 PWAttributes:Main VCCVCC:Router-Alert VCCVBFD:FaultDetectionwithBFD FlowLabel:- TunnelGroupID:0x800000130000001 TunnelNHLFEIDs:3 VSIName:aaaLinkID:8 PWType:VLANPWState:Up InLabel:1272OutLabel:1275 MTU:1500PWAttributes:MainVCCVCC:- VCCVBFD:FaultDetectionwithBFD FlowLabel:- TunnelGroupID:0x960000000 TunnelNHLFEIDs:1034 若入、出标签取值为空或者为“-”。请先执行displayl2vpnpwverbose命令查看 PW使用的信令协议（SignalingProtocol），再修改建立PW的信令协议相关配置是否正确： −若信令协议为BGP，则需要检查并修改BGP相关配置； −若信令协议为LDP，则需要检查并修改LDP相关配置； −若信令协议为Static，则需要检查并修改静态PW配置。 有关PW信令协议相关配置的详细介绍，请参见产品手册的“MPLS配置指导”中的“MPLSL2VPN”和“VPLS”。 若TunnelNHLFEIDs取值为空，请继续执行第(3)步。。 若PW的转发信息正常，请继续执行第(4)步。 (3)执行displaymplslsp命令，查看是否存在承载PW的隧道，即是否存在FEC为PW对端IP地址的LSP，若不存在，则需要先完成承载PW的隧道的建立。 <Sysname>displaymplslsp FECProtoIn/OutLabelOutInter/NHLFE/LSINDEX 100.100.100.100/24LDP-/1049GE1/0/1 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 n命令收集诊断信息。 5.告警与日志相关告警无。相关日志 •L2VPN/2/L2VPN_PWSTATE_CHANGE •L2VPN/4/L2VPN_BGPVC_CONFLICT_LOCAL •L2VPN/4/L2VPN_BGPVC_CONFLICT_REMOTE •L2VPN/4/L2VPN_HARD_RESOURCE_NOENOUGH •L2VPN/2/L2VPN_HARD_RESOURCE_RESTORE •L2VPN/4/L2VPN_LABEL_DUPLICATE 12.3MPLSL3VPN故障处理 12.3.1L3VPN流量中断 本类故障的常见原因主要包括：•私网路由下一跳不可达。 •路由策略配置不当导致路由无法发布和接收。 •标签超限导致私网路由无法发布。 •私网路由迭代不到隧道。 •ExportRT和ImportRT不匹配导致路由无法学习到私网路由表中。 •路由超限导致收到的路由被丢弃。 3.故障分析 本类故障的诊断流程如图95所示。 图95L3VPN流量中断故障诊断流程图 4.处理步骤(1)检查路由是否为最优路由。 执行命令displaybgprouting-tablevpnv4或displaybgprouting-tablevpnv6命令，查看BGPVPNv4/VPNv6路由表中到达VPNv4/VPNv6邻居的BGP路由是否最优。 以路由100.1.2.0/24为例，路由信息中存在标记“>”，则表示该路由为最优路由。 <Sysname>displaybgprouting-tablevpnv4 BGPlocalrouterIDis1.1.1.9 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala–additional-path Origin:i-IGP,e-EGP,?-incomplete TotalnumberofVPNroutes:8 TotalnumberofroutesfromallPEs:8 Routedistinguisher:100:1(vpn1) Totalnumberofroutes:6 NetworkNextHopMEDLocPrfPrefValPath/Ogn *>1.1.1.0/241.1.1.1032768?*1.1.1.2/321.1.1.1032768? *>100.1.2.0/24100.1.1.101000400i 根据以上显示信息进行判断： 如果不是最优路由，则执行displaymplslsp命令，查看是否存在指定路由的MPLS转发表项。如果不存在，则请在连接远端PE的公网接口下执行mplsenable和mplsldpenable命令，开启MPLS功能和LDP功能，保证VPNv4路由可以迭代到公网LSP；如果存在，则执行步骤(2)。 如果是最优路由，则执行步骤(2)。 (2)检查私网路由下一跳是否可达。 在路由的发送端（本端PE）执行displaybgprouting-tablevpnv4ipv4-address[mask|mask-length]命令查看私网路由信息（ipv4-address表示私网路由前缀）， 确认路由是否存在。 如果路由不存在，请确认CE路由是否发布到PE。在远端PE上执行displaybgprouting-tablevpnv4peeradvertised-routes或displaybgprouting-tablevpnv6peeradvertised-routes命令，查看远端PE是否将私网路由信息发布给本端PE，例如： <Sysname>displaybgprouting-tablevpnv4peer22.22.22.22advertised-routes Totalnumberofroutes:6 BGPlocalrouterIDis11.11.11.11 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala-additional-path Origin:i-IGP,e-EGP,?-incomplete Routedistinguisher:1:1 Totalnumberofroutes:3 NetworkNextHopMEDLocPrfPath/Ogn *>e1.1.1.1/3210.1.1.2010020i*>e7.7.7.7/3210.1.1.2010020?*>e10.1.1.0/2410.1.1.2010020?如果不存在以上显示信息，则执行步骤(3)。 如果路由存在，请确认私网路由下一跳是否可达，且私网路由是否活跃。 查看State字段，如果取值包括valid，则表示该路由是活跃的。查看Originalnexthop字 段，如果私网路由不活跃，则执行displayiprouting(果存在下一跳信息，则表示私网路由下一跳可达。−如)-tablevpn-instancevpn-instance-nameip-address命令查看IP路由表中是否存在到BGP下一跳（Originalnexthop）的路由。如果不存在，则说明私网路由下一跳不可达，请检查PE之间的公网路由配置；如果存在，则说明BGP路由下一跳可达，请执行步骤(3)。 −如果私网路由活跃，则执行步骤(3)。 <sysname>displaybgprouting-tablevpnv46.0.0.932 BGPlocalrouterID:4.0.0.9 LocalASnumber:200 Routedistinguisher:103:1 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof6.0.0.9/32:From:3.0.0.9(3.0.0.9)Relynexthop:20.0.2.1 Originalnexthop:3.0.0.9 OutLabel:24128 Ext-Community:<RT:100:1> RxPathID:0x0 TxPathID:0x0 AS-path:300103 Origin:igp Attributevalue:pref-val0 State:valid,external,best IPprecedence:N/A QoSlocalID:N/A Trafficindex:N/A Tunnelpolicy:tp1 RelytunnelIDs:2 (3)检查路由策略是否正确。 在路由的发送端和接收端执行displaycurrent-configurationconfigurationbgp命令查看BGP配置，确认是否配置邻居的出方向和入方向策略。 <sysname>displaycurrent-configurationconfigurationbgp #bgp100 peer1.1.1.1as-number100peer3.3.3.3as-number100 peer3.3.3.3connect-interfaceLoopBack1 # address-familyvpnv4peer3.3.3.3enable peer3.3.3.3route-policyinimportpeer3.3.3.3route-policyoutexport #return 如果两端配置了出方向和入方向策略，则需要确认这些策略是否会把私网路由过滤掉，导致该路由无法正常收发。如果两端没有配置相应的出方向和入方向策略，或者路由策略没有过滤掉私网路由，则执行步骤(4)。 (4)检查路由是否能迭代到隧道。 在路由的接收端（远端PE）执行displaybgprouting-tablevpnv4ipv4-address[mask|mask-length]命令查看VPNv4路由，确认VPNv4路由是否可以迭代到隧道。 如果显示信息中存在RelytunnelIDs字段，则表示该路由可以迭代到隧道。 如果迭代不到隧道，则请参见“LDPLSP无法Up”故障进行定位。 如果迭代到隧道，则执行步骤(5)。 <sysname>displaybgprouting-tablevpnv46.0.0.932 BGPlocalrouterID:4.0.0.9 LocalASnumber:200 Routedistinguisher:103:1 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof6.0.0.9/32: From:3.0.0.9(3.0.0.9) Relynexthop:20.0.2.1 Originalnexthop:3.0.0.9 OutLabel:24128 Ext-Community:<RT:100:1> RxPathID:0x0 TxPathID:0x0 AS-path:300103 Origin:igp Attributevalue:pref-val0 State:valid,external,best IPprecedence:N/AQoSlocalID:N/ATrafficindex:N/A Tunnelpolicy:tp1 RelytunnelIDs:2 (5)检查是否ExportRT和ImportRT不匹配导致路由无法学习到私网路由表中。 在路由的发送端（本端PE）和接收端（远端PE）执行displaybgprouting-tablevpnv4和displaycurrent-configurationconfigurationvpn-instance命令，查看是否本端VPN实例的ExportRT与远端VPN实例的ImportRT不匹配，导致路由发送到远端 PE上执行在本端displaybgpro(PE后无法学习到远端VPN实例中。)uting-tablevpnv4和displayipextcommunity-list命令查看本端VPN实例的ERT是否被过滤，导致路由无法发布。 如果ExportRT和ImportRT不匹配，则请在VPN实例下执行vpn-target命令配置匹配的RT值。 如果ExportRT被路由策略过滤，则请在路由策略视图下执行applyextcommunityrt命令修改路由策略，取消过滤指定的RT属性。 如果ExportRT和ImportRT匹配，或者ExportRT未被路由策略过滤，则执行步骤(6)。查看路由携带的ERT： <sysname>displaybgprouting-tablevpnv46.0.0.932 BGPlocalrouterID:4.0.0.9 LocalASnumber:200 Routedistinguisher:103:1 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof6.0.0.9/32:From:3.0.0.9(3.0.0.9) Relynexthop:20.0.2.1 Originalnexthop:3.0.0.9 OutLabel:24128 Ext-Community:<RT:100:1> RxPathID:0x0 TxPathID:0x0 AS-path:300103 Origin:igp Attributevalue:pref-val0 State:valid,external,bestIPprecedence:N/A QoSlocalID:N/A Trafficindex:N/A Tunnelpolicy:tp1 RelytunnelIDs:2 查看BGP扩展团体属性列表信息： <sysname>displayipextcommunity-list1 ExtendedCommunityListNumber10 Denyrt:100:1 ExtendedCommunityListNumber20Permitrt:200:1 查看本地配置的IRT： <sysname>displaycurrent-configurationconfigurationvpn-instance # ipvpn-instancevpn1route-distinguisher1:1vpn-target100:1import-extcommunityvpn-target100:1export-extcommunity # (6)检查MPLS标签数量是否超限。在路由发送端（本端PE）执行displaymplsinterface命令确认与远端PE相连的公网接口是否开启了MPLS功能。 如果显示信息中存在与远端PE相连的公网接口，则表示与远端PE相连的公网接口开启了MPLS功能。 如果显示信息中不存在与远端PE相连的公网接口，则在与远端PE相连的公网接口视图下执行mplsenable命令，开启MPLS功能。 <Sysname>displaymplsinterface InterfaceStatusMPLSMTU GE1/0/1Up1500 GE1/0/2Up1500 使用displaybgprouting-tablevpnv4advertise-info命令查看路由发送时是否申请标签。 如果显示信息中Inlabel字段无取值，则可能是由于标签资源不足，导致无法为该路由申请标签。如果是标签不足，则可以通过以下方法减少标签的使用量： −在VPN实例视图下执行apply-labelper-instance命令配置每实例每标签。 −通过路由聚合来减少路由数量。 −在系统视图下执行mplsmax-label命令增加设备可分配的标签数量。 如果显示信息中Inlabel字段有合理值，则表示标签资源充足，已经为该路由申请标签，请执行步骤(7)。 <Sysname>displaybgprouting-tablevpnv410.1.1.024advertise-info BGPlocalrouterID:1.1.1.9 LocalASnumber:100 Routedistinguisher:100:1 Totalnumberofroutes:1 Paths:1best BGProutingtableinformationof10.1.1.0/24(TxPathID:0): AdvertisedtoVPNpeers(1intotal): 3.3.3.9 Inlabel:1279 (7)检查路由数量是否超限。 执行displaybgppeervpnv4log-info命令，查看指定对等体的日志信息。如果显示Cease/maximumnumberofVPNv4prefixesreached，则表示路由数量超规格。 <Sysname>displaybgppeervpnv41.1.1.1log-info Peer:1.1.1.1 DateTimeStateNotification Error/SubError 06-Feb-201322:54:42DownSendnotificationwitherror6/1 Cease/maximumnumberofVPNv4prefixesreached如果设备上打印如下日志信息，则表示路由数量超规格。 BGP/4/BGP_EXCEED_ROUTE_LIMIT:BGPdefault.vpn1:Thenumberofroutes(101)frompeer1.1.1.1(IPv4-UNC)exceedsthelimit100. BGP/4/BGP_REACHED_THRESHOLD:BGPdefault.vpn1:Theratioofthenumberofroutes(3)receivedfrompeer1.1.1.1(IPv4-UNC)tothenumberofallowedroutes(2)hasreachedthethreshold(75%). 如果路由数量超规格，则在路由接收端的VPNv4地址族视图或者VPNv6地址族视图下执行peerroute-limit命令调大允许从对等体接收路由的最大数目。 如果路由数量未超规格，则执行步骤(8)。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：BGP4-MIB •bgpBackwardTransition(1.3.6.1.2.1.15.7.2)相关日志 •BGP_EXCEED_ROUTE_LIMIT •BGP_REACHED_THRESHOLD 12.3.2L3VPN私网路由频繁震荡 本类故障的常见原因主要包括： •公网路由震荡 •LDPLSP震荡 •接口震荡 3.故障分析 本类故障的诊断流程如图96所示。 图96L3VPN私网路由频繁震荡故障诊断流程图 4.处理步骤 (1)检查公网路由是否震荡。 a.确认路由类型。执行displayiprouting-table命令查看路由类型。以如下显示为例，Proto字段显示为IS_L1，表示路由类型为IS-IS；Interface字段显示为Tun1，表示部署了LDPoverMPLSTE。 <Sysname>displayiprouting-table1.1.1.1 Summarycount:1 Destination/MaskProtoPreCostNextHopInterface ",Suggestion not provided
运行OSPF的设备学习不到部分OSPF路由,本类故障的常见原因主要包括： •双方一端的网络类型为P2P，另一端的网络类型为Broadcast，邻居关系达到Full状态，但是 •OSPF进程下配(学习不到路由。)置了filter-policyimport命令。 •本OSPF区域下配置了filterimport命令。 •其他OSPF区域下配置了filterexport命令。 •绑定了VPN实例的OSPF进程，该进程引入外部路由的Tag值与ASExternalLSA（Type-5）或NSSAExternalLSA（Type-7）中的Tag值一致。 •ABR设备不可达。 •在ABR设备上，非骨干区的SummaryLSA不参与路由计算。 •ASBR设备不可达。 •ASExternalLSA（Type-5）或NSSAExternalLSA（Type-7）的FA地址不可达。 •NSSAExternalLSA（Type-7）到达FA地址的路由与NSSAExternalLSA（Type-7）不在同一区域。 3.故障分析 本类故障的诊断流程如图78、图79所示。 图78设备学习不到OSPF路由故障诊断流程图一 图79设备学习不到OSPF路由故障诊断流程图二 4.处理步骤 (1)检查建立邻居关系的双方是否一端的网络类型为P2P，另一端的网络类型为Broadcast。如果一端的网络类型为P2P，另一端的网络类型为Broadcast，那么邻居关系可以达到Full状态，但无法计算出路由信息。 a.请执行displayospfinterface命令查看接口的网络类型。 <Sysname>displayospfinterface OSPFProcess1withRouterID5.5.5.5 Interfaces Area:0.0.0.1 IPAddressTypeStateCostPriDRBDR 192.168.51.5PTPP-2-P110.0.0.00.0.0.0 b.如果存在上述情况，请在OSPF接口视图下执行ospfnetwork-type命令将本端设备与邻居设备的OSPF接口网络类型配置为一致。 如果不存在上述情况，请执行步骤(2)。(2)多次查看OSPF路由表，检查是否存在OSPF路由震荡的问题。 请执行displayiprouting-tableprotocolospfverbose命令，查看Age字段，确认是否存在震荡的OSPF路由。 如果某条或某些OSPF路由Age字段的数值一直很小，说明相应的OSPF路由发生震荡，请解决路由震荡问题。 如果不存在路由震荡的问题，请执行步骤(3)。 <Sysname>displayiprouting-tableprotocolospfverbose Summarycount:3 Destination:192.168.12.0/24 Protocol:O_INTER ProcessID:1 SubProtID:0x2Age:12h53m09s Cost:2Preference:10 IpPre:N/AQosLocalID:N/A Tag:0State:ActiveAdv OrigTblID:0x0OrigVrf:default-vrf TableID:0x2OrigAs:0 NibID:0x13000003LastAs:0 AttrID:0xffffffffNeighbor:0.0.0.0 Flags:0x10041OrigNextHop:192.168.51.1 Label:NULLRealNextHop:192.168.51.1BkLabel:NULLBkNextHop:N/A SRLabel:NULLInterface:GigabitEthernet1/0/2 BkSRLabel:NULLBkInterface:N/A SIDIndex:NULLInLabel:NULL TunnelID:InvalidIPInterface:GigabitEthernet1/0/2 BkTunnelID:InvalidBkIPInterface:N/AFtnIndex:0x0ColorInterface:N/ATrafficIndex:N/ABkColorInterface:N/AConnector:0.0.0.0VpnPeerId:N/ADscp:N/AExp:N/ASRTunnelID:InvalidStatFlags:0x0SIDType:N/ASID:N/A BkSID:N/ANID:InvalidFlushNID:InvalidBkNID:Invalid BkFlushNID:InvalidPathID:0x0 CommBlockLen:0 OrigLinkID:0x0RealLinkID:0x0 Destination:192.168.24.0/24 Protocol:O_INTER ProcessID:1 SubProtID:0x2Age:12h53m09s Cost:3Preference:10 IpPre:N/AQosLocalID:N/A Tag:0State:ActiveAdv OrigTblID:0x0OrigVrf:default-vrf TableID:0x2OrigAs:0 NibID:0x13000003LastAs:0 AttrID:0xffffffffNeighbor:0.0.0.0 Flags:0x10041OrigNextHop:192.168.51.1Label:NULLRealNextHop:192.168.51.1 BkLabel:NULLBkNextHop:N/A SRLabel:NULLInterface:GigabitEthernet1/0/2 BkSRLabel:NULLBkInterface:N/A SIDIndex:NULLInLabel:NULL TunnelID:InvalidIPInterface:GigabitEthernet1/0/2 BkTunnelID:InvalidBkIPInterface:N/AFtnIndex:0x0ColorInterface:N/ATrafficIndex:N/ABkColorInterface:N/AConnector:0.0.0.0VpnPeerId:N/ADscp:N/AExp:N/ASRTunnelID:InvalidStatFlags:0x0SIDType:N/ASID:N/A BkSID:N/ANID:InvalidFlushNID:InvalidBkNID:Invalid BkFlushNID:InvalidPathID:0x0 CommBlockLen:0 OrigLinkID:0x0RealLinkID:0x0 Destination:192.168.51.0/24 Protocol:O_INTRA ProcessID:1 SubProtID:0x1Age:12h54m07s Cost:1Preference:10 IpPre:N/AQosLocalID:N/A Tag:0State:InactiveAdv OrigTblID:0x0OrigVrf:default-vrf TableID:0x2OrigAs:0 NibID:0x13000001LastAs:0 AttrID:0xffffffffNeighbor:0.0.0.0Flags:0x10c1OrigNextHop:0.0.0.0 Label:NULLRealNextHop:0.0.0.0BkLabel:NULLBkNextHop:N/A SRLabel:NULLInterface:GigabitEthernet1/0/2 BkSRLabel:NULLBkInterface:N/A SIDIndex:NULLInLabel:NULL TunnelID:InvalidIPInterface:GigabitEthernet1/0/2 BkTunnelID:InvalidBkIPInterface:N/AFtnIndex:0x0ColorInterface:N/A TrafficIndex:N/ABkColorInterface:N/AConnector:0.0.0.0VpnPeerId:N/ADscp:N/AExp:N/ASRTunnelID:InvalidStatFlags:0x0SIDType:N/ASID:N/A BkSID:N/ANID:InvalidFlushNID:InvalidBkNID:Invalid BkFlushNID:InvalidPathID:0x0 CommBlockLen:0 OrigLinkID:0x0RealLinkID:0x0 (3)检查OSPF进程下是否配置了filter-policyimport命令。 某些场景下需要对路由信息进行过滤，实现业务隔离。请检查是否存在OSPF路由被错误过滤的情况。 a.请在本端设备出现问题的OSPF进程下执行displaythis命令，查看该OSPF进程下 是否配置了filter-policyimport命令，导致OSPF路由被过滤。 [Sysname-ospf-1]displaythis #ospf1import-routedirectfilter-policy2000importarea0.0.0.1 network192.168.51.00.0.0.255nssa#return b.如果OSPF进程下配置了filter-policyimport命令，请查看该命令引用的过滤规 −对于filter(则的配置信息。)-policyimport命令引用ACL规则进行路由过滤的情况，请执行 displayacl{acl-number|nameacl-name}命令查看ACL的配置信息。 −对于filter-policyimport命令引用前缀列表进行路由过滤的情况，请执行displayipprefix-list命令查看地址前缀列表的配置信息。 −对于filter-policyimport命令引用路由策略进行路由过滤的情况，请执行displayroute-policy命令查看路由策略的配置信息。 如果路由被过滤规则拒绝，请结合组网及实际业务需求确认过滤规则的配置是否合理。如果不合理，请修改filter-policyimport命令引用的过滤规则。 c.如果该路由没有被拒绝，或者该OSPF进程并没有配置filter-policyimport过滤策略，请执行步骤(4)。 (4)检查OSPF进程的LSDB是否包含未学习到的OSPF路由的LSA。请根据OSPF进程未学习到的路由信息的类型选择不同的故障处理方式。 oOSPF区域内路由如果OSPF进程缺失区域内路由，请在用户视图下执行displayospf[process-id]lsdbrouter命令，检查LSDB是否包含该区域中所有的RouterLSA信息。 <Sysname>displayospf100lsdbrouter OSPFProcess100withRouterID5.5.5.5 Area:0.0.0.1LinkStateDatabase Type:Router LSID:5.5.5.5 AdvRtr:5.5.5.5 LSage:7 Len:36 Options:ASBRONP Seq#:80000026Checksum:0x5f1f LinkCount:1 LinkID:192.168.51.1Data:192.168.51.5LinkType:TransNetMetric:1 Type:Router LSID:1.1.1.1 AdvRtr:1.1.1.1 LSage:8 Len:36 Options:ASBRABRONP Seq#:8000002aChecksum:0x534a LinkCount:1 LinkID:192.168.51.1Data:192.168.51.1LinkType:TransNetMetric:1 −如果OSPF进程的LSDB缺失RouterLSA，请执行步骤(7)。 −如果OSPF进程的LSDB包含完整的RouterLSA，但是无法计算出路由信息，请执行步骤(7)。 oOSPF区域间路由如果OSPF进程缺失区域间路由，请在用户视图下执行displayospf[process-id]lsdbsummary命令，检查LSDB是否包含其他所有区域的NetworkSummaryLSA。 <Sysname>displayospflsdbsummary OSPFProcess1withRouterID5.5.5.5 Area:0.0.0.1LinkStateDatabase Type:Sum-Net LSID:192.168.24.0 AdvRtr:1.1.1.1LSage:576 Len:28 Options:ONP Seq#:8000001fChecksum:0x4c25 NetMask:255.255.255.0 Tos0Metric:2 Type:Sum-Net LSID:192.168.12.0 AdvRtr:1.1.1.1LSage:576 Len:28 Options:ONP Seq#:8000001fChecksum:0xc6b7 NetMask:255.255.255.0Tos0Metric:1 −如果OSPF进程的LSDB缺失NetworkSummaryLSA，检查本区域下是否配置了filterimport命令，或者NetworkSummaryLSA的发布者所在区域下是否配置了filterexport命令。如果filterimport命令或filterexport命令引用的过滤规则错误地过滤掉了NetworkSummaryLSA，请修改过滤规则相关配置。filterimport命令和filterexport命令可以引用ACL、前缀列表、路由策略对NetworkSummaryLSA进行过滤，请分别使用displayacl{acl-number|nameacl-name}命令、displayipprefix-list命令、displayroute-policy命令查看相应的配置信息。 −如果OSPF进程的LSDB包含完整的NetworkSummaryLSA，但是无法计算出路由信息，请执行步骤(7)。 oO_ASE路由或者O_NSSA路由如果OSPF进程缺失O_ASE路由，请在用户视图下执行displayospf[process-id]lsdbase命令。检查LSDB是否包含ASExternalLSA。 <Sysname>displayospf100lsdbase OSPFProcess100withRouterID1.1.1.1LinkStateDatabase Type:ExternalLSID:10.1.1.0 AdvRtr:1.1.1.1LSage:713 Len:36 Options:OE Seq#:80000001 Checksum:0x934b NetMask:255.255.255.0 TOS0Metric:1 EType:2 ForwardingAddress:192.168.51.5Tag:1 如果OSPF进程缺失O_NSSA路由，请在用户视图下执行displayospf [process-id]lsdbnssa命令，检查LSDB是否包含NSSAExternalLSA。 <Sysname>displayospf100lsdbnssa OSPFProcess100withRouterID1.1.1.1 Area:0.0.0.0LinkStateDatabase Area:0.0.0.1LinkStateDatabase Type:NSSA LSID:192.168.51.0 AdvRtr:5.5.5.5LSage:965 Len:36 Options:ONP Seq#:8000001f Checksum:0x1dfa NetMask:255.255.255.0 TOS0Metric:1 EType:2 ForwardingAddress:192.168.51.5 Tag:1 Type:NSSA LSID:10.1.1.0 AdvRtr:5.5.5.5 LSage:965 Len:36 Options:ONP Seq#:8000001fChecksum:0x6840 NetMask:255.255.255.0 TOS0Metric:1 EType:2 ForwardingAddress:192.168.51.5 Tag:1 −如果OSPF进程的LSDB缺失ASExternalLSA或NSSAExternalLSA，请执行步骤 (7)。 −如果OSPF进程的LSDB包含完整的ASExternalLSA或NSSAExternalLSA，但是无法学习到O_ASE路由或者O_NSSA路由的情况，请执行步骤(7)。(5)检查ABR设备是否可达。区域间路由是ABR设备发布的，如果本端设备和ABR设备之间路由不可达，则会导致本端设备无法学习到区域间路由。 a.请在本端设备执行displayospf[process-id]lsdbsummary命令，查看AdvRtr 字段，该字段为通告NetworkSummaryLSA的RouterID，即ABR的RouterID。 <Sysname>displayospf100lsdbsummary OSPFProcess100withRouterID5.5.5.5 Area:0.0.0.1LinkStateDatabase Type:Sum-Net LSID:192.168.12.0 AdvRtr:1.1.1.1LSage:913 Len:28 Options:OE Seq#:80000001 Checksum:0x5d45 NetMask:255.255.255.0 Tos0Metric:1 b.请在本端设备执行displayospfabr-asbr命令，查看Destination字段和RtType字段，RtType字段取值为ABR时，Destination字段为ABR的RouterID。查看到此类路由信息时，说明存在到达为ABR的路由。 <Sysname>displayospf100abr-asbr OSPFProcess100withRouterID5.5.5.5RoutingTabletoABRandASBR TypeDestinationAreaCostNexthopRtType Intra1.1.1.10.0.0.11192.168.51.1ABR c.如果abr-asbr信息中不包含到达通告NetworkSummaryLSA的ABR的路由，请执行步骤 (7)。 d.如果abr-asbr信息中包含到达通告NetworkSummaryLSA的ABR的路由，且本设备为ABR设备，请检查OSPF区域是否为骨干区域。 −如果OSPF区域为非骨干区域（区域ID不为零），根据RFC2328的规定，ABR设备不会对非骨干区的NetworkSummaryLSA进行计算，没有区域间路由是正常现象。 −如果OSPF区域为骨干区域（区域ID为零），但是没有学习到区域间路由，请执行步骤(7)。 e.如果abr-asbr信息中包含到达通告NetworkSummaryLSA的ABR的路由，且本OSPF进程绑定了VPN实例。请检查OSPF进程下是否配置了vpn-instance-capabilitysimple命令。如果OSPF进程下配置了vpn-instance-capabilitysimple命令，请执行步骤(7)。 如果OSPF进程下未配置vpn-instance-capabilitysimple命令，故障处理方式如表13所示。 表13OSPF进程下未配置vpn-instance-capabilitysimple命令的故障处理方式 DN比特位是否置位故障处理方式 vpn-i(未配置)nstance-capability根据RFC2328的规定，私网OSPF进程不会使用DN比特位置位simple命令，且Network的NetworkSummaryLSA进行路由计算。没有对应的区域间路 SummaryLSA的Option字段包含由是正常现象 DN比特位（即DN比特位置位） 未配置 vpn-instance-capability simple命令，且Network请执行步骤(7) SummaryLSA的Option字段不包含 DN比特位 (6)检查ASBR设备是否可达，检查是否有防环检测。 O_ASE路由和O_NSSA路由是ASBR设备发布的，如果本端设备和ASBR设备之间路由不可达，则会导致本端设备无法学习到AS外部的路由。 a.请执行displayospf[process-id]lsdb[ase|nssa]命令，查看AdvRtr字段，该字段为通告ASExternalLSA（Type-5）或NSSAExternalLSA（Type-7）的RouterID，即ASBR的RouterID。 <Sysname>displayospf100lsdbase OSPFProcess100withRouterID1.1.1.1LinkStateDatabase Type:ExternalLSID:10.1.1.0 AdvRtr:1.1.1.1LSage:169 Len:36 Options:OE Seq#:80000001Checksum:0x934b NetMask:255.255.255.0 TOS0Metric:1 EType:2 ForwardingAddress:192.168.51.5 Tag:1 <Sysname>displayospf100lsdbnssa OSPFProcess100withRouterID1.1.1.1 Area:0.0.0.0LinkStateDatabase Area:0.0.0.1LinkStateDatabase Type:NSSA LSID:192.168.51.0 AdvRtr:5.5.5.5LSage:156 Len:36 Options:ONP Seq#:80000001Checksum:0x59dc NetMask:255.255.255.0 TOS0Metric:1 EType:2 ForwardingAddress:192.168.51.5 Tag:1 Type:NSSA LSID:10.1.1.0 AdvRtr:5.5.5.5 LSage:156 Len:36 Options:ONP Seq#:80000001Checksum:0xa422 NetMask:255.255.255.0 TOS0Metric:1 EType:2 ForwardingAddress:192.168.51.5 Tag:1 b.请执行displayospfabr-asbr命令，查看Destination字段和RtType字段，RtType字段取值为ASBR时，Destination字段为ASBR的RouterID。查看到此类路由信息时，说明存在到达为ASBR的路由。 <Sysname>displayospf100abr-asbr OSPFProcess100withRouterID1.1.1.1 RoutingTabletoABRandASBR TypeDestinationAreaCostNexthopRtType Intra5.5.5.50.0.0.11192.168.51.5ASBR c.如果abr-asbr信息中不包含到达通告ASExternalLSA或NSSAExternalLSA的ASBR的路由，请执行步骤(7)。 d.如果abr-asbr信息中包含到达通告ASExternalLSA或NSSAExternalLSA的ASBR的路由，且LSA的ForwardingAddress字段不为零，需要检查ForwardingAddress的可达性 请在用户视图(及路由类型。)下执行displyospfaroutingforwarding-address{mask-length|mask}命令查询是否存在到达ForwardingAddress的路由。 <Sysname>displayospf100routing192.168.51.524 OSPFProcess100withRouterID1.1.1.1 RoutingTable Routingfornetwork DestinationCostTypeNextHopAdvRouterArea 192.168.51.0/241Transit0.0.0.05.5.5.50.0.0.1 Totalnets:1 Intraarea:1Interarea:0ASE:0NSSA:0 ForwardingAddress的可达性及路由类型对OSPF是否能够学习到O_ASE路由或O_NSSA路由的影响如表14所示。 表14ForwardingAddress的可达性及路由类型对O_ASE路由或O_NSSA路由的影响 ForwardAddress是否可达故障处理方式 不可达如果通过displayospfroutingforwarding-address {mask-length|mask}命令无法查看到路由信息，说明 ForwardingAddress不可达，请执行步骤(7) 可达如果外部路由是由NSSAExternalLSA（Type-7）通告的，根据RFC3101的规定，要求到达ForwardingAddress的路由所在区域与NSSA ExternalLSA所在区域相同。如果Area字段标明的区域号与NSSAExternalLSA所在的区域不同，OSPF不使用此类NSSAExternalLSA进行路由计算。因此，没有对应的外部路由是正常现象 通过displayospfroutingforwarding-address{mask-length|mask}命令查看到的路由的Type字段为Type1或者Type2，说明到达ForwardingAddress的路由类型是外部路由。根据RFC2328的规定，到达非零ForwardingAddress的路由类型不允许是外部路由，OSPF不使用此类LSA进行路由计算。因此，没有对应的外部路由是正常现象 e.如果abr-asbr信息中包含到达通告ASExternalLSA或NSSAExternalLSA的ASBR的路OSPF进程下是否配置了请检查本vpn-(由，且本OSPF进程绑定了VPN实例。)instance-capabilitysimple命令。如果OSPF进程下配置了vpn-instance-capabilitysimple命令，请执行步骤(7)。如果OSPF进程下未配置vpn-instance-capabilitysimple命令，故障处理方式如表15所示。 表15OSPF进程下未配置vpn-instance-capabilitysimple命令的故障处理方式 DN比特位是否置位故障处理方式 vpn-i(未配置)nstance-capability根据RFC2328的规定，私网OSPF进程不会使用DN比特位置位simple命令，且ASExternalLSA的ASExternalLSA或者NSSAExternalLSA进行路由计算。没有 或者NSSAExternalLSA的Option对应的外部路由是正常现象字段包含DN比特位 请执行displayospf命令查看DefaultASEparameters字段，确认ASExternalLSA或者NSSAExternalLSA的Tag值是否与私 vpn-i(未配置)nstance-capability网OSPF进程的Tag值相同：simple命令，且ASExternalLSA•对于Tag值相同的情况，根据RFC2328的规定，私网或者NSSAExternalLSA的OptionOSPF进程不会使用此类LSA进行路由计算。因此，没有 字段不包含DN比特位对应的外部路由是正常现象 •对于Tag值不同的情况，请执行步骤(7) (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 10.4.4网络中IP地址冲突导致路由震荡 ,Suggestion not provided
在AC+FitAP的组网架构下，对于已经正常运行的网络，出现AP掉线的情况,"在AC+FitAP的组网架构下，AC和AP之间采用CAPWAP（ControlandProvisioningofWireless AccessPoints）隧道进行通信，AP上线的过程主要分为：获取AC地址、AP发现AC、AP接入 AC 、AC向FitAP下发配置、CAPWAP隧道维持和配置更新六个阶段。AP正常注册至AC上并稳定运行，需要保证上述六个过程均正常。 对于已经正常运行的网络，出现AP掉线情况的原因包括： •AP掉电重启 •AC和AP间链路不畅通 •AC的CPU或内存利用率过高 •AP的CPU或内存利用率过高 •AC上不存在AP的版本文件或版本文件异常 •AC或AP侧配置有误 3.故障分析 本类故障的定位思路一般为：首先，查看AP运行状态以及掉线原因；然后，判断AC和AP间链路是否畅通；再次，判断AC和AP的运行状态以及配置是否正常；最后，通过收集AC和AP的debugging信息分析问题原因。 本类故障的诊断流程如图5-4所示。 图5-4FitAP异常掉线的故障诊断流程图 4.处理步骤 本类问题建议按照如下步骤排查： (1)查看AP状态 napnameap-name命令的State显示字段，可以确认 AP是否在线。 −State为“I”表示AP未在线。 −State为“R/M”表示AP已上线，与主AC成功建立主隧道。 −State为“R/B”表示AP已上线，与备AC成功建立备隧道。−有关State显示字段的更多介绍请参见“AP管理命令参考”。 #显示ap1的信息。 <Sysname>displaywlanapnameap1 APinformation State:I=Idle,J=Join,JA=JoinAck,IL=ImageLoad C=Config,DC=DataCheck,R=RunM=Master,B=Backup APnameAPIDStateModelSerialID ap11IWA6320219801A28N819CE0002T 在AC上，通过displaywlanapallconnection-record查看AP连接记录。 −State为“Run”表示AP已上线，显示时间为已持续连接CAPWAP隧道的时间。 −State为“Offline”表示AP未在线，显示时间为AP与AC最后一次建立CAPWAP隧道的时间。 #显示AC上所有AP的连接记录。 <Sysname>displaywlanapallconnection-record APnameIPaddressStateTimeap1192.168.100.27Run01-0609:06:40 (2)查看AP掉线原因 在AC上，执行displaywlanapnameap-nameverbose命令，查看“Onlinetime”、“Systemuptime”和“Tunneldownreason”显示字段。其中： “Onlinetime”显示字段表示AP在线时长。 “Systemuptime”显示字段表示AP系统启动时长。 “Tunneldownreason”显示字段表示CAPWAP隧道关闭的原因。如果AP在成功和AC建立链接后，出现过链路中断，则该显示字段会记录下AC检测到的链路断开的原因。AP常见的掉线原因如表5-1所示。如需了解更多Tunneldownreason显示字段的含义，请参见“AP管理命令参考”。 表5-1Tunneldownreason显示字段常见输出信息 字段输出信息含义 Neighbordeadtimerexpired邻居报告定时器超时，AC在三倍的握手时间内没有收到 AP的Echorequest报文 Requestwaittimerexpired等待请求消息定时器超时，AC向AP发送了一个需要回应的控制报文后，AP在等待时间内没有响应 ProcessedjoinrequestinRunstateAC与AP完成CAPWAP隧道建立后，Run状态下收到并处理JoinRequest报文，断开隧道 Failedtoretransmitmessage报文重传失败 APwasresetduetoinconsistentlocalandreportedradiostatisticsRadio数据统计信息上报数据不一致 APwasresetAP重启，造成CAPWAP隧道断开 如果AP在线时长与AP系统启动时长相近，且“Tunneldownreason”显示字段为APwasreset，则表示AP重启导致掉线。如需进一步定位AP重启原因，请参考无线接入点重启故障处理相关内容。否则，建议执行步骤(3)。 <Sysname>displaywlanapnameap1verbose APname:ap1 APID:1 APgroupname:default-group State:Run Backuptype:Master Onlinetime:0days1hours25minutes12secondsSystemuptime:0days2hours22minutes12seconds Model:WA6320Regioncode:CN 显示信息略…… Lastrebootreason(APcheck):Theradiophysicalstatuswasdown Lastrebootreason(ACcheck):TheradiophysicalstatuswasdownLatestIPaddress:10.1.0.2 CurrentACIP:192.168.1.1 Tunneldownreason:Requestwaittimerexpired (3)AC和AP检查(显示信息略……)间链路是否畅通AC和AP之间的网络不通会导致AP无法在AC上线。在AC和AP上分别执行ping命令，查看双方能否相互ping通。需要注意的是：CAPWAP隧道对AC和AP之间的链路丢包比较敏感，要求有线丢包率小于0.1%。同时链路要支持MTU1500。 #在AC上，ping1472字节包（MTU1500），强制不分片，检测AP和AC间的链路。 <Sysname>ping-s1472-f192.168.100.27 PING192.168.100.27:1472databytes,pressCTRL_Ctobreak Replyfrom192.168.100.27:bytes=1472Sequence=1ttl=21time=20msReplyfrom192.168.100.27:bytes=1472Sequence=2ttl=21time=20ms Replyfrom192.168.100.27:bytes=1472Sequence=3ttl=21time=20ms Replyfrom192.168.100.27:bytes=1472Sequence=4ttl=21time=20ms 如果无法ping通，请检查物理链路、VLAN配置、STP状态是否异常，IP地址是否过期。 如果时延过大或存在丢包的情况，请检查中间网络是否出现环路。 如果ping包不丢包，延时正常，执行下一步检查。 (4)检查AC和AP的运行情况 检查AC、AP的CPU利用率和内存使用情况通过displaycpu-usage命令和displaymemory命令查看设备的CUP利用率和内存使用信息。 #显示设备的CUP利用率统计信息。 <Sysname>displaycpu-usage UnitCPUusage: 70%inlast5seconds 71%inlast1minute 75%inlast5minutes #显示设备的内存使用信息。 <Sysname>displaymemory MemorystatisticsaremeasuredinKB: Slot1: TotalUsedFreeSharedBuffersCachedFreeRatioMem:197471271849612562160974028251264.3% -/+Buffers/Cache:4262441548468Swap:000 当CPU利用率高于70%，表示CPU状态异常，建议从以下方面定位问题。 −通过displayprocesscpu命令查看当前设备所有进程的CPU使用率信息，定位长时间占用CPU的进程。 −了解当前网络是否存在重大操作，如：版本升级、整网配置修改、设备掉电、重启等。当内存利用率高于70%且出现持续增长，表示内存状态异常，建议从以下方面定位问题。 −通过displayprocessmemory命令查看当前设备所有进程的内存使用信息，定位长时间占用内存的进程。 −了解当前网络是否存在重大操作，如：新增网管需要采集设备信息、新增配置等。 −通过displaylogbuffer命令，查看并收集告警、日志等历史信息。 检查AC和AP的版本文件是否匹配 FitAP版本随AC版本发布，AC和AP之间需要版本匹配，才能保证AP在AC上上线。AC和AP版本不匹配的情况包括： −AC不支持对当前AP型号纳管。 −AC和AP之间的版本配套关系有误或版本文件异常。通过AC的版本说明书中的“配套AP列表”章节，查看AC能否对当前AP进行纳管。配套FitAP列表中，如果对应的AP型号在“是否打包”一列中为“否”，表示AP的ipe文件未打包到AC的ipe中。如果当前局点有使用该类型AP的需求，需要手工上传AP版本至AC的/apimge目录。用户在AC版本对应的zip压缩包中可以获取未打包AP的ipe文件。在AC上执行dir命令，可以查看AC上是否存在AP设备的版本文件，请检查AP版本文件是否与AC对应的版本配套，版本文件大小是否异常。 <Sysname>dirflash:/apimge Directoryofflash:/apimge 0-rw-19171328Jul20202223:51:00wa4300.ipe 1-rw-14518272Jul20202223:52:42wa4300h.ipe2-rw-14533632Jul20202223:51:17wa4300s.ipe 3-rw-18617344Jul20202223:51:59wa4600.ipe 4-rw-23329792Jul20202223:52:26wa5300.ipe 5-rw-19996672Jul20202223:51:39wa5600.ipe 6-rw-36929536Jul20202223:53:24wa6500.ipe 1015808KBtotal(744748KBfree) (5)检查AC侧配置是否有误，具体包括： 查看License的安装情况和有效期。 用户可以通过displaylicense命令或者Web页面查看设备是否已安装License、授权的有效期。建议在有效期内安装新的授权，以免当前授权过期，影响对应业务的继续运行。有关License申请、激活文件安装、License迁移等操作的使用指导及详细信息，请参见《http://www.h3c.com/cn/home/qr/default.htm?id=607》。 #显示设备上所有License的详细信息 <Sysname>displaylicense flash:/license/210235A1JMC1660000282021060717343842697.ak Feature:APMGR ProductDescription:EnhancedAccessControllerLicense,8APs,forVerticals,forV7 Registeredat:2021-06-0717:01:55 LicenseType:Trial(daysrestricted) TrialTimeLeft(days):0 CurrentState:Expired Pre-installedLicense Feature:APMGR FeatureDescription:PreAtomThisisAPMGRlicense TimeLeft(days):0 CurrentState:Expired 查看License资源剩余情况和AC最大管理AP数量。 AC允许上线的AP数量受最大支持APLicense数量和最大管理AP数量共同限制。通过displaywlanapall命令可以查看AC最大管理AP数量和License资源的剩余情况。 #显示所有AP的信息。 <Sysname>displaywlanapallTotalnumberofAPs:3 TotalnumberofconnectedAPs:3 TotalnumberofconnectedmanualAPs:3 TotalnumberofconnectedautoAPs:0 TotalnumberofconnectedcommonAPs:3 TotalnumberofconnectedWTUs:0TotalnumberofinsideAPs:0 MaximumsupportedAPs:2048 RemainingAPs:2045 TotalAPlicenses:128 LocalAPlicenses:128 ServerAPlicenses:0 RemaininglocalAPlicenses:125SyncAPlicenses:0 APinformation State:I=Idle,J=Join,JA=JoinAck,IL=ImageLoad C=Config,DC=DataCheck,R=RunM=Master,B=Backup APnameAPIDStateModelSerialIDap11R/MWA6320219801A28N819CE0002Tap22R/MWA6320219801A28N819CE0003Tap33R/MWA6320219801A28N819CE0004T 查看与AP相关的配置是否有误 在AC上执行displaycurrent-configurationconfigurationwlan-ap命令 可以查看设备上AP相关的配置信息。如果通过MAP文件的方式向指定AP下发配置，则需要进一步查看MAP文件内容。 #显示设备上与AP相关的配置信息 <Sysname>displaycurrent-configurationconfigurationwlan-ap # wlanapap1modelWA6320serial-id219801A2YF819BE002X6map-configurationflash:/map.txtradio1radio2radioenableservice-templatehellogigabitethernet1 # #显示文件map.txt的内容。 <Sysname>moreflash:/map.txtSystem-viewvlan200 interfacegigabitethernet1/0/1portlink-typetrunkporttrunkpermitvlan200 (6)检查AP侧配置查看AP上行口的配置信息。在AP上执行displaycurrent-configurationinterface命令，检查AP的上行口配置是否被修改。检查是否在AP上通过wlanmanagement-vlan命令配置了AP的管理VLAN。如果AP侧修改了管理VLAN，则需要检查中间网络设备是否已放通管理VLAN。 (7)如果故障仍未排除，请收集如下信息，并拨打H3C客户服务热线400-810-0504寻求帮助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Debug命令输出的调试信息 开启Debug之前，请检查CPU和内存的使用情况，确保开启Debug不会影响设备的正常运行。完成收集后，请及时关闭Debug。 如果需要在控制台显示调试信息，则需要进行如下配置： a.配置terminaldebugging命令允许调试信息输出到当前终端。 b.执行info-centerenable命令，开启信息中心功能（信息中心功能缺省处于开启状态）。 c.使用debugging命令打开功能模块的调试信息开关。例如：通过debuggingwlancapwap命令用来打开CAPWAP调试信息开关后，业务模块生成的debugging级别的日志信息。 监视终端是指以VTY类型用户线登录的用户终端。如果需要需要在监视终端上显示调试信息，则需要进行如下配置： a.配置terminalmonitor命令允许日志信息输出到当前终端，配置terminaldebugging命令允许调试信息输出到当前终端。 b.执行info-centerenable命令，开启信息中心功能（信息中心功能缺省处于开启状态）。 c.使用debugging命令打开功能模块的调试信息开关。 5.12扫码枪网络随机不通 ",Suggestion not provided
在AC+FitAP的组网架构下，客户端数据报文转发位置可以在AC或者AP上 ,"本类问题的常见原因包括： •AC和网关间的有线链路异常。 •有线口广播、组播报文占比过大。 •有线口存在瞬时大流量冲击。 •AC的转发进程过于繁忙，导致无线丢包。 •AP空口质量不佳。 3.故障分析 本类故障的定位思路一般为： (1)通过ACPing网关操作，检查AC和网关间的有线链路是否异常。 (2)摸索故障的规律性，观察故障发生是否和时间段强相关，是否和网络中流量模型相关。 (3)查看AC有线口报文统计信息。 (4)检查AC的转发进程是否长时间占用CPU。 (5)AP空口质量是否不佳 本类故障的诊断流程如图5-10所示。 图5-10集中转发方式下无线上网卡慢的故障诊断流程图 4.处理步骤 本类故障建议按照如下步骤排查： (1)查看AC和网关间的有线链路是否异常集中式转发架构下，AC通常旁挂在交换机上，在AC执行ping网关操作确定故障范围，检查AP与网关间的有线链路是否正常。 如果无法ping通，请检查物理链路、VLAN配置、STP状态是否异常，IP地址是否过期。 如果时延过大或存在丢包的情况，请检查AC和网关间的链路是否出现环路。当有线网络中存在环路时，AC会收到大量的组播报文或组播报文，导致设备无法处理无线报文，从而影响无线用户的网速。 如果ping包不丢包，延时正常，说明问题出现在无线终端至AC间的链路段，执行步骤（2）。 (2)观察故障和时间段的相关性关注无线网络使用体验不佳是否和时间段强相关。例如：办公场景下，某一段办公时间无线上网卡慢，其它时间正常；高校宿舍场景下，非教学时间明显出现无线卡慢等。 如果无线使用体验不佳和时间段强相关，则大概率是网络中流量发生变化导致，需要重点梳理有线网络中的流量。 如果无线使用体验不佳和时间段不相关，则执行步骤（3）。 (3)查看AC有线口接收或发送的非单播报文占比如果AC有线口接收或者发送广播、组播报文数量明显大于单播报文数量，则说明网络中广播或组播报文过多，需要重新梳理有线网络流量，考虑是否接口放通VLAN过多或者存在广播风暴。具体确认步骤如下： a.清空AC上联口的报文统计结果。 为方便查看，通过resetcounterinterface命令清空AC接口的报文统计结果并修改接口统计周期为5秒（缺省情况下，接口统计周期为300秒）。 <Sysname>resetcountersinterfacegigabitethernet1/0/1 <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]flow-interval5 b.查看接口的报文统计结果。在任意视图下，每间隔几秒执行displayinterface命令，查看接口的报文统计结果。 #查看以太网接口GigabitEthernet1/0/1的统计信息。 <Sysname>displayinterfaceGigabitEthernet1/0/1 GigabitEthernet1/0/1Currentstate:DOWNLineprotocolstate:DOWNIPpacketframetype:EthernetII,hardwareaddress:fc60-9ba1-81e0Description:GigabitEthernet1/0/1Interface显示信息略… Lasttimewhenphysicalstatechangedtoup:-Lasttimewhenphysicalstatechangedtodown:-Last5secondsinput:511025packets/sec405002105bytes/sec8%Last5secondsoutput:685075packets/sec426870884bytes/sec8%Input(total):58328063packets,21043223173bytes27274961unicasts,14726456broadcasts,16326646multicasts,0pauses显示信息略… Output(total):25964106packets,6817109645bytes 25756796unicasts,431broadcasts,206879multicasts,0pauses显示信息略…该命令需要重点关注的显示信息如表5-2所示。 表5-2displayinterface命令重点关注的显示信息 显示字段描述 Last5secondsinput:511025packets/sec405002105bytes/sec8%Last5secondsoutput:685075packets/sec426870884bytes/sec8%端口在最近一个统计周期（统计周期可以通过 flow-interval命令设置）内接收和发送报文的平均速率，单位分别为数据包/秒和字节/秒，以及实际速率和接口带宽的百分比。 Input(total):58328063packets, 21043223173bytes 27274961unicasts,14726456broadcasts,16326646multicasts,0pauses端口接收报文的统计值，包括正常报文、异常报文和正常 PAUSE帧的报文数、字节数 端口接收的单播报文（unicasts）、广播报文（broadcasts）、组播报文（multicasts）和PAUSE帧的数量 Output(total):25964106packets,6817109645bytes 25756796unicasts,431broadcasts,206879multicasts,0pauses端口发送报文的统计值，包括正常报文、异常报文和正常 PAUSE帧的报文数、字节数 端口发送的单播报文（unicasts）、广播报文（broadcasts）、组播报文（multicasts）和PAUSE帧的数量 −通过“Input(total):”和“Output(total):”显示字段，查看AC有线口入/出方向单播、广播、组播报文的比例，确认是否存在广播、组播报文占比过大的现象。如果广播或组播报文数量明显大于单播报文数量，则说明网络中广播或组播报文过多，需要重新梳理有线网络流量，考虑是否接口放通VLAN过多或者存在广播风暴。 −在集中转发方式下，业务数据报文会在AC上进行CAPWAP封装和解封装。如果网络中AC对N个AP进行纳管，AC从上行网络中收到1份业务VLAN的广播报文后，会将该广播报文复制N份，并发送给N个AP。广播报文的复制和分发。一方面会极大消耗AC的CPU，造成AC繁忙；另一方面，当广播报文会以最低速率在空口中传输，极大占用空口资源，对无线网络造成冲击。 通过“Last5secondsinput:”和“Last5secondsoutput:”显示字段，查看果AC上线口出方向报文是否明显多于入方向报文。如果是，则存在广播复制的情况，需要梳理网络流量，做好广播组播报文的隔离。 c.（可选）通过FPL统计功能查看AC有线口的报文统计数据。 如果排查问题时没有复现故障，即故障现象发生在过去某一段时间。可以通过FPL统计功能查看AC有线口当月7天内的报文数量统计数据，统计间隔为1分钟。 在Probe视图下，执行fpl-diag命令，其中，“item”显示字段为 “XGE1/0/3RxBroadcast”表示XGE1/0/3接口接收的广播报文；“Delta”显示字段表示报文每分钟的增长量。如果有线口发送（Tx）或接收（Rx）方向的广播报文或者组播报文量级较大且波动明显，则存在异常广播或组播报文，需要梳理有线网络。 #显示本月3日9点0分起100分钟内的统计数据 <Sysname>system-view [Sysname]probe [Sysname-probe]fpl-diagslot1showlogall3,9,0,100 idxitemdaterxdelta9530XGE1/0/3RxBroadcast09:11:3606/03/2020250281438249531XGE1/0/3RxBroadcast09:12:3606/03/202025069864172 9532XGE1/0/3RxBroadcast09:13:3606/03/202025118414855 9533XGE1/0/3RxBroadcast09:14:3606/03/202034430 9534XGE1/0/3RxBroadcast09:15:3606/03/202031050如果AC接口报文统计信息未发现异常，则执行步骤（4）。 (4)查看AC有线口是否存在尖峰流量查看AC有线口是否存在在瞬时大流量报文进出： 如果存在，需要进一步检查网络中是否存在环路、广播风暴等。 如果不存在，则执行步骤（5）具体操作步骤如下： a.查看有线口是否存在端口接收队列溢出的情形。 在任意视图下，每间隔几秒执行displayinterface命令，查看接口的报文统计结果。重点关注“overruns”显示字段：如果overruns不为0，说明有线口存在瞬时大流量报文进出，由于端口的接收速率超过接收队列的处理能力，导致报文被丢弃。 <Sysname>displayinterfacegigabitethernet1/0/1GigabitEthernet1/0/1Currentstate:UP Lineprotocolstate:UPIPpacketframetype:EthernetII,hardwareaddress:a4fa-7679-b6f0 …… Input(total):58328063packets,21043223173bytes 27274961unicasts,14726456broadcasts,16326646multicasts,0pauses显示信息略… Input:31153inputerrors,0runts,0giants,-throttles0CRC,-frame,31153overruns,0aborts -ignored,-parityerrors显示信息略… b.查看有线口是否存在瞬时非单播报文冲击。 广播流量不一定是持续并发，可能存在瞬时大流量冲击，仅通过接口的报文统计信息不一定能发现问题，此时可以通过每间隔几秒执行displaycountersrate命令的方式，查看接口的报文速率统计信息。如果AC有线口接收或发送广播报文（或组播报文）的平均速率明显高于单播报文，则说明网络中存在瞬时异常广播组播流量的冲击。 #显示接口的报文接收速率统计信息。 <Sysname>displaycountersrateinboundinterfaceGigabitEthernet1/0/1 Usage:Bandwidthutilizationinpercentage InterfaceUsage(%)Total(pps)Broadcast(pps)Multicast(pps) GE1/0/110098327666959525518 Overflow:Morethan14digits. --:Notsupported (5)查看ACCPU转发进程无论AC是否支持FPGA硬件转发，大多协议控制报文、部分数据报文会上送CPU处理。a.定位长时间占用CPU的进程。在AC上执行displayprocesscpu命令查看所有进程的CPU使用率信息，定位长时间占用CPU的进程。当AC所有转发进程（kdrvfwd）的CPU使用率超过50%时，表明转发进程过于繁忙，则会出现无线丢包的情况。AC支持转发进程的数量与设备型号有关，例如：WX5500H系列存在16个转发进程，如果某个转发进程CPU使用率超过2.5%，则可能出现无线丢包；如果CPU占比超过3%就会出现明显丢包。 −如果ACCPU转发进程存在异常，则执行步骤“b（可选）通过FPL统计功能查看转发进程丢弃的报文”。 −如果ACCPU转发进程不存在异常，则执行步骤（6）。 #显示设备的CUP利用率统计信息。 <Sysname>displayprocesscpu CPUutilizationin5secs:51.4%;1min:52.1%;5mins:52.3%JID5Sec1Min5MinName 显示信息略… 3083.2%3.2%3.2%[kdrvfwd16] 3093.2%3.2%3.0%[kdrvfwd17] 3103.2%3.2%3.2%[kdrvfwd18] 3112.6%3.2%2.9%[kdrvfwd19] 3123.2%3.2%3.2%[kdrvfwd20]3133.2%3.2%3.2%[kdrvfwd21]3143.2%3.2%3.2%[kdrvfwd22]3152.6%3.2%3.1%[kdrvfwd23] 3163.2%3.2%3.2%[kdrvfwd24] 3173.2%3.2%3.2%[kdrvfwd25]3183.2%3.2%3.2%[kdrvfwd26]3193.2%3.2%3.2%[kdrvfwd27] 3203.2%3.2%3.2%[kdrvfwd28]显示信息略… b.（可选）通过FPL统计功能查看转发进程丢弃的报文。排查转发进程是否存在丢包最直接的办法是在Probe视图下，执行fpl-diag命令，查看AC当月7天内的报文数量统计数据，统计间隔为1分钟。其中，“item”显示字段为“PoeDropPkt”表示转发进程丢弃的报文。“Delta”显示字段表示每分钟丢弃的转发报文个数，如果Delta项数值波动明显，则说明转发进程存在丢包。 #显示本月3日9点0分起100分钟内的统计数据 <Sysname>system-view[Sysname]probe[Sysname-probe]fpl-diagslot1showlogall3,9,0,100 idxitemdaterxdelta9519PoeDropPkt09:00:3606/03/202082250610 9520PoeDropPkt09:01:3606/03/202082252115 9521PoeDropPkt09:02:3606/03/202082254019 9522PoeDropPkt09:03:3606/03/202082259656 9523PoeDropPkt09:04:3606/03/202082260812 9524PoeDropPkt09:05:3606/03/202082263830 9525PoeDropPkt09:06:3606/03/202082266527 9526PoeDropPkt09:07:3606/03/202082269025 9527PoeDropPkt09:08:3606/03/202082270717 9528PoeDropPkt09:09:3606/03/202082272215 9529PoeDropPkt09:10:3606/03/202082273917 9530PoeDropPkt09:11:3606/03/202082275516 9531PoeDropPkt09:12:3606/03/202082278126 c.定位AC转发进程长时间占用CPU的原因。AC转发进程长时间占用CPU的原因如下： 首先，查看设备是否支持硬件转发。如果设备支持硬件转发，需要查看硬件转发功能是否开启，未开启硬件转发功能会导致无线业务报文上送CPU处理，进而加重的CPU工作负担。 #开启WLAN硬件快速转发功能。 <Sysname>system-view [Sysname]undowlanfast-forwardinghardwaredisable 如果设备不支持硬件转发，则所有的无线业务报文需要上送CPU处理。当WLAN网络中存在大量的无线网络设备和无线客户端，AC就需要消耗大部分的CPU资源来处理无线业务报文，可能导致AC的转发性能达到瓶颈，此时可以将“集中转发”修改为“本地转发”。其次，查看是否存在特殊的业务模型如果无线网络中，大部分业务是大量的TCP流量（如视频业务），可以尝试修改CAPWAP隧道的MSS（MaxSegmentSize，TCP最大报文段长度）来避免大包报文分片转发，进而减轻分片报文上送CPU处理引起的转发进程繁忙。 #配置CAPWAP隧道的TCP最大报文段长度为2000字节。 <Sysname>system-view [Sysname]wlantcpmss2000 (6)查看AP空口质量WLAN网络中，由于空口共享传输介质，容易引发空口质量问。在集中转发架构下，出现无线上网卡慢问题需要重点关注空口干扰和空口广播、组播包占比。查看AP空口质量的步骤如下： a.远程登录至AP。开启上线AP的执行控制台（缺省为开启），通过Telnet方式登录至终端关联的AP上，AP的缺省登录密码为h3capadmin。 #查找当前终端关联AP的名称 <Sysname>displaywlanclient Totalnumberofclients:3MACaddressUsernameAPnameRIPaddressVLAN000f-e265-6400N/Aap111.1.1.1200 #查找当前终端关联AP的IP地址 <Sysname>displaywlanapnameap1verbose APname:ap1 APID:1 APgroupname:default-group State:Run Backuptype:Master Onlinetime:0days1hours25minutes12secondsSystemuptime:0days2hours22minutes12seconds Model:WA6320 Regioncode:CN Regioncodelock:Disable SerialID:219801A28N819CE0002TMACaddress:0AFB-423B-893C IPaddress:192.168.1.50UDPcontrolportnumber:18313UDPdataportnumber:N/A显示信息略…#开启上线AP的执行控制台, <Sysname>system-view [Sysname]probe [Sysname-probe]wlanap-executeap1exec-consoleenable [Sysname-probe]quit [Sysname]quit <Sysname>telnet192.168.1.50 Trying192.168.1.50... PressCTRL+KtoabortConnectedto192.168.1.50... *Copyright(c)2004-2022NewH3CTechnologiesCo.,Ltd.Allrightsreserved.**Withouttheowner'spriorwrittenconsent,**nodecompilingorreverse-engineeringshallbeallowed.******************************************************************************* Password: <AP1> b.查看空口干扰。通过displayar5drvradiochannelbusy命令查看信道利用率，判断射频繁忙情况。 −如果CtlBusy高于60%时，则表示该射频繁忙，需要调整射频参数（信道、功率、频宽）。 −否则，执行步骤“c查看空口质量”。 #查看AP1Radio1的信道利用率 <AP1>system-view [AP1]probe [AP1-probe]displayar5drv1channelbusyChannelBusyinformationCtlChannel:52ChannelBand:80MRecordInterval(s):9IdleCheckDelay(s):0MeasureDelay(s):0 Date/Month/Year:22/09/2022Time(h/m/s):CtlBusy(%)TxBusy(%)RxBusy(%)ExtBusy(%)0103:15:42683728- 0203:15:33673629- 0303:15:24633526- 0403:15:15784033- 0503:15:06814336-显示信息略… c.查看空口质量。 AP使用最低速率发送广播和组播报文，大量的广播或组播报文占用射频资源，会降低整体网络使用效率，因此需要对APRadio接口发送的广播和组播报文进行控制。通过displayar5drvradiostatistics命令查看AP射频统计情况，判断空口质量。 <AP1>system-view [AP1]probe [AP1-probe]displayar5drv1statistics [RadioStatistics]TxFrameAllCnt:388216TxFrameAllBytes:134143677RxFrameAllCnt:633177RxFrameAllBytes:84402310 [TxQueueStatistics] QueueNumber:0123 ----------------------------------------------------------- TxFrmCnt:353398241321504 TxFrmBytes:133247267127421000269470TxUcastFrmCnt:215625241321504TxUcastFrmBytes:87605120127421000269470TxBcastFrmCnt:137773000TxMcastFrmCnt:0000TxMRetryCnt:340269 TxFragCnt:0000 TxDiscardFrm:0000TxDiscardFrmBytes:0000TxDataFrmCnt:3420376131328TxDataFrmBytes:1308296783002094316400TxUDataFrmCnt:2042646131328TxHwRetryExc:225111424显示信息略… ResetOnErr:0显示信息略…BeaconBusyCnt:2BeaconErrCnt:0 … 该命令需要重点关注的显示信息如表5-3所示。 表5-3displayar5drvradiostatistics命令重点关注的显示信息 显示字段描述 TxFrmCnt空口统计到的发送报文总量 TxUcastFrmCnt空口统计到的发送单播报文数量 TxBcastFrmCnt空口统计到的发送广播报文数量 TxMcastFrmCnt空口统计到的发送组播报文数量 TxDiscardFrm队列丢弃的报文总数，包括发送失败和队列溢出的报文 BeaconBusyCntAP发送Beacon报文的繁忙程度 BeaconErrCntAP发送Beacon报文的错误统计 如果出现如下情况，则会明显影响无线网络的使用体验，产生Ping包大迟延和丢包现象。 此时，需要在AP的以太网接口上配置二层隔离，梳理有线网络流量。 −如果（TxBcastFrmCnt+TxMcastFrmCnt）/TxFrmCnt超过50%。 −如果TxDiscardFra/TxUcastFrameCnt超过3% −如果BeaconBusyCnt和BeaconErrCnt出现增长。 (7)拨打热线400-810-0504求助。 如果故障仍未排除，请收集如下信息，并拨打H3C客户服务热线400-810-0504寻求帮助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Debug命令输出的调试信息 5.14终端通过RA方式自动获取IPv6DNS信息失败 ",Suggestion not provided
在AC+FitAP的组网架构下，客户端数据报文转发位置可以在AC或者AP上。 •集中转发：客户端数据报文转发位置配置在AC上，客户端的数据流量由AP通过CAPWAP （ControlandProvisioningofWirelessAccessPoints）隧道透传到AC，由AC转发数据报文。 •本地转发：客户端数据报文转发位置配置在AP上，客户端的数据流量直接由AP进行转发。 将转发位置配置在AP上可以缓解AC的数据转发压力。 本文中，“集中转发方式下无线上网卡慢”问题是指在同等条件下，采用本地转发方式无此问题、有线网络无此问题。具体表现在：无线终端打开网页慢、观看视频卡顿等，直接现象是集中转发方式下无线终端Ping网关有大迟延和丢包。 ,"本类问题的常见原因包括： •AC和网关间的有线链路异常。 •有线口广播、组播报文占比过大。 •有线口存在瞬时大流量冲击。 •AC的转发进程过于繁忙，导致无线丢包。 •AP空口质量不佳。 3.故障分析 本类故障的定位思路一般为： (1)通过ACPing网关操作，检查AC和网关间的有线链路是否异常。 (2)摸索故障的规律性，观察故障发生是否和时间段强相关，是否和网络中流量模型相关。 (3)查看AC有线口报文统计信息。 (4)检查AC的转发进程是否长时间占用CPU。 (5)AP空口质量是否不佳 本类故障的诊断流程如图5-10所示。 图5-10集中转发方式下无线上网卡慢的故障诊断流程图 4.处理步骤 本类故障建议按照如下步骤排查： (1)查看AC和网关间的有线链路是否异常集中式转发架构下，AC通常旁挂在交换机上，在AC执行ping网关操作确定故障范围，检查AP与网关间的有线链路是否正常。 如果无法ping通，请检查物理链路、VLAN配置、STP状态是否异常，IP地址是否过期。 如果时延过大或存在丢包的情况，请检查AC和网关间的链路是否出现环路。当有线网络中存在环路时，AC会收到大量的组播报文或组播报文，导致设备无法处理无线报文，从而影响无线用户的网速。 如果ping包不丢包，延时正常，说明问题出现在无线终端至AC间的链路段，执行步骤（2）。 (2)观察故障和时间段的相关性关注无线网络使用体验不佳是否和时间段强相关。例如：办公场景下，某一段办公时间无线上网卡慢，其它时间正常；高校宿舍场景下，非教学时间明显出现无线卡慢等。 如果无线使用体验不佳和时间段强相关，则大概率是网络中流量发生变化导致，需要重点梳理有线网络中的流量。 如果无线使用体验不佳和时间段不相关，则执行步骤（3）。 (3)查看AC有线口接收或发送的非单播报文占比如果AC有线口接收或者发送广播、组播报文数量明显大于单播报文数量，则说明网络中广播或组播报文过多，需要重新梳理有线网络流量，考虑是否接口放通VLAN过多或者存在广播风暴。具体确认步骤如下： a.清空AC上联口的报文统计结果。 为方便查看，通过resetcounterinterface命令清空AC接口的报文统计结果并修改接口统计周期为5秒（缺省情况下，接口统计周期为300秒）。 <Sysname>resetcountersinterfacegigabitethernet1/0/1 <Sysname>system-view [Sysname]interfacegigabitethernet1/0/1 [Sysname-GigabitEthernet1/0/1]flow-interval5 b.查看接口的报文统计结果。在任意视图下，每间隔几秒执行displayinterface命令，查看接口的报文统计结果。 #查看以太网接口GigabitEthernet1/0/1的统计信息。 <Sysname>displayinterfaceGigabitEthernet1/0/1 GigabitEthernet1/0/1Currentstate:DOWNLineprotocolstate:DOWNIPpacketframetype:EthernetII,hardwareaddress:fc60-9ba1-81e0Description:GigabitEthernet1/0/1Interface显示信息略… Lasttimewhenphysicalstatechangedtoup:-Lasttimewhenphysicalstatechangedtodown:-Last5secondsinput:511025packets/sec405002105bytes/sec8%Last5secondsoutput:685075packets/sec426870884bytes/sec8%Input(total):58328063packets,21043223173bytes27274961unicasts,14726456broadcasts,16326646multicasts,0pauses显示信息略… Output(total):25964106packets,6817109645bytes 25756796unicasts,431broadcasts,206879multicasts,0pauses显示信息略…该命令需要重点关注的显示信息如表5-2所示。 表5-2displayinterface命令重点关注的显示信息 显示字段描述 Last5secondsinput:511025packets/sec405002105bytes/sec8%Last5secondsoutput:685075packets/sec426870884bytes/sec8%端口在最近一个统计周期（统计周期可以通过 flow-interval命令设置）内接收和发送报文的平均速率，单位分别为数据包/秒和字节/秒，以及实际速率和接口带宽的百分比。 Input(total):58328063packets, 21043223173bytes 27274961unicasts,14726456broadcasts,16326646multicasts,0pauses端口接收报文的统计值，包括正常报文、异常报文和正常 PAUSE帧的报文数、字节数 端口接收的单播报文（unicasts）、广播报文（broadcasts）、组播报文（multicasts）和PAUSE帧的数量 Output(total):25964106packets,6817109645bytes 25756796unicasts,431broadcasts,206879multicasts,0pauses端口发送报文的统计值，包括正常报文、异常报文和正常 PAUSE帧的报文数、字节数 端口发送的单播报文（unicasts）、广播报文（broadcasts）、组播报文（multicasts）和PAUSE帧的数量 −通过“Input(total):”和“Output(total):”显示字段，查看AC有线口入/出方向单播、广播、组播报文的比例，确认是否存在广播、组播报文占比过大的现象。如果广播或组播报文数量明显大于单播报文数量，则说明网络中广播或组播报文过多，需要重新梳理有线网络流量，考虑是否接口放通VLAN过多或者存在广播风暴。 −在集中转发方式下，业务数据报文会在AC上进行CAPWAP封装和解封装。如果网络中AC对N个AP进行纳管，AC从上行网络中收到1份业务VLAN的广播报文后，会将该广播报文复制N份，并发送给N个AP。广播报文的复制和分发。一方面会极大消耗AC的CPU，造成AC繁忙；另一方面，当广播报文会以最低速率在空口中传输，极大占用空口资源，对无线网络造成冲击。 通过“Last5secondsinput:”和“Last5secondsoutput:”显示字段，查看果AC上线口出方向报文是否明显多于入方向报文。如果是，则存在广播复制的情况，需要梳理网络流量，做好广播组播报文的隔离。 c.（可选）通过FPL统计功能查看AC有线口的报文统计数据。 如果排查问题时没有复现故障，即故障现象发生在过去某一段时间。可以通过FPL统计功能查看AC有线口当月7天内的报文数量统计数据，统计间隔为1分钟。 在Probe视图下，执行fpl-diag命令，其中，“item”显示字段为 “XGE1/0/3RxBroadcast”表示XGE1/0/3接口接收的广播报文；“Delta”显示字段表示报文每分钟的增长量。如果有线口发送（Tx）或接收（Rx）方向的广播报文或者组播报文量级较大且波动明显，则存在异常广播或组播报文，需要梳理有线网络。 #显示本月3日9点0分起100分钟内的统计数据 <Sysname>system-view [Sysname]probe [Sysname-probe]fpl-diagslot1showlogall3,9,0,100 idxitemdaterxdelta9530XGE1/0/3RxBroadcast09:11:3606/03/2020250281438249531XGE1/0/3RxBroadcast09:12:3606/03/202025069864172 9532XGE1/0/3RxBroadcast09:13:3606/03/202025118414855 9533XGE1/0/3RxBroadcast09:14:3606/03/202034430 9534XGE1/0/3RxBroadcast09:15:3606/03/202031050如果AC接口报文统计信息未发现异常，则执行步骤（4）。 (4)查看AC有线口是否存在尖峰流量查看AC有线口是否存在在瞬时大流量报文进出： 如果存在，需要进一步检查网络中是否存在环路、广播风暴等。 如果不存在，则执行步骤（5）具体操作步骤如下： a.查看有线口是否存在端口接收队列溢出的情形。 在任意视图下，每间隔几秒执行displayinterface命令，查看接口的报文统计结果。重点关注“overruns”显示字段：如果overruns不为0，说明有线口存在瞬时大流量报文进出，由于端口的接收速率超过接收队列的处理能力，导致报文被丢弃。 <Sysname>displayinterfacegigabitethernet1/0/1GigabitEthernet1/0/1Currentstate:UP Lineprotocolstate:UPIPpacketframetype:EthernetII,hardwareaddress:a4fa-7679-b6f0 …… Input(total):58328063packets,21043223173bytes 27274961unicasts,14726456broadcasts,16326646multicasts,0pauses显示信息略… Input:31153inputerrors,0runts,0giants,-throttles0CRC,-frame,31153overruns,0aborts -ignored,-parityerrors显示信息略… b.查看有线口是否存在瞬时非单播报文冲击。 广播流量不一定是持续并发，可能存在瞬时大流量冲击，仅通过接口的报文统计信息不一定能发现问题，此时可以通过每间隔几秒执行displaycountersrate命令的方式，查看接口的报文速率统计信息。如果AC有线口接收或发送广播报文（或组播报文）的平均速率明显高于单播报文，则说明网络中存在瞬时异常广播组播流量的冲击。 #显示接口的报文接收速率统计信息。 <Sysname>displaycountersrateinboundinterfaceGigabitEthernet1/0/1 Usage:Bandwidthutilizationinpercentage InterfaceUsage(%)Total(pps)Broadcast(pps)Multicast(pps) GE1/0/110098327666959525518 Overflow:Morethan14digits. --:Notsupported (5)查看ACCPU转发进程无论AC是否支持FPGA硬件转发，大多协议控制报文、部分数据报文会上送CPU处理。a.定位长时间占用CPU的进程。在AC上执行displayprocesscpu命令查看所有进程的CPU使用率信息，定位长时间占用CPU的进程。当AC所有转发进程（kdrvfwd）的CPU使用率超过50%时，表明转发进程过于繁忙，则会出现无线丢包的情况。AC支持转发进程的数量与设备型号有关，例如：WX5500H系列存在16个转发进程，如果某个转发进程CPU使用率超过2.5%，则可能出现无线丢包；如果CPU占比超过3%就会出现明显丢包。 −如果ACCPU转发进程存在异常，则执行步骤“b（可选）通过FPL统计功能查看转发进程丢弃的报文”。 −如果ACCPU转发进程不存在异常，则执行步骤（6）。 #显示设备的CUP利用率统计信息。 <Sysname>displayprocesscpu CPUutilizationin5secs:51.4%;1min:52.1%;5mins:52.3%JID5Sec1Min5MinName 显示信息略… 3083.2%3.2%3.2%[kdrvfwd16] 3093.2%3.2%3.0%[kdrvfwd17] 3103.2%3.2%3.2%[kdrvfwd18] 3112.6%3.2%2.9%[kdrvfwd19] 3123.2%3.2%3.2%[kdrvfwd20]3133.2%3.2%3.2%[kdrvfwd21]3143.2%3.2%3.2%[kdrvfwd22]3152.6%3.2%3.1%[kdrvfwd23] 3163.2%3.2%3.2%[kdrvfwd24] 3173.2%3.2%3.2%[kdrvfwd25]3183.2%3.2%3.2%[kdrvfwd26]3193.2%3.2%3.2%[kdrvfwd27] 3203.2%3.2%3.2%[kdrvfwd28]显示信息略… b.（可选）通过FPL统计功能查看转发进程丢弃的报文。排查转发进程是否存在丢包最直接的办法是在Probe视图下，执行fpl-diag命令，查看AC当月7天内的报文数量统计数据，统计间隔为1分钟。其中，“item”显示字段为“PoeDropPkt”表示转发进程丢弃的报文。“Delta”显示字段表示每分钟丢弃的转发报文个数，如果Delta项数值波动明显，则说明转发进程存在丢包。 #显示本月3日9点0分起100分钟内的统计数据 <Sysname>system-view[Sysname]probe[Sysname-probe]fpl-diagslot1showlogall3,9,0,100 idxitemdaterxdelta9519PoeDropPkt09:00:3606/03/202082250610 9520PoeDropPkt09:01:3606/03/202082252115 9521PoeDropPkt09:02:3606/03/202082254019 9522PoeDropPkt09:03:3606/03/202082259656 9523PoeDropPkt09:04:3606/03/202082260812 9524PoeDropPkt09:05:3606/03/202082263830 9525PoeDropPkt09:06:3606/03/202082266527 9526PoeDropPkt09:07:3606/03/202082269025 9527PoeDropPkt09:08:3606/03/202082270717 9528PoeDropPkt09:09:3606/03/202082272215 9529PoeDropPkt09:10:3606/03/202082273917 9530PoeDropPkt09:11:3606/03/202082275516 9531PoeDropPkt09:12:3606/03/202082278126 c.定位AC转发进程长时间占用CPU的原因。AC转发进程长时间占用CPU的原因如下： 首先，查看设备是否支持硬件转发。如果设备支持硬件转发，需要查看硬件转发功能是否开启，未开启硬件转发功能会导致无线业务报文上送CPU处理，进而加重的CPU工作负担。 #开启WLAN硬件快速转发功能。 <Sysname>system-view [Sysname]undowlanfast-forwardinghardwaredisable 如果设备不支持硬件转发，则所有的无线业务报文需要上送CPU处理。当WLAN网络中存在大量的无线网络设备和无线客户端，AC就需要消耗大部分的CPU资源来处理无线业务报文，可能导致AC的转发性能达到瓶颈，此时可以将“集中转发”修改为“本地转发”。其次，查看是否存在特殊的业务模型如果无线网络中，大部分业务是大量的TCP流量（如视频业务），可以尝试修改CAPWAP隧道的MSS（MaxSegmentSize，TCP最大报文段长度）来避免大包报文分片转发，进而减轻分片报文上送CPU处理引起的转发进程繁忙。 #配置CAPWAP隧道的TCP最大报文段长度为2000字节。 <Sysname>system-view [Sysname]wlantcpmss2000 (6)查看AP空口质量WLAN网络中，由于空口共享传输介质，容易引发空口质量问。在集中转发架构下，出现无线上网卡慢问题需要重点关注空口干扰和空口广播、组播包占比。查看AP空口质量的步骤如下： a.远程登录至AP。开启上线AP的执行控制台（缺省为开启），通过Telnet方式登录至终端关联的AP上，AP的缺省登录密码为h3capadmin。 #查找当前终端关联AP的名称 <Sysname>displaywlanclient Totalnumberofclients:3MACaddressUsernameAPnameRIPaddressVLAN000f-e265-6400N/Aap111.1.1.1200 #查找当前终端关联AP的IP地址 <Sysname>displaywlanapnameap1verbose APname:ap1 APID:1 APgroupname:default-group State:Run Backuptype:Master Onlinetime:0days1hours25minutes12secondsSystemuptime:0days2hours22minutes12seconds Model:WA6320 Regioncode:CN Regioncodelock:Disable SerialID:219801A28N819CE0002TMACaddress:0AFB-423B-893C IPaddress:192.168.1.50UDPcontrolportnumber:18313UDPdataportnumber:N/A显示信息略…#开启上线AP的执行控制台, <Sysname>system-view [Sysname]probe [Sysname-probe]wlanap-executeap1exec-consoleenable [Sysname-probe]quit [Sysname]quit <Sysname>telnet192.168.1.50 Trying192.168.1.50... PressCTRL+KtoabortConnectedto192.168.1.50... *Copyright(c)2004-2022NewH3CTechnologiesCo.,Ltd.Allrightsreserved.**Withouttheowner'spriorwrittenconsent,**nodecompilingorreverse-engineeringshallbeallowed.******************************************************************************* Password: <AP1> b.查看空口干扰。通过displayar5drvradiochannelbusy命令查看信道利用率，判断射频繁忙情况。 −如果CtlBusy高于60%时，则表示该射频繁忙，需要调整射频参数（信道、功率、频宽）。 −否则，执行步骤“c查看空口质量”。 #查看AP1Radio1的信道利用率 <AP1>system-view [AP1]probe [AP1-probe]displayar5drv1channelbusyChannelBusyinformationCtlChannel:52ChannelBand:80MRecordInterval(s):9IdleCheckDelay(s):0MeasureDelay(s):0 Date/Month/Year:22/09/2022Time(h/m/s):CtlBusy(%)TxBusy(%)RxBusy(%)ExtBusy(%)0103:15:42683728- 0203:15:33673629- 0303:15:24633526- 0403:15:15784033- 0503:15:06814336-显示信息略… c.查看空口质量。 AP使用最低速率发送广播和组播报文，大量的广播或组播报文占用射频资源，会降低整体网络使用效率，因此需要对APRadio接口发送的广播和组播报文进行控制。通过displayar5drvradiostatistics命令查看AP射频统计情况，判断空口质量。 <AP1>system-view [AP1]probe [AP1-probe]displayar5drv1statistics [RadioStatistics]TxFrameAllCnt:388216TxFrameAllBytes:134143677RxFrameAllCnt:633177RxFrameAllBytes:84402310 [TxQueueStatistics] QueueNumber:0123 ----------------------------------------------------------- TxFrmCnt:353398241321504 TxFrmBytes:133247267127421000269470TxUcastFrmCnt:215625241321504TxUcastFrmBytes:87605120127421000269470TxBcastFrmCnt:137773000TxMcastFrmCnt:0000TxMRetryCnt:340269 TxFragCnt:0000 TxDiscardFrm:0000TxDiscardFrmBytes:0000TxDataFrmCnt:3420376131328TxDataFrmBytes:1308296783002094316400TxUDataFrmCnt:2042646131328TxHwRetryExc:225111424显示信息略… ResetOnErr:0显示信息略…BeaconBusyCnt:2BeaconErrCnt:0 … 该命令需要重点关注的显示信息如表5-3所示。 表5-3displayar5drvradiostatistics命令重点关注的显示信息 显示字段描述 TxFrmCnt空口统计到的发送报文总量 TxUcastFrmCnt空口统计到的发送单播报文数量 TxBcastFrmCnt空口统计到的发送广播报文数量 TxMcastFrmCnt空口统计到的发送组播报文数量 TxDiscardFrm队列丢弃的报文总数，包括发送失败和队列溢出的报文 BeaconBusyCntAP发送Beacon报文的繁忙程度 BeaconErrCntAP发送Beacon报文的错误统计 如果出现如下情况，则会明显影响无线网络的使用体验，产生Ping包大迟延和丢包现象。 此时，需要在AP的以太网接口上配置二层隔离，梳理有线网络流量。 −如果（TxBcastFrmCnt+TxMcastFrmCnt）/TxFrmCnt超过50%。 −如果TxDiscardFra/TxUcastFrameCnt超过3% −如果BeaconBusyCnt和BeaconErrCnt出现增长。 (7)拨打热线400-810-0504求助。 如果故障仍未排除，请收集如下信息，并拨打H3C客户服务热线400-810-0504寻求帮助。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 Debug命令输出的调试信息 5.14终端通过RA方式自动获取IPv6DNS信息失败 ",Suggestion not provided
在AC上打开调试信息，AC上能够收到AP的报文，但无法注册,"缺省情况下，自动AP功能处于关闭状态，这种情况的调试信息显示如下： *Aug1115:26:16:7662018H3CCWS/7/RCV_PKT:ReceiveddiscoveryrequestfromAP:IPaddress=180.10.1.67,MACaddress=c4ca-d98e-c350,serialID=219801A0CLC11B000010. *Aug1115:26:16:7672018H3CCWS/7/ERROR:FailedtoprocessdiscoveryrequestfromAPwithserialID219801A0CLC11B000010:在设备上使用wlanauto-apenable命令开启自动AP功能。 4.18云AP无法连接至云平台 ","缺省情况下，自动AP功能处于关闭状态，这种情况的调试信息显示如下： *Aug1115:26:16:7662018H3CCWS/7/RCV_PKT:ReceiveddiscoveryrequestfromAP:IPaddress=180.10.1.67,MACaddress=c4ca-d98e-c350,serialID=219801A0CLC11B000010. *Aug1115:26:16:7672018H3CCWS/7/ERROR:FailedtoprocessdiscoveryrequestfromAPwithserialID219801A0CLC11B000010:在设备上使用wlanauto-apenable命令开启自动AP功能。 4.18云AP无法连接至云平台 "
在AC上通过displaywlanapnameap-nameverbose命令或登录AP后在Probe视图下通过diagboot-infodisplay命令查看设备重启原因，显示字段为“Hardreboot”或“Usersoftreboot” ,"本类故障的常见原因包括： •人为按压RESET按钮导致设备硬重启 •人为下发重启配置 •配置了定时重启功能•Fit模式下AP未在AC上上线。 3.故障分析 本类故障的诊断流程如图6-3所示。图6-3人为重启问题的故障诊断流程图 4.处理步骤 (1)确认无人按压RESET按钮。 当设备重启原因显示“Hardreboot”时，表示曾通过按压RESET按钮的方式重启AP。设备的RESET按钮示意图如图6-4所示。图6-4设备RESET按钮示意图 (2)确认是否人为通过配置重启设备。 当设备重启原因显示“Usersoftreboot”时，建议按照如下步骤排查：a.确认是否人为下发重启配置 AP重启前，有无人员通过命令行、SNMP、Web等管理手段重启设备，并了解具体执行哪些操作。如果无人下发重启设备操作，则执行步骤b。 b.检查是否配置了定时重启功能 执行displayschedulerjob和disschedulerschedule命令，查看是否为AP配置了定时重启功能。下面以AP工作在Fit模式为例进行介绍。 #在AC上配置ap1于每周六21:00重启。 [Sysname]schedulerjobresetap [Sysname-job-resetap]command1resetwlanapnameap1[Sysname-job-resetap]quit [Sysname]schedulerscheduleresetap [Sysname-schedule-resetap]jobresetap [Sysname-schedule-resetap]timerepeatingat21:00week-daySat #显示Job的配置信息。 [Sysname]displayschedulerjobJobname:resetsp resetwlanapnameap1 #显示定时任务的运行信息。 [Sysname]disschedulerschedule Schedulename:resetap Scheduletype:RunoneverySatat21:00:00 Starttime:SatJul1621:00:002022 Lastexecutiontime:SatJul1621:00:002022 Lastcompletiontime:SatJul1621:00:152022 Executioncounts:1 -----------------------------------------------------------------------JobnameLastexecutionstatusresetapSuccessful c.确认FitAP是否在线 当AP工作在Fit模式时，如果AP未在AC上上线，AP会每隔一段时间（一般为7-8分钟）重启一次，通过displaywlanapnameap-name命令的State显示字段可以确认AP是否在线。 <Sysname>displaywlanapnameap1 APinformation State:I=Idle,J=Join,JA=JoinAck,IL=ImageLoad C=Config,DC=DataCheck,R=RunM=Master,B=Backup APnameAPIDStateModelSerialIDap11IWA6320219801A28N819CE0002T 当AP不在线时，可以通过displaywlanapnameap-nameverbose命令的“Tunneldownreason”显示字段查看CAPWAP隧道断开的原因，显示字段的具体含义请参见“AP管理命令参考”。 <Sysname>displaywlanapnameap1verboseAPname:ap1 APID:1 APgroupname:default-group State:Run Backuptype:Master Onlinetime:0days1hours25minutes12secondsSystemuptime:0days2hours22minutes12seconds Model:WA6320Regioncode:CN 显示信息略…… Lastrebootreason(APcheck):Theradiophysicalstatuswasdown Lastrebootreason(ACcheck):TheradiophysicalstatuswasdownLatestIPaddress:10.1.0.2 CurrentACIP:192.168.1.1 Tunneldownreason:Requestwaittimerexpired (3)如果排查以上方面(显示信息略……)后，问题得不到解决，请拨打H3C客户服务热线400-810-0504寻求帮助。 6.6软件重启 ",Suggestion not provided
在AC上通过displaywlanapnameap-nameverbose命令或登录AP后在Probe视图下通过diagboot-infodisplay命令查看设备重启原因，显示字段为“Poweron”,"当AP采用PoE供电方式时，本类故障的常见原因包括：网线不符合要求、PoE交换机重启、触发PoE交换机过载保护断电功能。 当AP通过电源适配器或PoE注入器供电时，本类故障的常见原因包括：供电设备不符合要求和供电设备损坏。 3.故障分析 本类故障的诊断流程如图6-1、图6-2所示。 图6-1设备掉电重启的故障诊断流程图（PoE供电方式） 图6-2设备掉电重启的故障诊断流程图（电源适配器或PoE注入器供电方式） 4.处理步骤 当AP采用PoE供电方式时，建议按照如下步骤排查： (1)检查线缆状况 a.检查网线规格 查看网线规格是否符合要求：一般要求使用超五类及以上线缆。2.5/5GE接口请务必使用超五类线（CAT5E）以上标准的线缆。10GE接口请务必使用六类线（CAT6）及以上标准的线缆。如果未满足，请更换符合要求的网线。如果满足，则执行步骤b。 b.检查网线是否损坏查看连接设备的网线水晶头是否松动，使用全新网线后观察一段时间，查看AP是否仍然有重启现象。如果问题得到解决，则为网线损坏。如果问题未解决，则执行步骤c。 c.检查PoE供电距离是否超出正常距离 核实部署AP时，供电距离是否超出可靠供电距离，供电距离一般建议在90米以内，最大不应超过100米。如果超出正常距离，建议缩短供电设备（PSE）与受电设备（PD）之间的距离或尝试其他供电方式。 (2)检查PoE交换机供电状况 a.检查PoE交换机是否重启在PoE交换机上执行displayversion命令，可以查看交换机的运行时间。 <Sysname>displayversion H3CComwareSoftware,Version7.1.070,Feature2607 Copyright(c)2004-2017NewH3CTechnologiesCo.,Ltd.Allrightsreserved. H3CXXXuptimeis0weeks,0days,2hours,14minutes Lastrebootreason:Coldreboot Bootimage:flash:/XXX-cmw710-boot-f2607.bin 显示信息略…… 通过对比交换机的运行时间和AP的运行时间是否相近，可以判断是否是交换机重启造成的AP重启。 b.检查是否触发过载保护断电功能 IEEE先后发布了802.3af（PoE）、802.3at（PoE+）和802.3bt（PoE++）PoE标准，后发布的标准兼容先发布的标准。 表6-2供电技术及对应参数 供电技术PoEPoE+PoE++ 遵循标准IEEE802.3afIEEE802.3atIEEE802.3bt PSE输出功率≤15.4W≤30W≤90W PD最大功率12.95W25.5W71.3W 线缆要求无超五类线（CAT5E）以上标准的线缆超五类线（CAT5E）以上标准的线缆 访问H3C官网查看无线接入点对应的安装指导，获取AP受电口遵循的标准和整机功耗等信息。 −如果AP的整机功耗不超过12.95W，则支持PoE功能的交换机即可满足供电要求； −如果AP的整机功耗大于12.95W，但小于等于25.5W，则可以通过PoE+交换机或电源注入器供电； −如果AP的整机功耗超过25.5W，则需要支持PoE++的交换机或对外供电60W的PoE注入器供电。 如果AP和PoE交换机实际协商遵循IEEE802.3af标准时，则交换机单端口最大输出功率为15.4W。在接入用户数增多的场景下，AP的实际功率可能会超过15.4W，此时会触发交换机上的过载保护断电功能，用户可以尝试通过poemax-powermax-power命令调高PoE接口的最大功率。 (3)如果排查以上方面后，问题得不到解决，请拨打H3C客户服务热线400-810-0504寻求帮助。 当AP通过电源适配器或PoE注入器供电时，建议按照如下步骤进行排查： (1)检查供电设备规格 查看电源适配器或PoE注入器的输出功率（电压和电流）是否满足AP安装手册中的电压要 求。如果未满足，请更换符合要求的电源适配器或PoE注入器。如果满足，则执行步骤(2)。 (2)检查供电设备是否损坏。 更换同型号的电源适配器或PoE注入器进行交叉测试。如果问题得到解决，则为供电侧故障，请更换供电设备。 (3)如果排查以上方面后，问题得不到解决，请拨打H3C客户服务热线400-810-0504寻求帮助。 6.5人为重启 ",Suggestion not provided
在AC上通过displaywlanapnameap-nameverbose命令或登录AP后在Probe视图下通过diagboot-infodisplay命令查看设备重启原因，显示字段为Watchdogreboot：看门狗重启,"软件重启的主要原因包括内核异常、内存泄漏、看门狗重启和版本自动升级等。此外，无法判断的重启原因也归类为软件重启，例如CPU异常等。 3.故障分析 本类故障建议用户查看产品对应的版本说明书，尝试将设备升级至最新版本后，观察问题是否得到解决。 4.处理步骤 本类问题建议按照如下步骤排查： (1)升级设备版本 查看产品版本说明书中，是否有针对重启问题的解决问题列表或遗留问题列表，如果产品后续版本中将对应重启问题列入“解决问题列表”，则需要对设备进行版本升级。 (2)如果无法通过版本升级解决问题，请拨打H3C客户服务热线400-810-0504寻求帮助。 2故障处理 2.1搜不到无线服务 2.1.1故障描述 无线终端无法搜索到设备上配置的无线服务。 2.1.2常见原因 搜索不到无线服务的常见原因如下： •无线网络布置不合理。 •无线功能配置不正确。 •设备故障。 2.1.3故障处理步骤 无线终端搜索不到无线服务的故障处理流程如下： 图2-1搜不到无线服务的故障处理流程图 (1)确认无线网络布置是否合理。 如果无线终端离设备过远，或者二者中间有遮挡物，会导致无线网络信号强度低，请尝试将终端靠近设备并绕过遮挡物。 如果无线终端的Wi-Fi功能无故障，且无线网络信号强度高，请继续执行步骤。 (2)检查设备指示灯状态，判断设备是否正常工作。 设备指示灯状态请参见表1-2和表1-3。若云网关PWR/SYS指示灯为绿色闪烁或云AP指示灯为黄色闪烁，则按照步骤(5)对设备进行恢复，否则请继续执行步骤(3)。 (3)检查设备的配置。如果设备已关联云平台，请登录云平台检查无线服务是否开启、SSID是否隐藏、射频是否开启。如果无线服务和射频关闭，则设备无法提供无线接入功能，SSID隐藏会导致终端只能手动输入SSID进行接入。如果射频的2.4GHz频段未开启，则仅支持2.4GHz频段的无线客户端无法搜索到无线服务。 查看设备配置的具体步骤如下： •如果设备关联至云平台。 在[网络管理/配置/云AP/无线配置/Wi-Fi配置]中，查看云AP无线服务的配置。 图2-2云平台上云AP的无线服务配置 在[网络管理/配置/云AP/无线配置/射频配置]中，查看云AP射频的配置。 图2-3云平台上云AP的射频配置 在[网络管理/配置/云网关/Wi-Fi配置]中，查看云网关以上功能的配置，仅对云网关自身射频生效。 图2-4云平台上云网关的无线服务配置 在云平台的[网络管理/配置/云网关/射频配置]中，查看云网关以上功能的配置，仅对云网关自身射频生效。与云AP的射频配置类似，故不赘述。 •如果设备未关联云平台，则在本地网管页面检查无线服务是否开启、SSID是否隐藏、射频是否开启等。 在设备的Wi-Fi配置页面和射频配置页面查看配置是否合理，云网关和云AP的页面类似，以下图为例。 图2-5本地Web页面的无线服务配置 图2-6本地Web页面的射频配置 如果设备的配置不正确，请修改设备配置。 如果设备的配置正确，请继续执行步骤(4)。 (4)判断5GHz终端是否符合区域码CN信道使用要求。区域码规定了射频的可用信道，如果终端不符合区域码CN信道要求，可能导致部分5GHz信道不可用。 如果终端不符合区域码CN信道使用要求，请将终端的区域码修改为CN，或者使用其他符合区域码CN信道使用要求的终端接入。 如果设备的配置正确，请继续执行步骤(5)。 (5)若确认配置无误，则尝试以下步骤进行恢复： 关闭无线服务，约半分钟后再开启无线服务，待云AP指示灯常亮、云网关2.4GHz或5GHz指示灯绿色常亮后查看是否可以搜到无线服务。若搜索不到或指示灯异常，请尝试下一步。 重启设备，重启完成后待云AP指示灯常亮、云网关2.4GHz或5GHz指示灯绿色常亮后，查看是否可以搜到无线服务。若搜索不到或指示灯异常，请尝试下一步。 记录上网配置信息（如PPPoE账号和密码等）后，恢复出厂设置。重新配置上网方式后，待云AP指示灯常亮、云网关2.4GHz或5GHz指示灯绿色常亮后，查看是否可以搜到无线服务。 (6)如以上方法均无法解决问题，请获取系统日志，并联系我们。 2.2无线终端无法接入 2.2.1故障描述 无线终端可以搜索到设备上配置的无线服务，但无法接入无线服务。 2.2.2常见原因 终端无法接入的常见原因如下： •无线网络布置不合理。 •无线功能配置不合理。 •设备故障。 2.2.3故障处理步骤 无线终端无法接入的故障处理步骤如下： 图2-7无线终端无法接入的故障处理流程图 (1)检查无线网络布置是否合理。 如果无线终端离设备过远，或者二者中间有遮挡物，会导致无线网络信号强度低，请尝试将终端靠近设备并绕过遮挡物。 如果无线终端的Wi-Fi功能无故障，且无线网络信号强度高，请继续执行步骤(2)。 (2)查看现场是否存在SSID相同但加密和认证配置不同的无线服务。 如果存在同名但加密和认证配置不同的无线服务时，终端可能会尝试接入错误的无线服务，此时会接入失败。可以通过云平台或本地Web页面查看设备的无线服务配置，也可以通过无线终端搜索其他设备是否存在同名的无线服务。 图2-8云平台上查看设备的无线服务 图2-9本地Web页面上查看设备的无线服务 如果存在同名但加密和认证配置不同的无线服务，请依据实际情况区分无线服务的名称，或者统一无线服务的加密与认证配置。 如果不存在同名但加密与认证配置不同的无线服务，请继续执行步骤(3)。 (3)确认是否开启一键网优拨码开关或云平台5G优先功能。 •云网关的一键网优/5G优先功能仅对自身射频生效，不对云AP的射频生效。 •仅部分型号的云网关和云AP支持云平台5G优先功能。 •拨码开关的优先级更高。 部分自身具备射频功能的云网关，前面板带有拨码开关。开启一键网优拨码开关时，如果云网关自身的射频同时开启了5GHz和2.4GHz频段，云网关会拒绝支持双频的终端接入2.4GHz，使终端接入5GHz频段。此时终端可能被2.4GHz射频拒绝，但未能成功接入5GHz射频。 云平台的5G优先功能与一键网优拨码开关相同，云AP可以通过云平台开启本功能。 云平台5G优先功能具体查看步骤如下： 在[网络管理/配置/云AP/无线配置/网络优化]中，查看云AP是否开启5G优先功能。 图2-10云平台上云AP开启5G优先功能 在[网络管理/配置/云网关/无线配置]中，查看云网关是否开启5G优先功能。 图2-11云平台上云网关开启5G优先功能 如果开启一键网优拨码开关或云平台5G优先功能，请配置关闭再尝试接入。 如果未开启/关闭一键网优拨码开关或云平台5G优先功能后仍无法接入，请继续执行步骤 (4)。 (4)确认是否开启弱信号终端优化功能。 弱信号终端优化功能会使得信号较弱的终端无法接入。当前仅支持通过本地Web页面配置本功能。 图2-12本地Web页面查看弱信号终端优化功能 如果开启弱信号终端优化功能，请配置关闭，或配置较小的接入门限和重连接门限值，再尝试接入。 如果未开启/关闭如果开启弱信号终端优化功能后仍无法接入，请继续执行步骤(5)。 (5)如以上方法均无法解决问题，请获取系统日志，并联系我们。 2.3网速慢 2.3.1故障描述 无线终端可以访问网络，但网速慢且ping有丢包。 2.3.2常见原因 网速慢的常见原因如下： •无线网络布置不合理。 •上行网络不稳定。上行网络不稳定时，一定出现此类故障。 •无线功能配置不合理。如果上行网络无问题，但无线配置不合理，也会造成此类故障。 2.3.3故障处理步骤 网速慢的故障处理流程如下： 图2-13网速慢的故障处理流程图 (1)检查无线网络布置是否合理。 检查无线终端是否离设备过远、无线终端和设备之间是否有遮挡物等。 如果无线终端离设备过远，或者二者中间有遮挡物，会导致无线网络信号强度低，请尝试将终端靠近设备并绕过遮挡物。 如果所有无线网络布置无问题，请继续执行步骤(2)。 (2)确认网络的出口带宽是否足够。 若网络内存在某台无线终端在占用大量网络资源，或有大量使用网络的无线终端在线，会导致网络抢占问题。此时可以停用占用大量网络的终端，或考虑升级网络带宽。 若网络内不存在占用大量网络资源的终端，且在线终端数量少，请继续执行步骤(3)。 (3)判断故障源于上行有线网络还是无线网络。 如下两种方式均可以判断故障来源： •将有线终端接入设备，使用尝试ping之前的地址，并查看丢包情况。 若有线终端也存在明显丢包问题，则说明故障源于上行有线网络。若有线终端不存在明显丢包问题，则说明故障源于无线网络。 •获取系统日志，查看网络状态日志uplinkquality.log是否有如下log信息： [FriDec110:21:07CST2020]Good [FriDec110:21:31CST2020]Busy [FriDec110:21:42CST2020]Busy [FriDec110:21:56CST2020]Unreachable [FriDec110:22:20CST2020]Good [FriDec110:22:45CST2020]Busy[FriDec110:23:09CST2020]Busy 若存在以上log信息，即存在上行网络Busy或Unreachable的信息，则说明故障源于上行有线网络。若不存在以上log信息，即上行网络无异常，说明故障源于无线网络。 若故障源于上行有线网络，请继续执行步骤(4)。 若故障源于无线网络，请执行步骤(5)排查无线网络的故障。 (4)查看设备首页组网图，若处于正常工作状态，且上网方式为PPPoE方式，则观察PPPoE连接经常断开。 若PPPoE经常断开，则联系上行网络的运营商排查问题。 若PPPoE未断开，则继续执行步骤(5)。 (5)检查云网关是否配置了限速功能。 云网关可以为下挂的云AP配置用户限速功能，对接入AP的客户端进行限速。静态限速基于每终端进行限速，动态限速基于无线服务整体进行限速；上行对终端发送至设备的流量限速，下行对设备发送至终端的流量限速。限速值配置不合理会导致终端网速慢。 在云平台的[网络管理/配置/云网关/Wi-Fi配置/无线服务配置]中，查看限速功能的配置。 图2-14云平台查看用户限速功能配置 若开启了用户限速功能或配置值不合理，请尝试关闭限速功能或者将限速值调高。 若未开启用户限速功能或配置值合理，则继续执行步骤(6)。 (6)请检查5GHz是否开启，若未开启且无特别的不开启原因，请开启5GHz频段。 如果设备在云平台上线，在[网络管理/配置/云AP/无线配置/射频配置]中，查看云AP的射频配置，在[网络管理/配置/云网关/Wi-Fi配置/Radio配置]中，查看云网关自身射频的配置。二者配置类似，以下图云AP配置为例。 图2-15云平台上查看云AP射频配置 如果设备通过本地管理，可以通过本地Web页面查看射频配置。 图2-16本地Web页面上查看射频配置 若未开启5GHz频段，请配置开启。 若开启开启5GHz频段，则继续执行步骤(7)。 (7)尝试修改工作信道和频宽。 在无线空口资源较为紧张的场景下，可能出现信道拥挤的情况，可以尝试修改射频的信道和频宽解决问题。 配置的具体步骤可以参考图2-15和图2-16中的信道和频宽配置项。若修改后未能解决问题，请继续执行步骤(8)。 (8)如以上方法均无法解决问题，请获取系统日志，并联系我们 2.4设备未关联云平台 2.4.1故障描述 通过云平台查看设备不在线。 2.4.2常见原因 设备未关联云平台的常见原因如下： •云网关开启独立运行拨码开关，无法连接至云平台。 •设备上行链路不通，无法与云简网络通信。 •设备的本地Web页面配置了自定义云连接地址。 •设备已绑定至其他云平台账号。 2.4.3故障处理步骤 设备未关联云平台的故障处理流程如下： 图2-17设备未关联云平台的故障处理流程图 (1)检查云网关是否开启独立运行拨码开关。 部分型号云网关的前面板带有拨码开关，如果开启了独立运行拨码开关，云网关将无法在云简网络上线，请确保云网关的独立运行拨码开关处于关闭状态。如果已经关闭独立运行开关，请继续执行步骤(2)。 (2)检查设备上行链路是否畅通，若设备不通外网，则无法关联至云平台。 有两种方式查看设备上行链路是否畅通： 查看本地Web的主页组网图，上行链路出现感叹号说明上行链路不通，没有感叹号说明畅通。 图2-18主页组网图查看到上行链路不通 在本地Web页面的<高级功能>页面，通过上行链路检测功能，检测设备是否能够与云平台联通。 图2-19上行链路检测功能 若上行链路不通，请检查网络配置，保证设备可以连接外网。 若上行链路通常，则执行步骤(3)。 (3)在本地Web页面的<高级功能>页面检查是否配置了自定义的云连接地址，云平台管理配置是否正确，下图为正确配置。需要注意的是，所有上行设备均不能禁止H3C云平台的端口号，否则设备无法连接至云平台。 图2-20云管理功能 若云管理功能配置不正确，请按照上图修改配置。 若云管理配置正确，则执行步骤(4)。 (4)判断是否需要解绑定。 把设备添加到云平台上时，如果提示设备已经绑定至其他云平台账户，则需要在原账户解绑设备，再绑定至现账户。登录原账户，删除设备完成解绑，在无法登录原账户的场景，可以在现账户使用设备解绑定功能将设备从原账户解绑。 设备解绑定的配置步骤如下： 在现云平台中的[网络管理/设置/设备解绑]中，输入设备的序列号，获取解绑码。 图2-21云平台获取解绑码 在本地Web页面的<高级功能>页面找到设备解绑定功能，输入解绑码，点击<确定>按钮完成解绑。此时可以在现云平台账户添加设备。 图2-22本地Web页面输入解绑码 如果未提示设备绑定至其他云平台账户，则继续执行步骤(5)。 (5)如以上方法均无法解决问题，请获取系统日志，并联系我们。 2.5无线经常断开 2.5.1故障描述 无线终端经常断开Wi-Fi连接。 2.5.2常见原因 无线终端的常见原因如下： •无线终端自身原因或网络布置不合理。 •上行网络的原因。如果上行网络不稳定，则无线网络一定出现此类故障。 •无线环境的原因。如果上行网络无问题，但无线配置不合理，也会造成此类故障。 2.5.3故障处理步骤 无线经常断开的故障处理流程如下： 图2-23无线经常断开的故障处理流程图 (1)检查无线网络布置是否合理。 确认无线终端是否离设备较远，或者二者中间有遮挡物。通过改变无线终端的位置，判断终端是否处于多台设备的覆盖交叉区域。 如果无线终端离设备过远、二者中间有遮挡物或终端处于多台设备的覆盖交叉区域，会导致无线网络信号强度低，请尝试将终端靠近设备并绕过遮挡物。 如果无线网络布置无问题，请继续执行步骤(2)。 (2)确认周围环境中是否有其他无线接入设备提供了同名的无线服务。 当其他无线设备存在同名无线服务时，客户端可能会尝试漫游至其他无线服务。如果同名的无线服务，加密和认证配置却不同，则终端将漫游失败，可能出现与一个无线服务断开，却不能接入另一个无线服务的情况。 如果周围有同名无线服务，请区分无线服务的名称，或统一无线服务的加密和认证配置。 如果周围没有同名无线服务，请继续执行步骤(3)。 (3)确认接入的无线客户端是否已经通过认证。 没有通过认证的客户端，即使连接了无线服务，也无法访问网络，此时终端可能会断开Wi-Fi连接。 如果客户端未认证，请手动认证。 如果客户端已经通过认证，请执行步骤(4)。 (4)切换设备信道，尝试切换信道后无线终端是否能正常稳定接入。 如果周围环境存在较多的无线设备和无线客户端，可能出现无线信道拥堵的情况，严重时可能导致Wi-Fi连接断开。请根据设备的管理方式选择在云平台或本地Web页面进行配置。 图2-24云平台的射频配置 图2-25本地Web页面的射频配置 如果修改射频配置无法解决问题，请执行步骤(6)。 (5)获取系统日志，如果条件允许，请提供客户端掉线前后的无线抓包，并联系我们。 2.6无线终端分配不到IP地址 2.6.1故障描述 无线终端可以接入无线网络，但分配不到IP地址。 2.6.2故障处理步骤 (1)首先请确认无线终端是否离设备过远、其它终端是否能接入此无线服务并正确分配IP地址。 (2)确认组网环境是否创建了对应的VLAN，且VLAN划分正确。 (3)检查对应的VLAN是否开启了DHCPServer。 (4)检查DHCPServer地址是否全部被占用。 (5)检查网络连通性，例如，将终端配置一个与DHCPServer相同网段的静态IP，尝试ping一下DHCPServer。 (6)确认环境中是否有干扰。 2.7无线终端无法上网 2.7.1故障描述 无线终端可以接入无线网络，但无法上网。 2.7.2故障处理步骤 无线终端无法上网的故障处理流程如下： 图2-26无线终端无法上网的故障处理流程图 (1)查看网管页面主页组网图，若上行链路不通，请检查线路，排除线路故障。 (2)排除线路故障后，检查是否所有网址都不能上网，是否有黑名单或有相关安全限制，详细参见 2.8个别网页或软件无法使用。 (3)确认是否所有无线终端都无法正常上网、无线终端是否离设备过远、无线终端和设备之间是否有遮挡物等。 (4)检查IP地址分配方式及结果是否正确： 静态IP方式需要检查IP地址、子网掩码、网关地址、DNS等配置是否正确。 DHCP方式配置了自定义DNS服务器，请检查自定义DNS是否填写正确。 若设备为云AP，检查终端IP是否为上行网络分配，检查上行网络VLAN配置是否正确。 (5)检查客户端是否成功获取IP地址，检查终端上是否有特殊配置，如指定了固定IP、配置了固定DNS等。 (6)在客户端上分别pingWAN口地址、DNS服务器，查看是否可以ping通。 (7)若DNS不可达，需要自定义DNS服务器。 (8)ping任意域名，如www.baidu.com等知名网址，或其他需要使用的特殊域名，若回显为解析地址失败，则配置自定义DNS再次尝试。 (9)检查服务模板是否已开启认证，若开启则检查客户端是否已经通过认证。 (10)检查设备的限速配置。 (11)检查上行网络网速是否过慢，用PC网线直插上行链路网口查看是否能正常上网。 2.8个别网页或软件无法使用 2.8.1故障描述 个别网页无法访问，或个别业务软件无法正常使用，但访问其它公共网络的网址可以正常访问（如百度、新浪、网易等）。 2.8.2故障处理步骤 (1)将终端切换至移动蜂窝网络，检查是否能正常上网。 (2)检查访问的域名是否被加入了域名黑名单中。 (3)客户端从无线服务接入，请确认客户端是否已经通过认证。 (4)请尝试ping该网址或ping软件所使用的域名，若ping不通，提示无法解析IP，请尝试自定义DNS。 (5)若提示能够解析IP但不可达，请确认该域名是否已经失效或对端服务器是否正常。 (6)若可ping通但依然不可访问或不可使用，基本排除网络问题，请尝试其他途径解决。 2.9客户端已认证通过但无法访问网络 2.9.1故障描述 接入的客户端通过认证，但无法正常访问网络资源。 2.9.2故障处理步骤 首先确认网管首页组网是否为正常工作状态，若不是，请首先解决网络不通问题。在网络通畅的情况下，依据本节步骤排查。 (1)认证日志oauth.log 若已经认证过，中途下线切换SSID，需要重新认证，对应的删除放行规则log信息为： authedclient[b8:08:d7:cf:dd:c1]onlineagain,willlogoutbecausessiddifferent [0901_oauthmem_333]! (2)认证日志oauth.log（下线离开超过30分钟） 若已经认证过，中途下线超过30分钟后重新连接，则需要重新认证；删除放行规则log信息为： 认证时触发逃生： Checkusertimeoutclient[b8:08:d7:cf:dd:c1]offlinetimeout Oauthlogoutclient[b8:08:d7:cf:dd:c1] 认证时未触发逃生： Checkusertimeoutclient[b8:08:d7:cf:dd:c1]offlinetimeout Oauthnotifycloudclient[b8:08:d7:cf:dd:c1]offlineandlogout (3)认证日志oauth.log（认证通过后持续在线超过6小时）若已经认证过，认证通过后，持续在线时间超过6小时，则需要重新认证。 删除放行规则log信息为： 认证时触发逃生： Checkusertimeoutclient[b8:08:d7:cf:dd:c1]sessiontimeoutOauthlogoutclient[b8:08:d7:cf:dd:c1] 认证时未触发逃生： Checkusertimeoutclient[b8:08:d7:cf:dd:c1]sessiontimeout Oauthnotifycloudclient[b8:08:d7:cf:dd:c1]offlineandlogout 2.10客户端未认证即可访问网络 2.10.1故障描述 接入的客户端不需要通过认证即可正常访问网络资源。 2.10.2故障处理步骤 根据以下步骤排查放行原因： (1)认证日志oauth.log（下线未超过30分钟） 若已经认证过，中途下线未超过30分钟，重新连接同一无线服务（SSID不变），则不需要重新认证即可访问网络，对应的log信息为： Authedclient[b8:08:d7:dd:c1]at[1510365737]onlineagain,lastofflinetime[1510365737]! (2)认证日志oauth.log（触发逃生） 若此时云平台认证服务器故障，则触发逃生，即客户端不需要认证即可访问网络，对应的log信息为： Authserverisontonline (3)认证日志oauth.log（场所内无感知认证）若场所内无感知认证功能开启，且在开启后已经认证过，若在当天24:00之前重新接入，则认证是无感知的（即不需要用户重新认证），对应的log信息为： [WedNov2219:20:192020][216535][Auth]:Mac_triggerstatusisON,Nextwilljudgeissendrefer. [WedNov2219:20:192020][216695][EVENT]:Clientmacb8:08:d7:cf:dd:c1willsendmacttriggerrequest. [WedNov2219:20:192020][400255][EVENT]:GettheresultisBIND,nextgetaccess_token. 2.11客户端认证失败 2.11.1故障描述 接入的客户端认证失败。 2.11.2故障处理步骤 (1)认证方式：一键认证 a.查看oauth.log日志是否有重定向URL，如下所示： Redirectingclientbrowserto http://oasisauth.h3c.com:80/portal/protocol?response_type=code&redirect_uri=http://192.168.60.1:2060/oauth/auth&nas_id=xb-0-1281397-219801A27VMSG3308091&template_id=552545&ssid=H3C_WiFi_2_22&usermac=1A-B4-DD-E3-B2-94&userip=192.168.60.111&userurl=http%3A%2F%2Fcaptive.apple.com%2Fhotspot-detect.html b.查看是否获取到token和code： Getaccesstokenforclient9a:f5:5c:82:29:17,code[1243077iccacf89d8c414288ab112250] c.查看是否获取到useinfo： Getuserinfoforclient9a:f5:5c:82:29:17 (2)认证方式：短信认证与一键认证的排查方式相同。 2.12配置的域名黑名单不生效 2.12.1故障描述 通过云网关的本地网管页面或云平台配置了域名黑名单，但客户端依然可以访问此域名或地址。 2.12.2故障处理步骤 (1)域名黑名单从配置到生效有一定的延时，请确认设备访问域名是否在此延时范围内。 (2)获取系统日志，查看h3cconfig日志中的域名黑名单，如下所示： SecurityConf Denylist:baidu.com 2.13配置的域名白名单不生效 2.13.1故障描述 通过云网关的本地网管页面或云平台配置了认证后的域名白名单，但客户端访问此域名或地址依然需要认证。 2.13.2故障处理步骤 获取系统日志，查看h3cconfig日志中的域名白名单，如下所示： Portalfreeurllistis: youku.com 2.14配置的无线黑名单不生效 2.14.1故障描述 在云网关本地Web网管页面配置了无线黑名单，但黑名单中的客户端仍然可以连接Wi-Fi。 2.14.2故障处理步骤 获取系统日志，查看h3cconfig日志中的无线黑名单列表，如下所示： macfilter-list‘blacklist’ listmaclist‘4e:91:29:25:d1:ea’ 2.15配置的无线白名单不生效 2.15.1故障描述 在云网关本地Web网管页面配置了无线白名单，但白名单之外的客户端仍然可以连接Wi-Fi。 2.15.2故障处理步骤 获取系统日志，查看h3cconfig日志中的无线白名单列表，如下所示： macfilter-list‘whitelist’ listmaclist‘54:a0:50:70:55:79’ 2.16设备时间信息不准确 2.16.1故障描述 获取系统日志，部分log日志中的时间信息不准确。 2.16.2故障处理步骤 设备启动时是从一个不确定的较早时间开始记录的，设备在网络可用后会通过NTP同步一次网络时间，并把第一次同步网络时间的时间点记录到timesyn.log文件中，如下所示： FriDec110:11:45CST2020 若收集的log日志集中，没有timesyn.log文件： (1)可以先ping任意域名，如www.baidu.com等知名网址或其它需要使用的特殊域名，若回显为解析地址失败，则配置自定义DNS再次尝试，若ping结果显示解析成功，可继续下一步； (2)在与设备相连接的PC的Windows操作系统的命令控制台中输入命令：w32tm/stripchart/computer:registry.h3c.com 若出现下图执行结果，则表示可以通过NTP服务获取时间，需要获取日志进一步分析。 若出现下图执行结果，则表示上行网络问题导致无法通过NTP服务获取时间，请及时联系上行网络运营商解决。 2.17VPN无法建立 2.17.1故障描述 •已按照相关要求完成VPN配置，无法正常建立连接。 •VPN显示已连接成功，设备侧可以访问远端服务设备，但远端服务设备无法访问本设备。 •VPN显示已连接成功，两端也可以相互访问，但经常会出现连接自动断开又自动连接的情况。 2.17.2故障处理步骤 •故障1： 首先排查建立VPN的链路是否通畅，即建立VPN的两端网关设备是否能够正常通信，测试方法为在一端去ping另一端的网关IP；若确认链路连通无问题，接着排查配置是否有误，重点排查IP是否配置正确，两端加密算法是否一致（建立VPN对两端设备的配置校验较为严格），至此可以解决大部分此类问题。 •故障2： 本系列网关设备在建立VPN时默认是强制开启NAT穿透功能的，VPN建立完成后远端设备无法访问本端设备，可能是由于远端设备未配置NAT穿透功能，解决方法是对远端设备开启 VPN的NAT穿透功能。 •故障3： VPN设备两侧配置了不同的PFS分组算法，第一次协商并不会出现问题，在重协商时可能会报PFS分组不一致的错误，注意检查两侧PFS配置是否一致，解决办法是关闭两端设备的 PFS分组算法或将PFS分组算法改成一致。 2.18AP通过CAPWAP无法上线 2.18.1故障描述 在AC上（云网关）无法看到该AP的AP列表，或者该AP的AP列表状态显示为离线；AP的指示灯不是绿灯或绿灯闪烁（注意AP在云平台上线也会呈现绿灯），出现以上两种情形中的任何一种即表明AP没有上线。 2.18.2故障处理步骤 AP通过CAPWAP无法上线的故障处理流程如下： 图2-27AP通过CAPWAP无法上线的故障处理流程图 (1)首先排查AP是否配置了静态的ACIP地址，如果是，请检查该IP是否是目标AC的IP地址。 (2)如果AP是通过OPTION43方式获取到的ACIP地址，请查看DHCPSERVER的配置是否正确。 (3)AP是否在网络中其它AC上线了。 (4)查看AC管理AP的规格是否达到上限。 (5)查看AP是否连接了云平台，如果AP连接云平台就不会在AC上线。 (6)云网关的CAPWAP功能是否开启（AP管理>高级功能>AP管理功能）。 (7)收集日志查看AP是否获取到了br-lan的IP地址。如未获取到请参考2.6无线终端分配不到 IP地址进行排查。 (8)在AP本地Web页面的网络工具中pingAC的IP地址，是否可以ping通。 2硬件类故障处理 2.1.1CPE上电后，串口没有打印信息 ",Suggestion not provided
在AC上通过displaywlanapnameap-nameverbose命令或登录AP后在Probe视图下通过diagboot-infodisplay命令查看设备重启原因，显示字段为以下任一情况： •Watchdogreboot：看门狗重启 •Unknownreboot：未知原因重启 •Kernelexceptionsoftreboot：内核异常重启 •Kerneldeadloopsoftreboot：内核死循环重启 •Autoupdatesoftreboot：版本自动升级 •Unknownsoftreboot：未知软件原因 •Memoryexhausted：内存耗尽 •Otherunknownsoftreboot：其他原因 ,软件重启的主要原因包括内核异常、内存泄漏、看门狗重启和版本自动升级等。此外，无法判断的重启原因也归类为软件重启，例如CPU异常等。 3.故障分析 本类故障建议用户查看产品对应的版本说明书，尝试将设备升级至最新版本后，观察问题是否得到解决。 4.处理步骤 本类问题建议按照如下步骤排查： (1)升级设备版本 查看产品版本说明书中，是否有针对重启问题的解决问题列表或遗留问题列表，如果产品后续版本中将对应重启问题列入“解决问题列表”，则需要对设备进行版本升级。 (2)如果无法通过版本升级解决问题，请拨打H3C客户服务热线400-810-0504寻求帮助。 3硬件类故障处理 3.1系统类故障 3.1.1终端无显示或显示乱码 ,Suggestion not provided
在EVPNL3VPNoverSRv6组网中，采用SRv6TE方式通过SRv6TEPolicy转发流量时，流量转发不通,"本类故障的常见原因主要包括： •BGPEVPN邻居未成功建立。 •EVPNL3VPNoverSRv6配置缺失。 •SRv6SID路由不可达。3.故障分析 本类故障的诊断流程如图112所示。 图112EVPNL3VPNoverSRv6BE流量转发不通的故障诊断流程图 4.处理步骤 (1)在本端PE设备上执行displaybgppeerl2vpnevpn命令查看BGPEVPN邻居是否成功建立： 若显示信息中的State字段取值为Established，则表示PE之间成功建立BGPEVPN邻居，请继续执行步骤(2)。 否则，请解决BGPEVPN邻居无法成功建立问题，解决方法请参见“BGP邻居无法建立的定位思路”。 <Sysname>displaybgppeerl2vpnevpn BGPlocalrouterID:1.1.1.1 LocalASnumber:100 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState 2::210013100200:00:05Established (2)检查两端PE设备上EVPNL3VPNoverSRv6的配置是否完整。若不完整，请补充缺失的配置；若完整，请继续执行步骤(3)。 在两端PE上执行displaycurrent-configuration命令，检查是否存在以下配置。若不存在，则需要参见《EVPNL3VPNoverSRv6配置指导》手册，补充相关配置。 #isis1 cost-stylewide-compatible # address-familyipv6unicast segment-routingipv6locatoraaa//配置通过IS-IS通告Locator网段路由 ##bgp100 peer3::3as-number100 # address-familyl2vpnevpnpeer3::3enable peer3::3advertiseencap-typesrv6//配置向对等体/对等体组发布SRv6封装的EVPN路由 # ipvpn-instancevpn1 #address-familyipv4unicast segment-routingipv6best-effortevpn//配置路由迭代到SRv6BE隧道segment-routingipv6locatoraaaevpn//配置BGP引用Locator段，以便在引用的Locator段内为指定VPN实例的私网路由申请SRv6SID # segment-routingipv6 encapsulationsource-address11::11//配置SRv6VPN封装的IPv6报文头的源地址locatoraaaipv6-prefix1:1::96static8//创建Locator段# (3)在两端PE设备上分别检查是否存在到达对端的SRv6SID的路由。 a.执行displaybgpl2vpnevpn命令，查看PrefixSID字段。该字段中的IPv6地址为 对端PE分配的SRv6SID。 <Sysname>displaybgpl2vpnevpn[5][0][64][4::]/176BGPlocalrouterID:1.1.1.1 LocalASnumber:100 Routedistinguisher:1:1 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof[5][0][64][4::]/176: From:2::2(2.2.2.2) Relynexthop:FE80::8A1B:6FFF:FEDB:708Originalnexthop:2::2 Outinterface:GigabitEthernet2/0/3Routeage:00h06m33s OutLabel:3 Ext-Community:<RT:1:1> RxPathID:0x0 TxPathID:0x0 PrefixSID:End.DT6SID<9::8000:2> AS-path:65420 Origin:incomplete Attributevalue:MED0,localpref100,pref-val0State:valid,internal,best Sourcetype:localIPprecedence:N/A QoSlocalID:N/A Trafficindex:N/A EVPNroutetype:IPprefixadvertisementroute ESI:0000.0000.0000.0000.0000 EthernettagID:0 IPprefix:4::/64 Gatewayaddress:::MPLSlabel:3 Tunnelpolicy:NULL RelytunnelIDs:N/A Re-orignination:Disable b.执行displayipv6routing-tableipv6-address命令，查看是否存在到达SRv6 SID的路由。 <Sysname>displayipv6routing-table9::8000:2 Summarycount:1 Destination:9::/64Protocol:IS_L1 NextHop:FE80::8A1B:6FFF:FEDB:708Preference:15 Interface:GE1/0/3Cost:20 若存在到达对端SRv6SID的路由，则继续执行步骤(4)；否则，请解决无法通过IGP学习到路由的问题，解决方法请参见“IP路由类故障处理手册”。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 13.1.2EVPNL3VPNoverSRv6TE流量转发不通 本类故障的常见原因主要包括：•BGPEVPN邻居未成功建立。 •SRv6SID路由不可达。 •BGP-VPNIPv4单播地址族视图或BGP-VPNIPv6单播地址族视图下，未配置采用SRv6TE方式进行路由迭代。 •EVPN路由迭代到的SRv6TEPolicy没有生效。3.故障分析 本类故障的诊断流程如图113所示。 图113EVPNL3VPNoverSRv6TE流量转发不通的诊断流程图 4.处理步骤 (1)在本端PE设备上执行displaybgppeerl2vpnevpn命令查看BGPEVPN邻居是否成功建立： 若显示信息中的State字段取值为Established，则表示PE之间成功建立BGPEVPN邻居，请继续执行步骤(2)。 否则，请解决BGPEVPN邻居无法成功建立问题，解决方法请参见“BGP邻居无法建立的定位思路”。 <Sysname>displaybgppeerl2vpnevpn BGPlocalrouterID:1.1.1.1 LocalASnumber:100 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState2::210013100200:00:05Established (2)在两端PE设备上分别检查是否存在到达对端的SRv6SID的路由。 a.执行displaybgpl2vpnevpn命令，查看PrefixSID字段。该字段中的IPv6地址为 对端PE分配的SRv6SID。 <Sysname>displaybgpl2vpnevpn[5][0][64][4::]/176 BGPlocalrouterID:1.1.1.1 LocalASnumber:100 Routedistinguisher:1:1 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof[5][0][64][4::]/176:From:2::2(2.2.2.2) Relynexthop:FE80::8A1B:6FFF:FEDB:708Originalnexthop:2::2 Outinterface:GigabitEthernet2/0/3Routeage:00h06m33s OutLabel:3 Ext-Community:<RT:1:1>RxPathID:0x0 TxPathID:0x0 PrefixSID:End.DT6SID<9::8000:2> AS-path:65420 Origin:incomplete Attributevalue:MED0,localpref100,pref-val0State:valid,internal,best Sourcetype:localIPprecedence:N/A QoSlocalID:N/A Trafficindex:N/A EVPNroutetype:IPprefixadvertisementroute ESI:0000.0000.0000.0000.0000 EthernettagID:0 IPprefix:4::/64 Gatewayaddress::: MPLSlabel:3 Tunnelpolicy:NULL RelytunnelIDs:2150629378 Re-orignination:Disable b.执行displayipv6routing-tableipv6-address命令，查看是否存在到达SRv6 SID的路由。 <Sysname>displayipv6routing-table9::8000:2 Summarycount:1 Destination:9::/64Protocol:IS_L1NextHop:FE80::8A1B:6FFF:FEDB:708Preference:15 Interface:GE1/0/3Cost:20 c.若存在到达对端SRv6SID的路由，则继续执行步骤(3)；否则，请解决无法通过IGP学习到路由的问题，解决方法请参见“IP路由类故障处理手册”。 (3)在BGP-VPNIPv4单播地址族视图或BGP-VPNIPv6单播地址族视图下，执行displaythis命令，查看当前配置中是否存在segment-routingipv6traffic-engineeringevpn或者segment-routingipv6traffic-engineeringbest-effortevpn命令。若 不存在上述命令，请补充配置该命令；否则，请继续执行步骤(4)。 <Sysname>system-view [Sysname]bgp100 [Sysname-bgp-default]ipvpn-instancevpn1 [Sysname-bgp-default-vpn1]address-familyipv4unicast [Sysname-bgp-default-ipv4-vpn1]displaythis # segment-routingipv6locatoraaaevpnsegment-routingipv6traffic-engineeringevpn# (4)在两端PE设备上判断EVPN路由迭代到的SRv6TEPolicy是否有效。 a.在两端PE设备上执行displaybgpl2vpnevpn命令，查看到达对端私网地址的EVPN路由的RelytunnelIDs字段取值。该值为EVPN路由迭代到的SRv6TEPolicy的隧道索引值。 <Sysname>displaybgpl2vpnevpn[5][0][64][4::]/176 BGPlocalrouterID:1.1.1.1 LocalASnumber:100 Routedistinguisher:1:1 Totalnumberofroutes:1 Paths:1available,1best BGProutingtableinformationof[5][0][64][4::]/176: From:2::2(2.2.2.2) Relynexthop:FE80::8A1B:6FFF:FEDB:708Originalnexthop:2::2 Outinterface:GigabitEthernet2/0/3Routeage:00h06m33s OutLabel:3 Ext-Community:<RT:1:1>RxPathID:0x0TxPathID:0x0 PrefixSID:End.DT6SID<9::8000:2> AS-path:65420 Origin:incomplete Attributevalue:MED0,localpref100,pref-val0 State:valid,internal,best Sourcetype:local IPprecedence:N/A QoSlocalID:N/A Trafficindex:N/A EVPNroutetype:IPprefixadvertisementroute ESI:0000.0000.0000.0000.0000 EthernettagID:0 IPprefix:4::/64 Gatewayaddress:::MPLSlabel:3 Tunnelpolicy:NULL RelytunnelIDs:2150629378 Re-orignination:Disable b.在两端PE设备上执行displaysegment-routingipv6tepolicy命令，检查 Forwardingindex字段取值与RelytunnelIDs字段取值相同的SRv6TEPolicy是否有效，即查看Status是否为Down。若为Down，则表示SRv6TEPolicy未生效，请参考“SRv6TEPolicy无法生效的定位思路”解决该问题。 <Sysname>displaysegment-routingipv6tepolicy Name/ID:p1/0 Color:10Endpoint:1000::1 NamefromBGP: BSID: Mode:DynamicType:Type2Requeststate:Succeeded CurrentBSID:8000::1ExplicitBSID:-DynamicBSID:8000::1Referencecounts:3Flags:A/BS/NC Status:Up AdminStatus:Up Uptime:2020-03-0916:09:40 Downtime:2020-03-0916:09:13Hotbackup:Enabled Statistics:Enabled Statisticsbyserviceclass:Enabled Pathverification:EnabledDrop-upon-invalid:Enabled BFDtriggerpath-down:Enabled SBFD:EnabledRemote:1000 SBFDtemplatename:abc SBFDbackuptemplatename:- OAMSID:- BFDEcho:Disabled Forwardingindex:2150629378AssociationID:1 Service-class:- Rate-limit:15000kbps PCEdelegation:Disabled PCEdelegatereport-only:Disabled Encapsulationmode:- Candidatepathsstate:Configured Candidatepathsstatistics: CLIpaths:1BGPpaths:0PCEPpaths:0ODNpaths:0 Candidatepaths:Preference:20 CpathName: ProtoOrigin:CLIDiscriminator:10InstanceID:0Nodeaddress:0.0.0.0 Originator:0,:: Optimal:YFlags:V/A Dynamic:NotconfiguredPCEP:Notconfigured ExplicitSIDlist: ID:1Name:Sl1 Weight:1Forwardingindex:2149580801State:UpState(EchoBFD):Down VerificationState:- PathMTU:1500PathMTUReserved:0 LocalBSID:- ReverseBSID:- (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 13.2SR-MPLS故障处理 13.2.1SR-MPLS-BE方式的SRLSP无法建立 ",Suggestion not provided
在Ingress上执行displaymplstetunnel-interface命令检查SR-MPLS-TETunnel的状态为Down。 <Sysname>displaymplstetunnel-interface TunnelName:Tunnel1TunnelSignalledName:tunnel1 TunnelState:Down(MainCRLSPDown.BackupCRLSPDown.),本类故障的常见原因主要包括： •构成SR-MPLS-TETunnel的SRLSP所经过的路径上存在物理链路故障。 •用于检测SR-MPLS-TETunnel的BFD会话状态为down，使得SR-MPLS-TETunnel状态为Down。 •SR-MPLS配置缺少或错误。 •SRTETunnel配置错误。3.故障分析 本类故障的诊断流程如图115所示。 图115SR-MPLSTETunnelDown的故障诊断流程图 4.处理步骤 (1)在SRLSP经过的各个节点上通过命令displayinterfacebrief检查物理链路状态，确保SRLSP转发路径上各接口的物理状态和数据链路层协议状态均为UP。如果链路正常，或链路恢复后问题仍未解决，请继续执行以下操作。 (2)检查是否由BFD会话Down导致SRTETunnelDown。 a.在SR-MPLS-TE隧道接口下使用displaythis命令检查是否配置了mplsbfd、mplssbfd、mplstunnel-bfd或mplstunnel-sbfd命令中的任一条。如果配置了，则 b.使用dis(执行b。)playmplsbfd或displaymplssbfd命令检查BFD/SBFD会话的状态。 c.BFD联动导致SR-TE隧道Down可能是由于，请执(如果BFD/SBFD会话的状态为Down，则执行c。)行undomplsbfd、undomplssbfd、undomplstunnel-bfd或undomplstunnel-sbfd命令删除BFD/SBFD检测相关命令。如果BFD/SBFD会话正常或者不存在BFD/SBFD会话，问题仍未解决请执行(3)。 (3)检查SR-MPLS配置（不支持通过IGP协议动态分配SID的产品请忽略此步骤）。 a.在IS-IS视图或OSPF视图下检查是否开启支持SR-MPLS功能，同时需要检查以下配置，否则SR-MPLS功能不会生效： −当IGP协议为IS-IS时，通过displayisis命令的显示信息中Coststyle字段来判断IS-IS开销值的类型是否为wide、compatible或wide-compatible。如果Coststyle字段的开销值类型不是以上三种，请执行cost-style命令来修改IS-IS开销值的类型。 −当IGP协议为OSPF时，通过displayospf命令来判断OSPF是否使能OpaqueLSA发布接收能力。如果displayospf命令显示信息中存在Opaquecapable字段，表示OpaqueLSA发布接收能力处于开启状态。若未使能该功能，则需要在OSPF视图下执行opaque-capabilityenable命令。 b.若使用前缀SID方式建立SRLSP转发路径，请在LoopBack接口视图下检查是否配置了前缀SID。如果未配置，则在OSPF视图下执行ospfprefix-sid命令或在IS-IS视图下执行isisprefix-sid命令配置前缀SID；若使用AdjacencySID方式建立SRLSP转发路径，请在OSPF视图或IS-IS视图下开启邻接标签分配功能或者在SRLSP转发路径的接口上检查是否配置了AdjacencySID。如果未配置，则在OSPF视图或IS-IS视图下执行segment-routingadjacencyenable命令开启邻接标签分配功能。也可以在接口视图下执行isisadjacency-sid命令或ospfadjacency-sid命令配置 AdjacencySID。 c.执行displaysegment-routinglabel-block命令检查LoopBack接口下配置的前缀SID是否在SRGB标签段范围内，并检查接口下配置的AdjacencySID是否在SRLB标签段范围内。如果前缀SID未在SRGB范围内或者AdjacencySID未在SRLB标签段范围内，则请修改配置的AdjacencySID，否则该SID不会生效。 d.如果执行以上操作后，问题仍未解决，则请继续执行以下操作。 (4)检查TE隧道配置。MPLSTE采用不同方式生成SRLSP时，故障定位方式有所不同： MPLSTE隧道采用静态指定标签生成SRLSP：在SRLSP的Ingress上执行displaymplsstatic-sr-mpls命令查看静态SRLSP信息或静态配置的邻接段信息，保证出标签栈字段Out-Label表示的标签序列依次和SRLSP路径上各节点配置的静态标签值一一对应。如果Ingress上出标签栈中的标签序列与SRLSP路径上各节点配置的静态标签值不对应，请执行static-sr-mplslsp命令修改Ingress上出标签栈中的标签序列。 若MPLSTE隧道采用显式路径算路生成SRLSP（不支持显式路径SRLSP的产品请忽略此步骤）：在SRLSP的Ingress上执行displayexplicit-path命令检查显式路径上节点的IP地址或者SID与SRLSP路径上各节点的IP地址或者本地SID一一对应，并保证Ingress上显式路径视图下通过nexthop命令指定的SID类型与SRLSP路径上各节点的接口视图下配置的前缀SID或AdjacencySID类型保持一致，即接口下配置了前缀SID，nexthop命令指定的SID也必须是前缀SID。如果存在问题，请通过nexthop命令修改显式路径上的IP地址或者SID。 若MPLSTE隧道采用PCE托管方式由控制器算路生成SRLSP（不支持PCE计算建立SRLSP的产品请忽略此步骤）：请检查SR-TETunnel接口下是否执行了mplstedelegation命令开启了SRLSP托管功能，并执行命令displaymplstepcepeer 检查PCC与PCE是否建立了PCEP会话。通过抓包确认控制器（PCE）是否进行了路径更新以及路径是否正确。在抓取报文中请确保由PCE下发的AdjacencySID或下一跳地址使用strict方式，前缀SID或者节点地址使用loose方式。如果PCC与PCE未正常建立了PCEP会话，且抓取报文未满足上述要求，请检查控制器上的配置。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志 •TE/5/TE_BACKUP_SWITCH 13.3SRv6TEPolicy故障处理 13.3.1SRv6TEPolicy无法生效的定位思路 ,Suggestion not provided
在MPLSL3VPN/IPv6MPLSL3VPN网络中，PE的VPN实例IP路由表中没有远端PE用户站点的私网路由，导致CE间无法互通,"本类故障的常见原因主要包括： •与远端PE的BGP会话未进入Established状态。 •远端PE未发送私网路由。 •公网隧道未建立。 •远端PE发送的私网路由被本端丢弃。 •远端PE发送的私网路由在本端的BGP路由表中，但未被添加到VPN实例的IP路由表中。 3.故障分析 本类故障的诊断流程如图101所示。 图101PE的私网IP路由表中没有远端PE发布的路由故障诊断流程图 4.处理步骤(1)检查BGP邻居是否建立。 执行displaybgppeervpnv4或displaybgppeervpnv6命令，查看本端PE与远端PE是否建立起了处于Established状态的BGP会话，例如： <Sysname>displaybgppeervpnv4 BGPlocalrouterID:11.11.11.11 LocalASnumber:10 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState 22.22.22.221082690201:01:28Established 如果已经建立，请执行步骤（3）。 如果未建立，请参见“三层技术-IP路由类故障处理”手册中的“BGP会话无法进入 Established状态”进行定位。BGP会话进入Established状态后，如果故障仍未能排除，请执行步骤（2）。 (2)查看远端PE是否向本端发布了私网路由信息。 在远端PE上执行displaybgprouting-tablevpnv4peeradvertised-routes或displaybgprouting-tablevpnv6peeradvertised-routes命令，查看远端 PE是否将私网路由信息发布给本端PE，例如： <Sysname>displaybgprouting-tablevpnv4peer22.22.22.22advertised-routes Totalnumberofroutes:6 BGPlocalrouterIDis11.11.11.11 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala-additional-path Origin:i-IGP,e-EGP,?-incomplete Routedistinguisher:1:1 Totalnumberofroutes:3 NetworkNextHopMEDLocPrfPath/Ogn *>e1.1.1.1/3210.1.1.2010020i*>e7.7.7.7/3210.1.1.2010020?*>e10.1.1.0/2410.1.1.2010020? Routedistinguisher:2:2 Totalnumberofroutes:3 NetworkNextHopMEDLocPrfPath/Ogn *>e2.2.2.2/3210.1.1.2010030i*>e7.7.7.7/3210.1.1.2010030?*>e10.1.1.0/2410.1.1.2010030? 如果存在这样的信息，请执行步骤（3），如果不存在，则进行如下检查： a.在远端PE上执行displaybgprouting-tablevpnv4或displaybgprouting-tablevpnv6命令，查看是否存在想要发布的私网路由。 −如果存在，请执行步骤b。 −如果不存在，则检查PE-CE间的配置。PE与CE间可以使用多种协议交互路由信息，包括静态路由、RIP、OSPF、OSPFv3、IS-IS、BGP等。关于BGP路由协议故障处理方法，请参见“三层技术-IP路由类故障处理手册”中的“BGP故障处理”；常见的IGP路由协议故障处理方法，请参见“三层技术-IP路由类故障处理”手册中的“OSPF故障处理”、“OSPFv3故障处理”或“IS-IS故障处理”。远端PE的BGP路由表获得 b.在了E的BGPVPNv4地址族视图或者BGPVPNv6远端地(私网路由后，如果故障仍不能排除，请执行步骤b。P)址族视图下执行displaythis命令，查看是否存在发布策略过滤了私网路由信息导致无法发布，可能造成影响的配置命 令有： −peerprefix-listexport −peerfilter-policyexport −peeras-path-aclexport −filter-policyexport −peerroute-policyexport 可以通过执行上述命令的undo形式命令来取消对私网路由信息发布的过滤，为了避免组网中的其他配置受到影响，请在技术支持人员的引导下修改私网路由信息发布的过滤策略。 如果故障仍不能排除，请执行步骤（3）。 (3)查看公网隧道是否建立。 MPLSL3VPN的公网隧道可以是LSP隧道、MPLSTE隧道和GRE隧道。当公网隧道为LSP隧道或MPLSTE隧道时，公网标记为MPLS标签，称为公网标签；当公网隧道为GRE隧道时，公网标记为GRE封装。常见的公网隧道建立方式是使用LDP标签分发协议自动建立标签转发路径，本故障处理流程以该方式为例，介绍建立公网隧道的故障排查方法。其他方式的公网隧道请参见相应的故障处 在私网路由发布的骨干网路径上，为所有设备(理手册或寻求技术支持人员的帮助进行排查。)执行displaymplsldppeer命令，查看 是否与LDP对等体成功建立了会话，例如： <Sysname>displaymplsldppeerVPNinstance:publicinstance Totalnumberofpeers:2 PeerLDPIDStateRoleGRAUTKASent/Rcvd 22.22.22.22:0OperationalPassiveOffNone1816/1816 11.11.11.11:0OperationalPassiveOffNone1816/1816如果已经成功建立了会话，请执行步骤（4）。如果未建立LDP会话，请参见“MPLS类故障处理手册”中的“LDP会话Down的定位思路”进行排查。 如果公网隧道建立后，故障仍不能排除，请执行步骤（4）。 (4)检查本端PE的BGP路由表中是否存在对端PE发布的私网路由。 在本端PE上执行displaybgprouting-tablevpnv4或displaybgprouting-tablevpnv6命令，查看是否存在远端PE发布的私网路由。如果不存在，则执行如下操作： a.在本端PE和远端PE上，均执行displayipvpn-instanceinstance-name命令，查看本端PE的VPN实例的ImportVPNTargets与远端PE的ExportVPNTargets是否一致，显示信息举例如下。 <Sysname>displayipvpn-instanceinstance-namevpn1VPN-InstanceNameandIndex:vpn1,1 RouteDistinguisher:1:1 Interfaces:GigabitEthernet1/0/1 TTLmode:pipeAddress-familyIPv4: ExportVPNTargets: 1:1 ImportVPNTargets:1:1 −如果不一致，则需要在本端或者远端PE的VPN实例视图下通过vpn-target命令，将RT修改为匹配的值。修改RT后，如果本端PE的BGP路由表中仍未存在对端PE发布的私网路由，请执行步骤b；如果本端PE的BGP路由表中已经存在对端PE发布的私网路由，但故障仍不能排除，请执行步骤（5）。−如果一致，请执行步骤b。 b.通过在BGP实例视图下执行displaythis命令，查看是否存在接收策略过滤了私网路 由信息导致无法接收，可能造成影响的配置命令有： −peerprefix-listimport −peerfilter-policyimport −peeras-path-aclimport −filter-policyimport −peerroute-policyimport 可以通过执行上述命令的undo形式命令来取消对私网路由信息接收的过滤，为了避免组网中的其他配置受到影响，请在技术支持人员的引导下修改私网路由信息接收的过滤策略。 如果故障仍不能排除，请执行步骤（5）。 (5)检查BGP路由添加到VPN实例IP路由表的受阻原因。可能的原因有： 设备配置了undopolicyvpn-target命令，与当前VPN实例RouteTarget属性不匹配的VPNv4/VPNv6路由可以添加到VPN实例的BGP路由表中，并能够在BGP路由表 中被优选，但是这些路由无法添加到当前VPN实例的IP路由表中。在BGP实例视图下执行displaythis命令，查看配置了undopolicyvpn-target命令的地址族，进入该地址族视图，并执行policyvpn-target命令，可以解决此问题。 设备配置了routing-tablebgp-rib-only命令，,禁止BGP路由下发到IP路由表中。在BGP实例视图下执行displaythis命令，查看配置了routing-tablebgp-rib-only命令的地址族，进入该地址族视图，并执行undorouting-tablebgp-rib-only命令，可以解决此问题。 如果故障仍未能排除，请执行步骤（6）。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 12.3.7私网间大包不通 ",Suggestion not provided
在MSTP网络中，设备上除了MSTI0之外的其他实例，本不应该是主端口角色的端口被计算为了主端口，且端口角色无法通过调整优先级、开销值等参数来改变,本类故障的常见原因为：同一MST域内，不同设备对MST域的配置不一致。 3.故障分析 如果两台设备对MST域的配置不一致，则设备会认为对端设备与本端设备不在同一个MST域中，导致与域内设备相连的端口也被计算为了主端口。所以本类故障的诊断思路为：检查同一MST域内设备的MST域配置信息，确保各个设备的配置保持一致。本类故障的诊断流程如图4-6所示。 图4-7非0实例端口状态为主端口且无法调整的故障处理流程图 4.处理步骤 (1)检查同一MST域内的设备对于MST域的域名、修订级别以及VLAN映射表配置是否相同， 执行displaystpregion(并确保这些参数的配置一致。)-configuration命令，显示设备生效的MST域配置信息。 例如： <Sysname>displaystpregion-configuration OperConfiguration Formatselector:0 Regionname:hello Revisionlevel:0 Configurationdigest:0x5f762d9a46311effb7a488a3267fca9f InstanceVLANsMapped 021to409411to10211to20 Regionname：MST域的域名，在系统视图下执行stpregion-configuration命令进入MST域视图后，通过region-name命令进行配置。 Revisionlevel：MST域的修订级别，在系统视图下执行stpregion-configuration命令进入MST域视图后，通过revision-level命令进行配置。 InstanceVLANsMapped：MST域的VLAN映射关系，在系统视图下执行stpregion-configuration命令进入MST域视图后，可以通过instance命令或vlan-mappingmodulo命令进行配置。 如果同一MST域内不同设备的上述参数配置不相同，请执行上述操作将参数的配置修改为一致配置完MST域的相关参数后，必须在MST域视图下执行activeregion-configuration命令，用户对MST域的配置才能激活并生效，否则MST域仍会按照之前的配置生效。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警•无相关日志 •无 4.5ND故障处理 4.5.1无法学习到ND表项 ,Suggestion not provided
在MSTP网络中，设备上除了MSTI0之外的其他实例端口角色无法通过调整优先级、开销值等参数来改变,本类故障的常见原因为：同一MST域内，不同设备对MST域的配置不一致。 3.故障分析 如果两台设备对MST域的配置不一致，则设备会认为对端设备与本端设备不在同一个MST域中，导致与域内设备相连的端口也被计算为了主端口。所以本类故障的诊断思路为：检查同一MST域内设备的MST域配置信息，确保各个设备的配置保持一致。本类故障的诊断流程如图4-6所示。 图4-7非0实例端口状态为主端口且无法调整的故障处理流程图 4.处理步骤 (1)检查同一MST域内的设备对于MST域的域名、修订级别以及VLAN映射表配置是否相同， 执行displaystpregion(并确保这些参数的配置一致。)-configuration命令，显示设备生效的MST域配置信息。 例如： <Sysname>displaystpregion-configuration OperConfiguration Formatselector:0 Regionname:hello Revisionlevel:0 Configurationdigest:0x5f762d9a46311effb7a488a3267fca9f InstanceVLANsMapped 021to409411to10211to20 Regionname：MST域的域名，在系统视图下执行stpregion-configuration命令进入MST域视图后，通过region-name命令进行配置。 Revisionlevel：MST域的修订级别，在系统视图下执行stpregion-configuration命令进入MST域视图后，通过revision-level命令进行配置。 InstanceVLANsMapped：MST域的VLAN映射关系，在系统视图下执行stpregion-configuration命令进入MST域视图后，可以通过instance命令或vlan-mappingmodulo命令进行配置。 如果同一MST域内不同设备的上述参数配置不相同，请执行上述操作将参数的配置修改为一致配置完MST域的相关参数后，必须在MST域视图下执行activeregion-configuration命令，用户对MST域的配置才能激活并生效，否则MST域仍会按照之前的配置生效。 (2)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警•无相关日志 •无 4.5ND故障处理 4.5.1无法学习到ND表项 ,Suggestion not provided
在设备上观察到BGP/5/BGP_STATE_CHANGED提示BGP会话状态变为Idle的日志打印信息，会话状态从Established变为Idle,本类故障的常见原因主要包括： •Keepalive或Update消息收发超时。 •TCP连接建立失败。 •设备达到内存门限。 •BGP报文解析发生错误。 3.故障分析 本类故障的诊断流程如图66所示。 图66BGP会话Down的故障诊断流程图 4.处理步骤 执行displaybgppeerlog-info命令，根据该命令的显示信息进一步确认BGP会话Down的原因。几种常见的BGP会话Down的原因如下： •BGP定时器超时导致断开会话如果log-info信息与下面的显示信息相似： <Sysname>displaybgppeeripv43.3.3.3log-info Peer:3.3.3.3 DateTimeStateNotification Error/SubError 17-Jan-202214:48:34DownReceivenotificationwitherror4/0 HoldTimerExpired/ErrSubCodeUnspecified Keepalivelasttriggeredtime:14:48:31-2022.1.17Keepalivelastsenttime:14:48:31-2022.1.17Updatelastsenttime:14:48:24-2022.1.17 EPOLLOUTlastoccurredtime:14:48:30-2022.1.17 则表示BGP会话Down的原因是在会话保持时间时间内未能收到对等体发送的Keepalive或Update消息。在BGP会话保持定时器超时后，设备则会主动断开BGP会话，并向对端对等体发送Notification消息。 定时器超时的原因可能是设备正常发送了Keepalive或Update消息，但报文由于链路故障等原因无法到达对等体或对等体处理不及时，或者设备调度故障导致未能及时产生Keepalive或Update消息等。如需解决此问题，请在BGP会话的两端设备的Probe视图下，均执行displaysysteminternalbgplog命令，并收集该命令的显示信息，联系技术支持人员进行进一步分析。 •TCP连接错误导致BGP会话断开如果log-info信息与下面的显示信息相似： <Sysname>displaybgppeeripv41.1.1.1log-info Peer:1.1.1.1 DateTimeStateNotification Error/SubError 17-Jan-202214:42:01DownReceiveTCP_Connection_Failedevent 则BGP会话Down的原因是TCP连接错误。BGP使用TCP作为其传输层协议，如果BGP会话两端设备间的TCP连接发生错误，BGP会话也会断开。如果用户观察到的显示信息与上述举例不相似，但是显示信息中包含了Notification消息错误码5/0，则也是由于TCP连接错误导致的BGP会话断开。 确认TCP连接发生错误后，请在BGP会话Down的两端设备的Probe视图中，均执行view/proc/tcp/tcp_logslotx命令（所有的单板/成员设备各执行一次），并收集该命令的显示信息，联系技术支持人员进行进一步分析。 •内存不足导致BGP会话断开如果log-info信息与下面的显示信息相似： <Sysname>displaybgppeeripv41.1.1.1log-infoPeer:1.1.1.1 DateTimeStateNotification Error/SubError 17-Jan-202215:38:53DownSendnotificationwitherror6/8 Enteredseverememorystate 17-Jan-202214:53:51DownSendnotificationwitherror6/8 Nomemorytoprocesstheattribute 表明设备没有足够内存处理BGP模块相关功能，导致BGP会话断开。此类错误原因对应log-info信息中的错误码6/8。此时请在BGP会话Down的两端设备上，均执行displaymemory-threshold命令，获取内存告警门限相关信息，并记录displaybgppeerlog-info命令的显示信息，联系技术支持人员进行进一步分析。 •报文解析错误导致BGP会话断开：BGP会话两端的设备如果报文解析能力不同或版本不匹配，则BGP可能无法解析接收到的报文，导致BGP会话断开。此类错误原因对应log-info信息中的消息差错码1、2和3（即“ErrBGP会话Down的两端设备上，均执行请在debu(or/SubError”中的“Error”为1、2或3）。)ggingbgpraw-packet、debuggingbgpopen以及debuggingbgpupdate命令，并收集这些命令的显示信息以及displaybgppeerlog-info命令的显示信息，联系技术支持人员进行进一步分析。 •如果displaybgppeerlog-info命令的显示信息中，提示的BGP会话Down的原因不属于以上任何一种常见的原因，请收集如下信息，并联系技术支持人员。 displaybgppeerlog-info命令的显示信息。 displaysysteminternalbgplog命令的显示信息。 view/proc/tcp/tcp_logslotx命令的显示信息（所有的单板/成员设备各执行一次）。 设备的配置文件、日志信息、告警信息。 作为参考，BGP会话断开的详细原因及其对应的错误码如表12所示。 表12邻居断开的详细原因列表 差错码/差错子码会话断开的详细原因说明 3/5attribute-typeattributelengtherrorattribute-type类型的属性长度错误，attribute-type取值包括： •AS_PATH •AS4_PATH •CLUSTER_LIST •AGGREGATOR •AS4_AGGREGATOR •ORIGIN •NEXT_HOP •MED •LOCAL_PREF •ATOMIC_AGGREGATE •ORIGINATOR_ID •MP_REACH_NLRI •COMMUNITIES •extendedcommunities attributelengthexceeds属性长度越界 3/6invalidORIGINattributeORIGIN属性无效 3/8invalidNEXT_HOPattribute下一跳属性无效 3/9invalidnexthoplengthinMP_REACH_NLRI(address-family)address-family地址族 MP_REACH_NLRI属性的Nexthop长度错误，address-family的取值包括： •4u：表示IPv4单播地址族 •IPv4Flowspec：表示IPv4Flowspec地址族 •MPLS：表示MPLS地址族 •VPNv4：表示VPNv4地址族 •6u：表示IPv6单播地址族 •VPNv6：表示VPNv6地址族 •L2VPN：表示L2VPN地址族 thelengthofMP_UNREACH_NLRIistoosmallMP_UNREACH_NLRI的长度小于3字节 theMPNLRIattributelengthexceedsMP_REACH_NLRI或 MP_UNREACH_NLRI属性长度越界 erroneousMPNLRIattributeendposition可达或不可达前缀结束位置与报文属性结束位置不同 3/10invalidnetworkfield网络字段无效 3/11malformedAS_PATHAS路径形式不对 4/0Keepalivelasttriggeredtime最后一次触发发送Keepalive消息时间 Keepalivelastsenttime最后一次发送Keepalive消息时间 差错码/差错子码会话断开的详细原因说明 Updatelastsenttime最后一次发送Update消息时间 EPOLLOUTlastoccurredtime最后一次发生EPOLLOUT时间 Keepalivelastreceivedtime最后一次接收Keepalive消息时间 Updatelastreceivedtime最后一次接收Update消息时间 EPOLLINlastoccurredtime最后一次发生EPOLLIN时间 5/0connectionretrytimerexpiresConnectRetry定时器超时 TCP_CR_Ackedeventreceived收到了TCP_CR_Acked事件 TCP_Connection_Confirmedeventreceived收到了TCP_Connection_Confirmed事件 5/3openmessagereceived收到open消息 6/0manualstopeventreceived收到manualstop事件 physicalinterfaceconfigurationchanged物理配置改变，比如接口变化 sessiondowneventreceivedfromBFD收到BFD会话down事件 6/1maximumnumberofprefixesreached前缀数超过peerroute-limit所配置的数目 maximumnumberofaddress-familyprefixesreachedaddress-family地址族的前缀数超过peerroute-limit所配置的数目，address-family的取值包括：•IPv4unicast：表示IPv4单播地址族 •IPv6unicast：表示IPv6单播地址族 •VPNv4：表示VPNv4地址族 •VPNv6：表示VPNv6地址族 6/2configurationofpeerignorechanged配置peerignore命令 6/3addressfamilydeleted地址族被删除 peerdisabled关闭对等体 6/4administrativereset执行resetbgp命令或者配置改变导致 BGP会话重启 6/5connectionrejected连接被拒绝 6/6otherconfigurationchange其他配置变化 6/7connectioncollisionresolution连接冲突 twoconnectionsexistandMD5authenticationisconfiguredfortheneighbor存在两个连接，且其中一个配置了MD5认证 5.告警与日志 相关告警无 相关日志 •BGP/5/BGP_STATE_CHANGED •BGP/5/BGP_STATE_CHANGED_REASON •BGP/6/BGP_PEER_STATE_CHG 10.1.3跨AS域的数据中心互联场景BGP路由环路 ,Suggestion not provided
在设备上每隔60秒执行displaypacket-drop命令查看指定接口丢弃的报文的信息，观察到 “PacketsdroppedduetofullGBPorinsufficientbandwidth”取值不断增长。 <Sysname>displaypacket-dropinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1: PacketsdroppedduetofullGBPorinsufficientbandwidth:301 PacketsdroppedduetoFastFilterProcessor(FFP):261 PacketsdroppedduetoSTPnon-forwardingstate:321 Packetsdroppedduetorate-limit:143 Packetsdroppedduetobroadcast-suppression:301 Packetsdroppedduetounicast-suppression:215 Packetsdroppedduetomulticast-suppression:241PacketsdroppedduetoTxpacketaging:246 基于以上现象判断设备的接口上可能产生拥塞丢包故障。 ,"本类故障的常见原因主要包括： •接口数据缓冲区设置不足，数据缓冲区占满后报文被丢弃。 •接收到的报文速率超过接口的处理带宽。 3.故障诊断流程本类故障的诊断流程如图125所示。图125拥塞丢包故障诊断流程图 4.故障处理步骤 (1)检查接收数据缓冲区是否存在不足。对于不支持配置数据缓冲区的产品，请跳过该步骤执行下一步。在设备上接口视图或系统视图下执行flow-interval命令修改接口统计报文信息的时间间隔为30秒，然后每隔60秒执行一次displayinterface命令查看指定接口的相关信息中ignored字段，ignored字段表示接收缓冲区不足而产生丢包的数量。 <Sysname>displayinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1 … Input(total):0packets,0bytes 0unicasts,0broadcasts,0multicasts,-pauses Input(normal):0packets,0bytes 0unicasts,0broadcasts,0multicasts,0pauses Input:0inputerrors,0runts,0giants,0throttles 0CRC,0frame,2048overruns,-aborts 1024ignored,-parityerrors Output(total):0packets,0bytes 0unicasts,0broadcasts,0multicasts,-pauses Output(normal):0packets,0bytes 0unicasts,0broadcasts,0multicasts,0pauses Output:0outputerrors,-underruns,-bufferfailures 0aborts,0deferred,0collisions,0latecollisions -lostcarrier,-nocarrier … 如果该显示信息不断增长，则表示接收数据缓冲区不足，产生了拥塞丢包。这种情况下，请执行burst-modeenable命令用来开启数据缓冲区自动分配功能，开启本功能后可以在一定 displayinterface一段时间后，再次执行(程度上提高报文缓存功能，降低报文丢包率。)命令或displaypacket-drop命令查看指定接口丢弃的报文的信息，如果问题仍未解决，则请继续执行以下操作。 (2)检测发送端接口是否流量过大然后每隔60秒执行一次displayinterface命令查看指定接口的相关信息中overruns字段，如果overruns字段标识的数字不断增长，则表示接口的接收速率超出接口队列处理能力。可以开启设备接口下队列的拥塞通知功能，使得设备不再丢弃拥塞报文，并使用拥塞通知机制通知报文发送端降低发包速率，从而达到降速减少丢包的目的。需要注意的是，该措施需要报文发送端和接收端均支持拥塞通知机制才能实现（对于不支持拥塞通知的产品，请跳过该步骤执行下一步）。 令创建WRED表，在WRED表视图下执行queueecn命令用来开启指定队列的拥塞通知功能，并执行qoswredapply命令将WRED表应用到接口下。 [Sysname]qoswredqueuetableaaa [Sysname-wred-table-aaa]queue2ecn [Sysname-wred-table-aaa]quit [Sysname-GigabitEthernet1/0/1]qoswredapplyaaa 部分设备，可在接口视图下执行qoswredqueueecn命令开启指定队列的拥塞通知功能。 部分设备，可在系统视图下执行qoswredecnenable命令用来开启全局拥塞通知功开启队列(能。)的拥塞通知功能一段时间后，再次执行displayinterface命令或displaypacket-drop命令查看指定接口丢弃的报文的信息，如果问题仍未解决，则请继续执行以下操作。 (3)QoS拥塞避免的目的仅仅是在现网条件下降低拥塞发生的概率，要从根本上解决拥塞丢包故障需要优化网络，提升链路带宽，合理规划网络流量。例如，采用以太网链路聚合将多条物理链路捆绑在一起形成一条聚合链路来提升链路带宽；合理规划ECMP等价路由，将流量合理分担到不同链路上。如果优化网络后问题仍未解决，则请继续执行以下操作。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员 上述步骤的执行结果。 设备的配置文件。 5.告警与日志相关告警无 相关日志 无 17IP隧道及安全VPN类故障处理 17.1IP隧道故障处理 17.1.1点对点类隧道无法Ping通对端Tunnel接口IP地址 ",Suggestion not provided
在设备上执行displaybfdsession命令，查看不到会话信息，或者显示信息中“State”值不是“Up”，即BFD会话无法Up,本类故障的常见原因主要包括： •路由表中不存在BFD会话目的地址的路由。 •BFD检测的链路存在故障，导致BFD报文无法正常交互。 3.故障分析 本类故障的诊断流程如图166所示。 图166BFD会话无法建立的故障诊断流程图 4.处理步骤 BFD在两台网络设备上建立会话，用来检测网络设备间的双向转发路径，为上层应用服务。BFD本身并没有发现机制，而是靠被服务的上层协议通知来建立会话。上层协议在建立新的邻居关系后，将邻居的参数及检测参数（包括目的地址和源地址等）通告给BFD；BFD根据收到的参数建立BFD会话。会话建立后会周期性地快速发送BFD报文，如果在检测时间内没有收到BFD报文，则认为该双向转发路径发生了故障，并将故障信息通知给该会话所服务的上层应用，由上层应用采取相应的措施。因此，在排除BFD会话无法建立的故障前，请保证上层协议工作正常，否则无法准确定位BFD会话故障原因。 (1)使用displaybfdsession命令查看是否存在BFD会话信息。 如果不存在BFD会话信息，请执行步骤(2)和步骤(3)。 如果存在BFD会话信息，但“State”显示为“Down”，请执行步骤(4)。(2)检查是否存在上层协议联动BFD的配置。 执行displaycurrent-configuration命令查看是否存在上层协议联动BFD的配置。 例如，OSPF联动BFD的配置如下所示： interfaceGigabitEthernet1/0/1ospfbfdenable 如果存在上层协议联动BFD的配置，则执行步骤(3)。 如果不存在上层协议联动BFD的配置，请配置上层协议联动BFD的命令，并确保配置正确。(3)检查BFD会话的数量是否超过了设备的BFD会话规格。 执行displaybfdsession命令，查看“Totalsessions”的取值。如果“Totalsessions” 的取值已达到设备规格，则无法创建新的BFD会话。可通过取消上层协议联动BFD的配置删除一些不必要的BFD会话解决此问题。如果BFD会话的数量未超规格，请执行步骤(4)。 (4)检查BFD路由、隧道信息是否正常。 使用BFD检测IP路径的连通性时，请执行如下步骤检查路由信息。 a.请执行displaybfdsession命令，查看“DestAddr”对应的IPv4地址或IPv6地址。 b.请执行displayiprouting-table命令或displayipv6routing-table命令，查看是否存在目的地为“DestAddr”的路由信息。 c.如果不存在路由信息，请参考“三层技术-IP路由类故障处理”，排除路由故障。如果存在路由信息，但BFD会话无法Up，请执行步骤(5)。 使用BFD检测LSP、PW、VXLAN隧道、MPLSTE隧道、SRLSP、SRv6TEPolicy时，请参考各模块的故障处理手册，检查隧道状态是否正常。如果隧道状态不正常，请排除隧道故障。 如果隧道状态正常，但BFD会话无法UP，请执行步骤(5)。 (5)检查BFD发包是否正常。反复执行displaybfdsessionverbose命令，查看“Txcount”取值的变化。“Tx count”字段表示发送的报文数，如果该字段的取值一直为0，说明BFD发包不正常。请执行如下步骤检查BFD发包情况。 a.请执行displaycurrent-configurationconfiguration bfd-static-session命令检查静态BFD会话监视的接口。例如，如下显示信息中track-interface后面的接口即为静态BFD会话监视的接口。 <Sysname>displaycurrent-configurationconfigurationbfd-static-session # bfdstaticchrispeer-ipv61::2source-ipv61::1discriminatorlocal1000remote1010track-interfaceGigabitEthernet1/0/2# b.请执行displayinterfaceinterface-typeinterface-number命令查看接口的运行状态。如果“Current”或“Lineprotocolstate”字段的取值不是UP，请排除接口故 c.displaybfdsession命令，查看“请执行I(障。如果接口的运行状态正常，请执行步骤c。)nitmode”的取值。“Initmode”字段表示BFD的运行模式，当“Initmode”取值为“Passive”时，表示BFD运行模式为被动模式；当“Initmode”取值为“Active”时，表示BFD运行模式为主动模式。对于工作在被动（Passive）模式的节点，只有收到工作在主动（Active）模式的节点发送过来的BFD控制报文后，才会发送BFD报文。 如果工作在主动（Active）模式的节点的“Txcount”字段取值一直在增长，说明该节点可以正常发送BFD报文。这种情况下，请执行步骤(6)，检查工作在被动（Passive）模式的节点能否正常收到BFD报文。 d.上述情况外的其他情况导致的BFD发包不正常，请执行步骤(8)。 (6)检查BFD收包是否正常。 在BFD会话的一端反复执行displaybfdsessionverbose命令，查看“Rxcount” 字段的取值，即查看接收的报文数。 “Rxcount”计数一直为0，请检查BFD会话对端发包是否正常。如果BFD会话对端发 BFD如果会话对端发包正常，请在(包不正常，请排除对端发包故障。)本端执行displaysysteminternalbfdpacket statistics命令查看“Thedetaileddiscardedpacketstatistics”中是否存在丢包数据。如果存在丢包，请根据具体的丢包原因排除故障。如果无法排除故障或不存在丢包，请执行步骤(8)。 “Rxcount”计数有增加，且BFD会话状态能够变为Init，说明本端能够收到BFD报文。此时，请在BFD会话的对端反复执行displaybfdsessionverbose命令，查看“Rx count”字段的取值。 −BFD会话对端的“Rxcount”计数一直为0，但本端发包正常，说明BFD会话的另一端收包不正常，这种情况会导致BFD会话的对端一直发送状态为Down的BFD控制报 文，导致本端BFD会话无法Up。请在BFD会话对端执行displaysystem internalbfdpacketstatistics命令查看“Thedetaileddiscardedpacketstatistics”中是否存在丢包数据。如果存在丢包，请根据具体的丢包原因排除故障。如果无法排除故障或不存在丢包，请执行步骤(8)。 −对于本端发包不正常导致BFD会话对端的“Rxcount”计数一直为0的情况，请排除本端发包故障。 对于两端发包正常，但一端无法收到报文的情况，请执行步骤(7)。 (7)检查转发是否正常。 使用ping工具检查BFD会话之间的链路是否能够正常转发报文。对于不同的链路类型，需要使用不同的ping工具，具体如表18所示。 表18不同的链路类型使用的ping工具 链路类型Ping工具 LSP隧道MPLSPing工具。即执行pingmplsipv4命令检测LSP隧道的连通性 MPLSTE隧道MPLSPing工具。即执行pingmplste命令检测MPLSTE隧道的连通性 PWMPLSPing工具。即执行pingmplspw命令检测PW隧道的连通性 SRv6TEPolicy转发路径的连通性SRv6TEPolicyPing工具。即执行pingsrv6-tepolicy命令检测SRv6 如果ping不通，请参见“Ping和Tracert—Ping不通”故障手册、“MPLS类”故障处理手册和“SegmentRouting类故障处理”排除隧道故障。 如果能ping通，请执行步骤(8)。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 20.1.2BFD会话震荡 ,Suggestion not provided
在图49的网络中，DeviceA和DeviceB组成M-LAG系统，配置完成后，通过命令displaym-lagsummary发现M-LAG接口无法UP。 图49M-LAG接口无法UP组网图 ,"本类故障的常见原因主要包括： •peer-link口为聚合接口，聚合接口无法UP。 •peer-link口为Tunnel接口，Tunnel接口无法UP。 •M-LAG系统配置不符合要求。 3.故障分析 本类故障的诊断思路如下： (1)确认peer-link接口的状态。 (2)确认M-LAG系统配置是否符合配置要求。本类故障的诊断流程如图48所示。 图48peer-link无法UP的故障诊断流程图 4.处理步骤 (1)查看peer-link接口的DOWN原因。在DeviceA上执行displaym-lagsummary命令，根据字段Peer-linkinterfacestate(cause)查看peer-link接口DOWN的原因： 如果cause显示为Aggregateinterfacedown或Tunnelinterfacedown，则表示配置为peer-link接口的聚合接口或Tunnel接口状态为DOWN，请按照聚合接口无法UP或者Tunnel接口无法UP故障处理流程定位。 如果cause显示为NocorrectDRCPDUsreceived，则表示未收到DRCPDU，请执行步骤（2）。 (2)M-LAG系统配置是否符合配置要求。M-LAG系统配置的要求为组成M-LAG系统的设备上，系统优先级和系统MAC地址必须相同，系统编号不能相同。在DeviceA或DeviceB上执行displaym-lagsystem命令，查看系统编号、系统MAC地址和系统优先级配置是否符合配置要求： <Sysname>displaym-lagsystem Systeminformation Localsystemnumber:1Peersystemnumber:2 LocalsystemMAC:0001-0001-0001PeersystemMAC:0001-0001-0001 Localsystempriority:123Peersystempriority:123 LocalbridgeMAC:3cd4-3ce1-0200PeerbridgeMAC:3cd4-437d-0300 Localeffectiverole:PrimaryPeereffectiverole:Secondary Healthlevel:0 Standalonemodeonsplit:EnabledInstandalonemode:Yes Systemtimerinformation TimerStateValue(s)Remainingtime(s) AutorecoveryDisabled--RestoredelayDisabled30-Consistency-checkdelayDisabled15-StandalonedelayDisabled-- RoletoNonedelayDisabled60- 如果M-LAG系统配置不符合配置要求，则在系统视图下执行m-lagsystem-mac、 m-lagsystem-number或m-lagsystem-priority命令，使DeviceA和DeviceB上的M-LAG系统配置满足配置要求。 如果M-LAG系统配置符合要求，则执行步骤（3）。 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 8.1.2M-LAG接口无法UP 本类故障的常见原因主要包括： •配置为M-LAG接口的聚合接口状态为DOWN。 •对端设备未配置相同M-LAG组ID的M-LAG接口。 •配置一致性检查不通过。 3.故障分析 本类故障的诊断思路如下： (1)确认配置为M-LAG接口的聚合接口状态。 (2)确认对端设备是否配置了相同M-LAG组ID的M-LAG接口。 (3)配置一致性检查是否通过。 本类故障的诊断流程如图50所示。 图50M-LAG接口无法UP的故障诊断流程图 4.处理步骤(1)查看M-LAG接口DOWN的原因。 在DeviceA上执行displaym-lagsummary命令，根据Localstate(cause)字段查看 M-LAG接口DOWN的原因： 如果cause显示为A，则表示M-LAG接口对应的聚合接口状态变为DOWN，请按照聚合接口无法UP故障处理流程定位。 如果cause显示为B，则表示对端不存在对应M-LAG接口，请执行步骤（2）。 如果cause显示为C，则表示配置一致性检查失败，请执行步骤（3）。 (2)检查M-LAG系统的两台设备上M-LAG接口的M-LAG组ID是否相同。 在DeviceA和DeviceB上执行displaym-lagsummary命令，查看M-LAGgroup字段，判断组成M-LAG系统的两台设备上M-LAG接口的M-LAG组ID是否相同： <DeviceA>displaym-lagsummary Flags:A--Aggregateinterfacedown,B--NopeerM-LAGinterfaceconfiguredC--Configurationconsistencycheckfailed Peer-linkinterface:BAGG3 Peer-linkinterfacestate(cause):UPKeepalivelinkstate(cause):UP M-LAGinterfaceinformation M-LAGIFM-LAGgroupLocalstate(cause)PeerstateRemainingdowntime(s)BAGG44UPUP- 如果两台设备上M-LAG接口的M-LAG组ID不同，则在其中一台设备的聚合接口视图下执行portm-laggroup命令，使得M-LAG接口的M-LAG组ID保持一致。 如果两台设备上M-LAG接口的M-LAG组ID相同，则执行步骤（3）。(3)配置一致性检查是否通过。 在DeviceA上执行displaym-lagconsistency命令，分别查看Type1和Type2的配置一致性信息，包括全局和M-LAG接口的配置一致性信息。M-LAG系统两端设备上的Type1类型配置必须一致，Type2类型配置建议一致。 #显示全局的Type1类型的配置一致性信息。 <Sysname>displaym-lagconsistencytype1global ConfigurationLocalPeer LinktypeAccessTrunk PVID1020 GlobalSTPEnabledDisabledSTPmodeMSTPRSTP… #显示全局的Type2类型的配置一致性信息。 <Sysname>displaym-lagconsistencytype2global ConfigurationLocalPeer VLANs1,3,5,7,92,4,6,8,10 Vlan-int10,12,14,17,22,3311,19,23,27,47 Vlan-int(shutdown)100,103,107,200,301200,261,290,333,465… #显示二层聚合接口1的Type1类型的配置一致性信息。 <Sysname>displaym-lagconsistencytype1interfacebridge-aggregation1ConfigurationLocalPeer LAGGmodeStaticDynamic LinktypeAccessTrunk PVID1020 #显示二层聚合接口1的Type2类型的配置一致性信息。 <Sysname>displaym-lagconsistencytype2interfacebridge-aggregation1 ConfigurationLocalPeer VLANs1,3,5,7,92,4,6,8,10 LACPselectspeedEnabledDisabledLAGGignorespeedEnabledDisabled RootguardEnabledDisabled… 如果Local和Peer的Type1类型的配置一致性信息中存在不匹配的信息，则请修改相关业务模块的配置，使Local和Peer的Type1类型配置匹配。 如果Local和Peer的Type1类型的配置一致性信息匹配，则执行步骤（4）。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 8.1.3Keepalive无法UP ",Suggestion not provided
在图51的网络中，DeviceA和DeviceB组成M-LAG系统，通过命令displaym-lagsummary命令发现Keepalive链路无法UP。 图51Keepalive无法UP组网图 ,本类故障的常见原因主要包括： •M-LAG系统未建立。 •接口上未配置Keepalive链路对应的IP地址。 •M-LAG设备间三层网络不通。 3.故障分析 本类故障的诊断思路如下： (1)确认M-LAG系统处于初始化状态时peer-link口是否UP。 (2)检查是否配置了Keepalive链路的IP地址。 (3)检查Keepalive链路的源IP地址和目的IP地址能否ping通。本类故障的诊断流程如图52所示。 图52Keepalive无法UP的故障诊断流程图 4.处理步骤(1)查看Keepalive链路DOWN原因。 在DeviceA上执行displaym-lagsummary命令，根据Keepalivelinkstate(cause)字 段查看Keepalive链路DOWN的原因： 如果cause显示为M-LAGsysteminit，则表示M-LAG系统初始化，请执行步骤（2）。 如果cause显示为LocalIPnotconfigured，则表示本端未配置IP地址，请执行步骤（3）。 如果cause显示为LocalTxfailed、LocalRxtimeout或PeerRxtimeout，则表示本端发送报文失败、本端接收报文超时或对端接收报文超时，请执行步骤（4）。 (2)检查M-LAG系统处于初始化状态时peer-link接口是否UP。执行displayinterface命令查看peer-link接口是否处于UP状态： 如果peer-link接口未处于UP状态，请按照peer-link接口无法UP故障处理流程定位。 如果peer-link接口处于UP状态，则执行步骤（3）。 (3)检查Keepalive链路的IP地址是否为本地接口地址。 在DeviceA和DeviceB上执行displaym-lagkeepalive命令，查看SourceIPaddress字段，即Keepalive链路的源IP地址，执行displayipinterfacebrief或displayipv6interfacebrief命令查看该地址是否为设备的接口地址。 <Sysname>displaym-lagkeepalive Neighborkeepalivelinkstatus(cause):UpNeighborisalivefor:135642s501ms Keepalivepackettransmissionstatus: Sent:Successful Received:Successful Lastreceivedkeepalivepacketinformation: SourceIPaddress:10.0.0.2 Time:2019/09/1109:21:51 Action:Accept M-LAGkeepaliveparameters: DestinationIPaddress:10.0.0.2 SourceIPaddress:10.0.0.1 KeepaliveUDPport:6400KeepaliveVPNname:vpn1 Keepaliveinterval:1000msKeepalivetimeout:5sec Keepaliveholdtime:3sec 如果未将Keepalive链路的源IP地址配置为本地接口地址，则在DeviceA和DeviceB直连链路的接口视图下执行ipaddress或ipv6address命令配置源IP地址。 如果已配置Keepalive链路的源IP地址，则执行步骤（4）。 (4)检查Keepalive链路的源IP地址和目的IP地址能否ping通。 在DeviceA上执行ping命令，检查Keepalive链路的目的IP地址是否可达：如果不能ping通，则按照Ping和Tracert故障处理流程，解决网络不可达问题。 如果能ping通，则执行步骤（5）。 (5)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警 无 相关日志无 8.2以太网链路聚合故障处理 8.2.1聚合接口无法UP ,Suggestion not provided
在图69所示的网络中，Spine设备与Leaf设备处在不同的AS域中。Spine设备之间建立全互联的BGP连接，Spine1和Spine2与Leaf建立EBGP连接。Spine2开启了负载分担功能，并且可以在EBGP和IBGP路由之间进行负载分担。Spine1重启时，经过Spine2到Leaf的流量有一半丢失。图69Spine和Leaf设备跨AS连接场景组网图 ,"在Spine1重启前，Spine2的BGP路由表与下表类似： <Spine2>displaybgprouting-tableipv4 Totalnumberofroutes:3 BGPlocalrouterIDis2.2.2.2 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala-additional-path Origin:i-IGP,e-EGP,?-incomplete NetworkNextHopMEDLocPrfPrefValPath/Ogn*>i0.0.0.0/024.1.1.41000i *>e100.1.1.0/2423.1.1.30020i *i1.1.1.10100020i Leaf2分别从Leaf1（23.1.1.3）和Spine1（1.1.1.1）接收到100.1.1.0/24网段路由，从Spine1接收到的100.1.1.0/24网段路由的下一跳为Spine1的Loopback接口地址。Spine2的IP路由表与下表类似： <Spine2>displayiprouting-table Destinations:24Routes:25 Destination/MaskProtoPreCostNextHopInterface 0.0.0.0/0BGP255024.1.1.4GE1/0/1 0.0.0.0/32Direct00127.0.0.1InLoop0 ",Suggestion not provided
在图98的网络中，配置MPLSL3VPN业务，CE1与CE3属于VPN1，CE2属于VPN2。由于业务的需求，在VPN1和VPN2上配置了相同的RouteTarget，以实现不同VPN间互通。 配置完成后，发现CE1可以Ping通相同VPN的CE3（IP地址为3.3.3.3），但CE2无法Ping通不同VPN的3.3.3.3。 图98MPLSL3VPN组网图 ,"本场景中，CE1可以Ping通相同VPN的CE3，说明MPLS骨干网中进行标签转发的公网隧道正常，本类故障的常见原因仅包括：PE设备上不同的VPN实例绑定的IP地址存在冲突。 3.故障分析 本类故障的诊断流程如图99所示。图99配置相同RT的不同VPN之间不能互通的故障诊断流程图 4.处理步骤 (1)检查PE的接口IP是否存在冲突。 在PE1上执行displayipinterfacebrief命令查看接口的IP地址，例如： <Sysname>displayipinterfacebrief *down:administrativelydown (s):spoofing(l):loopback InterfacePhysicalProtocolIPAddress/MaskVPNinstanceDescription... GE1/0/1upup10.1.1.1/24vpn1-- GE1/0/2upup10.1.1.1/24vpn2--...如果不同VPN实例的接口IP地址不相同，请执行步骤（2）。如果不同VPN实例的接口IP相同，则修改其中一个VPN实例中PE上的接口以及与其相连的CE上的接口的IP地址，并重新配置PE设备与CE设备间的路由交换。由于BGP会将RT匹配的路由在VPN实例间进行互引，为不同VPN的接口设置相同IP地址 时，同一目的地址的路由在BGP路由表中将会出现两条，而BGP只会优选其中一条，例如： <Sysname>displaybgprouting-tablevpnv4 BGPlocalrouterIDis11.11.11.11 Statuscodes:*-valid,>-best,d-dampened,h-history,s-suppressed,S-stale,i-internal,e-externala-additional-path Origin:i-IGP,e-EGP,?-incomplete TotalnumberofVPNroutes:11 TotalnumberofroutesfromallPEs:2 Routedistinguisher:1:1(vpn1) Totalnumberofroutes:6 NetworkNextHopMEDLocPrfPrefValPath/Ogn *>e1.1.1.1/3210.1.1.20020i *>e2.2.2.2/3210.1.1.20030i *>i3.3.3.3/3222.22.22.220100040i*>e10.1.1.0/2410.1.1.20020?*>i30.1.1.0/2422.22.22.220100040? Routedistinguisher:2:2(vpn2) Totalnumberofroutes:5 NetworkNextHopMEDLocPrfPrefValPath/Ogn *>e1.1.1.1/3210.1.1.20020i *>e2.2.2.2/3210.1.1.20030i *>i3.3.3.3/3222.22.22.220100040i*>e10.1.1.0/2410.1.1.20020? *e10.1.1.20030?*>i30.1.1.0/2422.22.22.220100040? 如上所示，在RD为2:2的VPN实例（即VPN2）BGP路由表中，优选的10.1.1.0网段的路由来自VPN1（根据AS_PATH属性判断），VPN2发布的路由未被优选，所以从VPN1去往VPN2的流量不会被PE1从GigabitEthernet1/0/2接口发送给VPN2，而是从GigabitEthernet1/0/1接口发送给VPN1，导致跨VPN通信失败。 所以，将关联了VPN实例的接口以及与其相连的CE上的接口修改为不同的IP地址，可以解决这类问题。以PE-CE间通过EBGP会话交互路由为例，PE1的处理步骤如下：a.在系统视图下，执行interface命令进入关联了VPN实例的接口视图。 b.执行ipaddress命令修改接口的IP地址。 c.在系统视图下，执行bgp命令进入BGP实例视图。 d.执行ipvpn-instance命令进入BGP-VPN实例视图。 e.执行undopeer命令删除用原冲突IP地址建立的BGP对等体。 f.执行peeras-number命令，指定使用新IP地址的CE设备为EBGP对等体。 g.执行address-familyipv4unicast命令，进入BGPIPv4单播地址族视图。 h.执行peerenable命令，使能与CE设备交互BGPIPv4单播路由信息的能力。 假设仅修改了VPN2的IP地址，则CE2的处理步骤如下： a.在系统视图下，执行interface命令进入与PE1直连的接口视图。 b.执行ipaddress命令修改接口的IP地址。 c.在系统视图下，执行bgp命令进入BGP实例视图。 d.执行undopeer命令删除用原冲突IP地址建立的BGP对等体。 e.执行peeras-number命令，指定使用新IP地址的PE设备为EBGP对等体。 f.执行address-familyipv4unicast命令，进入BGPIPv4单播地址族视图。 g.执行peerenable命令，使能与PE设备交互BGPIPv4单播路由信息的能力。 h.执行import-route命令或network命令，发布VPN实例的路由信息。 如果故障仍然未能排除，请执行步骤（2）。 (2)请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警无 相关日志无 12.3.5路由反射器进行VPN-Target过滤导致PE无法学习到路由 ",Suggestion not provided
在源端执行Ping操作，在一定时间范围内没有收到目的端对该请求的回应,"存在三种故障情形： •源端没有发出请求报文。 •目的端没有发出应答报文。 •中间设备丢包或传输时间长。 本类故障的常见原因主要包括： •链路传输时延较长。由于传输时延长，虽然源端接收到了目的端的回应报文，但已经超过等待时限而造成Ping不通的现象。 •配置不当。例如，当Ping报文过大时，报文的出接口MTU值较小，且设置了不可分片的功能等。 •FIB表或ARP表中缺少对应的表项。 •存在防攻击配置。 •硬件故障。 3.故障分析 本类故障的诊断思路如下： (1)检查Ping操作是否得当，调整Ping操作参数。 (2)查看Ping报文的统计信息，确认出问题的节点。 (3)检查是否存在到达目的端的ARP以及FIB表项。 (4)排查是否因为防攻击配置导致Ping报文被丢弃。 本类故障的诊断流程如图4-12所示。 图4-12Ping不通故障诊断流程图 4.处理步骤 (1)检查Ping操作是否得当。 a.检查是否因为实际链路传输时延较长导致Ping不通。检查是否执行了ping-ttimeout命令，如果执行了此操作，可通过增加-t参数的值（建议取值大于等于1000，达到秒级）或者去掉-t参数重新Ping。如果故障消除，则说明较大概率属于实际网络时延大导致的Ping不通；如果故障未消除，请继续定位。 -t参数用来指定ICMP回显应答（ECHO-REPLY）报文的超时时间，单位为毫秒，缺省值为2000。如果源端在timeout时间内未收到目的端的ICMP回显应答（ECHO-REPLY）报文，则会认为目的端不可达。 b.检查是否因为Ping报文过大而被丢弃。 检查是否执行了ping-f–spacket-size命令，如果执行了此操作，且报文转发路径上存在出接口的MTU小于报文长度packet-size的情况，则会导致报文因为超大且不允许被分片而被丢弃。可以通过减小报文长度或者取消-f参数来解决这个问题。 •-f参数表示将长度大于出接口MTU的报文直接丢弃，即不允许对发送的ICMP回显请求报文进行分片。 •-spacket-size参数用来指定发送的ICMP回显请求报文的长度（不包括IP和 ICMP报文头），单位为字节，缺省值为56。 以太网接口MTU的缺省值为1500字节，可以通过执行displayinterface命令来查 看接口的MTU值： <Sysname>displayinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1 Currentstate:UP Lineprotocolstate:UP Description:GigabitEthernet1/0/1Interface Bandwidth:1000000kbps Maximumtransmissionunit:1500 其它显示信息略…… c.检查是否指定了错误的出接口。 检查是否执行了ping-iinterface-typeinterface-number命令指定Ping报文的出接口。如果指定了出接口，请确保该接口和目的端之间的物理链路是否可达。否则，请换成其它接口或者去掉-i参数。 -iinterface-typeinterface-number参数用来指定发送ICMP回显请求报文的接口的类型和编号。不指定该参数时，将根据目的IP查找路由表或者转发表来确定发送 ICMP回显请求报文的接口。 d.检查是否指定了源地址。 检查是否执行了ping–asource-ip命令指定Ping报文的源地址。如果执行了该命令，请确保中间设备和目的端有到达源地址source-ip的路由。 -asource-ip：指定ICMP回显请求（ECHO-REQUEST）报文的源IP地址。该地址必须是设备上已配置的IP地址。不指定该参数时，ICMP回显请求报文的源IP地址是该报文出接口的主IP地址。 e.检查是否为目的端指定了准确的VPN。根据网络规划和部署情况，确认目的端是否属于某个VPN。如果目的端属于某个VPN，则需要在执行ping命令时通过-vpn-instance参数指定目的端所属的VPN。 (2)查看源端、目的端以及中间设备的收发包统计，确认Ping故障发生的方向。 检查源端是否发出了ICMP回显请求报文，并收到了ICMP回显应答报文。源端执行Ping操作后，在源端和目的端分别使用displayicmpstatistics命令查看ICMP报文收发情况。可以根据统计信息中Input和Output区段报文的数量来确定Ping出现问题的方向： −如果源端Output区段的echo值正常增加，但Input区段的echoreplies值没有增加，则说明源端发出了请求但是没有收到回应；与此同时，如果目的端Input区段和Output区段的计数都没有变化，则说明目的端没有收到请求也没有给予回应。这样，就可以确定Ping报文是在从源端到目的端的方向上出现了转发故障。 −如果源端Output区段的echo值正常增加，但Input区段的echoreplies值没有增加，则说明源端发出了请求但是没有收到回应；与此同时，如果目的端Input区段和Output区段的计数都正常增加，则说明目的端收到了请求，同时发出了回应。这样，就可以确定Ping报文是在从目的端到源端的方向上出现了转发故障。displayicmpstatistics命令显示信息示例如下： <Sysname>displayicmpstatistics Input:badformats0badchecksum0echo1destinationunreachable0sourcequench0redirects0echoreplies0parameterproblem0timestamp0informationrequests0maskrequests0maskreplies0timeexceeded0invalidtype0routeradvert0routersolicit0broadcast/multicastechorequestsignored0broadcast/multicasttimestamprequestsignored0Output:echo0destinationunreachable0sourcequench0redirects0echoreplies1parameterproblem0timestamp0informationreplies0maskrequests0maskreplies0timeexceeded0badaddress0packeterror0routeradvert0其它显示信息略…… 当目的端是框式设备或者IRF设备，但ICMP报文到达目的端前被分片了，请在目的端执行displayicmpstatistics命令来查看ICMP报文统计信息即可。 (3)确定出问题的节点。 确定了Ping故障的发生的方向后，请执行tracert命令确定该方向上报文丢失的位置。 如果源端到目的端方向出现了问题，请从源端开始排查。 如果目的端到源端方向出现问题，请从目的端开始排查。如下例所示，可以通过tracert命令查看报文从源端到目的端（IP地址为1.1.3.2，属于vpn1）所经过的路径，并显示报文经过的私网中的三层设备的信息。 <Sysname>tracert–vpn-instancevpn1–resolve-asvpn1.1.3.2 tracerouteto1.1.3.2(1.1.3.2),30hopsatmost,40byteseachpacket,pressCTRL+Ctobreak 11.1.1.2(1.1.1.2)673ms425ms30ms 21.1.2.2(1.1.2.2)580ms470ms80ms 3*** 由以上信息可判断，Ping报文在1.1.2.2的下一跳设备上（即显示为“3***”的节点）出现转发故障。 (4)检查是否存在到达目的端和源端的FIB表项与ARP表项。 请在问题节点上执行以下操作： 执行displayfib命令检查是否存在到达目的端和源端的路由。如果路由不存在，请检查OSPF、IS-IS、BGP等路由协议配置是否有误。 如果路由存在并且报文所经链路是以太链路，请执行displayarp命令查看是否存在所需的ARP表项。如果ARP表项不存在，请首先排查ARP故障。 (5)检查问题节点上是否配置ICMP防攻击功能。 如果设备上配置了ICMP攻击相关的防范策略，且设备检测到ICMP攻击，设备会将ICMP报 icmp-floodstatisticsip命令查看统计信息 通过displaycurrent-co(的计数来判断设备是否受到了)nfiguratio(ICMP攻击。)n|includeicmp-flood、displaycurrent-configuration|include“signaturedetect”查看当前是否配置攻击防范策略。 如果设备受到了ICMP攻击，请先定位并解除ICMP攻击。 (6)根据收发包统计，确认丢包位置和丢包原因。 在Ping报文途径的设备上： a.配置QoS策略，使用ACL源地址和目的地址过滤Ping报文，然后在Ping报文途径接口 b.通过displayqospolicyinte(的入方向和出方向应用QoS策略。)rface命令查看应用QoS策略的接口上QoS策略匹 配成功的报文个数。如果报文个数有增长，则说明设备收到了Ping报文；如果报文个数无增长，则说明设备没有收到Ping报文，此时，可以使用debuggingippacket命令打 开IP报文调试信息开关，进一步排查设备没有收到Ping报文的原因并解决问题。 (7)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 4.8.2Tracert不通 ",Suggestion not provided
支持EPON单板的机型，EPON单板的OLT端口下挂ONU设备，ONU设备可正确注册。EPON单板热重启或断电重启后OLT端口不up,•光模块未插牢固。 •光模块故障。 ,(1)通过命令displaytransceiverdiagnosisinterface查询OLT端口的光模块诊断信息。命令行中Currentdiagnosticparameters下数据表示光模块当前的温度、电压、偏置电流、接收 光功率、发送光功率，如果这些诊断信息未正常显示，则光模块硬件接触有问题，请重新拔插光模块。 <H3C>displaytransceiverdiagnosisinterfaceOlt2/0/12 Olt2/0/12transceiverdiagnosticinformation: Currentdiagnosticparameters: Temp.(°C)Voltage(V)Bias(mA)RXpower(dBm)TXpower(dBm) -16.50130.05-40.008.13 Alarmthresholds: Temp.(°C)Voltage(V)Bias(mA)RXpower(dBm)TXpower(dBm) HighN/AN/AN/AN/AN/A LowN/AN/AN/AN/AN/A (2)如果反复拔插光模块后，OLT端口仍然不能up，请收集设备的运行信息，并联系H3C的技术支持工程师。 4.告警与日志 相关告警无 相关日志 无 3.6.9OLT端口接收光功率超出阈值 
"支持EPON单板的机型，将光模块插入EPON单板的OLT端口后，设备打印如下日志信息： %Aug1909:53:07:6612016HPOPTMOD/4/MODULE_IN:-MDC=1-Slot=3;Olt3/0/12:Thetransceiveris1000_BASE_LX_SFP. ^Aug1909:53:07:9152016HPDRVMNT/2/ERRORCODE:-MDC=1-Slot=3; MdcId=1-ModuleId=0xf0b-Level=2;ErrCode=1326120980,SYSM:ManuInfoFail. %Aug1909:53:08:1112016HPOPTMOD/3/CFG_ERR:-MDC=1-Slot=3;Olt3/0/12:Transceivertypeandportconfigurationmismatched! %Aug1909:53:08:3442016HPOPTMOD/3/TYPE_ERR:-MDC=1-Slot=3;Olt3/0/12:Transceivertypenotsupported!",插入了OLT端口不支持的光模块。 ,(1)更换光模块。 EPON单板的OLT端口仅支持1000_BASE_PX_SFP类型的光模块；其他类型的光模块插入时，设备提示插入的光模块类型和不支持的原因。 (2)如果故障仍然未能排除，请收集信息，并联系技术支持人员。 4.告警与日志 相关告警无 相关日志 •OPTMOD/4/MODULE_IN •OPTMOD/3/CFG_ERR •OPTMOD/3/TYPE_ERR 3.6.8OLT端口不up 
支持USB口的机型，USB工作不正常,本类故障的常见原因主要包括： •USB设备故障。 •USB口无法识别插入的USB设备。 3.故障分析 本类故障的诊断流程如图6所示：图6USB状态异常故障诊断流程图 4.处理步骤 (1)查看设备USB的信息，检查USB状态是否正常 <Sysname>displaydeviceusbslot1: DeviceName:usbaState:Absent 如果USB状态显示为Absent，则表示设备的USB口未识别插入的USB设备。 (2)尝试更换其他USB设备插入设备USB口 (3)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 3.2电源类故障 3.2.1电源模块状态异常 ,Suggestion not provided
支持接口模块扩展卡的机型，接口模块扩展卡工作不正常,•设备不支持该类型的扩展卡 •扩展卡没有安装牢固 •设备的扩展卡接口故障 3.故障分析 本类故障的诊断流程如图9所示：图9接口模块扩展卡状态异常故障诊断流程图 4.故障处理步骤 (1)检查设备是否支持该扩展卡查看设备配套的安装指导或硬件描述手册，查看设备所支持的扩展卡型号。若不支持，请更换支持的扩展卡型号。 (2)检查扩展卡是否安装牢固若未安装牢固，请拆卸扩展卡后重新安装牢固，并查看设备是否能够获取扩展卡信息。若能够获取，表示扩展状态正常。 <sysname>displaydevicemanuinfoslot1 Subslot1: DEVICE_NAME:LSWM2SP2PB DEVICE_SERIAL_NUMBER:210231A9UFM186A0000R MANUFACTURING_DATE:2018-06-19 VENDOR_NAME:H3C …(略) (3)检查设备扩展卡接口是否故障若设备存在多个扩展卡接口，将该扩展卡插入的其他接口上并查看扩展卡状态是否正常，若正常，表示扩展卡接口故障，请联系H3C技术支持。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志 •SUBCARD_FAULT •SUBCARD_INSERTED •SUBCARD_REBOOT •SUBCARD_REMOVED 3.5单板故障 3.5.1单板状态异常故障 ,Suggestion not provided
"执行displaymplsldppeerpeer-lsr-idverbose命令，查看指定LDP对等体的 DiscoverySources信息： <Sysname>displaymplsldppeer1.1.1.1verbose VPNinstance:publicinstancePeerLDPID:1.1.1.1:0LocalLDPID:2.2.2.2:0 TCPConnection:2.2.2.2:14080->1.1.1.1:646 SessionState:OperationalSessionRole:Active SessionUpTime:0000:00:55(DD:HH:MM) MaxPDULength:4096bytes(Local:4096bytes,Peer:4096bytes) KeepaliveTime:45sec(Local:45sec,Peer:45sec) KeepaliveInterval:15sec MsgsSent/Rcvd:229/228 KASent/Rcvd:223/223 LabelAdvMode:DUGracefulRestart:Off ReconnectTime:0secRecoveryTime:0secLoopDetection:OffPathVectorLimit:0mLDPP2MP:Off DiscoverySources: GigabitEthernet1/0/1 HelloHoldTime:15secHelloInterval:5000ms Addressesreceivedfrompeer: 10.1.1.11.1.1.1 如果DiscoverySources信息的接口信息不包含指定路由的出接口，则检查指定路由的出接口上对应的LDP配置是否正确，及下游设备对应接口的LDP配置是否正确。如果不正确，则修改相应配置；如果正确，则执行步骤(5) 如果DiscoverySources信息的接口信息包含指定路由的出接口，则执行步骤(5)。 (5)检查是否资源不足，如内存不足，LSP数量达到上限的问题。 检查系统内存是否不足执行displaymemory-threshold命令，查看系统内存是否不足。如果存在内存不足，则删除不必要的LSP。 检查标签数量是否超出上限。 执行displaymplssummary命令，查看LDP的标签段剩余标签数量是否为0，即Idle字段显示为0。如果LDP标签段剩余标签数量为0，则表示LDP的标签资源全部使用完，需要删除不必要的LSP。 <Sysname>displaymplssummary MPLSLSRID:2.2.2.2 EgressLabelType:Implicit-nullEntropyLabel:Off Labels: RangeUsed/Idle/TotalOwner 16-20470/2032/2032StaticPW Static StaticCR StaticSRAdj BSID 2048-5999999129/588823/597952LDP RSVP BGP BGPSREPE OSPFSRAdj ISISSRAdj 如果不存在资源不足问题，请执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志 相关告警 模块名：MPLS-LSR-STD-MIB •节点名称(OID)mplsXCDown(1.3.6.1.2.1.10.166.2.0.2)相关日志无 12.1.4LDPLSP震荡 ",Cause not provided,Suggestion not provided
执行displaymplsldppeerverbose命令，查看LDP会话是否成功建立： 如果State字段显示不是Operational，则表示LDP会话没有正常建立，请参见“LDP会话无法Up”故障进行定位。 如果State字段的显示为Operational，则表示LDP会话已建立并处于Up状态，请执行步骤(3)。 <Sysname>displaymplsldppeerverbose VPNinstance:publicinstancePeerLDPID:1.1.1.1:0LocalLDPID:2.2.2.2:0 TCPConnection:2.2.2.2:14080->1.1.1.1:646 SessionState:OperationalSessionRole:Active SessionUpTime:0000:00:14(DD:HH:MM)… (3)检查BGP对等体关系是否建立。执行displaybgppeervpnv4命令，查看PE之间BGPVPNv4对等体关系，并执行displaybgppeeripv4vpn-instance命令，查看PE与CE之间BGP对等体关系： 如果不存在BGP对等体关系，或者State字段显示不是Established，则表示未建立BGP对等体关系，请参见“BGP邻居无法建立”故障进行定位。 如果State字段的显示为Established，则表示已建立BGP对等体关系，请执行步骤(4)。 <Sysname>displaybgppeervpnv4 BGPlocalrouterID:192.168.100.1 LocalASnumber:100 Totalnumberofpeers:1Peersinestablishedstate:1 *-Dynamicallycreatedpeer PeerASMsgRcvdMsgSentOutQPrefRcvUp/DownState ,Cause not provided,Suggestion not provided
执行displayqospolicyinterface命令查看指定接口上QoS策略的配置信息和运行情况时，发现当前接口上的流量未匹配到QoS策略中的流分类规则。 如下显示信息指定的流分类1中Matched字段为0(Packets)0(Bytes)，表示接口上符合流分类规则的数据包数目为0。需要注意的是，QoS策略中默认存在名称为default-class的流分类，未匹配到QoS策略中其他流分类规则的流量均匹配default-class的流分类。 <Sysname>displayqospolicyinterfacegigabitethernet1/0/1inbound Interface:GigabitEthernet1/0/1 Direction:InboundPolicy:1 Classifier:default-class Matched:213126(Packets)40928738(Bytes) 5-minutestatistics: Forwarded:20/4208(pps/bps) Dropped:0/0(pps/bps)Operator:AND Rule(s): If-matchany Behavior:be -none- Classifier:1 Matched:0(Packets)0(Bytes) 5-minutestatistics: Forwarded:0/0(pps/bps) Dropped:0/0(pps/bps)Operator:AND Rule(s): If-matchacl3000Behavior:1 Marking: Remarkdscp3 ,"本类故障的常见原因主要包括： •应用了QoS策略的接口状态为Down，没有转发流量。 •流分类配置错误，不能匹配到转发流量。 •流分类中ACL规则匹配的流量执行了更高优先的策略。 3.故障诊断流程本类故障的诊断流程如图4-49所示。图4-49流量不匹配分类的故障诊断流程图 4.故障处理步骤 (1)检查接口物理链路状态是否正常。 在设备上执行displayinterface命令检查接口状态，例如： <Sysname>displayinterfacegigabitethernet1/0/1 GigabitEthernet1/0/1 Interfaceindex:386 Currentstate:AdministrativelyDOWN Lineprotocolstate:DOWN … a.如果Currentstate显示为AdministrativelyDOWN，则在接口下执行undoshutdown命令打开关闭的接口。 b.如果Currentstate显示为DOWN，则检查接口的物理连线。 c.如果接口物理链路正常，问题仍未解决，则请继续执行以下操作。 (2)检查设备接口下应用的QoS策略中的流分类配置。 在设备上执行displaytrafficclassifieruser-defined命令检查用户定义的流分类的配置信息，关于if-match命令的匹配规则详细信息，请参见“ACL和QoS命令参考”中的“QoS”。如果流分类的配置错误，则执行trafficclassifier命令进入该流分类视图，并执行if-match命令修改流分类的匹配规则。例如： [Sysname-classifier-1]if-matchdscpef [Sysname-classifier-1]displaythis trafficclassifieraoperatoror if-matchprotocolipv6if-matchdscpef 请确认Operator字段显示的各规则之间的逻辑关系是否准确。AND表示该流分类下的规则之间是逻辑与的关系，即数据包必须匹配全部规则才属于该类。OR表示该流分类下的规则之间是逻辑或的关系，即数据包匹配任一规则均属于该类。本例中，如果Rule(s)中流分类规则不止一条，且Operator显示字段为AND，则表示该流分类下的规则之间是逻辑与的关系，即数据包必须匹配全部规则才属于该类。此时，请执行trafficclassifier命令指定operator参数为or。 <Sysname>displaytrafficclassifieruser-defined User-definedclassifierinformation: Classifier:1(ID101)Operator:AND Rule(s): If-matchdscpef Classifier:2(ID102)Operator:AND Rule(s): If-matchdscpaf21 Classifier:3(ID103)Operator:AND Rule(s): If-matchdscpaf11 如果QoS策略中的流分类配置正确，问题仍未解决，则请继续执行以下操作。(3)当流分类中引用ACL规则进行流量报文匹配时，也可能由于该ACL规则匹配到的流量报文执行了其他更高优先的策略行为导致MQC方式配置的QoS策略未生效，不同策略行为的优先顺序为：在报文出方向：报文过滤>全局应用MQC方式配置的QoS策略>接口应用MQC方式配置的QoS策略。在报文入方向：报文过滤>接口应用MQC方式配置的QoS策略>全局应用MQC方式配置的QoS策略。 请执行displaycurrent-configuration命令检查当前生效的配置中是否存在上述更高优先级的策略行为相关配置。如果不存在相关配置，问题仍未解决，请继续执行以下操作。 (4)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息。 5.告警与日志 相关告警 无 相关日志 •QOS_POLICY_APPLYIF_CBFAIL •QOS_POLICY_APPLYIF_FAIL 图4-50RADIUS认证服务器下发动态VLAN不生效故障诊断流程图 6.处理步骤(1)检查RADIUSDAE服务功能是否开启。请在系统视图下执行displaycurrent-configuration|includeradius命令查看radiusdynamic-authorserver配置是否存在。 如果该配置存在，则执行radiusdynamic-authorserver命令进入RADIUSDAE服务器视图下检查RADIUSDAE客户端以及RADIUSDAE服务端口配置是否正确。 <Sysname>system-view [Sysname]radiusdynamic-authorserver [Sysname-radius-da-server]displaythis # radiusdynamic-authorserverport3790 clientip3.3.3.3keycipher$c$3$kiAORLht3S3rTCmFq0uWXPgV8PjI2Q==# 如果该配置不存在，则执行radiusdynamic-authorserver命令开启RADIUSDAE服务，并进入RADIUSDAE服务器视图配置RADIUSDAE客户端以及RADIUSDAE服务端口（下例中客户端的IP地址为1.1.1.1、共享密钥为123456、服务端口号为3798）。 <Sysname>system-view [Sysname]radiusdynamic-authorserver [Sysname-radius-da-server]clientip1.1.1.1keysimple123456 [Sysname-radius-da-server]port3798 (2)检查RADIUS服务器下发的VLAN属性内容是否准确。执行debuggingradiuspacket命令打开RADIUS报文调试信息开关，同时让RADIUS服务器尝试再次下发VLAN属性。 RADIUS服务器需要同时下发如下3个标准属性来下发VLAN信息： 64号属性Tunnel-Type，Integer类型，取值固定为13（VLAN） 65号属性Tunnel-Medium-Type，Integer类型，取值固定为6（IEEE802）。 81号属性Tunnel-Private-Group-Id，String类型，取值为具体的VLANID或VLAN名称。查看打印的RADIUS报文调试信息，检查COArequest报文信息中是否携带了上述三个标准属性，如下例所示。 *Aug302:33:18:7002021SysnameRADIUS/7/PACKET: ReceivedaRADIUSpacket ServerIP:128.11.3.48 NAS-IP:128.11.30.69 VPNinstance:--(public) Serverport:55805 Type:COArequest Length:41 PacketID:34User-Name=""user"" Tunnel-Type:0=VLAN Tunnel-Medium-Type:0=IEEE-802 Tunnel-Private-Group-Id:0=""2"" 如果打印的授权属性不准确，请联系RADIUS服务器管理员修改授权VLAN配置并尝试重新下发VLAN，否则继续定位。(3)检查用户是否成功获得下发的VLAN信息。 执行displaydot1xconnection或displaymac-authenticationconnection 命令，查看相关在线用户信息中是否存在服务器动态下发的授权VLAN信息：如果存在授权VLAN信息，说明VLAN下发成功。 如果不存在授权VLAN信息，说明VLAN没有下发成功。此时，建议在技术支持人员的指导下，结合RADIUS调试信息继续定位故障发生的原因。 (4)检查授权的VLAN是否存在。 执行displayvlanbrief命令查看动态下发的VLAN是否存在。如果该VLAN不存在，请在系统视图下执行vlanvlan-id命令创建。 (5)检查VLAN所在接口类型是否正确。 不同类型的接口成功加入授权VLAN的要求有所不同，具体配置要求请参见“安全配置指导”中的“802.1X”和“MAC地址认证”。 (6)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、调试信息、诊断信息。 7.告警与日志相关告警无 相关日志无 4.17无线故障处理 4.17.1未开启自动AP配置功能造成AP无法注册 ",Suggestion not provided
终端通过DHCPv6方式自动获取IPv6DNS信息失败,本类故障的常见原因主要包括： •安卓终端不支持通过DHCPv6方式自动获取IPv6DNS信息。 •网络中设备VLAN配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •网络中设备的接口配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •设备侧DHCPv6配置错误，导致终端获取不到IPv6DNS信息。 •无线终端与设备间的DHCPv6报文交互流程出现问题，导致终端获取不到IPv6DNS信息。 3.故障分析 本类故障的诊断流程如图5-16所示。 图5-16通过DHCPv6方式自动获取IPv6DNS信息失败故障排查流程图 4.处理步骤 (1)查看终端类型 安卓终端只支持通过RA的方式获取DNS地址信息，不支持通过DHCPv6方式自动获取IPv6 DNS信息。 如果无线终端是安卓系统，请配置RA方式获取IPv6DNS信息，配置步骤请参见5.144. (5)。 如果无线终端不是安卓系统，请继续执行步骤(2)。 (2)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-17所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-17集中转发组网VLAN配置 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-18所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-18本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(3)。 (3)检查网络中设备的接口配置物理接口配置错误可能导致VLAN放通失败，正确的接口配置如下。 集中转发：如图5-17所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发：如图5-18所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(4)。 (4)检查设备侧DHCPv6配置设备侧DHCPv6配置不正确会导致无线终端无法通过DHCPv6方式获取IPv6DNS信息。通常以网关Switch作为路由通告发布的设备，以下面配置为例： ComwareV7/V9设备： <Switch>system-view [Switch]IPv6dhcppoolipv6 [Switch-dhcp6-pool-ipv6]network2001::/64 [Switch-dhcp6-pool-ipv6]gateway-list2001::1 [Switch-dhcp6-pool-ipv6]dns-server2001::2//配置IPv6DNSServer地址信息 [Switch-dhcp6-pool-ipv6]quit [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6ndautoconfigother-flag//设置NDRA报文中的O位 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 [Switch-Vlan-interface2]ipv6dhcpselectserver [Switch-Vlan-interface2]ipv6dhcpserverapplypoolipv6//将配置好的地址池在接口 Comw(上调用)areV5设备： <Switch>system-view [Switch]ipv6//V5Switch需要全局使能IPv6功能，V7Switch默认已使能，不需要配置该命令[Switch]ipv6dhcpserverenable//V5Switch需使能DHCPv6服务器功能，V7Switch不需要配置 [Switch]IPv6dhcppoolipv6 [Switch-dhcp6-pool-ipv6]network2001::/64 [Switch-dhcp6-pool-ipv6]gateway-list2001::1 [Switch-dhcp6-pool-ipv6]dns-server2001::2//配置IPv6DNSServer地址信息 [Switch-dhcp6-pool-ipv6]quit [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6ndautoconfigother-flag//设置NDRA报文中的O位 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 [Switch-Vlan-interface2]ipv6dhcpserverapplypoolipv6//将配置好的地址池在接口 在设备的(上调用)任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 Windows终端成功获取IPv6DNS信息结果如下图。 图5-19Windows终端获取IPv6DNS信息 如果设备侧DHCPv6配置不正确，请参照举例修改配置。 如果设备侧DHCPv6配置正确，请继续执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的DHCPv6报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 完整的DHCPv6报文交互过程如下图。 图5-20完整的DHCPv6报文交互过程 可以在抓包软件（以Wireshark为例）中通过“DHCPv6”关键字进行过滤，下面是一个完整的DHCPv6报文交互过程的抓包示意。 Solicit报文：DHCPv6客户端使用Solicit报文来确定DHCP服务器的位置。图5-21Solicit报文抓包 Advertise报文：DHCPv6服务器发送Advertise报文进行回应，宣告自己能够提供DHCPv6服务，并携带DNS信息。 图5-22Advertise报文抓包 Request报文：DHCPv6客户端向DHCPv6服务器请求IPv6DNS配置信息。图5-23Request报文抓包 Reply报文：DHCPv6服务器发送携带了配置信息(包含DNS信息)的Reply消息来回应从DHCPv6客户端收到的Solicit、Request等报文。图5-24Reply报文抓包 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.16终端通过无状态地址配置自动获取IPv6地址失败 ,Suggestion not provided
终端通过DHCPv6方式自动获取IPv6DNS信息失败。DHCPv6（DynamicHostConfigurationProtocolforIPv6）是针对IPv6编址方案设计的，为主机分配IPv6前缀、IPv6地址和其他网络配置参数的协议，其中就包括DNSServer地址信息，其工作机制与IPv4网络中的DHCP协议类似，也称为有状态地址配置,本类故障的常见原因主要包括： •安卓终端不支持通过DHCPv6方式自动获取IPv6DNS信息。 •网络中设备VLAN配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •网络中设备的接口配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •设备侧DHCPv6配置错误，导致终端获取不到IPv6DNS信息。 •无线终端与设备间的DHCPv6报文交互流程出现问题，导致终端获取不到IPv6DNS信息。 3.故障分析 本类故障的诊断流程如图5-16所示。 图5-16通过DHCPv6方式自动获取IPv6DNS信息失败故障排查流程图 4.处理步骤 (1)查看终端类型 安卓终端只支持通过RA的方式获取DNS地址信息，不支持通过DHCPv6方式自动获取IPv6 DNS信息。 如果无线终端是安卓系统，请配置RA方式获取IPv6DNS信息，配置步骤请参见5.144. (5)。 如果无线终端不是安卓系统，请继续执行步骤(2)。 (2)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-17所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-17集中转发组网VLAN配置 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-18所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-18本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(3)。 (3)检查网络中设备的接口配置物理接口配置错误可能导致VLAN放通失败，正确的接口配置如下。 集中转发：如图5-17所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发：如图5-18所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(4)。 (4)检查设备侧DHCPv6配置设备侧DHCPv6配置不正确会导致无线终端无法通过DHCPv6方式获取IPv6DNS信息。通常以网关Switch作为路由通告发布的设备，以下面配置为例： ComwareV7/V9设备： <Switch>system-view [Switch]IPv6dhcppoolipv6 [Switch-dhcp6-pool-ipv6]network2001::/64 [Switch-dhcp6-pool-ipv6]gateway-list2001::1 [Switch-dhcp6-pool-ipv6]dns-server2001::2//配置IPv6DNSServer地址信息 [Switch-dhcp6-pool-ipv6]quit [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6ndautoconfigother-flag//设置NDRA报文中的O位 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 [Switch-Vlan-interface2]ipv6dhcpselectserver [Switch-Vlan-interface2]ipv6dhcpserverapplypoolipv6//将配置好的地址池在接口 Comw(上调用)areV5设备： <Switch>system-view [Switch]ipv6//V5Switch需要全局使能IPv6功能，V7Switch默认已使能，不需要配置该命令[Switch]ipv6dhcpserverenable//V5Switch需使能DHCPv6服务器功能，V7Switch不需要配置 [Switch]IPv6dhcppoolipv6 [Switch-dhcp6-pool-ipv6]network2001::/64 [Switch-dhcp6-pool-ipv6]gateway-list2001::1 [Switch-dhcp6-pool-ipv6]dns-server2001::2//配置IPv6DNSServer地址信息 [Switch-dhcp6-pool-ipv6]quit [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6ndautoconfigother-flag//设置NDRA报文中的O位 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 [Switch-Vlan-interface2]ipv6dhcpserverapplypoolipv6//将配置好的地址池在接口 在设备的(上调用)任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 Windows终端成功获取IPv6DNS信息结果如下图。 图5-19Windows终端获取IPv6DNS信息 如果设备侧DHCPv6配置不正确，请参照举例修改配置。 如果设备侧DHCPv6配置正确，请继续执行步骤(5)。 (5)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的DHCPv6报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 完整的DHCPv6报文交互过程如下图。 图5-20完整的DHCPv6报文交互过程 可以在抓包软件（以Wireshark为例）中通过“DHCPv6”关键字进行过滤，下面是一个完整的DHCPv6报文交互过程的抓包示意。 Solicit报文：DHCPv6客户端使用Solicit报文来确定DHCP服务器的位置。图5-21Solicit报文抓包 Advertise报文：DHCPv6服务器发送Advertise报文进行回应，宣告自己能够提供DHCPv6服务，并携带DNS信息。 图5-22Advertise报文抓包 Request报文：DHCPv6客户端向DHCPv6服务器请求IPv6DNS配置信息。图5-23Request报文抓包 Reply报文：DHCPv6服务器发送携带了配置信息(包含DNS信息)的Reply消息来回应从DHCPv6客户端收到的Solicit、Request等报文。图5-24Reply报文抓包 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.16终端通过无状态地址配置自动获取IPv6地址失败 ,Suggestion not provided
终端通过RA方式自动获取IPv6DNS信息失败,"本类故障的常见原因主要包括： •AC版本过低，不支持通过RA报文下发IPv6DNSServer信息。 •Windows终端不支持通过RA方式自动获取IPv6DNS信息。 •设备侧RA配置错误，导致终端获取不到IPv6DNS信息。 •网络中设备VLAN配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •网络中设备的接口配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •无线终端与设备间的RS/RA报文交互流程出现问题，导致终端获取不到IPv6DNS信息。 3.故障分析 本类故障的诊断流程如图5-11所示。图5-11通过RA方式自动获取IPv6DNS信息失败故障排查流程图 4.处理步骤 (1)检查设备侧版本 E5420或者R5420之后的版本才支持通过RA方式下发IPv6DNS信息，AC版本过低会导致终端无法获取IPv6DNS信息。 在AC的任意视图下执行displayversion命令查看版本信息。 <AC>displayversion H3CComwareSoftware,Version7.1.064,Release5457 … 如果AC的版本过低，请升级AC版本。访问H3C官网获取版本文件，版本升级的操作步骤请参见H3C官网对应产品配置指导中的“基础配置指导/软件升级”。 如果AC的版本支持RA方式下发IPv6DNS信息，则继续执行步骤(2)。 (2)查看终端类型 部分安卓终端是不支持IPv6单协议栈。只有在IPv4+IPv6混合组网下，此类安卓终端才可能获取DNS相关信息。 Windows终端只支持通过DHCPv6的方式获取DNS地址信息，不支持通过RA报文自动获取IPv6DNS信息。 如果无线终端是Windows系统，请配置DHCPv6方式获取IPv6DNS信息，配置步骤请参见5.154.(4)。 如果无线终端不是Windows系统，请继续执行步骤(3)。 (3)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-12所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-12集中转发组网VLAN配置 GE1/0/2Vlan100Vlan200 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-13所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-13本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(4)。 (4)检查网络中设备的接口配置物理接口配置错误可能导致VLAN放通失败，正确的接口配置如下。 集中转发：如图5-12所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发：如图5-13所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(5)。 (5)检查设备侧RA配置设备侧RA配置不正确会导致无线终端无法通过RA方式获取IPv6DNS信息。通常以网关 Switch作为路由通告发布的设备，以下面配置为例： ComwareV7/V9设备： <Switch>system-view [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]ipv6ndradnsserver2001::2100000sequence1//配置dnsserver信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 ComwareV5设备： <Switch>system-view [Switch]ipv6//V5Switch需要全局使能IPv6功能，V7Switch默认已使能，不需要配置该命令 [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信 [Sw(息)itch-Vlan-interface2]ipv6ndradnsserver2001::2100000sequence1//配置dnsserver信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 在设备的任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 如果设备侧RA配置不正确，请参照举例修改配置。 如果设备侧RA配置正确，请继续执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的RS/RA报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 查看终端是否发送RS请求报文： RS（路由器请求，RouterSolicitation）是一个组播报文，由主机侧发送，用于请求路由器迅速提供路由器公告，要求路由器立即产生路由器通告消息，而不必等待下一个预定时间。IP部分源地址为发送接口IPv6地址或全0，目的地址是链路本地范围内所有路由器的组播地址FF02::2。RS报文属于ICMP报文，在抓包软件（以Wireshark为例）中可以通过“icmpv6”关键字进行报文过滤。图5-14RS报文抓包示意图 查看AC是否回应终端RA报文： RA（路由器公告，RouterAdvertisement）。RA报文由路由器侧周期发送，通告它的存 在以及配置的链路和网络参数（这其中就包括DNS信息），或者以公告响应路由器请求。IP部分源地址为发送接口链路本地地址，目的地址为所有节点多播地址FF02::1。RA报文也属于ICMP报文，在Wireshak中可以通过“icmpv6”关键字进行报文过滤。 查看RA报文中是否有携带option25属性，是否包含了DNSServer的地址信息： 图5-15RA报文抓包示意图 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.15终端通过DHCPv6方式自动获取IPv6DNS信息失败 ",Suggestion not provided
终端通过RA方式自动获取IPv6DNS信息失败。RA配置方式是指路由侧通过RA报文（Option25携带DNS信息）来进行IPv6DNS信息下发，也称为无状态地址配置,"本类故障的常见原因主要包括： •AC版本过低，不支持通过RA报文下发IPv6DNSServer信息。 •Windows终端不支持通过RA方式自动获取IPv6DNS信息。 •设备侧RA配置错误，导致终端获取不到IPv6DNS信息。 •网络中设备VLAN配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •网络中设备的接口配置不正确，导致二层网络不通，终端获取不到IPv6DNS信息。 •无线终端与设备间的RS/RA报文交互流程出现问题，导致终端获取不到IPv6DNS信息。 3.故障分析 本类故障的诊断流程如图5-11所示。图5-11通过RA方式自动获取IPv6DNS信息失败故障排查流程图 4.处理步骤 (1)检查设备侧版本 E5420或者R5420之后的版本才支持通过RA方式下发IPv6DNS信息，AC版本过低会导致终端无法获取IPv6DNS信息。 在AC的任意视图下执行displayversion命令查看版本信息。 <AC>displayversion H3CComwareSoftware,Version7.1.064,Release5457 … 如果AC的版本过低，请升级AC版本。访问H3C官网获取版本文件，版本升级的操作步骤请参见H3C官网对应产品配置指导中的“基础配置指导/软件升级”。 如果AC的版本支持RA方式下发IPv6DNS信息，则继续执行步骤(2)。 (2)查看终端类型 部分安卓终端是不支持IPv6单协议栈。只有在IPv4+IPv6混合组网下，此类安卓终端才可能获取DNS相关信息。 Windows终端只支持通过DHCPv6的方式获取DNS地址信息，不支持通过RA报文自动获取IPv6DNS信息。 如果无线终端是Windows系统，请配置DHCPv6方式获取IPv6DNS信息，配置步骤请参见5.154.(4)。 如果无线终端不是Windows系统，请继续执行步骤(3)。 (3)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-12所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-12集中转发组网VLAN配置 GE1/0/2Vlan100Vlan200 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-13所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-13本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(4)。 (4)检查网络中设备的接口配置物理接口配置错误可能导致VLAN放通失败，正确的接口配置如下。 集中转发：如图5-12所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发：如图5-13所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可，AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为：system-viewvlan200quit interfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(5)。 (5)检查设备侧RA配置设备侧RA配置不正确会导致无线终端无法通过RA方式获取IPv6DNS信息。通常以网关 Switch作为路由通告发布的设备，以下面配置为例： ComwareV7/V9设备： <Switch>system-view [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]ipv6ndradnsserver2001::2100000sequence1//配置dnsserver信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 ComwareV5设备： <Switch>system-view [Switch]ipv6//V5Switch需要全局使能IPv6功能，V7Switch默认已使能，不需要配置该命令 [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信 [Sw(息)itch-Vlan-interface2]ipv6ndradnsserver2001::2100000sequence1//配置dnsserver信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 在设备的任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 如果设备侧RA配置不正确，请参照举例修改配置。 如果设备侧RA配置正确，请继续执行步骤(6)。 (6)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的RS/RA报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 查看终端是否发送RS请求报文： RS（路由器请求，RouterSolicitation）是一个组播报文，由主机侧发送，用于请求路由器迅速提供路由器公告，要求路由器立即产生路由器通告消息，而不必等待下一个预定时间。IP部分源地址为发送接口IPv6地址或全0，目的地址是链路本地范围内所有路由器的组播地址FF02::2。RS报文属于ICMP报文，在抓包软件（以Wireshark为例）中可以通过“icmpv6”关键字进行报文过滤。图5-14RS报文抓包示意图 查看AC是否回应终端RA报文： RA（路由器公告，RouterAdvertisement）。RA报文由路由器侧周期发送，通告它的存 在以及配置的链路和网络参数（这其中就包括DNS信息），或者以公告响应路由器请求。IP部分源地址为发送接口链路本地地址，目的地址为所有节点多播地址FF02::1。RA报文也属于ICMP报文，在Wireshak中可以通过“icmpv6”关键字进行报文过滤。 查看RA报文中是否有携带option25属性，是否包含了DNSServer的地址信息： 图5-15RA报文抓包示意图 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.15终端通过DHCPv6方式自动获取IPv6DNS信息失败 ",Suggestion not provided
终端通过RA方式自动获取IPv6地址失败,本类故障的常见原因主要包括： •网络中设备VLAN配置不正确，导致网络不通，终端获取不到IPv6地址。 •网络中设备的接口配置不正确，导致网络不通，终端获取不到IPv6地址 •设备侧无状态地址配置不正确，导致终端无法自动获取IPv6地址。 •路由前缀是非64位，导致终端无法自动生成IPv6地址。 •安卓终端不支持在纯IPv6网络中，通过无状态地址配置获取IPv6地址。 •无线终端与设备间的RS/RA报文交互流程出现问题，导致终端获取不到IPv6地址。 3.故障分析 本类故障的诊断流程如图5-25所示。 图5-25通过无状态地址配置自动获取IPv6地址失败故障排查流程图 4.处理步骤 (1)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-26所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-26集中转发组网VLAN配置 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-27所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-27本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(2)。 (2)检查网络中设备的接口配置 如果设备的接口配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备接口的配置不同，具体配置原则如下。 集中转发：如图5-26所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发： 如图5-27所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可， AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为： system-viewvlan200quitinterfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(3)。 (3)检查设备侧RA配置设备侧RA配置不正确会导致无线终端无法通过RA方式获取IPv6地址。通常将网关交换机作为路由通告发布的设备，则正确的配置如下： ComwareV7/V9设备： <Switch>system-view [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 ComwareV5设备： <Switch>system-view [Switch]ipv6//V5Switch需要全局使能IPv6功能，V7Switch默认已使能，不需要配置该命令 [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 在设备的任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 如果设备侧RA配置不正确，请参照举例修改配置。 如果设备侧RA配置正确，请继续执行步骤。 (4)检查路由前缀 RA报文中携带的前缀必须是64位，终端才可以自动获取到IPv6地址。缺省情况下，RA报文使用的前缀是报文转发接口的IPv6地址前缀。在报文转发的设备上，通过displayipv6interfaceprefix命令查看报文转发接口的前缀是否为64位。 #查看VLAN接口10的IPv6前缀信息。 <Sysname>displayipv6interfaceVlan-interface10prefix Prefix:1001::/64Origin:ADDRESS Age:-Flag:AL Lifetime(Valid/Preferred):2592000/604800 Prefix:2001::/64Origin:STATIC Age:-Flag:L Lifetime(Valid/Preferred):3000/2000 Prefix:3001::/64Origin:RA Age:600Flag:ALifetime(Valid/Preferred):- 如果报文转发接口的前缀不为64位，可以通过ipv6address命令手动修改前缀长度，或执行ipv6ndraprefix命令配置RA消息中的前缀长度。 如果报文转发接口的前缀均为64位，则继续执行步骤。 (5)查看终端类型 安卓终端不支持IPv6单协议栈。只有在IPv4+IPv6混合组网，安卓终端获取到IPv4地址情况下才能获取到IPv6地址，才可能获取IPv6地址。 如果网络中Windows/IOS终端可以正常通过无状态地址配置获取IPv6地址，仅安卓终端出现异常，则需要修改组网规划，给安卓终端同时分配IPv4的地址。 如果是安卓终端且网络为纯IPv6组网时，请修改网络规划。 如果网络为IPv4+IPv6混合组网，请继续执行步骤。 (6)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的RS/RA报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 查看终端是否有发起RS报文请求路由信息。 路由器请求RS（RouterSolicitation）是一个组播报文，由主机侧发送，用于请求路由器迅速提供路由器公告，要求路由器立即产生路由器通告消息，而不必等待下一个预定时间。IP部分源地址为发送接口IPv6地址或全0，目的地址是链路本地范围内所有路由器的组播地址FF02::2。RS报文属于ICMP报文，在Wireshak中可以通过“icmpv6”关键字进行报文过滤。 图5-28RS报文抓包示意图 查看AC是否有回应路由器公告RA（RouterAdvertisement）。RA报文由路由器侧周期发送，通告它的存在以及配置的链路和网络参数，或者以公告响应路由器请求。IP部分源 地址为发送接口链路本地地址，目的地址为所有节点多播地址FF02::1。RA报文也属于 ICMP报文，在抓包软件（以Wireshak为例）中可以通过“icmpv6”关键字进行报文过滤。 然后查看RA报文中的Flag标志位中的M位是否有置零。M位（ManagedAddress ConfigurationFlag）置位时使用有状态可管理的协议进行自动地址配置，否则只使用无状态自动地址配置。M位这个标志位默认置零，如果没有置零说明设备侧路由信息配置错误，需检查设备侧配置。 图5-29RA报文抓包示意图 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.17终端通过有状态地址配置自动获取IPv6地址失败 ,Suggestion not provided
终端通过RA方式自动获取IPv6地址失败。无状态地址配置是指主机根据自己的链路层地址及路由器发布的前缀信息自动配置IPv6地址及相关信息,本类故障的常见原因主要包括： •网络中设备VLAN配置不正确，导致网络不通，终端获取不到IPv6地址。 •网络中设备的接口配置不正确，导致网络不通，终端获取不到IPv6地址 •设备侧无状态地址配置不正确，导致终端无法自动获取IPv6地址。 •路由前缀是非64位，导致终端无法自动生成IPv6地址。 •安卓终端不支持在纯IPv6网络中，通过无状态地址配置获取IPv6地址。 •无线终端与设备间的RS/RA报文交互流程出现问题，导致终端获取不到IPv6地址。 3.故障分析 本类故障的诊断流程如图5-25所示。 图5-25通过无状态地址配置自动获取IPv6地址失败故障排查流程图 4.处理步骤 (1)检查网络中设备的VLAN配置 如果设备的VLAN配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备VLAN配置不同，具体配置原则如下。 集中转发： 集中转发模式下，客户端的数据流量由AP通过CAPWAP隧道透传到AC，由AC转发数据报文。实际使用中通常会划分AP上线的管理VLAN和无线终端接入的业务VLAN，数据报文通过管理VLAN发送至AC，AC再通过业务VLAN转发数据报文，所以需要在AC转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-26所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 需要在AC转发无线业务报文的链路，即AC-Switch1链路放通业务VLAN200。 图5-26集中转发组网VLAN配置 本地转发： 本地转发模式下，无线终端和AC间会通过CAPWAP隧道交互控制报文，并由AP转发数据报文。实际使用中通常会区别AP上线的管理VLAN和无线终端接入的业务VLAN，所以需要在AP转发业务报文的链路上放通业务VLAN，否则终端无法取得IP地址。 业务VLAN有多种配置方式，其优先级为认证授权VLAN＞Radio接口绑定VLAN＞服务模板指定VLAN。 如图5-27所示，核心交换机作为网关，AC旁挂在核心交换机上，AP与接入交换机相连。 在AP转发无线业务报文的链路，即Switch1-Switch2-AP链路放通业务VLAN200。 图5-27本地转发组网AC配置 在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的VLAN配置不正确，请参照上文排查VLAN配置。 如果网络中设备的VLAN配置正确，请继续执行步骤(2)。 (2)检查网络中设备的接口配置 如果设备的接口配置不正确，会导致中间链路不通，此时无线终端无法获取IPv6地址。无线网络分为本地转发和集中转发两种转发方式，设备接口的配置不同，具体配置原则如下。 集中转发：如图5-26所示组网中，需要将AC与网关Switch1链路的物理接口GE1/0/1和GE1/0/2配置为Trunk模式并允许业务VLAN200通过。 本地转发： 如图5-27所示组网中，需要将AP的与上行设备的物理接口加入客户端上线的VLAN。可以在AC上通过编辑好的MAP文件，或远程配置功能下发给AP，本章节以MAP文件为例进行介绍。 无线终端在VLAN200上线，则需要将AP与Switch相连的接口interfaceGigabitEthernet 1/0/1加入VLAN200，MAP文件的内容如下： apcfg.txt的内容，要求为文本文件，按照命令行配置的顺序编写文本文件上传至AC即可， AC与AP关联后，通过map-configuration命令下发至AP生效。从而完成对AP的配置。 #apcfg.txt配置文件为： system-viewvlan200quitinterfaceGigabitEthernet1/0/1portlink-typetrunkporttrunkpermitvlan200 还需要将网关Switch1下行接口、接入交换机链路Switch2的上下行物理接口配置为Trunk模式并允许VLAN200通过，Switch2与AP连接的GE1/0/2接口的PVID配置为 100。在设备的任意视图下执行displaycurrent-configuration命令查看全部VLAN配置。 如果网络中设备的接口配置不正确，请参照上文排查接口配置。 如果网络中设备的接口配置正确，请继续执行步骤(3)。 (3)检查设备侧RA配置设备侧RA配置不正确会导致无线终端无法通过RA方式获取IPv6地址。通常将网关交换机作为路由通告发布的设备，则正确的配置如下： ComwareV7/V9设备： <Switch>system-view [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 ComwareV5设备： <Switch>system-view [Switch]ipv6//V5Switch需要全局使能IPv6功能，V7Switch默认已使能，不需要配置该命令 [Switch]interfaceVlan-interface2 [Switch-Vlan-interface2]ipv6address2001::1/64//配置设备接口IPv6地址及前缀长度信息 [Switch-Vlan-interface2]undoipv6ndrahalt//开启设备IPv6NDRA报文发送能力 在设备的任意视图下执行displaycurrent-configuration命令查看设备的全部配置。 如果设备侧RA配置不正确，请参照举例修改配置。 如果设备侧RA配置正确，请继续执行步骤。 (4)检查路由前缀 RA报文中携带的前缀必须是64位，终端才可以自动获取到IPv6地址。缺省情况下，RA报文使用的前缀是报文转发接口的IPv6地址前缀。在报文转发的设备上，通过displayipv6interfaceprefix命令查看报文转发接口的前缀是否为64位。 #查看VLAN接口10的IPv6前缀信息。 <Sysname>displayipv6interfaceVlan-interface10prefix Prefix:1001::/64Origin:ADDRESS Age:-Flag:AL Lifetime(Valid/Preferred):2592000/604800 Prefix:2001::/64Origin:STATIC Age:-Flag:L Lifetime(Valid/Preferred):3000/2000 Prefix:3001::/64Origin:RA Age:600Flag:ALifetime(Valid/Preferred):- 如果报文转发接口的前缀不为64位，可以通过ipv6address命令手动修改前缀长度，或执行ipv6ndraprefix命令配置RA消息中的前缀长度。 如果报文转发接口的前缀均为64位，则继续执行步骤。 (5)查看终端类型 安卓终端不支持IPv6单协议栈。只有在IPv4+IPv6混合组网，安卓终端获取到IPv4地址情况下才能获取到IPv6地址，才可能获取IPv6地址。 如果网络中Windows/IOS终端可以正常通过无状态地址配置获取IPv6地址，仅安卓终端出现异常，则需要修改组网规划，给安卓终端同时分配IPv4的地址。 如果是安卓终端且网络为纯IPv6组网时，请修改网络规划。 如果网络为IPv4+IPv6混合组网，请继续执行步骤。 (6)如果故障仍然未能排除，请收集如下信息，并拨打热线400-810-0504求助。 在AC的进出口方向或无线终端侧抓包来查看终端和AC的RS/RA报文交互过程，判断交互过程中的哪一环节出错，以缩小故障处理范围。 查看终端是否有发起RS报文请求路由信息。 路由器请求RS（RouterSolicitation）是一个组播报文，由主机侧发送，用于请求路由器迅速提供路由器公告，要求路由器立即产生路由器通告消息，而不必等待下一个预定时间。IP部分源地址为发送接口IPv6地址或全0，目的地址是链路本地范围内所有路由器的组播地址FF02::2。RS报文属于ICMP报文，在Wireshak中可以通过“icmpv6”关键字进行报文过滤。 图5-28RS报文抓包示意图 查看AC是否有回应路由器公告RA（RouterAdvertisement）。RA报文由路由器侧周期发送，通告它的存在以及配置的链路和网络参数，或者以公告响应路由器请求。IP部分源 地址为发送接口链路本地地址，目的地址为所有节点多播地址FF02::1。RA报文也属于 ICMP报文，在抓包软件（以Wireshak为例）中可以通过“icmpv6”关键字进行报文过滤。 然后查看RA报文中的Flag标志位中的M位是否有置零。M位（ManagedAddress ConfigurationFlag）置位时使用有状态可管理的协议进行自动地址配置，否则只使用无状态自动地址配置。M位这个标志位默认置零，如果没有置零说明设备侧路由信息配置错误，需检查设备侧配置。 图5-29RA报文抓包示意图 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.17终端通过有状态地址配置自动获取IPv6地址失败 ,Suggestion not provided
主AC故障恢复后，AP和Client仍然连在备AC上，不能自动回切,使用priority命令将主AC上配置的AP优先级设为7，在AC热备功能中，必须将优先级设置为7才支持回切。 <Master_AC>system-view [Master_AC]wlanapap1modelWA6320 [Master_AC-wlan-ap-ap1]priority7 4.4客户端无法弹出Portal认证页面 ,使用priority命令将主AC上配置的AP优先级设为7，在AC热备功能中，必须将优先级设置为7才支持回切。 <Master_AC>system-view [Master_AC]wlanapap1modelWA6320 [Master_AC-wlan-ap-ap1]priority7 4.4客户端无法弹出Portal认证页面 
主控板在使用中发生重启，无法正常启动,本类故障的常见原因主要包括： •启动文件损坏。 •主控板内存单元损坏。 •单板未完全插入或损坏导致BootWare运行异常。 3.故障分析 本类故障的诊断流程如图13所示。 图13故障诊断流程图 4.处理步骤 (1)检查主控板上的启动文件是否正常 通过Console口登录故障主控板，重新启动设备，如果BootWare提示CRC错误或者找不到启动文件，请重新加载启动文件，并确认Flash中文件大小与服务器上的文件是否一致，如不存在或不一致需重新加载启动文件。加载后请设置该文件为当前启动文件（在BootWare加载过程中，BootWare能自动将该文件设置为当前启动文件）。 (2)测试主控板内存单元是否正常 如果确认加载的文件大小正确，且设置为当前启动文件也正常。请重新启动单板，同时立即按住CTRL+T，对内存单元进行检测。如果提示内存错误，请更换单板。 (3)查看Bootware是否依旧提示错误 如果内存检查也正常，但BootWare启动过程中还有错误提示，则根据相关提示初步判断发生故障的器件。检查单板是否插牢。如已插牢则更换单板。 (4)寻求技术支持 如果上述检查完成后故障仍无法排除，请联系H3C的技术支持工程师。 5.告警与日志相关告警无 相关日志无 3.5.4主备倒换故障 ,Suggestion not provided
组播设备无法正常建立IGMP或者MLD表项,本类故障的常见原因主要包括： •设备上没有开启IP组播路由功能。 •与用户主机网段直连的接口物理状态为Down。 •与用户主机网段直连的接口未配置主IP地址。 •与用户主机网段直连的接口上未开启IGMP或MLD功能。 •组播组G属于SSM组地址范围，设备上配置的IGMP或MLD版本不正确。 •设备上配置了SSM组地址过滤规则，但组播组G地址不在ACL定义的permit规则范围内。 •设备上配置了IGMP或MLD组播组过滤器，但组播组G地址不在ACL定义的permit规则范围内。 3.故障分析 本类故障的诊断流程如图88所示。 图88设备无法正常建立IGMP或MLD表项的故障诊断流程图 4.处理步骤 (1)检查设备上是否开启IP组播路由功能。 在直连用户主机网段的设备上执行displaycurrent-configuration|include multicast命令，查看是否开启IP组播路由功能。 如果未开启，请在系统视图下执行multicastrouting或ipv6multicastrouting 命令，开启IP组播路由功能。 如果已开启，请执行步骤(2)。 (2)检查与用户主机网段直连接口的物理状态是否为Up。在直连用户主机网段的设备上执行displayinterfaceinterface-type interface-number命令查看显示信息中的“Currentstate”字段，确认与用户主机网段直连的接口的物理状态是否为Up。a.如果为Up，请执行步骤(3)。 b.如果为Down，请排查处理接口物理Down的问题。 (3)检查接口上是否配置了主IP地址。 在设备直连用户主机网段接口的接口视图下执行displaythis命令，查看是否通过ipaddress命令配置了接口的主IP地址。 a.如果没有配置，请在接口上通过ipaddress命令进行配置。 b.如果已配置，请执行步骤(4)。 (4)检查与用户主机网段直连接口上是否开启IGMP或MLD功能。 在直连用户主机网段的设备上执行displaycurrent-configurationinterface命 令，查看与用户主机网段直连的接口上是否开启IGMP或MLD功能。 a.如果没有开启，请在相应的接口上开启IGMP或MLD功能。 b.如果已开启，请执行步骤(5)。 (5)检查组播组G是否属于SSM组地址范围。 对于IGMP表项无法生成的情况：请检查组播组G是否属于SSM组地址范围，SSM组播组地址的范围为232.0.0.0/8。 −如果属于，请确保与用户主机网段直连的接口上的IGMP版本为IGMPv3，并确认 IGMPv3的报文正确。如果故障仍未排除，请执行步骤(6)。 −如果不属于，请执行步骤(7)。 对于MLD表项无法生成的情况： 请检查组播组G是否属于IPv6SSM组地址范围，IPv6SSM组播组的范围为FF3x::/32。 −如果属于，请确保与用户主机网段直连的接口上的MLD版本为MLDv2。如果故障仍未排除，请执行步骤(6)。 −如果不属于，请执行步骤(7)。 (6)检查是否配置了SSM组播组过滤器。 在直连用户主机网段的设备上执行displaycurrent-configurationconfigurationpim或者displaycurrent-configurationconfigurationpim6命令，查看是否已通过ssm-policy命令配置SSM组播组的范围。 如果已配置，请检查组播组G是否在ACL规则允许的范围之内。 −如果不在，建议根据实际组网在PIM视图下执行undossm-policy命令恢复缺省情况；重新配置ACL规则，使得组播组G地址在ACL的permit规则中。 −如果在，请执行步骤(7)。 如果未配置，请执行步骤(7)。 (7)检查接口上是否配置了IGMP或MLD组播组过滤器。 在直连用户主机网段的设备上执行displaycurrent-configuration命令，查看是否已通过igmpgroup-policy或mldgroup-policy命令配置了IGMP或MLD组播组过滤器。 如果已配置，请检查组播组G是否在ACL规则允许的范围之内。 −如果不在，建议根据实际组网需要执行undoigmpgroup-policy或undomldgroup-policy命令删除该组播组过滤器配置；重新配置ACL规则，使得组播组G地址在ACL的permit规则中。 −如果在，请执行步骤(8)。 如果未配置，请执行步骤(8)。 (8)如果故障仍然未能排除，请收集如下信息，并联系技术支持人员。 上述步骤的执行结果。 设备的配置文件、日志信息、告警信息。 5.告警与日志相关告警无 相关日志无 11.4二层组播故障处理 11.4.1二层组播业务不通 ,Suggestion not provided
